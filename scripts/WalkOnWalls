repeat wait()a=pcall(function()((game:WaitForChild("\080\108\097\121\101\114\115")).LocalPlayer:WaitForChild("\080\108\097\121\101\114\083\099\114\105\112\116\115")).ChildAdded:Connect(function(K)if K.Name=="\080\108\097\121\101\114\083\099\114\105\112\116\115\076\111\097\100\101\114"then K.Disabled=true end end)end)if a==true then break end until false;((game:WaitForChild("\080\108\097\121\101\114\115")).LocalPlayer:WaitForChild("\080\108\097\121\101\114\083\099\114\105\112\116\115")).ChildAdded:Connect(function(K)if K.Name=="\080\108\097\121\101\114\083\099\114\105\112\116\115\076\111\097\100\101\114"then K.Disabled=true end end)function _CameraUI()local K=game:GetService("\080\108\097\121\101\114\115")local d=game:GetService("\084\119\101\101\110\083\101\114\118\105\099\101")local M=K.LocalPlayer if not M then(K:GetPropertyChangedSignal("\076\111\099\097\108\080\108\097\121\101\114")):Wait()M=K.LocalPlayer end local function A(K,d)local M=K:FindFirstChildOfClass(d)while not M or M.ClassName~=d do M=K.ChildAdded:Wait()end return M end local U=A(M,"\080\108\097\121\101\114\071\117\105")local j=UDim2.new(0,326,0,58)local O=UDim2.new(0,80,0,58)local P=Color3.fromRGB(32,32,32)local q=.4 local N=Color3.fromRGB(200,200,200)local G=0 local function c(K)return function(d)local M=Instance.new(K)local A=d.Parent d.Parent=nil for K,d in pairs(d)do if type(K)=="\115\116\114\105\110\103"then M[K]=d else d.Parent=M end end M.Parent=A return M end end local H=false local m local b local p local t local L local function S()assert(not H)m=(c("\083\099\114\101\101\110\071\117\105"))({Name="\082\098\120\067\097\109\101\114\097\085\073";AutoLocalize=false;Enabled=true;DisplayOrder=-1,IgnoreGuiInset=false;ResetOnSpawn=false;ZIndexBehavior=Enum.ZIndexBehavior.Sibling;(c("\073\109\097\103\101\076\097\098\101\108"))({Name="\084\111\097\115\116";Visible=false,AnchorPoint=Vector2.new(.5,0),BackgroundTransparency=1;BorderSizePixel=0;Position=UDim2.new(.5,0,0,8);Size=O,Image="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\117\105\047\067\097\109\101\114\097\047\067\097\109\101\114\097\084\111\097\115\116\057\083\108\105\099\101\046\112\110\103";ImageColor3=P;ImageRectSize=Vector2.new(6,6);ImageTransparency=1;ScaleType=Enum.ScaleType.Slice;SliceCenter=Rect.new(3,3,3,3);ClipsDescendants=true,(c("\070\114\097\109\101"))({Name="\073\099\111\110\066\117\102\102\101\114",BackgroundTransparency=1,BorderSizePixel=0,Position=UDim2.new(0,0,0,0);Size=UDim2.new(0,80,1,0),(c("\073\109\097\103\101\076\097\098\101\108"))({Name="\073\099\111\110",AnchorPoint=Vector2.new(.5,.5);BackgroundTransparency=1,Position=UDim2.new(.5,0,.5,0),Size=UDim2.new(0,48,0,48),ZIndex=2,Image="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\117\105\047\067\097\109\101\114\097\047\067\097\109\101\114\097\084\111\097\115\116\073\099\111\110\046\112\110\103";ImageColor3=N,ImageTransparency=1})});(c("\070\114\097\109\101"))({Name="\084\101\120\116\066\117\102\102\101\114",BackgroundTransparency=1,BorderSizePixel=0,Position=UDim2.new(0,80,0,0),Size=UDim2.new(1,-80,1,0);ClipsDescendants=true;(c("\084\101\120\116\076\097\098\101\108"))({Name="\085\112\112\101\114";AnchorPoint=Vector2.new(0,1),BackgroundTransparency=1,Position=UDim2.new(0,0,.5,0),Size=UDim2.new(1,0,0,19);Font=Enum.Font.GothamSemibold;Text="\067\097\109\101\114\097 \099\111\110\116\114\111\108 \101\110\097\098\108\101\100";TextColor3=N;TextTransparency=1;TextSize=19;TextXAlignment=Enum.TextXAlignment.Left;TextYAlignment=Enum.TextYAlignment.Center}),(c("\084\101\120\116\076\097\098\101\108"))({Name="\076\111\119\101\114",AnchorPoint=Vector2.new(0,0),BackgroundTransparency=1,Position=UDim2.new(0,0,.5,3),Size=UDim2.new(1,0,0,15);Font=Enum.Font.Gotham;Text="\082\105\103\104\116 \109\111\117\115\101 \098\117\116\116\111\110 \116\111 \116\111\103\103\108\101";TextColor3=N,TextTransparency=1;TextSize=15,TextXAlignment=Enum.TextXAlignment.Left,TextYAlignment=Enum.TextYAlignment.Center})})}),Parent=U})b=m.Toast p=b.IconBuffer.Icon t=b.TextBuffer.Upper L=b.TextBuffer.Lower H=true end local Z={}do function Z.setCameraModeToastEnabled(K)if not K and not H then return end if not H then S()end b.Visible=K if not K then Z.setCameraModeToastOpen(false)end end local K=TweenInfo.new(.25,Enum.EasingStyle.Quad,Enum.EasingDirection.Out)function Z.setCameraModeToastOpen(M)assert(H);(d:Create(b,K,{Size=M and j or O;ImageTransparency=M and q or 1})):Play();(d:Create(p,K,{ImageTransparency=M and G or 1})):Play();(d:Create(t,K,{TextTransparency=M and G or 1})):Play();(d:Create(L,K,{TextTransparency=M and G or 1})):Play()end end return Z end function _CameraToggleStateController()local K=game:GetService("\080\108\097\121\101\114\115")local d=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local M=(UserSettings()):GetService("\085\115\101\114\071\097\109\101\083\101\116\116\105\110\103\115")local A=K.LocalPlayer if not A then(K:GetPropertyChangedSignal("\076\111\099\097\108\080\108\097\121\101\114")):Wait()A=K.LocalPlayer end local U=A:GetMouse()local j=_CameraInput()local O=_CameraUI()local P=false local q=tick()local N="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\067\117\114\115\111\114\115\047\067\114\111\115\115\077\111\117\115\101\073\099\111\110\046\112\110\103"local G=false local c=false local H=false O.setCameraModeToastEnabled(false)return function(K)local A=j.getTogglePan()local m=3 if K and A~=P then G=true end if P~=A or tick()-q>m then local K=A and tick()-q<m O.setCameraModeToastOpen(K)if A then G=false end q=tick()P=A end if K~=H then if K then c=j.getTogglePan()j.setTogglePan(true)elseif not G then j.setTogglePan(c)end end if K then if j.getTogglePan()then U.Icon=N d.MouseBehavior=Enum.MouseBehavior.LockCenter else U.Icon=""d.MouseBehavior=Enum.MouseBehavior.Default end elseif j.getTogglePan()then U.Icon=N d.MouseBehavior=Enum.MouseBehavior.LockCenter M.RotationType=Enum.RotationType.MovementRelative elseif j.getHoldPan()then U.Icon=""d.MouseBehavior=Enum.MouseBehavior.LockCurrentPosition M.RotationType=Enum.RotationType.MovementRelative else U.Icon=""d.MouseBehavior=Enum.MouseBehavior.Default M.RotationType=Enum.RotationType.MovementRelative end H=K end end function _CameraInput()local K=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local d=.3 local M,A do local d=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116")local U=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116")M=d.Event A=U.Event K.InputBegan:Connect(function(K,M)if not M and K.UserInputType==Enum.UserInputType.MouseButton2 then d:Fire()end end)K.InputEnded:Connect(function(K,d)if K.UserInputType==Enum.UserInputType.MouseButton2 then U:Fire()end end)end local U=false local j=false local O=0 local P={}function P.getHoldPan()return U end function P.getTogglePan()return j end function P.getPanning()return j or U end function P.setTogglePan(K)j=K end local q=false local N local G function P.enableCameraToggleInput()if q then return end q=true U=false j=false if N then N:Disconnect()end if G then G:Disconnect()end N=M:Connect(function()U=true O=tick()end)G=A:Connect(function()U=false if tick()-O<d and(j or(K:GetMouseDelta()).Magnitude<2)then j=not j end end)end function P.disableCameraToggleInput()if not q then return end q=false if N then N:Disconnect()N=nil end if G then G:Disconnect()G=nil end end return P end function _BaseCamera()local K=Vector3.new(0,0,1)local d=Vector3.new(1,0,1)local M=.2 local A=12.5 local U=25 local j=1 local O=Enum.ContextActionPriority.Default.Value local P=math.rad(-80)local q=math.rad(80)local N=math.rad(30)local G=math.rad(-15)local c=2.1 local H=.5 local m=math.rad(15)local b=Vector2.new(math.rad(15),0)local p=Vector2.new(math.rad(45),0)local t=.1 local L=.4 local S=Vector2.new(0,0)local Z=Vector3.new(0,0,0)local T=Vector2.new(.00945*math.pi,.003375*math.pi)local B=Vector2.new(.002*math.pi,.0015*math.pi)local l=Vector3.new(0,5,0)local e=Vector3.new(0,4,0)local V=Vector3.new(0,1.5,0)local a=Vector3.new(0,1.5,0)local o=Vector3.new(0,2,0)local Q=Vector3.new(2,2,1)local k=0 local s=10 local E=20 local x=20 local F=.5 local I=math.abs local D=math.sign local w do local K,d=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\067\097\109\101\114\097\084\111\103\103\108\101")end)w=K and d end local v do local K,d=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\068\111\110\116\065\100\106\117\115\116\083\101\110\115\105\116\118\105\116\121\070\111\114\080\111\114\116\114\097\105\116")end)v=K and d end local z do local K,d=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\070\105\120\090\111\111\109\073\110\090\111\111\109\079\117\116\068\105\115\099\114\101\112\097\110\099\121")end)z=K and d end local f=_CameraUtils()local g=_ZoomController()local X=_CameraToggleStateController()local h=_CameraInput()local r=_CameraUI()local i=game:GetService("\080\108\097\121\101\114\115")local Y=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local J=game:GetService("\083\116\097\114\116\101\114\071\117\105")local u=game:GetService("\071\117\105\083\101\114\118\105\099\101")local C=game:GetService("\067\111\110\116\101\120\116\065\099\116\105\111\110\083\101\114\118\105\099\101")local W=game:GetService("\086\082\083\101\114\118\105\099\101")local y=(UserSettings()):GetService("\085\115\101\114\071\097\109\101\083\101\116\116\105\110\103\115")local R=i.LocalPlayer local n={}n.__index=n function n.new()local K=setmetatable({},n)K.FIRST_PERSON_DISTANCE_THRESHOLD=j K.cameraType=nil K.cameraMovementMode=nil K.lastCameraTransform=nil K.rotateInput=S K.userPanningCamera=false K.lastUserPanCamera=tick()K.humanoidRootPart=nil K.humanoidCache={}K.lastSubject=nil K.lastSubjectPosition=Vector3.new(0,5,0)K.defaultSubjectDistance=math.clamp(A,R.CameraMinZoomDistance,R.CameraMaxZoomDistance)K.currentSubjectDistance=math.clamp(A,R.CameraMinZoomDistance,R.CameraMaxZoomDistance)K.inFirstPerson=false K.inMouseLockedMode=false K.portraitMode=false K.isSmallTouchScreen=false K.resetCameraAngle=true K.enabled=false K.inputBeganConn=nil K.inputChangedConn=nil K.inputEndedConn=nil K.startPos=nil K.lastPos=nil K.panBeginLook=nil K.panEnabled=true K.keyPanEnabled=true K.distanceChangeEnabled=true K.PlayerGui=nil K.cameraChangedConn=nil K.viewportSizeChangedConn=nil K.boundContextActions={}K.shouldUseVRRotation=false K.VRRotationIntensityAvailable=false K.lastVRRotationIntensityCheckTime=0 K.lastVRRotationTime=0 K.vrRotateKeyCooldown={}K.cameraTranslationConstraints=Vector3.new(1,1,1)K.humanoidJumpOrigin=nil K.trackingHumanoid=nil K.cameraFrozen=false K.subjectStateChangedConn=nil K.activeGamepad=nil K.gamepadPanningCamera=false K.lastThumbstickRotate=nil K.numOfSeconds=.7 K.currentSpeed=0 K.maxSpeed=6 K.vrMaxSpeed=4 K.lastThumbstickPos=Vector2.new(0,0)K.ySensitivity=.65 K.lastVelocity=nil K.gamepadConnectedConn=nil K.gamepadDisconnectedConn=nil K.currentZoomSpeed=1 K.L3ButtonDown=false K.dpadLeftDown=false K.dpadRightDown=false K.isDynamicThumbstickEnabled=false K.fingerTouches={}K.dynamicTouchInput=nil K.numUnsunkTouches=0 K.inputStartPositions={}K.inputStartTimes={}K.startingDiff=nil K.pinchBeginZoom=nil K.userPanningTheCamera=false K.touchActivateConn=nil K.mouseLockOffset=Z if R.Character then K:OnCharacterAdded(R.Character)end R.CharacterAdded:Connect(function(d)K:OnCharacterAdded(d)end)if K.cameraChangedConn then K.cameraChangedConn:Disconnect()end K.cameraChangedConn=(workspace:GetPropertyChangedSignal("\067\117\114\114\101\110\116\067\097\109\101\114\097")):Connect(function()K:OnCurrentCameraChanged()end)K:OnCurrentCameraChanged()if K.playerCameraModeChangeConn then K.playerCameraModeChangeConn:Disconnect()end K.playerCameraModeChangeConn=(R:GetPropertyChangedSignal("\067\097\109\101\114\097\077\111\100\101")):Connect(function()K:OnPlayerCameraPropertyChange()end)if K.minDistanceChangeConn then K.minDistanceChangeConn:Disconnect()end K.minDistanceChangeConn=(R:GetPropertyChangedSignal("\067\097\109\101\114\097\077\105\110\090\111\111\109\068\105\115\116\097\110\099\101")):Connect(function()K:OnPlayerCameraPropertyChange()end)if K.maxDistanceChangeConn then K.maxDistanceChangeConn:Disconnect()end K.maxDistanceChangeConn=(R:GetPropertyChangedSignal("\067\097\109\101\114\097\077\097\120\090\111\111\109\068\105\115\116\097\110\099\101")):Connect(function()K:OnPlayerCameraPropertyChange()end)if K.playerDevTouchMoveModeChangeConn then K.playerDevTouchMoveModeChangeConn:Disconnect()end K.playerDevTouchMoveModeChangeConn=(R:GetPropertyChangedSignal("\068\101\118\084\111\117\099\104\077\111\118\101\109\101\110\116\077\111\100\101")):Connect(function()K:OnDevTouchMovementModeChanged()end)K:OnDevTouchMovementModeChanged()if K.gameSettingsTouchMoveMoveChangeConn then K.gameSettingsTouchMoveMoveChangeConn:Disconnect()end K.gameSettingsTouchMoveMoveChangeConn=(y:GetPropertyChangedSignal("\084\111\117\099\104\077\111\118\101\109\101\110\116\077\111\100\101")):Connect(function()K:OnGameSettingsTouchMovementModeChanged()end)K:OnGameSettingsTouchMovementModeChanged()y:SetCameraYInvertVisible()y:SetGamepadCameraSensitivityVisible()K.hasGameLoaded=game:IsLoaded()if not K.hasGameLoaded then K.gameLoadedConn=game.Loaded:Connect(function()K.hasGameLoaded=true K.gameLoadedConn:Disconnect()K.gameLoadedConn=nil end)end K:OnPlayerCameraPropertyChange()return K end function n.GetModuleName(K)return"\066\097\115\101\067\097\109\101\114\097"end function n.OnCharacterAdded(d,K)d.resetCameraAngle=d.resetCameraAngle or d:GetEnabled()d.humanoidRootPart=nil if Y.TouchEnabled then d.PlayerGui=R:WaitForChild("\080\108\097\121\101\114\071\117\105")for K,M in ipairs(K:GetChildren())do if M:IsA("\084\111\111\108")then d.isAToolEquipped=true end end K.ChildAdded:Connect(function(K)if K:IsA("\084\111\111\108")then d.isAToolEquipped=true end end)K.ChildRemoved:Connect(function(K)if K:IsA("\084\111\111\108")then d.isAToolEquipped=false end end)end end function n.GetHumanoidRootPart(K)if not K.humanoidRootPart then if R.Character then local d=R.Character:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")if d then K.humanoidRootPart=d.RootPart end end end return K.humanoidRootPart end function n.GetBodyPartToFollow(M,K,d)if K:GetState()==Enum.HumanoidStateType.Dead then local d=K.Parent if d and d:IsA("\077\111\100\101\108")then return d:FindFirstChild("\072\101\097\100")or K.RootPart end end return K.RootPart end function n.GetSubjectPosition(K)local d=K.lastSubjectPosition local M=game.Workspace.CurrentCamera local A=M and M.CameraSubject if A then if A:IsA("\072\117\109\097\110\111\105\100")then local M=A local U=M:GetState()==Enum.HumanoidStateType.Dead if W.VREnabled and(U and M==K.lastSubject)then d=K.lastSubjectPosition else local K=M.RootPart if U then if M.Parent and M.Parent:IsA("\077\111\100\101\108")then K=M.Parent:FindFirstChild("\072\101\097\100")or K end end if K and K:IsA("\066\097\115\101\080\097\114\116")then local A if M.RigType==Enum.HumanoidRigType.R15 then if M.AutomaticScalingEnabled then A=a if K==M.RootPart then local K=M.RootPart.Size.Y/2-Q.Y/2 A=A+Vector3.new(0,K,0)end else A=o end else A=V end if U then A=Z end d=K.CFrame.p+K.CFrame:vectorToWorldSpace(A+M.CameraOffset)end end elseif A:IsA("\086\101\104\105\099\108\101\083\101\097\116")then local K=l if W.VREnabled then K=e end d=A.CFrame.p+A.CFrame:vectorToWorldSpace(K)elseif A:IsA("\083\107\097\116\101\098\111\097\114\100\080\108\097\116\102\111\114\109")then d=A.CFrame.p+l elseif A:IsA("\066\097\115\101\080\097\114\116")then d=A.CFrame.p elseif A:IsA("\077\111\100\101\108")then if A.PrimaryPart then d=(A:GetPrimaryPartCFrame()).p else d=(A:GetModelCFrame()).p end end else return end K.lastSubject=A K.lastSubjectPosition=d return d end function n.UpdateDefaultSubjectDistance(K)if K.portraitMode then K.defaultSubjectDistance=math.clamp(U,R.CameraMinZoomDistance,R.CameraMaxZoomDistance)else K.defaultSubjectDistance=math.clamp(A,R.CameraMinZoomDistance,R.CameraMaxZoomDistance)end end function n.OnViewportSizeChanged(K)local d=game.Workspace.CurrentCamera local M=d.ViewportSize K.portraitMode=M.X<M.Y K.isSmallTouchScreen=Y.TouchEnabled and(M.Y<500 or M.X<700)K:UpdateDefaultSubjectDistance()end function n.OnCurrentCameraChanged(K)if Y.TouchEnabled then if K.viewportSizeChangedConn then K.viewportSizeChangedConn:Disconnect()K.viewportSizeChangedConn=nil end local d=game.Workspace.CurrentCamera if d then K:OnViewportSizeChanged()K.viewportSizeChangedConn=(d:GetPropertyChangedSignal("\086\105\101\119\112\111\114\116\083\105\122\101")):Connect(function()K:OnViewportSizeChanged()end)end end if K.cameraSubjectChangedConn then K.cameraSubjectChangedConn:Disconnect()K.cameraSubjectChangedConn=nil end local d=game.Workspace.CurrentCamera if d then K.cameraSubjectChangedConn=(d:GetPropertyChangedSignal("\067\097\109\101\114\097\083\117\098\106\101\099\116")):Connect(function()K:OnNewCameraSubject()end)K:OnNewCameraSubject()end end function n.OnDynamicThumbstickEnabled(K)if Y.TouchEnabled then K.isDynamicThumbstickEnabled=true end end function n.OnDynamicThumbstickDisabled(K)K.isDynamicThumbstickEnabled=false end function n.OnGameSettingsTouchMovementModeChanged(K)if R.DevTouchMovementMode==Enum.DevTouchMovementMode.UserChoice then if y.TouchMovementMode==Enum.TouchMovementMode.DynamicThumbstick or y.TouchMovementMode==Enum.TouchMovementMode.Default then K:OnDynamicThumbstickEnabled()else K:OnDynamicThumbstickDisabled()end end end function n.OnDevTouchMovementModeChanged(K)if R.DevTouchMovementMode.Name=="\068\121\110\097\109\105\099\084\104\117\109\098\115\116\105\099\107"then K:OnDynamicThumbstickEnabled()else K:OnGameSettingsTouchMovementModeChanged()end end function n.OnPlayerCameraPropertyChange(K)K:SetCameraToSubjectDistance(K.currentSubjectDistance)end function n.GetCameraHeight(K)if W.VREnabled and not K.inFirstPerson then return math.sin(m)*K.currentSubjectDistance end return 0 end function n.InputTranslationToCameraAngleChange(M,K,d)if not v then local M=game.Workspace.CurrentCamera if M and(M.ViewportSize.X>0 and(M.ViewportSize.Y>0 and M.ViewportSize.Y>M.ViewportSize.X))then return K*Vector2.new(d.Y,d.X)end end return K*d end function n.Enable(d,K)if d.enabled~=K then d.enabled=K if d.enabled then d:ConnectInputEvents()d:BindContextActions()if R.CameraMode==Enum.CameraMode.LockFirstPerson then d.currentSubjectDistance=.5 if not d.inFirstPerson then d:EnterFirstPerson()end end else d:DisconnectInputEvents()d:UnbindContextActions()d:Cleanup()end end end function n.GetEnabled(K)return K.enabled end function n.OnInputBegan(M,K,d)if K.UserInputType==Enum.UserInputType.Touch then M:OnTouchBegan(K,d)elseif K.UserInputType==Enum.UserInputType.MouseButton2 then M:OnMouse2Down(K,d)elseif K.UserInputType==Enum.UserInputType.MouseButton3 then M:OnMouse3Down(K,d)end end function n.OnInputChanged(M,K,d)if K.UserInputType==Enum.UserInputType.Touch then M:OnTouchChanged(K,d)elseif K.UserInputType==Enum.UserInputType.MouseMovement then M:OnMouseMoved(K,d)end end function n.OnInputEnded(M,K,d)if K.UserInputType==Enum.UserInputType.Touch then M:OnTouchEnded(K,d)elseif K.UserInputType==Enum.UserInputType.MouseButton2 then M:OnMouse2Up(K,d)elseif K.UserInputType==Enum.UserInputType.MouseButton3 then M:OnMouse3Up(K,d)end end function n.OnPointerAction(U,K,d,M,A)if A then return end if d.Magnitude>0 then local K=Vector2.new(1,y:GetCameraYInvertValue())local M=U:InputTranslationToCameraAngleChange(x*d,B)*K U.rotateInput=U.rotateInput+M end local O=U.currentSubjectDistance local P=-(K+M)if I(P)>0 then local K if U.inFirstPerson and P>0 then K=j else if z then if P>0 then K=O+P*(1+O*F)else K=(O+P)/(1-P*F)end else K=O+P*(1+O*F)end end U:SetCameraToSubjectDistance(K)end end function n.ConnectInputEvents(K)K.pointerActionConn=Y.PointerAction:Connect(function(d,M,A,U)K:OnPointerAction(d,M,A,U)end)K.inputBeganConn=Y.InputBegan:Connect(function(d,M)K:OnInputBegan(d,M)end)K.inputChangedConn=Y.InputChanged:Connect(function(d,M)K:OnInputChanged(d,M)end)K.inputEndedConn=Y.InputEnded:Connect(function(d,M)K:OnInputEnded(d,M)end)K.menuOpenedConn=u.MenuOpened:connect(function()K:ResetInputStates()end)K.gamepadConnectedConn=Y.GamepadDisconnected:connect(function(d)if K.activeGamepad~=d then return end K.activeGamepad=nil K:AssignActivateGamepad()end)K.gamepadDisconnectedConn=Y.GamepadConnected:connect(function(d)if K.activeGamepad==nil then K:AssignActivateGamepad()end end)K:AssignActivateGamepad()if not w then K:UpdateMouseBehavior()end end function n.BindContextActions(K)K:BindGamepadInputActions()K:BindKeyboardInputActions()end function n.AssignActivateGamepad(K)local d=Y:GetConnectedGamepads()if#d>0 then for M=1,#d,1 do if K.activeGamepad==nil then K.activeGamepad=d[M]elseif d[M].Value<K.activeGamepad.Value then K.activeGamepad=d[M]end end end if K.activeGamepad==nil then K.activeGamepad=Enum.UserInputType.Gamepad1 end end function n.DisconnectInputEvents(K)if K.inputBeganConn then K.inputBeganConn:Disconnect()K.inputBeganConn=nil end if K.inputChangedConn then K.inputChangedConn:Disconnect()K.inputChangedConn=nil end if K.inputEndedConn then K.inputEndedConn:Disconnect()K.inputEndedConn=nil end end function n.UnbindContextActions(K)for d=1,#K.boundContextActions,1 do C:UnbindAction(K.boundContextActions[d])end K.boundContextActions={}end function n.Cleanup(K)if K.pointerActionConn then K.pointerActionConn:Disconnect()K.pointerActionConn=nil end if K.menuOpenedConn then K.menuOpenedConn:Disconnect()K.menuOpenedConn=nil end if K.mouseLockToggleConn then K.mouseLockToggleConn:Disconnect()K.mouseLockToggleConn=nil end if K.gamepadConnectedConn then K.gamepadConnectedConn:Disconnect()K.gamepadConnectedConn=nil end if K.gamepadDisconnectedConn then K.gamepadDisconnectedConn:Disconnect()K.gamepadDisconnectedConn=nil end if K.subjectStateChangedConn then K.subjectStateChangedConn:Disconnect()K.subjectStateChangedConn=nil end if K.viewportSizeChangedConn then K.viewportSizeChangedConn:Disconnect()K.viewportSizeChangedConn=nil end if K.touchActivateConn then K.touchActivateConn:Disconnect()K.touchActivateConn=nil end K.turningLeft=false K.turningRight=false K.lastCameraTransform=nil K.lastSubjectCFrame=nil K.userPanningTheCamera=false K.rotateInput=Vector2.new()K.gamepadPanningCamera=Vector2.new(0,0)K.startPos=nil K.lastPos=nil K.panBeginLook=nil K.isRightMouseDown=false K.isMiddleMouseDown=false K.fingerTouches={}K.dynamicTouchInput=nil K.numUnsunkTouches=0 K.startingDiff=nil K.pinchBeginZoom=nil if Y.MouseBehavior~=Enum.MouseBehavior.LockCenter then Y.MouseBehavior=Enum.MouseBehavior.Default end end function n.ResetInputStates(K)K.isRightMouseDown=false K.isMiddleMouseDown=false K:OnMousePanButtonReleased()if Y.TouchEnabled then for d in pairs(K.fingerTouches)do K.fingerTouches[d]=nil end K.dynamicTouchInput=nil K.panBeginLook=nil K.startPos=nil K.lastPos=nil K.userPanningTheCamera=false K.startingDiff=nil K.pinchBeginZoom=nil K.numUnsunkTouches=0 end end function n.GetGamepadPan(U,K,d,A)if A.UserInputType==U.activeGamepad and A.KeyCode==Enum.KeyCode.Thumbstick2 then if d==Enum.UserInputState.Cancel then U.gamepadPanningCamera=S return end local K=Vector2.new(A.Position.X,-A.Position.Y)if K.magnitude>M then U.gamepadPanningCamera=Vector2.new(A.Position.X,-A.Position.Y)else U.gamepadPanningCamera=S end return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end function n.DoKeyboardPanTurn(A,K,d,M)if not A.hasGameLoaded and W.VREnabled then return Enum.ContextActionResult.Pass end if d==Enum.UserInputState.Cancel then A.turningLeft=false A.turningRight=false return Enum.ContextActionResult.Sink end if A.panBeginLook==nil and A.keyPanEnabled then if M.KeyCode==Enum.KeyCode.Left then A.turningLeft=d==Enum.UserInputState.Begin elseif M.KeyCode==Enum.KeyCode.Right then A.turningRight=d==Enum.UserInputState.Begin end return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end function n.DoPanRotateCamera(d,K)local M=f.RotateVectorByAngleAndRound(d:GetCameraLookVector()*Vector3.new(1,0,1),K,math.pi*.25)if M~=0 then d.rotateInput=d.rotateInput+Vector2.new(M,0)d.lastUserPanCamera=tick()d.lastCameraTransform=nil end end function n.DoGamepadZoom(A,K,d,M)if M.UserInputType==A.activeGamepad then if M.KeyCode==Enum.KeyCode.ButtonR3 then if d==Enum.UserInputState.Begin then if A.distanceChangeEnabled then local K=A:GetCameraToSubjectDistance()if K>(s+E)/2 then A:SetCameraToSubjectDistance(s)elseif K>(k+s)/2 then A:SetCameraToSubjectDistance(k)else A:SetCameraToSubjectDistance(E)end end end elseif M.KeyCode==Enum.KeyCode.DPadLeft then A.dpadLeftDown=d==Enum.UserInputState.Begin elseif M.KeyCode==Enum.KeyCode.DPadRight then A.dpadRightDown=d==Enum.UserInputState.Begin end if A.dpadLeftDown then A.currentZoomSpeed=1.04 elseif A.dpadRightDown then A.currentZoomSpeed=.96 else A.currentZoomSpeed=1 end return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end function n.DoKeyboardZoom(A,K,d,M)if not A.hasGameLoaded and W.VREnabled then return Enum.ContextActionResult.Pass end if d~=Enum.UserInputState.Begin then return Enum.ContextActionResult.Pass end if A.distanceChangeEnabled and R.CameraMode~=Enum.CameraMode.LockFirstPerson then if M.KeyCode==Enum.KeyCode.I then A:SetCameraToSubjectDistance(A.currentSubjectDistance-5)elseif M.KeyCode==Enum.KeyCode.O then A:SetCameraToSubjectDistance(A.currentSubjectDistance+5)end return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end function n.BindAction(A,K,d,M,...)table.insert(A.boundContextActions,K)C:BindActionAtPriority(K,d,M,O,...)end function n.BindGamepadInputActions(K)K:BindAction("\066\097\115\101\067\097\109\101\114\097\071\097\109\101\112\097\100\080\097\110",function(d,M,A)return K:GetGamepadPan(d,M,A)end,false,Enum.KeyCode.Thumbstick2)K:BindAction("\066\097\115\101\067\097\109\101\114\097\071\097\109\101\112\097\100\090\111\111\109",function(d,M,A)return K:DoGamepadZoom(d,M,A)end,false,Enum.KeyCode.DPadLeft,Enum.KeyCode.DPadRight,Enum.KeyCode.ButtonR3)end function n.BindKeyboardInputActions(K)K:BindAction("\066\097\115\101\067\097\109\101\114\097\075\101\121\098\111\097\114\100\080\097\110\065\114\114\111\119\075\101\121\115",function(d,M,A)return K:DoKeyboardPanTurn(d,M,A)end,false,Enum.KeyCode.Left,Enum.KeyCode.Right)K:BindAction("\066\097\115\101\067\097\109\101\114\097\075\101\121\098\111\097\114\100\090\111\111\109",function(d,M,A)return K:DoKeyboardZoom(d,M,A)end,false,Enum.KeyCode.I,Enum.KeyCode.O)end local function Kp(K)local d=R:FindFirstChildOfClass("\080\108\097\121\101\114\071\117\105")local M=d and d:FindFirstChild("\084\111\117\099\104\071\117\105")local A=M and M:FindFirstChild("\084\111\117\099\104\067\111\110\116\114\111\108\070\114\097\109\101")local U=A and A:FindFirstChild("\068\121\110\097\109\105\099\084\104\117\109\098\115\116\105\099\107\070\114\097\109\101")if not U then return false end local j=U.AbsolutePosition local O=j+U.AbsoluteSize if K.Position.X>=j.X and K.Position.Y>=j.Y then if K.Position.X<=O.X and K.Position.Y<=O.Y then return true end end return false end function n.AdjustTouchSensitivity(M,K,d)local A=game.Workspace.CurrentCamera and game.Workspace.CurrentCamera.CFrame if not A then return d end local U=A:ToEulerAnglesYXZ()local j=c if U>N and K.Y<0 then local K=(U-N)/(q-N)K=1-(1-K)^3 j=c-K*(c-H)elseif U<G and K.Y>0 then local K=(U-G)/(P-G)K=1-(1-K)^3 j=c-K*(c-H)end return Vector2.new(d.X,d.Y*j)end function n.OnTouchBegan(M,K,d)local A=M.isDynamicThumbstickEnabled and not d if A then if M.dynamicTouchInput==nil and Kp(K)then M.dynamicTouchInput=K return end M.fingerTouches[K]=d M.inputStartPositions[K]=K.Position M.inputStartTimes[K]=tick()M.numUnsunkTouches=M.numUnsunkTouches+1 end end function n.OnTouchChanged(M,K,d)if M.fingerTouches[K]==nil then if M.isDynamicThumbstickEnabled then return end M.fingerTouches[K]=d if not d then M.numUnsunkTouches=M.numUnsunkTouches+1 end end if M.numUnsunkTouches==1 then if M.fingerTouches[K]==false then M.panBeginLook=M.panBeginLook or M:GetCameraLookVector()M.startPos=M.startPos or K.Position M.lastPos=M.lastPos or M.startPos M.userPanningTheCamera=true local d=K.Position-M.lastPos d=Vector2.new(d.X,d.Y*y:GetCameraYInvertValue())if M.panEnabled then local K=T M:AdjustTouchSensitivity(d,T)local A=M:InputTranslationToCameraAngleChange(d,K)M.rotateInput=M.rotateInput+A end M.lastPos=K.Position end else M.panBeginLook=nil M.startPos=nil M.lastPos=nil M.userPanningTheCamera=false end if M.numUnsunkTouches==2 then local K={}for d,M in pairs(M.fingerTouches)do if not M then table.insert(K,d)end end if#K==2 then local d=(K[1].Position-K[2].Position).magnitude if M.startingDiff and M.pinchBeginZoom then local K=d/math.max(.01,M.startingDiff)local A=math.clamp(K,.1,10)if M.distanceChangeEnabled then M:SetCameraToSubjectDistance(M.pinchBeginZoom/A)end else M.startingDiff=d M.pinchBeginZoom=M:GetCameraToSubjectDistance()end end else M.startingDiff=nil M.pinchBeginZoom=nil end end function n.OnTouchEnded(M,K,d)if K==M.dynamicTouchInput then M.dynamicTouchInput=nil return end if M.fingerTouches[K]==false then if M.numUnsunkTouches==1 then M.panBeginLook=nil M.startPos=nil M.lastPos=nil M.userPanningTheCamera=false elseif M.numUnsunkTouches==2 then M.startingDiff=nil M.pinchBeginZoom=nil end end if M.fingerTouches[K]~=nil and M.fingerTouches[K]==false then M.numUnsunkTouches=M.numUnsunkTouches-1 end M.fingerTouches[K]=nil M.inputStartPositions[K]=nil M.inputStartTimes[K]=nil end function n.OnMouse2Down(M,K,d)if d then return end M.isRightMouseDown=true M:OnMousePanButtonPressed(K,d)end function n.OnMouse2Up(M,K,d)M.isRightMouseDown=false M:OnMousePanButtonReleased(K,d)end function n.OnMouse3Down(M,K,d)if d then return end M.isMiddleMouseDown=true M:OnMousePanButtonPressed(K,d)end function n.OnMouse3Up(M,K,d)M.isMiddleMouseDown=false M:OnMousePanButtonReleased(K,d)end function n.OnMouseMoved(M,K,d)if not M.hasGameLoaded and W.VREnabled then return end local A=K.Delta A=Vector2.new(A.X,A.Y*y:GetCameraYInvertValue())local U=w and h.getPanning()local j=M.startPos and(M.lastPos and M.panBeginLook)local O=j or M.inFirstPerson or M.inMouseLockedMode or U if M.panEnabled and O then local K=M:InputTranslationToCameraAngleChange(A,B)M.rotateInput=M.rotateInput+K end if M.startPos and(M.lastPos and M.panBeginLook)then M.lastPos=M.lastPos+K.Delta end end function n.OnMousePanButtonPressed(M,K,d)if d then return end if not w then M:UpdateMouseBehavior()end M.panBeginLook=M.panBeginLook or M:GetCameraLookVector()M.startPos=M.startPos or K.Position M.lastPos=M.lastPos or M.startPos M.userPanningTheCamera=true end function n.OnMousePanButtonReleased(M,K,d)if not w then M:UpdateMouseBehavior()end if not(M.isRightMouseDown or M.isMiddleMouseDown)then M.panBeginLook=nil M.startPos=nil M.lastPos=nil M.userPanningTheCamera=false end end function n.UpdateMouseBehavior(K)if w and K.isCameraToggle then r.setCameraModeToastEnabled(true)h.enableCameraToggleInput()X(K.inFirstPerson)else if w then r.setCameraModeToastEnabled(false)h.disableCameraToggleInput()end if K.inFirstPerson or K.inMouseLockedMode then Y.MouseBehavior=Enum.MouseBehavior.LockCenter else y.RotationType=Enum.RotationType.MovementRelative if K.isRightMouseDown or K.isMiddleMouseDown then Y.MouseBehavior=Enum.MouseBehavior.LockCurrentPosition else Y.MouseBehavior=Enum.MouseBehavior.Default end end end end function n.UpdateForDistancePropertyChange(K)K:SetCameraToSubjectDistance(K.currentSubjectDistance)end function n.SetCameraToSubjectDistance(d,K)local M=d.currentSubjectDistance if R.CameraMode==Enum.CameraMode.LockFirstPerson then d.currentSubjectDistance=.5 if not d.inFirstPerson then d:EnterFirstPerson()end else local M=math.clamp(K,R.CameraMinZoomDistance,R.CameraMaxZoomDistance)if M<j then d.currentSubjectDistance=.5 if not d.inFirstPerson then d:EnterFirstPerson()end else d.currentSubjectDistance=M if d.inFirstPerson then d:LeaveFirstPerson()end end end g.SetZoomParameters(d.currentSubjectDistance,math.sign(K-M))return d.currentSubjectDistance end function n.SetCameraType(d,K)d.cameraType=K end function n.GetCameraType(K)return K.cameraType end function n.SetCameraMovementMode(d,K)d.cameraMovementMode=K end function n.GetCameraMovementMode(K)return K.cameraMovementMode end function n.SetIsMouseLocked(d,K)d.inMouseLockedMode=K if not w then d:UpdateMouseBehavior()end end function n.GetIsMouseLocked(K)return K.inMouseLockedMode end function n.SetMouseLockOffset(d,K)d.mouseLockOffset=K end function n.GetMouseLockOffset(K)return K.mouseLockOffset end function n.InFirstPerson(K)return K.inFirstPerson end function n.EnterFirstPerson(K) end function n.LeaveFirstPerson(K) end function n.GetCameraToSubjectDistance(K)return K.currentSubjectDistance end function n.GetMeasuredDistanceToFocus(K)local d=game.Workspace.CurrentCamera if d then return(d.CoordinateFrame.p-d.Focus.p).magnitude end return nil end function n.GetCameraLookVector(d)return game.Workspace.CurrentCamera and game.Workspace.CurrentCamera.CFrame.lookVector or K end function n.CalculateNewLookCFrame(d,K)local M=K or d:GetCameraLookVector()local A=math.asin(M.y)local U=math.clamp(d.rotateInput.y,-q+A,-P+A)local j=Vector2.new(d.rotateInput.x,U)local O=CFrame.new(Z,M)local N=(CFrame.Angles(0,-j.x,0)*O)*CFrame.Angles(-j.y,0,0)return N end function n.CalculateNewLookVector(d,K)local M=d:CalculateNewLookCFrame(K)return M.lookVector end function n.CalculateNewLookVectorVR(K)local M=K:GetSubjectPosition()local A=M-game.Workspace.CurrentCamera.CFrame.p local U=(A*d).unit local j=Vector2.new(K.rotateInput.x,0)local O=CFrame.new(Z,U)local P=((CFrame.Angles(0,-j.x,0)*O)*CFrame.Angles(-j.y,0,0)).lookVector return(P*d).unit end function n.GetHumanoid(K)local d=R and R.Character if d then local M=K.humanoidCache[R]if M and M.Parent==d then return M else K.humanoidCache[R]=nil local M=d:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")if M then K.humanoidCache[R]=M end return M end end return nil end function n.GetHumanoidPartToFollow(M,K,d)if d==Enum.HumanoidStateType.Dead then local d=K.Parent if d then return d:FindFirstChild("\072\101\097\100")or K.Torso else return K.Torso end else return K.Torso end end function n.UpdateGamepad(K)local d=K.gamepadPanningCamera if d and(K.hasGameLoaded or not W.VREnabled)then d=f.GamepadLinearToCurve(d)local M=tick()if d.X~=0 or d.Y~=0 then K.userPanningTheCamera=true elseif d==S then K.lastThumbstickRotate=nil if K.lastThumbstickPos==S then K.currentSpeed=0 end end local A=0 if K.lastThumbstickRotate then if W.VREnabled then K.currentSpeed=K.vrMaxSpeed else local A=(M-K.lastThumbstickRotate)*10 K.currentSpeed=K.currentSpeed+K.maxSpeed*((A*A)/K.numOfSeconds)if K.currentSpeed>K.maxSpeed then K.currentSpeed=K.maxSpeed end if K.lastVelocity then local A=(d-K.lastThumbstickPos)/(M-K.lastThumbstickRotate)local U=(A-K.lastVelocity).magnitude if U>12 then K.currentSpeed=K.currentSpeed*(20/U)if K.currentSpeed>K.maxSpeed then K.currentSpeed=K.maxSpeed end end end end A=y.GamepadCameraSensitivity*K.currentSpeed K.lastVelocity=(d-K.lastThumbstickPos)/(M-K.lastThumbstickRotate)end K.lastThumbstickPos=d K.lastThumbstickRotate=M return Vector2.new(d.X*A,((d.Y*A)*K.ySensitivity)*y:GetCameraYInvertValue())end return S end function n.ApplyVRTransform(K)if not W.VREnabled then return end local d=K.humanoidRootPart and K.humanoidRootPart:FindFirstChild("\082\111\111\116\074\111\105\110\116")if not d then return end local M=game.Workspace.CurrentCamera.CameraSubject local A=M and M:IsA("\086\101\104\105\099\108\101\083\101\097\116")if K.inFirstPerson and not A then local K=W:GetUserCFrame(Enum.UserCFrame.Head)local M=K-K.p d.C0=CFrame.new(M:vectorToObjectSpace(K.p))*CFrame.new(0,0,0,-1,0,0,0,0,1,0,1,0)else d.C0=CFrame.new(0,0,0,-1,0,0,0,0,1,0,1,0)end end function n.IsInFirstPerson(K)return K.inFirstPerson end function n.ShouldUseVRRotation(K)if not W.VREnabled then return false end if not K.VRRotationIntensityAvailable and tick()-K.lastVRRotationIntensityCheckTime<1 then return false end local d,M=pcall(function()return J:GetCore("\086\082\082\111\116\097\116\105\111\110\073\110\116\101\110\115\105\116\121")end)K.VRRotationIntensityAvailable=d and M~=nil K.lastVRRotationIntensityCheckTime=tick()K.shouldUseVRRotation=d and(M~=nil and M~="\083\109\111\111\116\104")return K.shouldUseVRRotation end function n.GetVRRotationInput(K)local d=S local M,A=pcall(function()return J:GetCore("\086\082\082\111\116\097\116\105\111\110\073\110\116\101\110\115\105\116\121")end)if not M then return end local U=K.GamepadPanningCamera or S local j=tick()-K.lastVRRotationTime>=K:GetRepeatDelayValue(A)if math.abs(U.x)>=K:GetActivateValue()then if j or not K.vrRotateKeyCooldown[Enum.KeyCode.Thumbstick2]then local M=1 if U.x<0 then M=-1 end d=d+K:GetRotateAmountValue(A)*M K.vrRotateKeyCooldown[Enum.KeyCode.Thumbstick2]=true end elseif math.abs(U.x)<K:GetActivateValue()-.1 then K.vrRotateKeyCooldown[Enum.KeyCode.Thumbstick2]=nil end if K.turningLeft then if j or not K.vrRotateKeyCooldown[Enum.KeyCode.Left]then d=d-K:GetRotateAmountValue(A)K.vrRotateKeyCooldown[Enum.KeyCode.Left]=true end else K.vrRotateKeyCooldown[Enum.KeyCode.Left]=nil end if K.turningRight then if j or not K.vrRotateKeyCooldown[Enum.KeyCode.Right]then d=d+K:GetRotateAmountValue(A)K.vrRotateKeyCooldown[Enum.KeyCode.Right]=true end else K.vrRotateKeyCooldown[Enum.KeyCode.Right]=nil end if d~=S then K.lastVRRotationTime=tick()end return d end function n.CancelCameraFreeze(d,K)if not K then d.cameraTranslationConstraints=Vector3.new(d.cameraTranslationConstraints.x,1,d.cameraTranslationConstraints.z)end if d.cameraFrozen then d.trackingHumanoid=nil d.cameraFrozen=false end end function n.StartCameraFreeze(M,K,d)if not M.cameraFrozen then M.humanoidJumpOrigin=K M.trackingHumanoid=d M.cameraTranslationConstraints=Vector3.new(M.cameraTranslationConstraints.x,0,M.cameraTranslationConstraints.z)M.cameraFrozen=true end end function n.OnNewCameraSubject(K)if K.subjectStateChangedConn then K.subjectStateChangedConn:Disconnect()K.subjectStateChangedConn=nil end local d=workspace.CurrentCamera and workspace.CurrentCamera.CameraSubject if K.trackingHumanoid~=d then K:CancelCameraFreeze()end if d and d:IsA("\072\117\109\097\110\111\105\100")then K.subjectStateChangedConn=d.StateChanged:Connect(function(M,A)if W.VREnabled and(A==Enum.HumanoidStateType.Jumping and not K.inFirstPerson)then K:StartCameraFreeze(K:GetSubjectPosition(),d)elseif A~=Enum.HumanoidStateType.Jumping and A~=Enum.HumanoidStateType.Freefall then K:CancelCameraFreeze(true)end end)end end function n.GetVRFocus(M,K,d)local A=M.LastCameraFocus or K if not M.cameraFrozen then M.cameraTranslationConstraints=Vector3.new(M.cameraTranslationConstraints.x,math.min(1,M.cameraTranslationConstraints.y+.42*d),M.cameraTranslationConstraints.z)end local U if M.cameraFrozen and(M.humanoidJumpOrigin and M.humanoidJumpOrigin.y>A.y)then U=CFrame.new(Vector3.new(K.x,math.min(M.humanoidJumpOrigin.y,A.y+5*d),K.z))else U=CFrame.new((Vector3.new(K.x,A.y,K.z)):lerp(K,M.cameraTranslationConstraints.y))end if M.cameraFrozen then if M.inFirstPerson then M:CancelCameraFreeze()end if M.humanoidJumpOrigin and K.y<M.humanoidJumpOrigin.y-.5 then M:CancelCameraFreeze()end end return U end function n.GetRotateAmountValue(d,K)K=K or J:GetCore("\086\082\082\111\116\097\116\105\111\110\073\110\116\101\110\115\105\116\121")if K then if K=="\076\111\119"then return b elseif K=="\072\105\103\104"then return p end end return S end function n.GetRepeatDelayValue(d,K)K=K or J:GetCore("\086\082\082\111\116\097\116\105\111\110\073\110\116\101\110\115\105\116\121")if K then if K=="\076\111\119"then return t elseif K=="\072\105\103\104"then return L end end return 0 end function n.Update(d,K)error("\066\097\115\101\067\097\109\101\114\097\058\085\112\100\097\116\101\040\041 \084\104\105\115 \105\115 \097 \118\105\114\116\117\097\108 \102\117\110\099\116\105\111\110 \116\104\097\116 \115\104\111\117\108\100 \110\101\118\101\114 \098\101 \103\101\116\116\105\110\103 \099\097\108\108\101\100\046",2)end n.UpCFrame=CFrame.new()function n.UpdateUpCFrame(d,K)d.UpCFrame=K end local dp=Vector3.new(0,0,0)function n.CalculateNewLookCFrame(d,K)local M=K or d:GetCameraLookVector()M=d.UpCFrame:VectorToObjectSpace(M)local A=math.asin(M.y)local U=math.clamp(d.rotateInput.y,-q+A,-P+A)local j=Vector2.new(d.rotateInput.x,U)local O=CFrame.new(dp,M)local N=(CFrame.Angles(0,-j.x,0)*O)*CFrame.Angles(-j.y,0,0)return N end return n end function _BaseOcclusion()local K={}K.__index=K setmetatable(K,{__call=function(d,...)return K.new(...)end})function K.new()local d=setmetatable({},K)return d end function K.CharacterAdded(M,K,d) end function K.CharacterRemoving(M,K,d) end function K.OnCameraSubjectChanged(d,K) end function K.GetOcclusionMode(K)warn("\066\097\115\101\079\099\099\108\117\115\105\111\110 \071\101\116\079\099\099\108\117\115\105\111\110\077\111\100\101 \109\117\115\116 \098\101 \111\118\101\114\114\105\100\100\101\110 \098\121 \100\101\114\105\118\101\100 \099\108\097\115\115\101\115")return nil end function K.Enable(d,K)warn("\066\097\115\101\079\099\099\108\117\115\105\111\110 \069\110\097\098\108\101 \109\117\115\116 \098\101 \111\118\101\114\114\105\100\100\101\110 \098\121 \100\101\114\105\118\101\100 \099\108\097\115\115\101\115")end function K.Update(A,K,d,M)warn("\066\097\115\101\079\099\099\108\117\115\105\111\110 \085\112\100\097\116\101 \109\117\115\116 \098\101 \111\118\101\114\114\105\100\100\101\110 \098\121 \100\101\114\105\118\101\100 \099\108\097\115\115\101\115")return d,M end return K end function _Popper()local K=game:GetService("\080\108\097\121\101\114\115")local d=game.Workspace.CurrentCamera local M=math.min local A=math.tan local U=math.rad local j=math.huge local O=Ray.new local function P(K)return 1-(1-K.Transparency)*(1-K.LocalTransparencyModifier)end local function q(K,d)for d=#K,d+1,-1 do K[d]=nil end end local N,G,c do local function K()local K=U(d.FieldOfView)local M=d.ViewportSize local j=M.X/M.Y c=2*A(K/2)G=j*c end;(d:GetPropertyChangedSignal("\070\105\101\108\100\079\102\086\105\101\119")):Connect(K);(d:GetPropertyChangedSignal("\086\105\101\119\112\111\114\116\083\105\122\101")):Connect(K)K()N=d.NearPlaneZ;(d:GetPropertyChangedSignal("\078\101\097\114\080\108\097\110\101\090")):Connect(function()N=d.NearPlaneZ end)end local H={}do local d={}local function M()local K=1 H={}for d,M in pairs(d)do H[K]=M K=K+1 end end local function A(K)local function A(A)d[K]=A M()end local function U()d[K]=nil M()end K.CharacterAdded:Connect(A)K.CharacterRemoving:Connect(U)if K.Character then A(K.Character)end end local function U(K)d[K]=nil M()end K.PlayerAdded:Connect(A)K.PlayerRemoving:Connect(U)for K,d in ipairs(K:GetPlayers())do A(d)end M()end local m local b;(d:GetPropertyChangedSignal("\067\097\109\101\114\097\083\117\098\106\101\099\116")):Connect(function()local K=d.CameraSubject if K:IsA("\072\117\109\097\110\111\105\100")then b=K.RootPart elseif K:IsA("\066\097\115\101\080\097\114\116")then b=K else b=nil end end)local function p(K)return P(K)<.25 and(K.CanCollide and(m~=(K:GetRootPart()or K)and not K:IsA("\084\114\117\115\115\080\097\114\116")))end local t={Vector2.new(.4,0),Vector2.new(-0.4,0),Vector2.new(0,-0.4);Vector2.new(0,.4);Vector2.new(0,.2)}local function L(K,d)local M=#H repeat local A,U=workspace:FindPartOnRayWithIgnoreList(O(K,d),H,false,true)if A then if A.CanCollide then q(H,M)return U,true end H[#H+1]=A end until not A q(H,M)return K+d,false end local function S(K,d,M,A)debug.profilebegin("\113\117\101\114\121\080\111\105\110\116")local U=#H M=M+N local P=K+d*M local G=j local c=j local m=K repeat local U,q=workspace:FindPartOnRayWithIgnoreList(O(m,P-m),H,false,true)if U then if p(U)then local d={U}local j=workspace:FindPartOnRayWithWhitelist(O(P,q-P),d,true)local N=(q-K).Magnitude if j then local K=false if A then K=workspace:FindPartOnRayWithWhitelist(O(A,P-A),d,true)or workspace:FindPartOnRayWithWhitelist(O(P,A-P),d,true)end if K then c=N elseif M<G then G=N end else c=N end end H[#H+1]=U m=q-d*.001 end until c<j or not U q(H,U)debug.profileend()return G-N,c-N end local function Z(K,M)debug.profilebegin("\113\117\101\114\121\086\105\101\119\112\111\114\116")local A=K.p local U=K.rightVector local O=K.upVector local P=-K.lookVector local q=d.ViewportSize local H=j local m=j for K=0,1,1 do local j=U*((K-.5)*G)for U=0,1,1 do local G=O*((U-.5)*c)local b=A+N*(j+G)local p=(d:ViewportPointToRay(q.x*K,q.y*U)).Origin local t,L=S(b,P,M,p)if L<H then H=L end if t<m then m=t end end end debug.profileend()return m,H end local function T(K,d,A)debug.profilebegin("\116\101\115\116\080\114\111\109\111\116\105\111\110")local U=K.p local O=K.rightVector local P=K.upVector local q=-K.lookVector do debug.profilebegin("\101\120\116\114\097\112\111\108\097\116\101")local K=.0625 local j=1.25 local O=(L(U,A.posVelocity*j)-U).Magnitude local P=A.posVelocity.magnitude for K=0,M(j,A.rotVelocity.magnitude+O/P),K do local M=A.extrapolate(K)if S(M.p,-M.lookVector,d)>=d then return false end end debug.profileend()end do debug.profilebegin("\116\101\115\116\079\102\102\115\101\116\115")for K,M in ipairs(t)do local A=M local N=L(U,O*A.x+P*A.y)if S(N,((U+q*d)-N).Unit,d)==j then return false end end debug.profileend()end debug.profileend()return true end local function B(K,d,M)debug.profilebegin("\112\111\112\112\101\114")m=b and b:GetRootPart()or b local A=d local U,j=Z(K,d)if j<A then A=j end if U<A and T(K,d,M)then A=U end m=nil debug.profileend()return A end return B end function _ZoomController()local K=4.5 local d=12.5 local M=.0375 local A=.5 local U=1 local j=_Popper()local O=math.clamp local P=math.exp local q=math.min local N=math.max local G=math.pi local c,H do local K=(game:GetService("\080\108\097\121\101\114\115")).LocalPlayer local function d()c=K.CameraMinZoomDistance H=K.CameraMaxZoomDistance end d();(K:GetPropertyChangedSignal("\067\097\109\101\114\097\077\105\110\090\111\111\109\068\105\115\116\097\110\099\101")):Connect(d);(K:GetPropertyChangedSignal("\067\097\109\101\114\097\077\097\120\090\111\111\109\068\105\115\116\097\110\099\101")):Connect(d)end local m={}do m.__index=m function m.new(K,d,M,A)d=O(d,M,A)return setmetatable({freq=K,x=d;v=0;minValue=M,maxValue=A;goal=d},m)end function m.Step(d,K)local M=(d.freq*2)*G local A=d.x local U=d.v local j=d.minValue local O=d.maxValue local q=d.goal local N=q-A local c=M*K local H=P(-c)local m=q+(U*K-N*(c+1))*H local b=((N*M-U)*c+U)*H if m<j then m=j b=0 elseif m>O then m=O b=0 end d.x=m d.v=b return m end end local b=m.new(K,d,A,H)local function p(K,d,A,j)K=O(K+d*(1+K*M),A,j)if K<U then K=d<=0 and A or U end return K end local t=0 local L={}do function L.Update(K,d,M)local O=math.huge if b.goal>U then local K=N(b.x,p(b.goal,t,c,H))O=j(d*CFrame.new(0,0,A),K-A,M)+A end b.minValue=A b.maxValue=q(H,O)return b:Step(K)end function L.SetZoomParameters(K,d)b.goal=K t=d end end return L end function _MouseLockController()local K="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\077\111\117\115\101\076\111\099\107\101\100\067\117\114\115\111\114\046\112\110\103"local d="\077\111\117\115\101\076\111\099\107\083\119\105\116\099\104\065\099\116\105\111\110"local M=Enum.ContextActionPriority.Default.Value local A=game:GetService("\080\108\097\121\101\114\115")local U=game:GetService("\067\111\110\116\101\120\116\065\099\116\105\111\110\083\101\114\118\105\099\101")local j=UserSettings()local O=j.GameSettings local P=A.LocalPlayer:GetMouse()local q={}q.__index=q function q.new()local K=setmetatable({},q)K.isMouseLocked=false K.savedMouseCursor=nil K.boundKeys={Enum.KeyCode.LeftShift,Enum.KeyCode.RightShift}K.mouseLockToggledEvent=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116")local d=script:FindFirstChild("\066\111\117\110\100\075\101\121\115")if not d or not d:IsA("\083\116\114\105\110\103\086\097\108\117\101")then if d then d:Destroy()end d=Instance.new("\083\116\114\105\110\103\086\097\108\117\101")d.Name="\066\111\117\110\100\075\101\121\115"d.Value="\076\101\102\116\083\104\105\102\116\044\082\105\103\104\116\083\104\105\102\116"d.Parent=script end if d then d.Changed:Connect(function(d)K:OnBoundKeysObjectChanged(d)end)K:OnBoundKeysObjectChanged(d.Value)end O.Changed:Connect(function(d)if d=="\067\111\110\116\114\111\108\077\111\100\101"or d=="\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101"then K:UpdateMouseLockAvailability()end end);(A.LocalPlayer:GetPropertyChangedSignal("\068\101\118\069\110\097\098\108\101\077\111\117\115\101\076\111\099\107")):Connect(function()K:UpdateMouseLockAvailability()end);(A.LocalPlayer:GetPropertyChangedSignal("\068\101\118\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101")):Connect(function()K:UpdateMouseLockAvailability()end)K:UpdateMouseLockAvailability()return K end function q.GetIsMouseLocked(K)return K.isMouseLocked end function q.GetBindableToggleEvent(K)return K.mouseLockToggledEvent.Event end function q.GetMouseLockOffset(K)local d=script:FindFirstChild("\067\097\109\101\114\097\079\102\102\115\101\116")if d and d:IsA("\086\101\099\116\111\114\051\086\097\108\117\101")then return d.Value else if d then d:Destroy()end d=Instance.new("\086\101\099\116\111\114\051\086\097\108\117\101")d.Name="\067\097\109\101\114\097\079\102\102\115\101\116"d.Value=Vector3.new(1.75,0,0)d.Parent=script end if d and d.Value then return d.Value end return Vector3.new(1.75,0,0)end function q.UpdateMouseLockAvailability(K)local d=A.LocalPlayer.DevEnableMouseLock local M=A.LocalPlayer.DevComputerMovementMode==Enum.DevComputerMovementMode.Scriptable local U=O.ControlMode==Enum.ControlMode.MouseLockSwitch local j=O.ComputerMovementMode==Enum.ComputerMovementMode.ClickToMove local P=d and(U and(not j and not M))if P~=K.enabled then K:EnableMouseLock(P)end end function q.OnBoundKeysObjectChanged(d,K)d.boundKeys={}for K in string.gmatch(K,"\091\094\037\115\044\093\043")do for M,A in pairs(Enum.KeyCode:GetEnumItems())do if K==A.Name then d.boundKeys[#d.boundKeys+1]=A break end end end d:UnbindContextActions()d:BindContextActions()end function q.OnMouseLockToggled(d)d.isMouseLocked=not d.isMouseLocked if d.isMouseLocked then local M=script:FindFirstChild("\067\117\114\115\111\114\073\109\097\103\101")if M and(M:IsA("\083\116\114\105\110\103\086\097\108\117\101")and M.Value)then d.savedMouseCursor=P.Icon P.Icon=M.Value else if M then M:Destroy()end M=Instance.new("\083\116\114\105\110\103\086\097\108\117\101")M.Name="\067\117\114\115\111\114\073\109\097\103\101"M.Value=K M.Parent=script d.savedMouseCursor=P.Icon P.Icon=K end else if d.savedMouseCursor then P.Icon=d.savedMouseCursor d.savedMouseCursor=nil end end d.mouseLockToggledEvent:Fire()end function q.DoMouseLockSwitch(A,K,d,M)if d==Enum.UserInputState.Begin then A:OnMouseLockToggled()return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end function q.BindContextActions(K)U:BindActionAtPriority(d,function(d,M,A)return K:DoMouseLockSwitch(d,M,A)end,false,M,unpack(K.boundKeys))end function q.UnbindContextActions(K)U:UnbindAction(d)end function q.IsMouseLocked(K)return K.enabled and K.isMouseLocked end function q.EnableMouseLock(d,K)if K~=d.enabled then d.enabled=K if d.enabled then d:BindContextActions()else if P.Icon~=""then P.Icon=""end d:UnbindContextActions()if d.isMouseLocked then d.mouseLockToggledEvent:Fire()end d.isMouseLocked=false end end end return q end function _TransparencyController()local K=2.8 local d=_CameraUtils()local M={}M.__index=M function M.new()local K=setmetatable({},M)K.lastUpdate=tick()K.transparencyDirty=false K.enabled=false K.lastTransparency=nil K.descendantAddedConn,K.descendantRemovingConn=nil,nil K.toolDescendantAddedConns={}K.toolDescendantRemovingConns={}K.cachedParts={}return K end function M.HasToolAncestor(d,K)if K.Parent==nil then return false end return K.Parent:IsA("\084\111\111\108")or d:HasToolAncestor(K.Parent)end function M.IsValidPartToModify(d,K)if K:IsA("\066\097\115\101\080\097\114\116")or K:IsA("\068\101\099\097\108")then return not d:HasToolAncestor(K)end return false end function M.CachePartsRecursive(d,K)if K then if d:IsValidPartToModify(K)then d.cachedParts[K]=true d.transparencyDirty=true end for K,M in pairs(K:GetChildren())do d:CachePartsRecursive(M)end end end function M.TeardownTransparency(K)for K,d in pairs(K.cachedParts)do K.LocalTransparencyModifier=0 end K.cachedParts={}K.transparencyDirty=true K.lastTransparency=nil if K.descendantAddedConn then K.descendantAddedConn:disconnect()K.descendantAddedConn=nil end if K.descendantRemovingConn then K.descendantRemovingConn:disconnect()K.descendantRemovingConn=nil end for d,M in pairs(K.toolDescendantAddedConns)do M:Disconnect()K.toolDescendantAddedConns[d]=nil end for d,M in pairs(K.toolDescendantRemovingConns)do M:Disconnect()K.toolDescendantRemovingConns[d]=nil end end function M.SetupTransparency(d,K)d:TeardownTransparency()if d.descendantAddedConn then d.descendantAddedConn:disconnect()end d.descendantAddedConn=K.DescendantAdded:Connect(function(M)if d:IsValidPartToModify(M)then d.cachedParts[M]=true d.transparencyDirty=true elseif M:IsA("\084\111\111\108")then if d.toolDescendantAddedConns[M]then d.toolDescendantAddedConns[M]:Disconnect()end d.toolDescendantAddedConns[M]=M.DescendantAdded:Connect(function(K)d.cachedParts[K]=nil if K:IsA("\066\097\115\101\080\097\114\116")or K:IsA("\068\101\099\097\108")then K.LocalTransparencyModifier=0 end end)if d.toolDescendantRemovingConns[M]then d.toolDescendantRemovingConns[M]:disconnect()end d.toolDescendantRemovingConns[M]=M.DescendantRemoving:Connect(function(M)wait()if K and(M and M:IsDescendantOf(K))then if d:IsValidPartToModify(M)then d.cachedParts[M]=true d.transparencyDirty=true end end end)end end)if d.descendantRemovingConn then d.descendantRemovingConn:disconnect()end d.descendantRemovingConn=K.DescendantRemoving:connect(function(K)if d.cachedParts[K]then d.cachedParts[K]=nil K.LocalTransparencyModifier=0 end end)d:CachePartsRecursive(K)end function M.Enable(d,K)if d.enabled~=K then d.enabled=K d:Update()end end function M.SetSubject(d,K)local M=nil if K and K:IsA("\072\117\109\097\110\111\105\100")then M=K.Parent end if K and(K:IsA("\086\101\104\105\099\108\101\083\101\097\116")and K.Occupant)then M=K.Occupant.Parent end if M then d:SetupTransparency(M)else d:TeardownTransparency()end end function M.Update(M)local A=false local U=tick()local j=workspace.CurrentCamera if j then local O=0 if not M.enabled then A=true else local P=(j.Focus.p-j.CoordinateFrame.p).magnitude O=P<2 and 1-(P-.5)/1.5 or 0 if O<.5 then O=0 end if M.lastTransparency then local d=O-M.lastTransparency if not A and(O<1 and M.lastTransparency<.95)then local A=K*(U-M.lastUpdate)d=math.clamp(d,-A,A)end O=M.lastTransparency+d else M.transparencyDirty=true end O=math.clamp(d.Round(O,2),0,1)end if M.transparencyDirty or M.lastTransparency~=O then for K,d in pairs(M.cachedParts)do K.LocalTransparencyModifier=O end M.transparencyDirty=false M.lastTransparency=O end end M.lastUpdate=U end return M end function _Poppercam()local K=_ZoomController()local d={}do d.__index=d local K=CFrame.new()local function M(K)local d,M=K:toAxisAngle()return d*M end local function A(d)local M=d.magnitude if M>1e-05 then return CFrame.fromAxisAngle(d,M)end return K end local function U(K)local d,M,A,U,j,O,P,q,N,G,c,H=K:components()return CFrame.new(0,0,0,U,j,O,P,q,N,G,c,H)end function d.new()return setmetatable({lastCFrame=nil},d)end function d.Step(j,K,d)local O=j.lastCFrame or d j.lastCFrame=d local P=d.p local q=U(d)local N=O.p local G=U(O)local c=(P-N)/K local H=M(q*G:inverse())/K local function m(K)local d=c*K+P local M=A(H*K)*q return M+d end return{extrapolate=m;posVelocity=c;rotVelocity=H}end function d.Reset(K)K.lastCFrame=nil end end local M=_BaseOcclusion()local A=setmetatable({},M)A.__index=A function A.new()local K=setmetatable(M.new(),A)K.focusExtrapolator=d.new()return K end function A.GetOcclusionMode(K)return Enum.DevCameraOcclusionMode.Zoom end function A.Enable(d,K)d.focusExtrapolator:Reset()end function A.Update(j,d,M,A,U)local O=CFrame.new(A.p,M.p)*CFrame.new(0,0,0,-1,0,0,0,1,0,0,0,-1)local P=j.focusExtrapolator:Step(d,O)local q=K.Update(d,O,P)return O*CFrame.new(0,0,q),A end function A.CharacterAdded(M,K,d) end function A.CharacterRemoving(M,K,d) end function A.OnCameraSubjectChanged(d,K) end local U=_ZoomController()function A.Update(j,K,d,M,A)local O=M*(d-d.p)local P=j.focusExtrapolator:Step(K,O)local q=U.Update(K,O,P)return O*CFrame.new(0,0,q),M end return A end function _Invisicam()local K=game:GetService("\080\108\097\121\101\114\115")local d=Vector3.new(0,0,0)local M=true local A=.75 local U=.5 local j={LIMBS=2;MOVEMENT=3;CORNERS=4;CIRCLE1=5,CIRCLE2=6,LIMBMOVE=7;SMART_CIRCLE=8;CHAR_OUTLINE=9}local O={Head=true,["\076\101\102\116 \065\114\109"]=true;["\082\105\103\104\116 \065\114\109"]=true,["\076\101\102\116 \076\101\103"]=true,["\082\105\103\104\116 \076\101\103"]=true,LeftLowerArm=true,RightLowerArm=true;LeftUpperLeg=true;RightUpperLeg=true}local P={Vector3.new(1,1,-1);Vector3.new(1,-1,-1),Vector3.new(-1,-1,-1);Vector3.new(-1,1,-1)}local q=10 local N=3 local G=24 local c=(2*math.pi)/G local H=24 local function m(K,...)local d={}local M=""for K,A in pairs({...})do d[A]=true M=M..((M==""and""or" \111\114 ")..A)end local A=type(K)assert(d[A],M..(" \116\121\112\101 \101\120\112\101\099\116\101\100\044 \103\111\116\058 "..A))end local function b(K,d,M,A,U,j,O,P,q)return(K*(U*q-j*P)-d*(A*q-j*O))+M*(A*P-U*O)end local function p(K,M,A,U)local j=M:Cross(U)local O=A.x-K.x local P=A.y-K.y local q=A.z-K.z local N=b(M.x,-U.x,j.x,M.y,-U.y,j.y,M.z,-U.z,j.z)if N==0 then return d end local G=b(O,-U.x,j.x,P,-U.y,j.y,q,-U.z,j.z)/N local c=b(M.x,O,j.x,M.y,P,j.y,M.z,q,j.z)/N local H=K+G*M local m=A+c*U local p=H+.5*(m-H)if(m-H).Magnitude<.25 then return p else return d end end local t=_BaseOcclusion()local L=setmetatable({},t)L.__index=L function L.new()local K=setmetatable(t.new(),L)K.char=nil K.humanoidRootPart=nil K.torsoPart=nil K.headPart=nil K.childAddedConn=nil K.childRemovedConn=nil K.behaviors={}K.behaviors[j.LIMBS]=K.LimbBehavior K.behaviors[j.MOVEMENT]=K.MoveBehavior K.behaviors[j.CORNERS]=K.CornerBehavior K.behaviors[j.CIRCLE1]=K.CircleBehavior K.behaviors[j.CIRCLE2]=K.CircleBehavior K.behaviors[j.LIMBMOVE]=K.LimbMoveBehavior K.behaviors[j.SMART_CIRCLE]=K.SmartCircleBehavior K.behaviors[j.CHAR_OUTLINE]=K.CharacterOutlineBehavior K.mode=j.SMART_CIRCLE K.behaviorFunction=K.SmartCircleBehavior K.savedHits={}K.trackedLimbs={}K.camera=game.Workspace.CurrentCamera K.enabled=false return K end function L.Enable(d,K)d.enabled=K if not K then d:Cleanup()end end function L.GetOcclusionMode(K)return Enum.DevCameraOcclusionMode.Invisicam end function L.LimbBehavior(d,K)for d,M in pairs(d.trackedLimbs)do K[#K+1]=d.Position end end function L.MoveBehavior(d,K)for M=1,N,1 do local A,U=d.humanoidRootPart.Position,d.humanoidRootPart.Velocity local j=(Vector3.new(U.X,0,U.Z)).Magnitude/2 local O=((M-1)*d.humanoidRootPart.CFrame.lookVector)*j K[#K+1]=A+O end end function L.CornerBehavior(d,K)local M=d.humanoidRootPart.CFrame local A=M.p local U=M-A local j=d.char:GetExtentsSize()/2 K[#K+1]=A for d=1,#P,1 do K[#K+1]=A+U*(j*P[d])end end function L.CircleBehavior(d,K)local M if d.mode==j.CIRCLE1 then M=d.humanoidRootPart.CFrame else local K=d.camera.CoordinateFrame M=(K-K.p)+d.humanoidRootPart.Position end K[#K+1]=M.p for d=0,q-1,1 do local A=((2*math.pi)/q)*d local U=3*Vector3.new(math.cos(A),math.sin(A),0)K[#K+1]=M*U end end function L.LimbMoveBehavior(d,K)d:LimbBehavior(K)d:MoveBehavior(K)end function L.CharacterOutlineBehavior(M,K)local A=M.torsoPart.CFrame.upVector.unit local U=M.torsoPart.CFrame.rightVector.unit K[#K+1]=M.torsoPart.CFrame.p K[#K+1]=M.torsoPart.CFrame.p+A K[#K+1]=M.torsoPart.CFrame.p-A K[#K+1]=M.torsoPart.CFrame.p+U K[#K+1]=M.torsoPart.CFrame.p-U if M.headPart then K[#K+1]=M.headPart.CFrame.p end local j=CFrame.new(d,Vector3.new(M.camera.CoordinateFrame.lookVector.X,0,M.camera.CoordinateFrame.lookVector.Z))local O=M.torsoPart and M.torsoPart.Position or M.humanoidRootPart.Position local P={M.torsoPart}if M.headPart then P[#P+1]=M.headPart end for d=1,H,1 do local M=((2*math.pi)*d)/H local A=j*(3*Vector3.new(math.cos(M),math.sin(M),0))A=Vector3.new(A.X,math.max(A.Y,-2.25),A.Z)local U=Ray.new(O+A,-3*A)local q,N=game.Workspace:FindPartOnRayWithWhitelist(U,P,false,false)if q then K[#K+1]=N+.2*(O-N).unit end end end function L.SmartCircleBehavior(d,K)local M=d.torsoPart.CFrame.upVector.unit local A=d.torsoPart.CFrame.rightVector.unit K[#K+1]=d.torsoPart.CFrame.p K[#K+1]=d.torsoPart.CFrame.p+M K[#K+1]=d.torsoPart.CFrame.p-M K[#K+1]=d.torsoPart.CFrame.p+A K[#K+1]=d.torsoPart.CFrame.p-A if d.headPart then K[#K+1]=d.headPart.CFrame.p end local U=d.camera.CFrame-d.camera.CFrame.p local j=Vector3.new(0,.5,0)+(d.torsoPart and d.torsoPart.Position or d.humanoidRootPart.Position)local O=2.5 for M=1,G,1 do local A=c*M-.5*math.pi local P=O*Vector3.new(math.cos(A),math.sin(A),0)local q=j+U*P local N=q-d.camera.CFrame.p local G=Ray.new(j,q-j)local H,m,b=game.Workspace:FindPartOnRayWithIgnoreList(G,{d.char},false,false)local t=q if H then local K=m+.1*b.unit local M=K-j local A=(M:Cross(N)).unit local U=(A:Cross(b)).unit local O=(K-d.camera.CFrame.p).unit if M.unit:Dot(-U)<M.unit:Dot(O)then t=p(K,U,q,N)if t.Magnitude>0 then local M=Ray.new(K,t-K)local A,U,j=game.Workspace:FindPartOnRayWithIgnoreList(M,{d.char},false,false)if A then local K=U+.1*j.unit t=K end else t=K end else t=K end local P=Ray.new(j,t-j)local G,c,H=game.Workspace:FindPartOnRayWithIgnoreList(P,{d.char},false,false)if G then local K=c-.1*(t-j).unit t=K end end K[#K+1]=t end end function L.CheckTorsoReference(K)if K.char then K.torsoPart=K.char:FindFirstChild("\084\111\114\115\111")if not K.torsoPart then K.torsoPart=K.char:FindFirstChild("\085\112\112\101\114\084\111\114\115\111")if not K.torsoPart then K.torsoPart=K.char:FindFirstChild("\072\117\109\097\110\111\105\100\082\111\111\116\080\097\114\116")end end K.headPart=K.char:FindFirstChild("\072\101\097\100")end end function L.CharacterAdded(A,d,M)if M~=K.LocalPlayer then return end if A.childAddedConn then A.childAddedConn:Disconnect()A.childAddedConn=nil end if A.childRemovedConn then A.childRemovedConn:Disconnect()A.childRemovedConn=nil end A.char=d A.trackedLimbs={}local function U(K)if K:IsA("\066\097\115\101\080\097\114\116")then if O[K.Name]then A.trackedLimbs[K]=true end if K.Name=="\084\111\114\115\111"or K.Name=="\085\112\112\101\114\084\111\114\115\111"then A.torsoPart=K end if K.Name=="\072\101\097\100"then A.headPart=K end end end local function j(K)A.trackedLimbs[K]=nil A:CheckTorsoReference()end A.childAddedConn=d.ChildAdded:Connect(U)A.childRemovedConn=d.ChildRemoved:Connect(j)for K,d in pairs(A.char:GetChildren())do U(d)end end function L.SetMode(d,K)m(K,"\110\117\109\098\101\114")for M,A in pairs(j)do if A==K then d.mode=K d.behaviorFunction=d.behaviors[d.mode]return end end error("\073\110\118\097\108\105\100 \109\111\100\101 \110\117\109\098\101\114")end function L.GetObscuredParts(K)return K.savedHits end function L.Cleanup(K)for K,d in pairs(K.savedHits)do K.LocalTransparencyModifier=d end end function L.Update(O,K,d,j)if not O.enabled or not O.char then return d,j end O.camera=game.Workspace.CurrentCamera if not O.humanoidRootPart then local K=O.char:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")if K and K.RootPart then O.humanoidRootPart=K.RootPart else O.humanoidRootPart=O.char:FindFirstChild("\072\117\109\097\110\111\105\100\082\111\111\116\080\097\114\116")if not O.humanoidRootPart then return d,j end end local M M=O.humanoidRootPart.AncestryChanged:Connect(function(K,d)if K==O.humanoidRootPart and not d then O.humanoidRootPart=nil if M and M.Connected then M:Disconnect()M=nil end end end)end if not O.torsoPart then O:CheckTorsoReference()if not O.torsoPart then return d,j end end local P={}O.behaviorFunction(O,P)local q={}local N={O.char}local function G(K)q[K]=true if not O.savedHits[K]then O.savedHits[K]=K.LocalTransparencyModifier end end local c local H=0 local m={}local b=A local p=A if M then local K=O.headPart and O.headPart.CFrame.p or P[1]local d=O.torsoPart and O.torsoPart.CFrame.p or P[2]c=O.camera:GetPartsObscuringTarget({K;d},N)for K=1,#c,1 do local d=c[K]H=H+1 m[d]=true for K,d in pairs(d:GetChildren())do if d:IsA("\068\101\099\097\108")or d:IsA("\084\101\120\116\117\114\101")then H=H+1 break end end end if H>0 then b=math.pow(.5*A+(.5*A)/H,1/H)p=math.pow(.5*U+(.5*U)/H,1/H)end end c=O.camera:GetPartsObscuringTarget(P,N)local t={}for K=1,#c,1 do local d=c[K]t[d]=m[d]and b or p if d.Transparency<t[d]then G(d)end for K,M in pairs(d:GetChildren())do if M:IsA("\068\101\099\097\108")or M:IsA("\084\101\120\116\117\114\101")then if M.Transparency<t[d]then t[M]=t[d]G(M)end end end end for K,d in pairs(O.savedHits)do if q[K]then K.LocalTransparencyModifier=K.Transparency<1 and(t[K]-K.Transparency)/(1-K.Transparency)or 0 else K.LocalTransparencyModifier=d O.savedHits[K]=nil end end return d,j end return L end function _LegacyCamera()local K=Vector2.new(0,0)local d=_CameraUtils()local M=game:GetService("\080\108\097\121\101\114\115")local A=_BaseCamera()local U=setmetatable({},A)U.__index=U function U.new()local K=setmetatable(A.new(),U)K.cameraType=Enum.CameraType.Fixed K.lastUpdate=tick()K.lastDistanceToSubject=nil return K end function U.GetModuleName(K)return"\076\101\103\097\099\121\067\097\109\101\114\097"end function U.SetCameraToSubjectDistance(d,K)return A.SetCameraToSubjectDistance(d,K)end function U.Update(U,A)if not U.cameraType then return end local j=tick()local O=j-U.lastUpdate local P=workspace.CurrentCamera local q=P.CFrame local N=P.Focus local G=M.LocalPlayer if U.lastUpdate==nil or O>1 then U.lastDistanceToSubject=nil end local c=U:GetSubjectPosition()if U.cameraType==Enum.CameraType.Fixed then if U.lastUpdate then local K=math.min(.1,j-U.lastUpdate)local d=U:UpdateGamepad()U.rotateInput=U.rotateInput+d*K end if c and(G and P)then local d=U:GetCameraToSubjectDistance()local M=U:CalculateNewLookVector()U.rotateInput=K N=P.Focus q=CFrame.new(P.CFrame.p,P.CFrame.p+d*M)end elseif U.cameraType==Enum.CameraType.Attach then if c and P then local M=U:GetCameraToSubjectDistance()local A=U:GetHumanoid()if U.lastUpdate and(A and A.RootPart)then local K=math.min(.1,j-U.lastUpdate)local M=U:UpdateGamepad()U.rotateInput=U.rotateInput+M*K local O=A.RootPart.CFrame.lookVector local P=d.GetAngleBetweenXZVectors(O,U:GetCameraLookVector())if d.IsFinite(P)then U.rotateInput=Vector2.new(P,U.rotateInput.Y)end end local O=U:CalculateNewLookVector()U.rotateInput=K N=CFrame.new(c)q=CFrame.new(c-M*O,c)end elseif U.cameraType==Enum.CameraType.Watch then if c and(G and P)then local d=nil local M=U:GetHumanoid()if M and M.RootPart then local K=c-P.CFrame.p d=K.unit if U.lastDistanceToSubject and U.lastDistanceToSubject==U:GetCameraToSubjectDistance()then local d=K.magnitude U:SetCameraToSubjectDistance(d)end end local A=U:GetCameraToSubjectDistance()local j=U:CalculateNewLookVector(d)U.rotateInput=K N=CFrame.new(c)q=CFrame.new(c-A*j,c)U.lastDistanceToSubject=A end else return P.CFrame,P.Focus end U.lastUpdate=j return q,N end return U end function _OrbitalCamera()local K=Vector3.new(0,0,1)local d=Vector3.new(1,0,1)local M=Vector3.new(0,0,0)local A=Vector2.new(0,0)local U=2*math.pi local j=.2 local O=-80 local P=80 local q={}q.InitialDistance=25 q.MinDistance=10 q.MaxDistance=100 q.InitialElevation=35 q.MinElevation=35 q.MaxElevation=35 q.ReferenceAzimuth=-45 q.CWAzimuthTravel=90 q.CCWAzimuthTravel=90 q.UseAzimuthLimits=false local N=_CameraUtils()local G=game:GetService("\080\108\097\121\101\114\115")local c=game:GetService("\086\082\083\101\114\118\105\099\101")local H=_BaseCamera()local m=setmetatable({},H)m.__index=m function m.new()local K=setmetatable(H.new(),m)K.lastUpdate=tick()K.changedSignalConnections={}K.refAzimuthRad=nil K.curAzimuthRad=nil K.minAzimuthAbsoluteRad=nil K.maxAzimuthAbsoluteRad=nil K.useAzimuthLimits=nil K.curElevationRad=nil K.minElevationRad=nil K.maxElevationRad=nil K.curDistance=nil K.minDistance=nil K.maxDistance=nil K.r3ButtonDown=false K.l3ButtonDown=false K.gamepadDollySpeedMultiplier=1 K.lastUserPanCamera=tick()K.externalProperties={}K.externalProperties.InitialDistance=25 K.externalProperties.MinDistance=10 K.externalProperties.MaxDistance=100 K.externalProperties.InitialElevation=35 K.externalProperties.MinElevation=35 K.externalProperties.MaxElevation=35 K.externalProperties.ReferenceAzimuth=-45 K.externalProperties.CWAzimuthTravel=90 K.externalProperties.CCWAzimuthTravel=90 K.externalProperties.UseAzimuthLimits=false K:LoadNumberValueParameters()return K end function m.LoadOrCreateNumberValueParameter(A,K,d,M)local U=script:FindFirstChild(K)if U and U:isA(d)then A.externalProperties[K]=U.Value elseif A.externalProperties[K]~=nil then U=Instance.new(d)U.Name=K U.Parent=script U.Value=A.externalProperties[K]else print("\101\120\116\101\114\110\097\108\080\114\111\112\101\114\116\105\101\115 \116\097\098\108\101 \104\097\115 \110\111 \101\110\116\114\121 \102\111\114 ",K)return end if M then if A.changedSignalConnections[K]then A.changedSignalConnections[K]:Disconnect()end A.changedSignalConnections[K]=U.Changed:Connect(function(d)A.externalProperties[K]=d M(A)end)end end function m.SetAndBoundsCheckAzimuthValues(K)K.minAzimuthAbsoluteRad=math.rad(K.externalProperties.ReferenceAzimuth)-math.abs(math.rad(K.externalProperties.CWAzimuthTravel))K.maxAzimuthAbsoluteRad=math.rad(K.externalProperties.ReferenceAzimuth)+math.abs(math.rad(K.externalProperties.CCWAzimuthTravel))K.useAzimuthLimits=K.externalProperties.UseAzimuthLimits if K.useAzimuthLimits then K.curAzimuthRad=math.max(K.curAzimuthRad,K.minAzimuthAbsoluteRad)K.curAzimuthRad=math.min(K.curAzimuthRad,K.maxAzimuthAbsoluteRad)end end function m.SetAndBoundsCheckElevationValues(K)local d=math.max(K.externalProperties.MinElevation,O)local M=math.min(K.externalProperties.MaxElevation,P)K.minElevationRad=math.rad(math.min(d,M))K.maxElevationRad=math.rad(math.max(d,M))K.curElevationRad=math.max(K.curElevationRad,K.minElevationRad)K.curElevationRad=math.min(K.curElevationRad,K.maxElevationRad)end function m.SetAndBoundsCheckDistanceValues(K)K.minDistance=K.externalProperties.MinDistance K.maxDistance=K.externalProperties.MaxDistance K.curDistance=math.max(K.curDistance,K.minDistance)K.curDistance=math.min(K.curDistance,K.maxDistance)end function m.LoadNumberValueParameters(K)K:LoadOrCreateNumberValueParameter("\073\110\105\116\105\097\108\069\108\101\118\097\116\105\111\110","\078\117\109\098\101\114\086\097\108\117\101",nil)K:LoadOrCreateNumberValueParameter("\073\110\105\116\105\097\108\068\105\115\116\097\110\099\101","\078\117\109\098\101\114\086\097\108\117\101",nil)K:LoadOrCreateNumberValueParameter("\082\101\102\101\114\101\110\099\101\065\122\105\109\117\116\104","\078\117\109\098\101\114\086\097\108\117\101",K.SetAndBoundsCheckAzimuthValue)K:LoadOrCreateNumberValueParameter("\067\087\065\122\105\109\117\116\104\084\114\097\118\101\108","\078\117\109\098\101\114\086\097\108\117\101",K.SetAndBoundsCheckAzimuthValues)K:LoadOrCreateNumberValueParameter("\067\067\087\065\122\105\109\117\116\104\084\114\097\118\101\108","\078\117\109\098\101\114\086\097\108\117\101",K.SetAndBoundsCheckAzimuthValues)K:LoadOrCreateNumberValueParameter("\077\105\110\069\108\101\118\097\116\105\111\110","\078\117\109\098\101\114\086\097\108\117\101",K.SetAndBoundsCheckElevationValues)K:LoadOrCreateNumberValueParameter("\077\097\120\069\108\101\118\097\116\105\111\110","\078\117\109\098\101\114\086\097\108\117\101",K.SetAndBoundsCheckElevationValues)K:LoadOrCreateNumberValueParameter("\077\105\110\068\105\115\116\097\110\099\101","\078\117\109\098\101\114\086\097\108\117\101",K.SetAndBoundsCheckDistanceValues)K:LoadOrCreateNumberValueParameter("\077\097\120\068\105\115\116\097\110\099\101","\078\117\109\098\101\114\086\097\108\117\101",K.SetAndBoundsCheckDistanceValues)K:LoadOrCreateNumberValueParameter("\085\115\101\065\122\105\109\117\116\104\076\105\109\105\116\115","\066\111\111\108\086\097\108\117\101",K.SetAndBoundsCheckAzimuthValues)K.curAzimuthRad=math.rad(K.externalProperties.ReferenceAzimuth)K.curElevationRad=math.rad(K.externalProperties.InitialElevation)K.curDistance=K.externalProperties.InitialDistance K:SetAndBoundsCheckAzimuthValues()K:SetAndBoundsCheckElevationValues()K:SetAndBoundsCheckDistanceValues()end function m.GetModuleName(K)return"\079\114\098\105\116\097\108\067\097\109\101\114\097"end function m.SetInitialOrientation(d,K)if not K or not K.RootPart then warn("\079\114\098\105\116\097\108\067\097\109\101\114\097 \099\111\117\108\100 \110\111\116 \115\101\116 \105\110\105\116\105\097\108 \111\114\105\101\110\116\097\116\105\111\110 \100\117\101 \116\111 \109\105\115\115\105\110\103 \104\117\109\097\110\111\105\100")return end local M=(K.RootPart.CFrame.lookVector-Vector3.new(0,.23,0)).unit local A=N.GetAngleBetweenXZVectors(M,d:GetCameraLookVector())local U=math.asin((d:GetCameraLookVector()).y)-math.asin(M.y)if not N.IsFinite(A)then A=0 end if not N.IsFinite(U)then U=0 end d.rotateInput=Vector2.new(A,U)end function m.GetCameraToSubjectDistance(K)return K.curDistance end function m.SetCameraToSubjectDistance(d,K)print("\079\114\098\105\116\097\108\067\097\109\101\114\097 \083\101\116\067\097\109\101\114\097\084\111\083\117\098\106\101\099\116\068\105\115\116\097\110\099\101 ",K)local M=G.LocalPlayer if M then d.currentSubjectDistance=math.clamp(K,d.minDistance,d.maxDistance)d.currentSubjectDistance=math.max(d.currentSubjectDistance,d.FIRST_PERSON_DISTANCE_THRESHOLD)end d.inFirstPerson=false d:UpdateMouseBehavior()return d.currentSubjectDistance end function m.CalculateNewLookVector(A,K,d)local U=K or A:GetCameraLookVector()local j=math.asin(U.y)local q=math.clamp(d.y,j-math.rad(P),j-math.rad(O))local N=Vector2.new(d.x,q)local G=CFrame.new(M,U)local c=((CFrame.Angles(0,-N.x,0)*G)*CFrame.Angles(-N.y,0,0)).lookVector return c end function m.GetGamepadPan(U,K,d,M)if M.UserInputType==U.activeGamepad and M.KeyCode==Enum.KeyCode.Thumbstick2 then if U.r3ButtonDown or U.l3ButtonDown then if M.Position.Y>j then U.gamepadDollySpeedMultiplier=.96 elseif M.Position.Y<-j then U.gamepadDollySpeedMultiplier=1.04 else U.gamepadDollySpeedMultiplier=1 end else if d==Enum.UserInputState.Cancel then U.gamepadPanningCamera=A return end local K=Vector2.new(M.Position.X,-M.Position.Y)if K.magnitude>j then U.gamepadPanningCamera=Vector2.new(M.Position.X,-M.Position.Y)else U.gamepadPanningCamera=A end end return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end function m.DoGamepadZoom(A,K,d,M)if M.UserInputType==A.activeGamepad and(M.KeyCode==Enum.KeyCode.ButtonR3 or M.KeyCode==Enum.KeyCode.ButtonL3)then if d==Enum.UserInputState.Begin then A.r3ButtonDown=M.KeyCode==Enum.KeyCode.ButtonR3 A.l3ButtonDown=M.KeyCode==Enum.KeyCode.ButtonL3 elseif d==Enum.UserInputState.End then if M.KeyCode==Enum.KeyCode.ButtonR3 then A.r3ButtonDown=false elseif M.KeyCode==Enum.KeyCode.ButtonL3 then A.l3ButtonDown=false end if not A.r3ButtonDown and not A.l3ButtonDown then A.gamepadDollySpeedMultiplier=1 end end return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end function m.BindGamepadInputActions(K)K:BindAction("\079\114\098\105\116\097\108\067\097\109\071\097\109\101\112\097\100\080\097\110",function(d,M,A)return K:GetGamepadPan(d,M,A)end,false,Enum.KeyCode.Thumbstick2)K:BindAction("\079\114\098\105\116\097\108\067\097\109\071\097\109\101\112\097\100\090\111\111\109",function(d,M,A)return K:DoGamepadZoom(d,M,A)end,false,Enum.KeyCode.ButtonR3,Enum.KeyCode.ButtonL3)end function m.Update(j,M)local O=tick()local P=O-j.lastUpdate local q=j.UserPanningTheCamera==true local N=workspace.CurrentCamera local H=N.CFrame local m=N.Focus local b=G.LocalPlayer local p=N and N.CameraSubject local t=p and p:IsA("\086\101\104\105\099\108\101\083\101\097\116")local L=p and p:IsA("\083\107\097\116\101\098\111\097\114\100\080\108\097\116\102\111\114\109")if j.lastUpdate==nil or P>1 then j.lastCameraTransform=nil end if j.lastUpdate then local K=j:UpdateGamepad()if j:ShouldUseVRRotation()then j.RotateInput=j.RotateInput+j:GetVRRotationInput()else local d=math.min(.1,P)if K~=A then q=true j.rotateInput=j.rotateInput+K*d end local M=0 if not(t or L)then M=M+(j.TurningLeft and-120 or 0)M=M+(j.TurningRight and 120 or 0)end if M~=0 then j.rotateInput=j.rotateInput+Vector2.new(math.rad(M*d),0)q=true end end end if q then j.lastUserPanCamera=tick()end local S=j:GetSubjectPosition()if S and(b and N)then if j.gamepadDollySpeedMultiplier~=1 then j:SetCameraToSubjectDistance(j.currentSubjectDistance*j.gamepadDollySpeedMultiplier)end local M=c.VREnabled m=M and j:GetVRFocus(S,P)or CFrame.new(S)local O=m.p if M and not j:IsInFirstPerson()then local K=j:GetCameraHeight()local M=S-N.CFrame.p local U=M.magnitude if U>j.currentSubjectDistance or j.rotateInput.x~=0 then local P=math.min(U,j.currentSubjectDistance)M=j:CalculateNewLookVector(M.unit*d,Vector2.new(j.rotateInput.x,0))*P local q=O-M local G=N.CFrame.lookVector if j.rotateInput.x~=0 then G=M end local c=Vector3.new(q.x+G.x,q.y,q.z+G.z)j.RotateInput=A H=CFrame.new(q,c)+Vector3.new(0,K,0)end else j.curAzimuthRad=j.curAzimuthRad-j.rotateInput.x if j.useAzimuthLimits then j.curAzimuthRad=math.clamp(j.curAzimuthRad,j.minAzimuthAbsoluteRad,j.maxAzimuthAbsoluteRad)else j.curAzimuthRad=j.curAzimuthRad~=0 and math.sign(j.curAzimuthRad)*(math.abs(j.curAzimuthRad)%U)or 0 end j.curElevationRad=math.clamp(j.curElevationRad+j.rotateInput.y,j.minElevationRad,j.maxElevationRad)local d=j.currentSubjectDistance*(CFrame.fromEulerAnglesYXZ(-j.curElevationRad,j.curAzimuthRad,0)*K)local M=S+d H=CFrame.new(M,S)j.rotateInput=A end j.lastCameraTransform=H j.lastCameraFocus=m if(t or L)and p:IsA("\066\097\115\101\080\097\114\116")then j.lastSubjectCFrame=p.CFrame else j.lastSubjectCFrame=nil end end j.lastUpdate=O return H,m end return m end function _ClassicCamera()local K=Vector2.new(0,0)local d=math.rad(220)local M=math.rad(0)local A=math.rad(250)local U=2 local j=CFrame.fromOrientation(math.rad(-15),0,0)local O do local K,d=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\067\097\109\101\114\097\084\111\103\103\108\101")end)O=K and d end local P=game:GetService("\080\108\097\121\101\114\115")local q=game:GetService("\086\082\083\101\114\118\105\099\101")local N=_CameraInput()local G=_CameraUtils()local c=_BaseCamera()local H=setmetatable({},c)H.__index=H function H.new()local K=setmetatable(c.new(),H)K.isFollowCamera=false K.isCameraToggle=false K.lastUpdate=tick()K.cameraToggleSpring=G.Spring.new(5,0)return K end function H.GetCameraToggleOffset(d,K)assert(O)if d.isCameraToggle then local M=d.currentSubjectDistance if N.getTogglePan()then d.cameraToggleSpring.goal=math.clamp(G.map(M,.5,d.FIRST_PERSON_DISTANCE_THRESHOLD,0,1),0,1)else d.cameraToggleSpring.goal=0 end local A=math.clamp(G.map(M,.5,64,0,1),0,1)+1 return Vector3.new(0,d.cameraToggleSpring:step(K)*A,0)end return Vector3.new()end function H.SetCameraMovementMode(d,K)c.SetCameraMovementMode(d,K)d.isFollowCamera=K==Enum.ComputerCameraMovementMode.Follow d.isCameraToggle=K==Enum.ComputerCameraMovementMode.CameraToggle end function H.Update(N)local c=tick()local H=c-N.lastUpdate local m=workspace.CurrentCamera local b=m.CFrame local p=m.Focus local t=nil if N.resetCameraAngle then local K=N:GetHumanoidRootPart()if K then t=(K.CFrame*j).lookVector else t=j.lookVector end N.resetCameraAngle=false end local L=P.LocalPlayer local S=N:GetHumanoid()local Z=m.CameraSubject local T=Z and Z:IsA("\086\101\104\105\099\108\101\083\101\097\116")local B=Z and Z:IsA("\083\107\097\116\101\098\111\097\114\100\080\108\097\116\102\111\114\109")local l=S and S:GetState()==Enum.HumanoidStateType.Climbing if N.lastUpdate==nil or H>1 then N.lastCameraTransform=nil end if N.lastUpdate then local d=N:UpdateGamepad()if N:ShouldUseVRRotation()then N.rotateInput=N.rotateInput+N:GetVRRotationInput()else local M=math.min(.1,H)if d~=K then N.rotateInput=N.rotateInput+d*M end local A=0 if not(T or B)then A=A+(N.turningLeft and-120 or 0)A=A+(N.turningRight and 120 or 0)end if A~=0 then N.rotateInput=N.rotateInput+Vector2.new(math.rad(A*M),0)end end end local e=N:GetCameraHeight()if N.userPanningTheCamera then M=0 N.lastUserPanCamera=tick()end local V=c-N.lastUserPanCamera<U local a=N:GetSubjectPosition()if a and(L and m)then local U=N:GetCameraToSubjectDistance()if U<.5 then U=.5 end if N:GetIsMouseLocked()and not N:IsInFirstPerson()then local K=N:CalculateNewLookCFrame(t)local d=N:GetMouseLockOffset()local M=(d.X*K.rightVector+d.Y*K.upVector)+d.Z*K.lookVector if G.IsFiniteVector3(M)then a=a+M end else if not N.userPanningTheCamera and N.lastCameraTransform then local K=N:IsInFirstPerson()if(T or B or N.isFollowCamera and l)and(N.lastUpdate and(S and S.Torso))then if K then if N.lastSubjectCFrame and((T or B)and Z:IsA("\066\097\115\101\080\097\114\116"))then local K=-G.GetAngleBetweenXZVectors(N.lastSubjectCFrame.lookVector,Z.CFrame.lookVector)if G.IsFinite(K)then N.rotateInput=N.rotateInput+Vector2.new(K,0)end M=0 end elseif not V then local K=S.Torso.CFrame.lookVector if B then K=Z.CFrame.lookVector end M=math.clamp(M+d*H,0,A)local U=math.clamp(M*H,0,1)if N:IsInFirstPerson()and not(N.isFollowCamera and N.isClimbing)then U=1 end local j=G.GetAngleBetweenXZVectors(K,N:GetCameraLookVector())if G.IsFinite(j)and math.abs(j)>.0001 then N.rotateInput=N.rotateInput+Vector2.new(j*U,0)end end elseif N.isFollowCamera and(not(K or V)and not q.VREnabled)then local K=-(N.lastCameraTransform.p-a)local d=G.GetAngleBetweenXZVectors(K,N:GetCameraLookVector())local M=.4 if G.IsFinite(d)and(math.abs(d)>.0001 and math.abs(d)>M*H)then N.rotateInput=N.rotateInput+Vector2.new(d,0)end end end end if not N.isFollowCamera then local d=q.VREnabled if d then p=N:GetVRFocus(a,H)else p=CFrame.new(a)end local M=p.p if d and not N:IsInFirstPerson()then local d=a-m.CFrame.p local A=d.magnitude if A>U or N.rotateInput.x~=0 then local j=math.min(A,U)d=N:CalculateNewLookVectorVR()*j local O=M-d local P=m.CFrame.lookVector if N.rotateInput.x~=0 then P=d end local q=Vector3.new(O.x+P.x,O.y,O.z+P.z)N.rotateInput=K b=CFrame.new(O,q)+Vector3.new(0,e,0)end else local d=N:CalculateNewLookVector(t)N.rotateInput=K b=CFrame.new(M-U*d,M)end else local d=N:CalculateNewLookVector(t)N.rotateInput=K if q.VREnabled then p=N:GetVRFocus(a,H)else p=CFrame.new(a)end b=CFrame.new(p.p-U*d,p.p)+Vector3.new(0,e,0)end if O then local K=N:GetCameraToggleOffset(H)p=p+K b=b+K end N.lastCameraTransform=b N.lastCameraFocus=p if(T or B)and Z:IsA("\066\097\115\101\080\097\114\116")then N.lastSubjectCFrame=Z.CFrame else N.lastSubjectCFrame=nil end end N.lastUpdate=c return b,p end function H.EnterFirstPerson(K)K.inFirstPerson=true K:UpdateMouseBehavior()end function H.LeaveFirstPerson(K)K.inFirstPerson=false K:UpdateMouseBehavior()end return H end function _CameraUtils()local K={}local d do local K,M=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\067\097\109\101\114\097\084\111\103\103\108\101")end)d=K and M end local function M(K)return math.floor(K+.5)end local A={}do A.__index=A function A.new(K,d)return setmetatable({freq=K,goal=d;pos=d;vel=0},A)end function A.step(d,K)local M=(d.freq*2)*math.pi local A=d.goal local U=d.pos local j=d.vel local O=U-A local P=math.exp(-M*K)local q=(O*(1+M*K)+j*K)*P+A local N=(j*(1-M*K)-O*((M*M)*K))*P d.pos=q d.vel=N return q end end K.Spring=A function K.map(K,d,M,A,U)return((K-d)*(U-A))/(M-d)+A end function K.Round(K,d)local M=10^d return math.floor(K*M+.5)/M end function K.IsFinite(K)return K==K and(K~=math.huge and K~=-math.huge)end function K.IsFiniteVector3(d)return K.IsFinite(d.X)and(K.IsFinite(d.Y)and K.IsFinite(d.Z))end function K.GetAngleBetweenXZVectors(K,d)return math.atan2(d.X*K.Z-d.Z*K.X,d.X*K.X+d.Z*K.Z)end function K.RotateVectorByAngleAndRound(K,d,A)if K.Magnitude>0 then K=K.unit local U=math.atan2(K.z,K.x)local j=M((math.atan2(K.z,K.x)+d)/A)*A return j-U end return 0 end local U=.35 local j=.8 local function O(K)K=math.clamp(K,-1,1)if K>=0 then return(U*K)/((U-K)+1)end return-((j*-K)/((j+K)+1))end local P=.1 local function q(K)return(1+P)*(2*math.abs(K)-1)-P end local function N(K)return K/2+.5 end function K.GamepadLinearToCurve(K)local function d(K)local d=1 if K<0 then d=-1 end local M=N(O(q(math.abs(K))))M=M*d return math.clamp(M,-1,1)end return Vector2.new(d(K.x),d(K.y))end function K.ConvertCameraModeEnumToStandard(K)if K==Enum.TouchCameraMovementMode.Default then return Enum.ComputerCameraMovementMode.Follow end if K==Enum.ComputerCameraMovementMode.Default then return Enum.ComputerCameraMovementMode.Classic end if K==Enum.TouchCameraMovementMode.Classic or K==Enum.DevTouchCameraMovementMode.Classic or K==Enum.DevComputerCameraMovementMode.Classic or K==Enum.ComputerCameraMovementMode.Classic then return Enum.ComputerCameraMovementMode.Classic end if K==Enum.TouchCameraMovementMode.Follow or K==Enum.DevTouchCameraMovementMode.Follow or K==Enum.DevComputerCameraMovementMode.Follow or K==Enum.ComputerCameraMovementMode.Follow then return Enum.ComputerCameraMovementMode.Follow end if K==Enum.TouchCameraMovementMode.Orbital or K==Enum.DevTouchCameraMovementMode.Orbital or K==Enum.DevComputerCameraMovementMode.Orbital or K==Enum.ComputerCameraMovementMode.Orbital then return Enum.ComputerCameraMovementMode.Orbital end if d then if K==Enum.ComputerCameraMovementMode.CameraToggle or K==Enum.DevComputerCameraMovementMode.CameraToggle then return Enum.ComputerCameraMovementMode.CameraToggle end end if K==Enum.DevTouchCameraMovementMode.UserChoice or K==Enum.DevComputerCameraMovementMode.UserChoice then return Enum.DevComputerCameraMovementMode.UserChoice end return Enum.ComputerCameraMovementMode.Classic end return K end function _CameraModule()local K={}K.__index=K local d do local K,M=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\067\097\109\101\114\097\084\111\103\103\108\101")end)d=K and M end local M do local K,d=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\082\101\109\111\118\101\084\104\101\067\097\109\101\114\097\065\112\105")end)M=K and d end local A={"\067\097\109\101\114\097\077\105\110\090\111\111\109\068\105\115\116\097\110\099\101","\067\097\109\101\114\097\077\097\120\090\111\111\109\068\105\115\116\097\110\099\101";"\067\097\109\101\114\097\077\111\100\101","\068\101\118\067\097\109\101\114\097\079\099\099\108\117\115\105\111\110\077\111\100\101","\068\101\118\067\111\109\112\117\116\101\114\067\097\109\101\114\097\077\111\100\101";"\068\101\118\084\111\117\099\104\067\097\109\101\114\097\077\111\100\101","\068\101\118\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101","\068\101\118\084\111\117\099\104\077\111\118\101\109\101\110\116\077\111\100\101","\068\101\118\069\110\097\098\108\101\077\111\117\115\101\076\111\099\107"}local U={"\067\111\109\112\117\116\101\114\067\097\109\101\114\097\077\111\118\101\109\101\110\116\077\111\100\101","\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101","\067\111\110\116\114\111\108\077\111\100\101","\071\097\109\101\112\097\100\067\097\109\101\114\097\083\101\110\115\105\116\105\118\105\116\121";"\077\111\117\115\101\083\101\110\115\105\116\105\118\105\116\121","\082\111\116\097\116\105\111\110\084\121\112\101","\084\111\117\099\104\067\097\109\101\114\097\077\111\118\101\109\101\110\116\077\111\100\101","\084\111\117\099\104\077\111\118\101\109\101\110\116\077\111\100\101"}local j=game:GetService("\080\108\097\121\101\114\115")local O=game:GetService("\082\117\110\083\101\114\118\105\099\101")local P=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local q=(UserSettings()):GetService("\085\115\101\114\071\097\109\101\083\101\116\116\105\110\103\115")local N=_CameraUtils()local G=_ClassicCamera()local c=_OrbitalCamera()local H=_LegacyCamera()local m=_Invisicam()local b=_Poppercam()local p=_TransparencyController()local t=_MouseLockController()local L={}local S={}do local K=j.LocalPlayer:WaitForChild("\080\108\097\121\101\114\083\099\114\105\112\116\115")K:RegisterTouchCameraMovementMode(Enum.TouchCameraMovementMode.Default)K:RegisterTouchCameraMovementMode(Enum.TouchCameraMovementMode.Follow)K:RegisterTouchCameraMovementMode(Enum.TouchCameraMovementMode.Classic)K:RegisterComputerCameraMovementMode(Enum.ComputerCameraMovementMode.Default)K:RegisterComputerCameraMovementMode(Enum.ComputerCameraMovementMode.Follow)K:RegisterComputerCameraMovementMode(Enum.ComputerCameraMovementMode.Classic)if d then K:RegisterComputerCameraMovementMode(Enum.ComputerCameraMovementMode.CameraToggle)end end K.FFlagUserCameraToggle=d function K.new()local d=setmetatable({},K)d.activeCameraController=nil d.activeOcclusionModule=nil d.activeTransparencyController=nil d.activeMouseLockController=nil d.currentComputerCameraMovementMode=nil d.cameraSubjectChangedConn=nil d.cameraTypeChangedConn=nil for K,M in pairs(j:GetPlayers())do d:OnPlayerAdded(M)end j.PlayerAdded:Connect(function(K)d:OnPlayerAdded(K)end)d.activeTransparencyController=p.new()d.activeTransparencyController:Enable(true)if not P.TouchEnabled then d.activeMouseLockController=t.new()local K=d.activeMouseLockController:GetBindableToggleEvent()if K then K:Connect(function()d:OnMouseLockToggled()end)end end d:ActivateCameraController(d:GetCameraControlChoice())d:ActivateOcclusionModule(j.LocalPlayer.DevCameraOcclusionMode)d:OnCurrentCameraChanged()O:BindToRenderStep("\099\097\109\101\114\097\082\101\110\100\101\114\085\112\100\097\116\101",Enum.RenderPriority.Camera.Value,function(K)d:Update(K)end)for K,M in pairs(A)do(j.LocalPlayer:GetPropertyChangedSignal(M)):Connect(function()d:OnLocalPlayerCameraPropertyChanged(M)end)end for K,M in pairs(U)do(q:GetPropertyChangedSignal(M)):Connect(function()d:OnUserGameSettingsPropertyChanged(M)end)end;(game.Workspace:GetPropertyChangedSignal("\067\117\114\114\101\110\116\067\097\109\101\114\097")):Connect(function()d:OnCurrentCameraChanged()end)d.lastInputType=P:GetLastInputType()P.LastInputTypeChanged:Connect(function(K)d.lastInputType=K end)return d end function K.GetCameraMovementModeFromSettings(K)local d=j.LocalPlayer.CameraMode if d==Enum.CameraMode.LockFirstPerson then return N.ConvertCameraModeEnumToStandard(Enum.ComputerCameraMovementMode.Classic)end local M,A if P.TouchEnabled then M=N.ConvertCameraModeEnumToStandard(j.LocalPlayer.DevTouchCameraMode)A=N.ConvertCameraModeEnumToStandard(q.TouchCameraMovementMode)else M=N.ConvertCameraModeEnumToStandard(j.LocalPlayer.DevComputerCameraMode)A=N.ConvertCameraModeEnumToStandard(q.ComputerCameraMovementMode)end if M==Enum.DevComputerCameraMovementMode.UserChoice then return A end return M end function K.ActivateOcclusionModule(d,K)local M if K==Enum.DevCameraOcclusionMode.Zoom then M=b elseif K==Enum.DevCameraOcclusionMode.Invisicam then M=m else warn("\067\097\109\101\114\097\083\099\114\105\112\116 \065\099\116\105\118\097\116\101\079\099\099\108\117\115\105\111\110\077\111\100\117\108\101 \099\097\108\108\101\100 \119\105\116\104 \117\110\115\117\112\112\111\114\116\101\100 \109\111\100\101")return end if d.activeOcclusionModule and d.activeOcclusionModule:GetOcclusionMode()==K then if not d.activeOcclusionModule:GetEnabled()then d.activeOcclusionModule:Enable(true)end return end local A=d.activeOcclusionModule d.activeOcclusionModule=S[M]if not d.activeOcclusionModule then d.activeOcclusionModule=M.new()if d.activeOcclusionModule then S[M]=d.activeOcclusionModule end end if d.activeOcclusionModule then local M=d.activeOcclusionModule:GetOcclusionMode()if M~=K then warn("\067\097\109\101\114\097\083\099\114\105\112\116 \065\099\116\105\118\097\116\101\079\099\099\108\117\115\105\111\110\077\111\100\117\108\101 \109\105\115\109\097\116\099\104\058 ",d.activeOcclusionModule:GetOcclusionMode(),"~\061",K)end if A then if A~=d.activeOcclusionModule then A:Enable(false)else warn("\067\097\109\101\114\097\083\099\114\105\112\116 \065\099\116\105\118\097\116\101\079\099\099\108\117\115\105\111\110\077\111\100\117\108\101 \102\097\105\108\117\114\101 \116\111 \100\101\116\101\099\116 \097\108\114\101\097\100\121 \114\117\110\110\105\110\103 \099\111\114\114\101\099\116 \109\111\100\117\108\101")end end if K==Enum.DevCameraOcclusionMode.Invisicam then if j.LocalPlayer.Character then d.activeOcclusionModule:CharacterAdded(j.LocalPlayer.Character,j.LocalPlayer)end else for K,M in pairs(j:GetPlayers())do if M and M.Character then d.activeOcclusionModule:CharacterAdded(M.Character,M)end end d.activeOcclusionModule:OnCameraSubjectChanged(game.Workspace.CurrentCamera.CameraSubject)end d.activeOcclusionModule:Enable(true)end end function K.ActivateCameraController(A,K,M)local U=nil if M~=nil then if M==Enum.CameraType.Scriptable then if A.activeCameraController then A.activeCameraController:Enable(false)A.activeCameraController=nil return end elseif M==Enum.CameraType.Custom then K=A:GetCameraMovementModeFromSettings()elseif M==Enum.CameraType.Track then K=Enum.ComputerCameraMovementMode.Classic elseif M==Enum.CameraType.Follow then K=Enum.ComputerCameraMovementMode.Follow elseif M==Enum.CameraType.Orbital then K=Enum.ComputerCameraMovementMode.Orbital elseif M==Enum.CameraType.Attach or M==Enum.CameraType.Watch or M==Enum.CameraType.Fixed then U=H else warn("\067\097\109\101\114\097\083\099\114\105\112\116 \101\110\099\111\117\110\116\101\114\101\100 \097\110 \117\110\104\097\110\100\108\101\100 \067\097\109\101\114\097\046\067\097\109\101\114\097\084\121\112\101 \118\097\108\117\101\058 ",M)end end if not U then if K==Enum.ComputerCameraMovementMode.Classic or K==Enum.ComputerCameraMovementMode.Follow or K==Enum.ComputerCameraMovementMode.Default or d and K==Enum.ComputerCameraMovementMode.CameraToggle then U=G elseif K==Enum.ComputerCameraMovementMode.Orbital then U=c else warn("\065\099\116\105\118\097\116\101\067\097\109\101\114\097\067\111\110\116\114\111\108\108\101\114 \100\105\100 \110\111\116 \115\101\108\101\099\116 \097 \109\111\100\117\108\101\046")return end end local j if not L[U]then j=U.new()L[U]=j else j=L[U]end if A.activeCameraController then if A.activeCameraController~=j then A.activeCameraController:Enable(false)A.activeCameraController=j A.activeCameraController:Enable(true)elseif not A.activeCameraController:GetEnabled()then A.activeCameraController:Enable(true)end elseif j~=nil then A.activeCameraController=j A.activeCameraController:Enable(true)end if A.activeCameraController then if K~=nil then A.activeCameraController:SetCameraMovementMode(K)elseif M~=nil then A.activeCameraController:SetCameraType(M)end end end function K.OnCameraSubjectChanged(K)if K.activeTransparencyController then K.activeTransparencyController:SetSubject(game.Workspace.CurrentCamera.CameraSubject)end if K.activeOcclusionModule then K.activeOcclusionModule:OnCameraSubjectChanged(game.Workspace.CurrentCamera.CameraSubject)end end function K.OnCameraTypeChanged(d,K)if K==Enum.CameraType.Scriptable then if P.MouseBehavior==Enum.MouseBehavior.LockCenter then P.MouseBehavior=Enum.MouseBehavior.Default end end d:ActivateCameraController(nil,K)end function K.OnCurrentCameraChanged(K)local d=game.Workspace.CurrentCamera if not d then return end if K.cameraSubjectChangedConn then K.cameraSubjectChangedConn:Disconnect()end if K.cameraTypeChangedConn then K.cameraTypeChangedConn:Disconnect()end K.cameraSubjectChangedConn=(d:GetPropertyChangedSignal("\067\097\109\101\114\097\083\117\098\106\101\099\116")):Connect(function()K:OnCameraSubjectChanged(d.CameraSubject)end)K.cameraTypeChangedConn=(d:GetPropertyChangedSignal("\067\097\109\101\114\097\084\121\112\101")):Connect(function()K:OnCameraTypeChanged(d.CameraType)end)K:OnCameraSubjectChanged(d.CameraSubject)K:OnCameraTypeChanged(d.CameraType)end function K.OnLocalPlayerCameraPropertyChanged(d,K)if K=="\067\097\109\101\114\097\077\111\100\101"then if j.LocalPlayer.CameraMode==Enum.CameraMode.LockFirstPerson then if not d.activeCameraController or d.activeCameraController:GetModuleName()~="\067\108\097\115\115\105\099\067\097\109\101\114\097"then d:ActivateCameraController(N.ConvertCameraModeEnumToStandard(Enum.DevComputerCameraMovementMode.Classic))end if d.activeCameraController then d.activeCameraController:UpdateForDistancePropertyChange()end elseif j.LocalPlayer.CameraMode==Enum.CameraMode.Classic then local K=d:GetCameraMovementModeFromSettings()d:ActivateCameraController(N.ConvertCameraModeEnumToStandard(K))else warn("\085\110\104\097\110\100\108\101\100 \118\097\108\117\101 \102\111\114 \112\114\111\112\101\114\116\121 \112\108\097\121\101\114\046\067\097\109\101\114\097\077\111\100\101\058 ",j.LocalPlayer.CameraMode)end elseif K=="\068\101\118\067\111\109\112\117\116\101\114\067\097\109\101\114\097\077\111\100\101"or K=="\068\101\118\084\111\117\099\104\067\097\109\101\114\097\077\111\100\101"then local K=d:GetCameraMovementModeFromSettings()d:ActivateCameraController(N.ConvertCameraModeEnumToStandard(K))elseif K=="\068\101\118\067\097\109\101\114\097\079\099\099\108\117\115\105\111\110\077\111\100\101"then d:ActivateOcclusionModule(j.LocalPlayer.DevCameraOcclusionMode)elseif K=="\067\097\109\101\114\097\077\105\110\090\111\111\109\068\105\115\116\097\110\099\101"or K=="\067\097\109\101\114\097\077\097\120\090\111\111\109\068\105\115\116\097\110\099\101"then if d.activeCameraController then d.activeCameraController:UpdateForDistancePropertyChange()end elseif K=="\068\101\118\084\111\117\099\104\077\111\118\101\109\101\110\116\077\111\100\101"then elseif K=="\068\101\118\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101"then elseif K=="\068\101\118\069\110\097\098\108\101\077\111\117\115\101\076\111\099\107"then end end function K.OnUserGameSettingsPropertyChanged(d,K)if K=="\067\111\109\112\117\116\101\114\067\097\109\101\114\097\077\111\118\101\109\101\110\116\077\111\100\101"then local K=d:GetCameraMovementModeFromSettings()d:ActivateCameraController(N.ConvertCameraModeEnumToStandard(K))end end function K.Update(M,K)if M.activeCameraController then if d then M.activeCameraController:UpdateMouseBehavior()end local A,U=M.activeCameraController:Update(K)M.activeCameraController:ApplyVRTransform()if M.activeOcclusionModule then A,U=M.activeOcclusionModule:Update(K,A,U)end game.Workspace.CurrentCamera.CFrame=A game.Workspace.CurrentCamera.Focus=U if M.activeTransparencyController then M.activeTransparencyController:Update()end end end function K.GetCameraControlChoice(K)local d=j.LocalPlayer if d then if K.lastInputType==Enum.UserInputType.Touch or P.TouchEnabled then if d.DevTouchCameraMode==Enum.DevTouchCameraMovementMode.UserChoice then return N.ConvertCameraModeEnumToStandard(q.TouchCameraMovementMode)else return N.ConvertCameraModeEnumToStandard(d.DevTouchCameraMode)end else if d.DevComputerCameraMode==Enum.DevComputerCameraMovementMode.UserChoice then local K=N.ConvertCameraModeEnumToStandard(q.ComputerCameraMovementMode)return N.ConvertCameraModeEnumToStandard(K)else return N.ConvertCameraModeEnumToStandard(d.DevComputerCameraMode)end end end end function K.OnCharacterAdded(M,K,d)if M.activeOcclusionModule then M.activeOcclusionModule:CharacterAdded(K,d)end end function K.OnCharacterRemoving(M,K,d)if M.activeOcclusionModule then M.activeOcclusionModule:CharacterRemoving(K,d)end end function K.OnPlayerAdded(d,K)K.CharacterAdded:Connect(function(M)d:OnCharacterAdded(M,K)end)K.CharacterRemoving:Connect(function(M)d:OnCharacterRemoving(M,K)end)end function K.OnMouseLockToggled(K)if K.activeMouseLockController then local d=K.activeMouseLockController:GetIsMouseLocked()local M=K.activeMouseLockController:GetMouseLockOffset()if K.activeCameraController then K.activeCameraController:SetIsMouseLocked(d)K.activeCameraController:SetMouseLockOffset(M)end end end local Z=K local T=CFrame.new()local B=T Z.UpVector=Vector3.new(0,1,0)Z.TransitionRate=.15 Z.UpCFrame=T function Z.GetUpVector(d,K)return K end local function l(K,d,M)local A,U=K:Dot(d),K:Cross(d)if A<-0.99999 then return CFrame.fromAxisAngle(M,math.pi)end return CFrame.new(0,0,0,U.x,U.y,U.z,1+A)end function Z.CalculateUpCFrame(K)local d=K.UpVector local M=K:GetUpVector(d)local A=game.Workspace.CurrentCamera.CFrame.RightVector local U=l(d,M,A)local j=T:Lerp(U,K.TransitionRate)K.UpVector=j*d K.UpCFrame=j*K.UpCFrame B=K.UpCFrame end function Z.Update(d,K)if d.activeCameraController then if Z.FFlagUserCameraToggle then d.activeCameraController:UpdateMouseBehavior()end local M,A=d.activeCameraController:Update(K)d.activeCameraController:ApplyVRTransform()d:CalculateUpCFrame()d.activeCameraController:UpdateUpCFrame(d.UpCFrame)local U=Vector3.new(0,0,0)if d.activeMouseLockController and d.activeMouseLockController:GetIsMouseLocked()then U=d.activeMouseLockController:GetMouseLockOffset()end local j=A:ToObjectSpace(M)local O=d.UpCFrame*j A=(A-M:VectorToWorldSpace(U))+O:VectorToWorldSpace(U)M=A*O if d.activeCameraController.lastCameraTransform then d.activeCameraController.lastCameraTransform=M d.activeCameraController.lastCameraFocus=A end if d.activeOcclusionModule then M,A=d.activeOcclusionModule:Update(K,M,A)end game.Workspace.CurrentCamera.CFrame=M game.Workspace.CurrentCamera.Focus=A if d.activeTransparencyController then d.activeTransparencyController:Update()end end end function Z.IsFirstPerson(K)if K.activeCameraController then return K.activeCameraController:InFirstPerson()end return false end function Z.IsMouseLocked(K)if K.activeCameraController then return K.activeCameraController:GetIsMouseLocked()end return false end function Z.IsToggleMode(K)if K.activeCameraController then return K.activeCameraController.isCameraToggle end return false end function Z.IsCamRelative(K)return K:IsMouseLocked()or K:IsFirstPerson()end local e=_CameraUtils()function e.GetAngleBetweenXZVectors(K,d)local M=B K=M:VectorToObjectSpace(K)d=M:VectorToObjectSpace(d)return math.atan2(d.X*K.Z-d.Z*K.X,d.X*K.X+d.Z*K.Z)end local V=K.new()local a={}return V end function _ClickToMoveDisplay()local K={}local d="\114\098\120\097\115\115\101\116\105\100\058\047\047\050\056\055\052\056\052\048\055\048\054"local M="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\117\105\047\116\114\097\105\108\100\111\116\046\112\110\103"local A="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\117\105\047\119\097\121\112\111\105\110\116\046\112\110\103"local U=false local j=2 local O=3 local P=UDim2.new(0,42,0,50)local q=Vector2.new(0,.5)local N=Vector2.new(0,1)local G=Vector2.new(0,.5)local c=Vector2.new(.1,.5)local H=Vector2.new(-0.1,.5)local m=.125 local b=4 local p=5 local t="\067\108\105\099\107\084\111\077\111\118\101\068\105\115\112\108\097\121"local L=Vector2.new(1.5,1.5)local S=1 local Z=10 local T=2.5 local B=100 local l=game:GetService("\080\108\097\121\101\114\115")local e=game:GetService("\084\119\101\101\110\083\101\114\118\105\099\101")local V=game:GetService("\082\117\110\083\101\114\118\105\099\101")local a=game:GetService("\087\111\114\107\115\112\097\099\101")local o=l.LocalPlayer local function Q()local K=Instance.new("\080\097\114\116")K.Size=Vector3.new(1,1,1)K.Anchored=true K.CanCollide=false K.Name="\084\114\097\105\108\068\111\116"K.Transparency=1 local d=Instance.new("\073\109\097\103\101\072\097\110\100\108\101\065\100\111\114\110\109\101\110\116")d.Name="\084\114\097\105\108\068\111\116\073\109\097\103\101"d.Size=L d.SizeRelativeOffset=Vector3.new(0,0,-0.1)d.AlwaysOnTop=U d.Image=M d.Adornee=K d.Parent=K local j=Instance.new("\080\097\114\116")j.Size=Vector3.new(2,2,2)j.Anchored=true j.CanCollide=false j.Name="\069\110\100\087\097\121\112\111\105\110\116"j.Transparency=1 local O=Instance.new("\073\109\097\103\101\072\097\110\100\108\101\065\100\111\114\110\109\101\110\116")O.Name="\084\114\097\105\108\068\111\116\073\109\097\103\101"O.Size=L O.SizeRelativeOffset=Vector3.new(0,0,-0.1)O.AlwaysOnTop=U O.Image=M O.Adornee=j O.Parent=j local N=Instance.new("\066\105\108\108\098\111\097\114\100\071\117\105")N.Name="\069\110\100\087\097\121\112\111\105\110\116\066\105\108\108\098\111\097\114\100"N.Size=P N.LightInfluence=0 N.SizeOffset=q N.AlwaysOnTop=true N.Adornee=j N.Parent=j local c=Instance.new("\073\109\097\103\101\076\097\098\101\108")c.Image=A c.BackgroundTransparency=1 c.Size=UDim2.new(1,0,1,0)c.Parent=N local H=Instance.new("\080\097\114\116")H.Size=Vector3.new(2,2,2)H.Anchored=true H.CanCollide=false H.Name="\070\097\105\108\117\114\101\087\097\121\112\111\105\110\116"H.Transparency=1 local m=Instance.new("\073\109\097\103\101\072\097\110\100\108\101\065\100\111\114\110\109\101\110\116")m.Name="\084\114\097\105\108\068\111\116\073\109\097\103\101"m.Size=L m.SizeRelativeOffset=Vector3.new(0,0,-0.1)m.AlwaysOnTop=U m.Image=M m.Adornee=H m.Parent=H local b=Instance.new("\066\105\108\108\098\111\097\114\100\071\117\105")b.Name="\070\097\105\108\117\114\101\087\097\121\112\111\105\110\116\066\105\108\108\098\111\097\114\100"b.Size=P b.LightInfluence=0 b.SizeOffset=G b.AlwaysOnTop=true b.Adornee=H b.Parent=H local p=Instance.new("\070\114\097\109\101")p.BackgroundTransparency=1 p.Size=UDim2.new(0,0,0,0)p.Position=UDim2.new(.5,0,1,0)p.Parent=b local t=Instance.new("\073\109\097\103\101\076\097\098\101\108")t.Image=A t.BackgroundTransparency=1 t.Position=UDim2.new(0,-P.X.Offset/2,0,-P.Y.Offset)t.Size=P t.Parent=p return K,j,H end local k,s,E=Q()local function x()local K=a.CurrentCamera local d=K:FindFirstChild(t)if not d then d=Instance.new("\077\111\100\101\108")d.Name=t d.Parent=K end return d end local function F(K,d)local M=Ray.new(d+Vector3.new(0,2.5,0),Vector3.new(0,-10,0))local A,U,j=a:FindPartOnRayWithIgnoreList(M,{a.CurrentCamera;o.Character})if A then K.CFrame=CFrame.new(U,U+j)K.Parent=x()end end local I={}I.__index=I function I.Destroy(K)K.DisplayModel:Destroy()end function I.NewDisplayModel(d,K)local M=k:Clone()F(M,K)return M end function I.new(K,d)local M=setmetatable({},I)M.DisplayModel=M:NewDisplayModel(K)M.ClosestWayPoint=d return M end local D={}D.__index=D function D.Destroy(K)K.Destroyed=true K.Tween:Cancel()K.DisplayModel:Destroy()end function D.NewDisplayModel(d,K)local M=s:Clone()F(M,K)return M end function D.CreateTween(K)local d=TweenInfo.new(.5,Enum.EasingStyle.Sine,Enum.EasingDirection.Out,-1,true)local M=e:Create(K.DisplayModel.EndWaypointBillboard,d,{SizeOffset=N})M:Play()return M end function D.TweenInFrom(d,K)local M=d.DisplayModel.Position local A=K-M d.DisplayModel.EndWaypointBillboard.StudsOffset=Vector3.new(0,A.Y,0)local U=TweenInfo.new(1,Enum.EasingStyle.Sine,Enum.EasingDirection.Out)local j=e:Create(d.DisplayModel.EndWaypointBillboard,U,{StudsOffset=Vector3.new(0,0,0)})j:Play()return j end function D.new(K,d,M)local A=setmetatable({},D)A.DisplayModel=A:NewDisplayModel(K)A.Destroyed=false if M and(M-K).magnitude>p then A.Tween=A:TweenInFrom(M);(coroutine.wrap(function()A.Tween.Completed:Wait()if not A.Destroyed then A.Tween=A:CreateTween()end end))()else A.Tween=A:CreateTween()end A.ClosestWayPoint=d return A end local w={}w.__index=w function w.Hide(K)K.DisplayModel.Parent=nil end function w.Destroy(K)K.DisplayModel:Destroy()end function w.NewDisplayModel(d,K)local M=E:Clone()F(M,K)local A=Ray.new(K+Vector3.new(0,2.5,0),Vector3.new(0,-10,0))local U,j,O=a:FindPartOnRayWithIgnoreList(A,{a.CurrentCamera,o.Character})if U then M.CFrame=CFrame.new(j,j+O)M.Parent=x()end return M end function w.RunFailureTween(K)wait(m)local d=TweenInfo.new(m/2,Enum.EasingStyle.Sine,Enum.EasingDirection.Out)local M=e:Create(K.DisplayModel.FailureWaypointBillboard,d,{SizeOffset=c})M:Play()local A=e:Create(K.DisplayModel.FailureWaypointBillboard.Frame,d,{Rotation=10})A:Play()M.Completed:wait()d=TweenInfo.new(m,Enum.EasingStyle.Sine,Enum.EasingDirection.Out,b-1,true)local U=e:Create(K.DisplayModel.FailureWaypointBillboard,d,{SizeOffset=H})U:Play()d=TweenInfo.new(m,Enum.EasingStyle.Sine,Enum.EasingDirection.Out,b-1,true)local j=e:Create(K.DisplayModel.FailureWaypointBillboard.Frame.ImageLabel,d,{ImageColor3=Color3.new(.75,.75,.75)})j:Play()local O=e:Create(K.DisplayModel.FailureWaypointBillboard.Frame,d,{Rotation=-10})O:Play()U.Completed:wait()d=TweenInfo.new(m/2,Enum.EasingStyle.Sine,Enum.EasingDirection.Out)local P=e:Create(K.DisplayModel.FailureWaypointBillboard,d,{SizeOffset=G})P:Play()local q=e:Create(K.DisplayModel.FailureWaypointBillboard.Frame,d,{Rotation=0})q:Play()P.Completed:wait()wait(m)end function w.new(K)local d=setmetatable({},w)d.DisplayModel=d:NewDisplayModel(K)return d end local v=Instance.new("\065\110\105\109\097\116\105\111\110")v.AnimationId=d local z=nil local f=nil local function g(K)if K==z then return f end f=K:LoadAnimation(v)f.Priority=Enum.AnimationPriority.Action f.Looped=false return f end local function X()local K=o.Character if K then return K:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")end end local function h(K,d)local M={}local A=1 for d=1,#K-1,1 do local U=(K[d].Position-K[#K].Position).magnitude<O local P=d%j==0 and not U if P then local U=I.new(K[d].Position,d)M[A]=U A=A+1 end end local U=D.new(K[#K].Position,#K,d)table.insert(M,U)local P={}A=1 for K=#M,1,-1 do P[A]=M[K]A=A+1 end return P end local function r(K,d)local M=B-Z local A=math.clamp(K-Z,0,M)/M local U=S+(T-S)*A return d*U end local i=0 function K.CreatePathDisplay(K,d)i=i+1 local M=h(K,d)local function A(K)for d=#M,1,-1 do local A=M[d]if A.ClosestWayPoint<=K then A:Destroy()M[d]=nil else break end end end local U="\067\108\105\099\107\084\111\077\111\118\101\082\101\115\105\122\101\084\114\097\105\108"..i local function j()if#M==0 then V:UnbindFromRenderStep(U)return end local K=a.CurrentCamera.CFrame.p for d=1,#M,1 do local A=M[d].DisplayModel:FindFirstChild("\084\114\097\105\108\068\111\116\073\109\097\103\101")if A then local U=(M[d].DisplayModel.Position-K).magnitude A.Size=r(U,L)end end end V:BindToRenderStep(U,Enum.RenderPriority.Camera.Value-1,j)local function O()A(#K)end return O,A end local Y=nil function K.DisplayFailureWaypoint(K)if Y then Y:Hide()end local d=w.new(K)Y=d;(coroutine.wrap(function()d:RunFailureTween()d:Destroy()d=nil end))()end function K.CreateEndWaypoint(K)return D.new(K)end function K.PlayFailureAnimation()local K=X()if K then local d=g(K)d:Play()end end function K.CancelFailureAnimation()if f~=nil and f.IsPlaying then f:Stop()end end function K.SetWaypointTexture(K)M=K k,s,E=Q()end function K.GetWaypointTexture()return M end function K.SetWaypointRadius(K)L=Vector2.new(K,K)k,s,E=Q()end function K.GetWaypointRadius()return L.X end function K.SetEndWaypointTexture(K)A=K k,s,E=Q()end function K.GetEndWaypointTexture()return A end function K.SetWaypointsAlwaysOnTop(K)U=K k,s,E=Q()end function K.GetWaypointsAlwaysOnTop()return U end return K end function _BaseCharacterController()local K=Vector3.new(0,0,0)local d={}d.__index=d function d.new()local M=setmetatable({},d)M.enabled=false M.moveVector=K M.moveVectorIsCameraRelative=true M.isJumping=false return M end function d.OnRenderStepped(d,K) end function d.GetMoveVector(K)return K.moveVector end function d.IsMoveVectorCameraRelative(K)return K.moveVectorIsCameraRelative end function d.GetIsJumping(K)return K.isJumping end function d.Enable(d,K)error("\066\097\115\101\067\104\097\114\097\099\116\101\114\067\111\110\116\114\111\108\108\101\114\058\069\110\097\098\108\101 \109\117\115\116 \098\101 \111\118\101\114\114\105\100\100\101\110 \105\110 \100\101\114\105\118\101\100 \099\108\097\115\115\101\115 \097\110\100 \115\104\111\117\108\100 \110\111\116 \098\101 \099\097\108\108\101\100\046")return false end return d end function _VehicleController()local K=game:GetService("\067\111\110\116\101\120\116\065\099\116\105\111\110\083\101\114\118\105\099\101")local d=true local M=false local A=Vector3.new(0,0,0)local U=35 local j={}j.__index=j function j.new(K)local d=setmetatable({},j)d.CONTROL_ACTION_PRIORITY=K d.enabled=false d.vehicleSeat=nil d.throttle=0 d.steer=0 d.acceleration=0 d.decceleration=0 d.turningRight=0 d.turningLeft=0 d.vehicleMoveVector=A d.autoPilot={}d.autoPilot.MaxSpeed=0 d.autoPilot.MaxSteeringAngle=0 return d end function j.BindContextActions(M)if d then K:BindActionAtPriority("\116\104\114\111\116\116\108\101\065\099\099\101\108",function(K,d,A)M:OnThrottleAccel(K,d,A)return Enum.ContextActionResult.Pass end,false,M.CONTROL_ACTION_PRIORITY,Enum.KeyCode.ButtonR2)K:BindActionAtPriority("\116\104\114\111\116\116\108\101\068\101\099\099\101\108",function(K,d,A)M:OnThrottleDeccel(K,d,A)return Enum.ContextActionResult.Pass end,false,M.CONTROL_ACTION_PRIORITY,Enum.KeyCode.ButtonL2)end K:BindActionAtPriority("\097\114\114\111\119\083\116\101\101\114\082\105\103\104\116",function(K,d,A)M:OnSteerRight(K,d,A)return Enum.ContextActionResult.Pass end,false,M.CONTROL_ACTION_PRIORITY,Enum.KeyCode.Right)K:BindActionAtPriority("\097\114\114\111\119\083\116\101\101\114\076\101\102\116",function(K,d,A)M:OnSteerLeft(K,d,A)return Enum.ContextActionResult.Pass end,false,M.CONTROL_ACTION_PRIORITY,Enum.KeyCode.Left)end function j.Enable(j,M,U)if M==j.enabled and U==j.vehicleSeat then return end j.enabled=M j.vehicleMoveVector=A if M then if U then j.vehicleSeat=U j:SetupAutoPilot()j:BindContextActions()end else if d then K:UnbindAction("\116\104\114\111\116\116\108\101\065\099\099\101\108")K:UnbindAction("\116\104\114\111\116\116\108\101\068\101\099\099\101\108")end K:UnbindAction("\097\114\114\111\119\083\116\101\101\114\082\105\103\104\116")K:UnbindAction("\097\114\114\111\119\083\116\101\101\114\076\101\102\116")j.vehicleSeat=nil end end function j.OnThrottleAccel(A,K,d,M)if d==Enum.UserInputState.End or d==Enum.UserInputState.Cancel then A.acceleration=0 else A.acceleration=-1 end A.throttle=A.acceleration+A.decceleration end function j.OnThrottleDeccel(A,K,d,M)if d==Enum.UserInputState.End or d==Enum.UserInputState.Cancel then A.decceleration=0 else A.decceleration=1 end A.throttle=A.acceleration+A.decceleration end function j.OnSteerRight(A,K,d,M)if d==Enum.UserInputState.End or d==Enum.UserInputState.Cancel then A.turningRight=0 else A.turningRight=1 end A.steer=A.turningRight+A.turningLeft end function j.OnSteerLeft(A,K,d,M)if d==Enum.UserInputState.End or d==Enum.UserInputState.Cancel then A.turningLeft=0 else A.turningLeft=-1 end A.steer=A.turningRight+A.turningLeft end function j.Update(O,K,U,j)if O.vehicleSeat then if U then K=K+Vector3.new(O.steer,0,O.throttle)if j and(M and d)then O.vehicleSeat.ThrottleFloat=-O.throttle else O.vehicleSeat.ThrottleFloat=-K.Z end O.vehicleSeat.SteerFloat=K.X return K,true else local d=O.vehicleSeat.Occupant.RootPart.CFrame:VectorToObjectSpace(K)O.vehicleSeat.ThrottleFloat=O:ComputeThrottle(d)O.vehicleSeat.SteerFloat=O:ComputeSteer(d)return A,true end end return K,false end function j.ComputeThrottle(d,K)if K~=A then local d=-K.Z return d else return 0 end end function j.ComputeSteer(d,K)if K~=A then local M=-math.atan2(-K.x,-K.z)*(180/math.pi)return M/d.autoPilot.MaxSteeringAngle else return 0 end end function j.SetupAutoPilot(K)K.autoPilot.MaxSpeed=K.vehicleSeat.MaxSpeed K.autoPilot.MaxSteeringAngle=U end return j end function _TouchJump()local K=game:GetService("\080\108\097\121\101\114\115")local d=game:GetService("\071\117\105\083\101\114\118\105\099\101")local M="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\117\105\047\073\110\112\117\116\047\084\111\117\099\104\067\111\110\116\114\111\108\115\083\104\101\101\116\086\050\046\112\110\103"local A=_BaseCharacterController()local U=setmetatable({},A)U.__index=U function U.new()local K=setmetatable(A.new(),U)K.parentUIFrame=nil K.jumpButton=nil K.characterAddedConn=nil K.humanoidStateEnabledChangedConn=nil K.humanoidJumpPowerConn=nil K.humanoidParentConn=nil K.externallyEnabled=false K.jumpPower=0 K.jumpStateEnabled=true K.isJumping=false K.humanoid=nil return K end function U.EnableButton(M,d)if d then if not M.jumpButton then M:Create()end local d=K.LocalPlayer.Character and K.LocalPlayer.Character:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")if d and M.externallyEnabled then if M.externallyEnabled then if d.JumpPower>0 then M.jumpButton.Visible=true end end end else M.jumpButton.Visible=false M.isJumping=false M.jumpButton.ImageRectOffset=Vector2.new(1,146)end end function U.UpdateEnabled(K)if K.jumpPower>0 and K.jumpStateEnabled then K:EnableButton(true)else K:EnableButton(false)end end function U.HumanoidChanged(M,d)local A=K.LocalPlayer.Character and K.LocalPlayer.Character:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")if A then if d=="\074\117\109\112\080\111\119\101\114"then M.jumpPower=A.JumpPower M:UpdateEnabled()elseif d=="\080\097\114\101\110\116"then if not A.Parent then M.humanoidChangeConn:Disconnect()end end end end function U.HumanoidStateEnabledChanged(M,K,d)if K==Enum.HumanoidStateType.Jumping then M.jumpStateEnabled=d M:UpdateEnabled()end end function U.CharacterAdded(d,K)if d.humanoidChangeConn then d.humanoidChangeConn:Disconnect()d.humanoidChangeConn=nil end d.humanoid=K:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")while not d.humanoid do K.ChildAdded:wait()d.humanoid=K:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")end d.humanoidJumpPowerConn=(d.humanoid:GetPropertyChangedSignal("\074\117\109\112\080\111\119\101\114")):Connect(function()d.jumpPower=d.humanoid.JumpPower d:UpdateEnabled()end)d.humanoidParentConn=(d.humanoid:GetPropertyChangedSignal("\080\097\114\101\110\116")):Connect(function()if not d.humanoid.Parent then d.humanoidJumpPowerConn:Disconnect()d.humanoidJumpPowerConn=nil d.humanoidParentConn:Disconnect()d.humanoidParentConn=nil end end)d.humanoidStateEnabledChangedConn=d.humanoid.StateEnabledChanged:Connect(function(K,M)d:HumanoidStateEnabledChanged(K,M)end)d.jumpPower=d.humanoid.JumpPower d.jumpStateEnabled=d.humanoid:GetStateEnabled(Enum.HumanoidStateType.Jumping)d:UpdateEnabled()end function U.SetupCharacterAddedFunction(d)d.characterAddedConn=K.LocalPlayer.CharacterAdded:Connect(function(K)d:CharacterAdded(K)end)if K.LocalPlayer.Character then d:CharacterAdded(K.LocalPlayer.Character)end end function U.Enable(M,K,d)if d then M.parentUIFrame=d end M.externallyEnabled=K M:EnableButton(K)end function U.Create(K)if not K.parentUIFrame then return end if K.jumpButton then K.jumpButton:Destroy()K.jumpButton=nil end local A=math.min(K.parentUIFrame.AbsoluteSize.x,K.parentUIFrame.AbsoluteSize.y)local U=A<=500 local j=U and 70 or 120 K.jumpButton=Instance.new("\073\109\097\103\101\066\117\116\116\111\110")K.jumpButton.Name="\074\117\109\112\066\117\116\116\111\110"K.jumpButton.Visible=false K.jumpButton.BackgroundTransparency=1 K.jumpButton.Image=M K.jumpButton.ImageRectOffset=Vector2.new(1,146)K.jumpButton.ImageRectSize=Vector2.new(144,144)K.jumpButton.Size=UDim2.new(0,j,0,j)K.jumpButton.Position=U and UDim2.new(1,-(j*1.5-10),1,-j-20)or UDim2.new(1,-(j*1.5-10),1,-j*1.75)local O=nil K.jumpButton.InputBegan:connect(function(d)if O or d.UserInputType~=Enum.UserInputType.Touch or d.UserInputState~=Enum.UserInputState.Begin then return end O=d K.jumpButton.ImageRectOffset=Vector2.new(146,146)K.isJumping=true end)local P=function()O=nil K.isJumping=false K.jumpButton.ImageRectOffset=Vector2.new(1,146)end K.jumpButton.InputEnded:connect(function(K)if K==O then P()end end)d.MenuOpened:connect(function()if O then P()end end)if not K.characterAddedConn then K:SetupCharacterAddedFunction()end K.jumpButton.Parent=K.parentUIFrame end return U end function _ClickToMoveController()local K=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local d=game:GetService("\080\097\116\104\102\105\110\100\105\110\103\083\101\114\118\105\099\101")local M=game:GetService("\080\108\097\121\101\114\115")local A=game:GetService("\068\101\098\114\105\115")local U=game:GetService("\083\116\097\114\116\101\114\071\117\105")local j=game:GetService("\087\111\114\107\115\112\097\099\101")local O=game:GetService("\067\111\108\108\101\099\116\105\111\110\083\101\114\118\105\099\101")local P=game:GetService("\071\117\105\083\101\114\118\105\099\101")local q=true local N=true local G=false local c=true local H=1 local m=8 local b={[Enum.KeyCode.W]=true,[Enum.KeyCode.A]=true;[Enum.KeyCode.S]=true,[Enum.KeyCode.D]=true;[Enum.KeyCode.Up]=true;[Enum.KeyCode.Down]=true}local p,t=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\078\097\118\105\103\097\116\105\111\110\067\108\105\099\107\084\111\077\111\118\101\083\107\105\112\080\097\115\115\101\100\087\097\121\112\111\105\110\116\115")end)local L=p and t local S=M.LocalPlayer local Z=_ClickToMoveDisplay()local T=Vector3.new(0,0,0)local B=1e-06 local l={}do local function K(d)if d then local M=d:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")if M then return d,M else return K(d.Parent)end end end l.FindCharacterAncestor=K local function d(M,A,U)U=U or{}local O,P,q,N=j:FindPartOnRayWithIgnoreList(M,U)if O then if A and O.CanCollide==false then local j,P=K(O)if P==nil then table.insert(U,O)return d(M,A,U)end end return O,P,q,N end return nil,nil end l.Raycast=d end local e={}local function V(K)local d=K and K.Character if d then local M=e[K]if M and M.Parent==d then return M else e[K]=nil local M=d:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")if M then e[K]=M end return M end end end local a local o=nil local Q=nil local k=nil local function s()return S and S.Character end local function E(K)if K==o then return end if Q then Q:Disconnect()Q=nil end if k then k:Disconnect()k=nil end o=K a={s()}if o~=nil then local K=O:GetTagged(o)for K,d in ipairs(K)do table.insert(a,d)end Q=(O:GetInstanceAddedSignal(o)):Connect(function(K)table.insert(a,K)end)k=(O:GetInstanceRemovedSignal(o)):Connect(function(K)for d=1,#a,1 do if a[d]==K then a[d]=a[#a]table.remove(a)break end end end)end end local function x()if a then return a end a={}table.insert(a,s())return a end local function F(K,M,A)local U={}local O local P if A~=nil then O=A P=A else O=G P=c end U.Cancelled=false U.Started=false U.Finished=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116")U.PathFailed=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116")U.PathComputing=false U.PathComputed=false U.OriginalTargetPoint=K U.TargetPoint=K U.TargetSurfaceNormal=M U.DiedConn=nil U.SeatedConn=nil U.BlockedConn=nil U.TeleportedConn=nil U.CurrentPoint=0 U.HumanoidOffsetFromPath=T U.CurrentWaypointPosition=nil U.CurrentWaypointPlaneNormal=T U.CurrentWaypointPlaneDistance=0 U.CurrentWaypointNeedsJump=false U.CurrentHumanoidPosition=T U.CurrentHumanoidVelocity=0 U.NextActionMoveDirection=T U.NextActionJump=false U.Timeout=0 U.Humanoid=V(S)U.OriginPoint=nil U.AgentCanFollowPath=false U.DirectPath=false U.DirectPathRiseFirst=false local N=U.Humanoid and U.Humanoid.RootPart if N then U.OriginPoint=N.CFrame.p local K=2 local M=5 local A=true local j=U.Humanoid.SeatPart if j and j:IsA("\086\101\104\105\099\108\101\083\101\097\116")then local d=j:FindFirstAncestorOfClass("\077\111\100\101\108")if d then local O=d.PrimaryPart d.PrimaryPart=j if P then local j=d:GetExtentsSize()K=(H*.5)*math.sqrt(j.X*j.X+j.Z*j.Z)M=H*j.Y A=false U.AgentCanFollowPath=true U.DirectPath=P end d.PrimaryPart=O end else local d=(s()):GetExtentsSize()K=(H*.5)*math.sqrt(d.X*d.X+d.Z*d.Z)M=H*d.Y A=U.Humanoid.JumpPower>0 U.AgentCanFollowPath=true U.DirectPath=O U.DirectPathRiseFirst=U.Humanoid.Sit end U.pathResult=d:CreatePath({AgentRadius=K,AgentHeight=M;AgentCanJump=A})end function U.Cleanup(K)if U.stopTraverseFunc then U.stopTraverseFunc()U.stopTraverseFunc=nil end if U.MoveToConn then U.MoveToConn:Disconnect()U.MoveToConn=nil end if U.BlockedConn then U.BlockedConn:Disconnect()U.BlockedConn=nil end if U.DiedConn then U.DiedConn:Disconnect()U.DiedConn=nil end if U.SeatedConn then U.SeatedConn:Disconnect()U.SeatedConn=nil end if U.TeleportedConn then U.TeleportedConn:Disconnect()U.TeleportedConn=nil end U.Started=false end function U.Cancel(K)U.Cancelled=true U:Cleanup()end function U.IsActive(K)return U.AgentCanFollowPath and(U.Started and not U.Cancelled)end function U.OnPathInterrupted(K)U.Cancelled=true U:OnPointReached(false)end function U.ComputePath(K)if U.OriginPoint then if U.PathComputed or U.PathComputing then return end U.PathComputing=true if U.AgentCanFollowPath then if U.DirectPath then U.pointList={PathWaypoint.new(U.OriginPoint,Enum.PathWaypointAction.Walk),PathWaypoint.new(U.TargetPoint,U.DirectPathRiseFirst and Enum.PathWaypointAction.Jump or Enum.PathWaypointAction.Walk)}U.PathComputed=true else U.pathResult:ComputeAsync(U.OriginPoint,U.TargetPoint)U.pointList=U.pathResult:GetWaypoints()U.BlockedConn=U.pathResult.Blocked:Connect(function(K)U:OnPathBlocked(K)end)U.PathComputed=U.pathResult.Status==Enum.PathStatus.Success end end U.PathComputing=false end end function U.IsValidPath(K)U:ComputePath()return U.PathComputed and U.AgentCanFollowPath end U.Recomputing=false function U.OnPathBlocked(d,K)local M=K>=U.CurrentPoint if not M or U.Recomputing then return end U.Recomputing=true if U.stopTraverseFunc then U.stopTraverseFunc()U.stopTraverseFunc=nil end U.OriginPoint=U.Humanoid.RootPart.CFrame.p U.pathResult:ComputeAsync(U.OriginPoint,U.TargetPoint)U.pointList=U.pathResult:GetWaypoints()if#U.pointList>0 then U.HumanoidOffsetFromPath=U.pointList[1].Position-U.OriginPoint end U.PathComputed=U.pathResult.Status==Enum.PathStatus.Success if q then U.stopTraverseFunc,U.setPointFunc=Z.CreatePathDisplay(U.pointList)end if U.PathComputed then U.CurrentPoint=1 U:OnPointReached(true)else U.PathFailed:Fire()U:Cleanup()end U.Recomputing=false end function U.OnRenderStepped(d,K)if U.Started and not U.Cancelled then U.Timeout=U.Timeout+K if U.Timeout>m then U:OnPointReached(false)return end U.CurrentHumanoidPosition=U.Humanoid.RootPart.Position+U.HumanoidOffsetFromPath U.CurrentHumanoidVelocity=U.Humanoid.RootPart.Velocity while U.Started and U:IsCurrentWaypointReached()do U:OnPointReached(true)end if U.Started then U.NextActionMoveDirection=U.CurrentWaypointPosition-U.CurrentHumanoidPosition if U.NextActionMoveDirection.Magnitude>B then U.NextActionMoveDirection=U.NextActionMoveDirection.Unit else U.NextActionMoveDirection=T end if U.CurrentWaypointNeedsJump then U.NextActionJump=true U.CurrentWaypointNeedsJump=false else U.NextActionJump=false end end end end function U.IsCurrentWaypointReached(K)local d=false if U.CurrentWaypointPlaneNormal~=T then local K=U.CurrentWaypointPlaneNormal:Dot(U.CurrentHumanoidPosition)-U.CurrentWaypointPlaneDistance local M=-U.CurrentWaypointPlaneNormal:Dot(U.CurrentHumanoidVelocity)local A=math.max(1,.0625*M)d=K<A else d=true end if d then U.CurrentWaypointPosition=nil U.CurrentWaypointPlaneNormal=T U.CurrentWaypointPlaneDistance=0 end return d end function U.OnPointReached(d,K)if K and not U.Cancelled then if U.setPointFunc then U.setPointFunc(U.CurrentPoint)end local K=U.CurrentPoint+1 if K>#U.pointList then if U.stopTraverseFunc then U.stopTraverseFunc()end U.Finished:Fire()U:Cleanup()else local d=U.pointList[U.CurrentPoint]local M=U.pointList[K]local A=U.Humanoid:GetState()local j=A==Enum.HumanoidStateType.FallingDown or A==Enum.HumanoidStateType.Freefall or A==Enum.HumanoidStateType.Jumping if j then local K=M.Action==Enum.PathWaypointAction.Jump if not K and U.CurrentPoint>1 then local A=U.pointList[U.CurrentPoint-1]local j=d.Position-A.Position local O=M.Position-d.Position local P=(Vector2.new(j.x,j.z)).Unit local q=(Vector2.new(O.x,O.z)).Unit local N=.996 K=P:Dot(q)<N end if K then U.Humanoid.FreeFalling:Wait()wait(.1)end end if L then U:MoveToNextWayPoint(d,M,K)else if U.setPointFunc then U.setPointFunc(K)end if M.Action==Enum.PathWaypointAction.Jump then U.Humanoid.Jump=true end U.Humanoid:MoveTo(M.Position)U.CurrentPoint=K end end else U.PathFailed:Fire()U:Cleanup()end end function U.MoveToNextWayPoint(A,K,d,M)U.CurrentWaypointPlaneNormal=K.Position-d.Position U.CurrentWaypointPlaneNormal=Vector3.new(U.CurrentWaypointPlaneNormal.X,0,U.CurrentWaypointPlaneNormal.Z)if U.CurrentWaypointPlaneNormal.Magnitude>B then U.CurrentWaypointPlaneNormal=U.CurrentWaypointPlaneNormal.Unit U.CurrentWaypointPlaneDistance=U.CurrentWaypointPlaneNormal:Dot(d.Position)else U.CurrentWaypointPlaneNormal=T U.CurrentWaypointPlaneDistance=0 end U.CurrentWaypointNeedsJump=d.Action==Enum.PathWaypointAction.Jump U.CurrentWaypointPosition=d.Position U.CurrentPoint=M U.Timeout=0 end function U.Start(d,K)if not U.AgentCanFollowPath then U.PathFailed:Fire()return end if U.Started then return end U.Started=true Z.CancelFailureAnimation()if q then if K==nil or K then U.stopTraverseFunc,U.setPointFunc=Z.CreatePathDisplay(U.pointList,U.OriginalTargetPoint)end end if#U.pointList>0 then U.HumanoidOffsetFromPath=Vector3.new(0,U.pointList[1].Position.Y-U.OriginPoint.Y,0)U.CurrentHumanoidPosition=U.Humanoid.RootPart.Position+U.HumanoidOffsetFromPath U.CurrentHumanoidVelocity=U.Humanoid.RootPart.Velocity U.SeatedConn=U.Humanoid.Seated:Connect(function(K,d)U:OnPathInterrupted()end)U.DiedConn=U.Humanoid.Died:Connect(function()U:OnPathInterrupted()end)U.TeleportedConn=(U.Humanoid.RootPart:GetPropertyChangedSignal("\067\070\114\097\109\101")):Connect(function()U:OnPathInterrupted()end)U.CurrentPoint=1 U:OnPointReached(true)else U.PathFailed:Fire()if U.stopTraverseFunc then U.stopTraverseFunc()end end end local b=U.TargetPoint+U.TargetSurfaceNormal*1.5 local p=Ray.new(b,Vector3.new(0,-1,0)*50)local t,l=j:FindPartOnRayWithIgnoreList(p,x())if t then U.TargetPoint=l end U:ComputePath()return U end local function I()local K=V(S)return K~=nil and K.Health>0 end local function D(K)if K~=nil then for K,d in pairs(K:GetChildren())do if d:IsA("\084\111\111\108")then return d end end end end local w=nil local v=nil local z=nil local f=nil local function g()if w then w:Cancel()w=nil end if z then z:Disconnect()z=nil end if f then f:Disconnect()f=nil end if v then v:Destroy()end end local function X(K,d,M,A,U)if w then g()end w=K K:Start(U)z=K.Finished.Event:Connect(function()g()if M then local K=D(A)if K then K:Activate()end end end)f=K.PathFailed.Event:Connect(function()g()if U==nil or U then local K=N and not(w and w:IsActive())if K then Z.PlayFailureAnimation()end Z.DisplayFailureWaypoint(d)end end)end local function h(K)if w and w:IsActive()then w:Cancel()end if N then Z.PlayFailureAnimation()end Z.DisplayFailureWaypoint(K)end function OnTap(K,d,A)local O=j.CurrentCamera local P=S.Character if not I()then return end if#K==1 or d then if O then local j=O:ScreenPointToRay(K[1].x,K[1].y)local q=Ray.new(j.Origin,j.Direction*1000)local N=V(S)local G,c,H=l.Raycast(q,true,x())local m,b=l.FindCharacterAncestor(G)if A and(b and U:GetCore("\065\118\097\116\097\114\067\111\110\116\101\120\116\077\101\110\117\069\110\097\098\108\101\100"))then local K=M:GetPlayerFromCharacter(b.Parent)if K then g()return end end if d then c=d m=nil end if c and P then g()local K=F(c,H)if K:IsValidPath()then X(K,c,m,P)else K:Cleanup()h(c)end end end elseif#K>=2 then if O then local K=D(P)if K then K:Activate()end end end end local function r(K)if K then K:Disconnect()end end local i=_Keyboard()local Y=setmetatable({},i)Y.__index=Y function Y.new(K)local d=setmetatable(i.new(K),Y)d.fingerTouches={}d.numUnsunkTouches=0 d.mouse1Down=tick()d.mouse1DownPos=Vector2.new()d.mouse2DownTime=tick()d.mouse2DownPos=Vector2.new()d.mouse2UpTime=tick()d.keyboardMoveVector=T d.tapConn=nil d.inputBeganConn=nil d.inputChangedConn=nil d.inputEndedConn=nil d.humanoidDiedConn=nil d.characterChildAddedConn=nil d.onCharacterAddedConn=nil d.characterChildRemovedConn=nil d.renderSteppedConn=nil d.menuOpenedConnection=nil d.running=false d.wasdEnabled=false return d end function Y.DisconnectEvents(K)r(K.tapConn)r(K.inputBeganConn)r(K.inputChangedConn)r(K.inputEndedConn)r(K.humanoidDiedConn)r(K.characterChildAddedConn)r(K.onCharacterAddedConn)r(K.renderSteppedConn)r(K.characterChildRemovedConn)r(K.menuOpenedConnection)end function Y.OnTouchBegan(M,K,d)if M.fingerTouches[K]==nil and not d then M.numUnsunkTouches=M.numUnsunkTouches+1 end M.fingerTouches[K]=d end function Y.OnTouchChanged(M,K,d)if M.fingerTouches[K]==nil then M.fingerTouches[K]=d if not d then M.numUnsunkTouches=M.numUnsunkTouches+1 end end end function Y.OnTouchEnded(M,K,d)if M.fingerTouches[K]~=nil and M.fingerTouches[K]==false then M.numUnsunkTouches=M.numUnsunkTouches-1 end M.fingerTouches[K]=nil end function Y.OnCharacterAdded(M,d)M:DisconnectEvents()M.inputBeganConn=K.InputBegan:Connect(function(K,d)if K.UserInputType==Enum.UserInputType.Touch then M:OnTouchBegan(K,d)end if M.wasdEnabled and(d==false and(K.UserInputType==Enum.UserInputType.Keyboard and b[K.KeyCode]))then g()Z.CancelFailureAnimation()end if K.UserInputType==Enum.UserInputType.MouseButton1 then M.mouse1DownTime=tick()M.mouse1DownPos=K.Position end if K.UserInputType==Enum.UserInputType.MouseButton2 then M.mouse2DownTime=tick()M.mouse2DownPos=K.Position end end)M.inputChangedConn=K.InputChanged:Connect(function(K,d)if K.UserInputType==Enum.UserInputType.Touch then M:OnTouchChanged(K,d)end end)M.inputEndedConn=K.InputEnded:Connect(function(K,d)if K.UserInputType==Enum.UserInputType.Touch then M:OnTouchEnded(K,d)end if K.UserInputType==Enum.UserInputType.MouseButton2 then M.mouse2UpTime=tick()local d=K.Position local A=w or M.keyboardMoveVector.Magnitude<=0 if M.mouse2UpTime-M.mouse2DownTime<.25 and((d-M.mouse2DownPos).magnitude<5 and A)then local K={d}OnTap(K)end end end)M.tapConn=K.TouchTap:Connect(function(K,d)if not d then OnTap(K,nil,true)end end)M.menuOpenedConnection=P.MenuOpened:Connect(function()g()end)local function U(d)if K.TouchEnabled then if d:IsA("\084\111\111\108")then d.ManualActivationOnly=true end end if d:IsA("\072\117\109\097\110\111\105\100")then r(M.humanoidDiedConn)M.humanoidDiedConn=d.Died:Connect(function()if v then A:AddItem(v.Model,1)end end)end end M.characterChildAddedConn=d.ChildAdded:Connect(function(K)U(K)end)M.characterChildRemovedConn=d.ChildRemoved:Connect(function(d)if K.TouchEnabled then if d:IsA("\084\111\111\108")then d.ManualActivationOnly=false end end end)for K,d in pairs(d:GetChildren())do U(d)end end function Y.Start(K)K:Enable(true)end function Y.Stop(K)K:Enable(false)end function Y.CleanupPath(K)g()end function Y.Enable(U,d,M,A)if d then if not U.running then if S.Character then U:OnCharacterAdded(S.Character)end U.onCharacterAddedConn=S.CharacterAdded:Connect(function(K)U:OnCharacterAdded(K)end)U.running=true end U.touchJumpController=A if U.touchJumpController then U.touchJumpController:Enable(U.jumpEnabled)end else if U.running then U:DisconnectEvents()g()if K.TouchEnabled then local K=S.Character if K then for K,d in pairs(K:GetChildren())do if d:IsA("\084\111\111\108")then d.ManualActivationOnly=false end end end end U.running=false end if U.touchJumpController and not U.jumpEnabled then U.touchJumpController:Enable(true)end U.touchJumpController=nil end if K.KeyboardEnabled and d~=U.enabled then U.forwardValue=0 U.backwardValue=0 U.leftValue=0 U.rightValue=0 U.moveVector=T if d then U:BindContextActions()U:ConnectFocusEventListeners()else U:UnbindContextActions()U:DisconnectFocusEventListeners()end end U.wasdEnabled=d and M or false U.enabled=d end function Y.OnRenderStepped(d,K)d.isJumping=false if w then w:OnRenderStepped(K)if w then d.moveVector=w.NextActionMoveDirection d.moveVectorIsCameraRelative=false if w.NextActionJump then d.isJumping=true end else d.moveVector=d.keyboardMoveVector d.moveVectorIsCameraRelative=true end else d.moveVector=d.keyboardMoveVector d.moveVectorIsCameraRelative=true end if d.jumpRequested then d.isJumping=true end end function Y.UpdateMovement(d,K)if K==Enum.UserInputState.Cancel then d.keyboardMoveVector=T elseif d.wasdEnabled then d.keyboardMoveVector=Vector3.new(d.leftValue+d.rightValue,0,d.forwardValue+d.backwardValue)end end function Y.UpdateJump(K) end function Y.SetShowPath(d,K)q=K end function Y.GetShowPath(K)return q end function Y.SetWaypointTexture(d,K)Z.SetWaypointTexture(K)end function Y.GetWaypointTexture(K)return Z.GetWaypointTexture()end function Y.SetWaypointRadius(d,K)Z.SetWaypointRadius(K)end function Y.GetWaypointRadius(K)return Z.GetWaypointRadius()end function Y.SetEndWaypointTexture(d,K)Z.SetEndWaypointTexture(K)end function Y.GetEndWaypointTexture(K)return Z.GetEndWaypointTexture()end function Y.SetWaypointsAlwaysOnTop(d,K)Z.SetWaypointsAlwaysOnTop(K)end function Y.GetWaypointsAlwaysOnTop(K)return Z.GetWaypointsAlwaysOnTop()end function Y.SetFailureAnimationEnabled(d,K)N=K end function Y.GetFailureAnimationEnabled(K)return N end function Y.SetIgnoredPartsTag(d,K)E(K)end function Y.GetIgnoredPartsTag(K)return o end function Y.SetUseDirectPath(d,K)G=K end function Y.GetUseDirectPath(K)return G end function Y.SetAgentSizeIncreaseFactor(d,K)H=1+K/100 end function Y.GetAgentSizeIncreaseFactor(K)return(H-1)*100 end function Y.SetUnreachableWaypointTimeout(d,K)m=K end function Y.GetUnreachableWaypointTimeout(K)return m end function Y.SetUserJumpEnabled(d,K)d.jumpEnabled=K if d.touchJumpController then d.touchJumpController:Enable(K)end end function Y.GetUserJumpEnabled(K)return K.jumpEnabled end function Y.MoveTo(A,K,d,M)local U=S.Character if U==nil then return false end local j=F(K,Vector3.new(0,1,0),M)if j and j:IsValidPath()then X(j,K,nil,U,d)return true end return false end return Y end function _TouchThumbstick()local K=game:GetService("\080\108\097\121\101\114\115")local d=game:GetService("\071\117\105\083\101\114\118\105\099\101")local M=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local A=Vector3.new(0,0,0)local U="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\117\105\047\084\111\117\099\104\067\111\110\116\114\111\108\115\083\104\101\101\116\046\112\110\103"local j=_BaseCharacterController()local O=setmetatable({},j)O.__index=O function O.new()local K=setmetatable(j.new(),O)K.isFollowStick=false K.thumbstickFrame=nil K.moveTouchObject=nil K.onTouchMovedConn=nil K.onTouchEndedConn=nil K.screenPos=nil K.stickImage=nil K.thumbstickSize=nil return K end function O.Enable(M,K,d)if K==nil then return false end K=K and true or false if M.enabled==K then return true end M.moveVector=A M.isJumping=false if K then if not M.thumbstickFrame then M:Create(d)end M.thumbstickFrame.Visible=true else M.thumbstickFrame.Visible=false M:OnInputEnded()end M.enabled=K end function O.OnInputEnded(K)K.thumbstickFrame.Position=K.screenPos K.stickImage.Position=UDim2.new(0,K.thumbstickFrame.Size.X.Offset/2-K.thumbstickSize/4,0,K.thumbstickFrame.Size.Y.Offset/2-K.thumbstickSize/4)K.moveVector=A K.isJumping=false K.thumbstickFrame.Position=K.screenPos K.moveTouchObject=nil end function O.Create(A,K)if A.thumbstickFrame then A.thumbstickFrame:Destroy()A.thumbstickFrame=nil if A.onTouchMovedConn then A.onTouchMovedConn:Disconnect()A.onTouchMovedConn=nil end if A.onTouchEndedConn then A.onTouchEndedConn:Disconnect()A.onTouchEndedConn=nil end end local j=math.min(K.AbsoluteSize.x,K.AbsoluteSize.y)local O=j<=500 A.thumbstickSize=O and 70 or 120 A.screenPos=O and UDim2.new(0,A.thumbstickSize/2-10,1,-A.thumbstickSize-20)or UDim2.new(0,A.thumbstickSize/2,1,-A.thumbstickSize*1.75)A.thumbstickFrame=Instance.new("\070\114\097\109\101")A.thumbstickFrame.Name="\084\104\117\109\098\115\116\105\099\107\070\114\097\109\101"A.thumbstickFrame.Active=true A.thumbstickFrame.Visible=false A.thumbstickFrame.Size=UDim2.new(0,A.thumbstickSize,0,A.thumbstickSize)A.thumbstickFrame.Position=A.screenPos A.thumbstickFrame.BackgroundTransparency=1 local P=Instance.new("\073\109\097\103\101\076\097\098\101\108")P.Name="\079\117\116\101\114\073\109\097\103\101"P.Image=U P.ImageRectOffset=Vector2.new()P.ImageRectSize=Vector2.new(220,220)P.BackgroundTransparency=1 P.Size=UDim2.new(0,A.thumbstickSize,0,A.thumbstickSize)P.Position=UDim2.new(0,0,0,0)P.Parent=A.thumbstickFrame A.stickImage=Instance.new("\073\109\097\103\101\076\097\098\101\108")A.stickImage.Name="\083\116\105\099\107\073\109\097\103\101"A.stickImage.Image=U A.stickImage.ImageRectOffset=Vector2.new(220,0)A.stickImage.ImageRectSize=Vector2.new(111,111)A.stickImage.BackgroundTransparency=1 A.stickImage.Size=UDim2.new(0,A.thumbstickSize/2,0,A.thumbstickSize/2)A.stickImage.Position=UDim2.new(0,A.thumbstickSize/2-A.thumbstickSize/4,0,A.thumbstickSize/2-A.thumbstickSize/4)A.stickImage.ZIndex=2 A.stickImage.Parent=A.thumbstickFrame local q=nil local N=.05 local function G(K)local d=K/(A.thumbstickSize/2)local M=d.magnitude if M<N then d=Vector3.new()else d=d.unit*((M-N)/(1-N))d=Vector3.new(d.x,0,d.y)end A.moveVector=d end local function c(K)local d=Vector2.new(K.x-q.x,K.y-q.y)local M=d.magnitude local U=A.thumbstickFrame.AbsoluteSize.x/2 if A.isFollowStick and M>U then local M=d.unit*U A.thumbstickFrame.Position=UDim2.new(0,(K.x-A.thumbstickFrame.AbsoluteSize.x/2)-M.x,0,(K.y-A.thumbstickFrame.AbsoluteSize.y/2)-M.y)else M=math.min(M,U)d=d.unit*M end A.stickImage.Position=UDim2.new(0,d.x+A.stickImage.AbsoluteSize.x/2,0,d.y+A.stickImage.AbsoluteSize.y/2)end A.thumbstickFrame.InputBegan:Connect(function(K)if A.moveTouchObject or K.UserInputType~=Enum.UserInputType.Touch or K.UserInputState~=Enum.UserInputState.Begin then return end A.moveTouchObject=K A.thumbstickFrame.Position=UDim2.new(0,K.Position.x-A.thumbstickFrame.Size.X.Offset/2,0,K.Position.y-A.thumbstickFrame.Size.Y.Offset/2)q=Vector2.new(A.thumbstickFrame.AbsolutePosition.x+A.thumbstickFrame.AbsoluteSize.x/2,A.thumbstickFrame.AbsolutePosition.y+A.thumbstickFrame.AbsoluteSize.y/2)local d=Vector2.new(K.Position.x-q.x,K.Position.y-q.y)end)A.onTouchMovedConn=M.TouchMoved:Connect(function(K,d)if K==A.moveTouchObject then q=Vector2.new(A.thumbstickFrame.AbsolutePosition.x+A.thumbstickFrame.AbsoluteSize.x/2,A.thumbstickFrame.AbsolutePosition.y+A.thumbstickFrame.AbsoluteSize.y/2)local d=Vector2.new(K.Position.x-q.x,K.Position.y-q.y)G(d)c(K.Position)end end)A.onTouchEndedConn=M.TouchEnded:Connect(function(K,d)if K==A.moveTouchObject then A:OnInputEnded()end end)d.MenuOpened:Connect(function()if A.moveTouchObject then A:OnInputEnded()end end)A.thumbstickFrame.Parent=K end return O end function _DynamicThumbstick()local K=Vector3.new(0,0,0)local d="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\117\105\047\073\110\112\117\116\047\084\111\117\099\104\067\111\110\116\114\111\108\115\083\104\101\101\116\086\050\046\112\110\103"local M="\068\121\110\097\109\105\099\084\104\117\109\098\115\116\105\099\107\065\099\116\105\111\110"local A=Enum.ContextActionPriority.High.Value local U={.11;.3,.4;.5,.6;.7,.75}local j=#U local O=true local P=.35 local q=.3 local N=.5 local G=TweenInfo.new(.15,Enum.EasingStyle.Quad,Enum.EasingDirection.InOut)local c=game:GetService("\080\108\097\121\101\114\115")local H=game:GetService("\071\117\105\083\101\114\118\105\099\101")local m=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local b=game:GetService("\067\111\110\116\101\120\116\065\099\116\105\111\110\083\101\114\118\105\099\101")local p=game:GetService("\082\117\110\083\101\114\118\105\099\101")local t=game:GetService("\084\119\101\101\110\083\101\114\118\105\099\101")local L=c.LocalPlayer if not L then(c:GetPropertyChangedSignal("\076\111\099\097\108\080\108\097\121\101\114")):Wait()L=c.LocalPlayer end local S=_BaseCharacterController()local Z=setmetatable({},S)Z.__index=Z function Z.new()local K=setmetatable(S.new(),Z)K.moveTouchObject=nil K.moveTouchLockedIn=false K.moveTouchFirstChanged=false K.moveTouchStartPosition=nil K.startImage=nil K.endImage=nil K.middleImages={}K.startImageFadeTween=nil K.endImageFadeTween=nil K.middleImageFadeTweens={}K.isFirstTouch=true K.thumbstickFrame=nil K.onRenderSteppedConn=nil K.fadeInAndOutBalance=N K.fadeInAndOutHalfDuration=q K.hasFadedBackgroundInPortrait=false K.hasFadedBackgroundInLandscape=false K.tweenInAlphaStart=nil K.tweenOutAlphaStart=nil return K end function Z.GetIsJumping(K)local d=K.isJumping K.isJumping=false return d end function Z.Enable(A,K,d)if K==nil then return false end K=K and true or false if A.enabled==K then return true end if K then if not A.thumbstickFrame then A:Create(d)end A:BindContextActions()else b:UnbindAction(M)A:OnInputEnded()end A.enabled=K A.thumbstickFrame.Visible=K end function Z.OnInputEnded(d)d.moveTouchObject=nil d.moveVector=K d:FadeThumbstick(false)end function Z.FadeThumbstick(d,K)if not K and d.moveTouchObject then return end if d.isFirstTouch then return end if d.startImageFadeTween then d.startImageFadeTween:Cancel()end if d.endImageFadeTween then d.endImageFadeTween:Cancel()end for K=1,#d.middleImages,1 do if d.middleImageFadeTweens[K]then d.middleImageFadeTweens[K]:Cancel()end end if K then d.startImageFadeTween=t:Create(d.startImage,G,{ImageTransparency=0})d.startImageFadeTween:Play()d.endImageFadeTween=t:Create(d.endImage,G,{ImageTransparency=.2})d.endImageFadeTween:Play()for K=1,#d.middleImages,1 do d.middleImageFadeTweens[K]=t:Create(d.middleImages[K],G,{ImageTransparency=U[K]})d.middleImageFadeTweens[K]:Play()end else d.startImageFadeTween=t:Create(d.startImage,G,{ImageTransparency=1})d.startImageFadeTween:Play()d.endImageFadeTween=t:Create(d.endImage,G,{ImageTransparency=1})d.endImageFadeTween:Play()for K=1,#d.middleImages,1 do d.middleImageFadeTweens[K]=t:Create(d.middleImages[K],G,{ImageTransparency=1})d.middleImageFadeTweens[K]:Play()end end end function Z.FadeThumbstickFrame(M,K,d)M.fadeInAndOutHalfDuration=K*.5 M.fadeInAndOutBalance=d M.tweenInAlphaStart=tick()end function Z.InputInFrame(d,K)local M=d.thumbstickFrame.AbsolutePosition local A=M+d.thumbstickFrame.AbsoluteSize local U=K.Position if U.X>=M.X and U.Y>=M.Y then if U.X<=A.X and U.Y<=A.Y then return true end end return false end function Z.DoFadeInBackground(K)local d=L:FindFirstChildOfClass("\080\108\097\121\101\114\071\117\105")local M=false if d then if d.CurrentScreenOrientation==Enum.ScreenOrientation.LandscapeLeft or d.CurrentScreenOrientation==Enum.ScreenOrientation.LandscapeRight then M=K.hasFadedBackgroundInLandscape K.hasFadedBackgroundInLandscape=true elseif d.CurrentScreenOrientation==Enum.ScreenOrientation.Portrait then M=K.hasFadedBackgroundInPortrait K.hasFadedBackgroundInPortrait=true end end if not M then K.fadeInAndOutHalfDuration=q K.fadeInAndOutBalance=N K.tweenInAlphaStart=tick()end end function Z.DoMove(M,d)local A=d local U=A.magnitude if U<M.radiusOfDeadZone then A=K else A=A.unit*(1-math.max(0,(M.radiusOfMaxSpeed-A.magnitude)/M.radiusOfMaxSpeed))A=Vector3.new(A.x,0,A.y)end M.moveVector=A end function Z.LayoutMiddleImages(M,K,d)local A=M.thumbstickSize/2+M.middleSize local U=d-K local O=(U.magnitude-M.thumbstickRingSize/2)-M.middleSize local P=U.unit local q=M.middleSpacing*j local N=M.middleSpacing if q<O then N=O/j end for K=1,j,1 do local U=M.middleImages[K]local j=A+N*(K-2)local q=A+N*(K-1)if j<O then local K=d-P*q local A=math.clamp(1-(q-O)/N,0,1)U.Visible=true U.Position=UDim2.new(0,K.X,0,K.Y)U.Size=UDim2.new(0,M.middleSize*A,0,M.middleSize*A)else U.Visible=false end end end function Z.MoveStick(d,K)local M=Vector2.new(d.moveTouchStartPosition.X,d.moveTouchStartPosition.Y)local A=M-d.thumbstickFrame.AbsolutePosition local U=Vector2.new(K.X,K.Y)-d.thumbstickFrame.AbsolutePosition d.endImage.Position=UDim2.new(0,U.X,0,U.Y)d:LayoutMiddleImages(A,U)end function Z.BindContextActions(K)local function d(d)if K.moveTouchObject then return Enum.ContextActionResult.Pass end if not K:InputInFrame(d)then return Enum.ContextActionResult.Pass end if K.isFirstTouch then K.isFirstTouch=false local d=TweenInfo.new(.5,Enum.EasingStyle.Quad,Enum.EasingDirection.Out,0,false,0);(t:Create(K.startImage,d,{Size=UDim2.new(0,0,0,0)})):Play();(t:Create(K.endImage,d,{Size=UDim2.new(0,K.thumbstickSize,0,K.thumbstickSize);ImageColor3=Color3.new(0,0,0)})):Play()end K.moveTouchLockedIn=false K.moveTouchObject=d K.moveTouchStartPosition=d.Position K.moveTouchFirstChanged=true if O then K:DoFadeInBackground()end return Enum.ContextActionResult.Pass end local function U(d)if d==K.moveTouchObject then if K.moveTouchFirstChanged then K.moveTouchFirstChanged=false local M=Vector2.new(d.Position.X-K.thumbstickFrame.AbsolutePosition.X,d.Position.Y-K.thumbstickFrame.AbsolutePosition.Y)K.startImage.Visible=true K.startImage.Position=UDim2.new(0,M.X,0,M.Y)K.endImage.Visible=true K.endImage.Position=K.startImage.Position K:FadeThumbstick(true)K:MoveStick(d.Position)end K.moveTouchLockedIn=true local M=Vector2.new(d.Position.x-K.moveTouchStartPosition.x,d.Position.y-K.moveTouchStartPosition.y)if math.abs(M.x)>0 or math.abs(M.y)>0 then K:DoMove(M)K:MoveStick(d.Position)end return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end local function j(d)if d==K.moveTouchObject then K:OnInputEnded()if K.moveTouchLockedIn then return Enum.ContextActionResult.Sink end end return Enum.ContextActionResult.Pass end local function P(M,A,O)if A==Enum.UserInputState.Begin then return d(O)elseif A==Enum.UserInputState.Change then return U(O)elseif A==Enum.UserInputState.End then return j(O)elseif A==Enum.UserInputState.Cancel then K:OnInputEnded()end end b:BindActionAtPriority(M,P,false,A,Enum.UserInputType.Touch)end function Z.Create(M,K)if M.thumbstickFrame then M.thumbstickFrame:Destroy()M.thumbstickFrame=nil if M.onRenderSteppedConn then M.onRenderSteppedConn:Disconnect()M.onRenderSteppedConn=nil end end M.thumbstickSize=45 M.thumbstickRingSize=20 M.middleSize=10 M.middleSpacing=M.middleSize+4 M.radiusOfDeadZone=2 M.radiusOfMaxSpeed=20 local A=K.AbsoluteSize local O=math.min(A.x,A.y)>500 if O then M.thumbstickSize=M.thumbstickSize*2 M.thumbstickRingSize=M.thumbstickRingSize*2 M.middleSize=M.middleSize*2 M.middleSpacing=M.middleSpacing*2 M.radiusOfDeadZone=M.radiusOfDeadZone*2 M.radiusOfMaxSpeed=M.radiusOfMaxSpeed*2 end local function q(K)if K then M.thumbstickFrame.Size=UDim2.new(1,0,.4,0)M.thumbstickFrame.Position=UDim2.new(0,0,.6,0)else M.thumbstickFrame.Size=UDim2.new(.4,0,.66666666666667,0)M.thumbstickFrame.Position=UDim2.new(0,0,.33333333333333,0)end end M.thumbstickFrame=Instance.new("\070\114\097\109\101")M.thumbstickFrame.BorderSizePixel=0 M.thumbstickFrame.Name="\068\121\110\097\109\105\099\084\104\117\109\098\115\116\105\099\107\070\114\097\109\101"M.thumbstickFrame.Visible=false M.thumbstickFrame.BackgroundTransparency=1 M.thumbstickFrame.BackgroundColor3=Color3.fromRGB(0,0,0)M.thumbstickFrame.Active=false q(false)M.startImage=Instance.new("\073\109\097\103\101\076\097\098\101\108")M.startImage.Name="\084\104\117\109\098\115\116\105\099\107\083\116\097\114\116"M.startImage.Visible=true M.startImage.BackgroundTransparency=1 M.startImage.Image=d M.startImage.ImageRectOffset=Vector2.new(1,1)M.startImage.ImageRectSize=Vector2.new(144,144)M.startImage.ImageColor3=Color3.new(0,0,0)M.startImage.AnchorPoint=Vector2.new(.5,.5)M.startImage.Position=UDim2.new(0,M.thumbstickRingSize*3.3,1,-M.thumbstickRingSize*2.8)M.startImage.Size=UDim2.new(0,M.thumbstickRingSize*3.7,0,M.thumbstickRingSize*3.7)M.startImage.ZIndex=10 M.startImage.Parent=M.thumbstickFrame M.endImage=Instance.new("\073\109\097\103\101\076\097\098\101\108")M.endImage.Name="\084\104\117\109\098\115\116\105\099\107\069\110\100"M.endImage.Visible=true M.endImage.BackgroundTransparency=1 M.endImage.Image=d M.endImage.ImageRectOffset=Vector2.new(1,1)M.endImage.ImageRectSize=Vector2.new(144,144)M.endImage.AnchorPoint=Vector2.new(.5,.5)M.endImage.Position=M.startImage.Position M.endImage.Size=UDim2.new(0,M.thumbstickSize*.8,0,M.thumbstickSize*.8)M.endImage.ZIndex=10 M.endImage.Parent=M.thumbstickFrame for K=1,j,1 do M.middleImages[K]=Instance.new("\073\109\097\103\101\076\097\098\101\108")M.middleImages[K].Name="\084\104\117\109\098\115\116\105\099\107\077\105\100\100\108\101"M.middleImages[K].Visible=false M.middleImages[K].BackgroundTransparency=1 M.middleImages[K].Image=d M.middleImages[K].ImageRectOffset=Vector2.new(1,1)M.middleImages[K].ImageRectSize=Vector2.new(144,144)M.middleImages[K].ImageTransparency=U[K]M.middleImages[K].AnchorPoint=Vector2.new(.5,.5)M.middleImages[K].ZIndex=9 M.middleImages[K].Parent=M.thumbstickFrame end local N=nil local function G()if N then N:Disconnect()N=nil end local K=workspace.CurrentCamera if K then local function d()local d=K.ViewportSize local M=d.X<d.Y q(M)end N=(K:GetPropertyChangedSignal("\086\105\101\119\112\111\114\116\083\105\122\101")):Connect(d)d()end end;(workspace:GetPropertyChangedSignal("\067\117\114\114\101\110\116\067\097\109\101\114\097")):Connect(G)if workspace.CurrentCamera then G()end M.moveTouchStartPosition=nil M.startImageFadeTween=nil M.endImageFadeTween=nil M.middleImageFadeTweens={}M.onRenderSteppedConn=p.RenderStepped:Connect(function()if M.tweenInAlphaStart~=nil then local K=tick()-M.tweenInAlphaStart local d=(M.fadeInAndOutHalfDuration*2)*M.fadeInAndOutBalance M.thumbstickFrame.BackgroundTransparency=1-P*math.min(K/d,1)if K>d then M.tweenOutAlphaStart=tick()M.tweenInAlphaStart=nil end elseif M.tweenOutAlphaStart~=nil then local K=tick()-M.tweenOutAlphaStart local d=M.fadeInAndOutHalfDuration*2-(M.fadeInAndOutHalfDuration*2)*M.fadeInAndOutBalance M.thumbstickFrame.BackgroundTransparency=(1-P)+P*math.min(K/d,1)if K>d then M.tweenOutAlphaStart=nil end end end)M.onTouchEndedConn=m.TouchEnded:connect(function(K)if K==M.moveTouchObject then M:OnInputEnded()end end)H.MenuOpened:connect(function()if M.moveTouchObject then M:OnInputEnded()end end)local c=L:FindFirstChildOfClass("\080\108\097\121\101\114\071\117\105")while not c do L.ChildAdded:wait()c=L:FindFirstChildOfClass("\080\108\097\121\101\114\071\117\105")end local b=nil local t=c.CurrentScreenOrientation==Enum.ScreenOrientation.LandscapeLeft or c.CurrentScreenOrientation==Enum.ScreenOrientation.LandscapeRight local function S()M.fadeInAndOutHalfDuration=2.5 M.fadeInAndOutBalance=.05 M.tweenInAlphaStart=tick()end b=(c:GetPropertyChangedSignal("\067\117\114\114\101\110\116\083\099\114\101\101\110\079\114\105\101\110\116\097\116\105\111\110")):Connect(function()if t and c.CurrentScreenOrientation==Enum.ScreenOrientation.Portrait or not t and c.CurrentScreenOrientation~=Enum.ScreenOrientation.Portrait then b:disconnect()S()if t then M.hasFadedBackgroundInPortrait=true else M.hasFadedBackgroundInLandscape=true end end end)M.thumbstickFrame.Parent=K if game:IsLoaded()then S()else(coroutine.wrap(function()game.Loaded:Wait()S()end))()end end return Z end function _Gamepad()local K=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local d=game:GetService("\067\111\110\116\101\120\116\065\099\116\105\111\110\083\101\114\118\105\099\101")local M=Vector3.new(0,0,0)local A=Enum.UserInputType.None local U=.2 local j=_BaseCharacterController()local O=setmetatable({},j)O.__index=O function O.new(K)local d=setmetatable(j.new(),O)d.CONTROL_ACTION_PRIORITY=K d.forwardValue=0 d.backwardValue=0 d.leftValue=0 d.rightValue=0 d.activeGamepad=A d.gamepadConnectedConn=nil d.gamepadDisconnectedConn=nil return d end function O.Enable(U,d)if not K.GamepadEnabled then return false end if d==U.enabled then return true end U.forwardValue=0 U.backwardValue=0 U.leftValue=0 U.rightValue=0 U.moveVector=M U.isJumping=false if d then U.activeGamepad=U:GetHighestPriorityGamepad()if U.activeGamepad~=A then U:BindContextActions()U:ConnectGamepadConnectionListeners()else return false end else U:UnbindContextActions()U:DisconnectGamepadConnectionListeners()U.activeGamepad=A end U.enabled=d return true end function O.GetHighestPriorityGamepad(d)local M=K:GetConnectedGamepads()local U=A for K,d in pairs(M)do if d.Value<U.Value then U=d end end return U end function O.BindContextActions(K)if K.activeGamepad==A then return false end local j=function(d,M,A)K.isJumping=M==Enum.UserInputState.Begin return Enum.ContextActionResult.Sink end local O=function(d,A,j)if A==Enum.UserInputState.Cancel then K.moveVector=M return Enum.ContextActionResult.Sink end if K.activeGamepad~=j.UserInputType then return Enum.ContextActionResult.Pass end if j.KeyCode~=Enum.KeyCode.Thumbstick1 then return end if j.Position.magnitude>U then K.moveVector=Vector3.new(j.Position.X,0,-j.Position.Y)else K.moveVector=M end return Enum.ContextActionResult.Sink end d:BindActivate(K.activeGamepad,Enum.KeyCode.ButtonR2)d:BindActionAtPriority("\106\117\109\112\065\099\116\105\111\110",j,false,K.CONTROL_ACTION_PRIORITY,Enum.KeyCode.ButtonA)d:BindActionAtPriority("\109\111\118\101\084\104\117\109\098\115\116\105\099\107",O,false,K.CONTROL_ACTION_PRIORITY,Enum.KeyCode.Thumbstick1)return true end function O.UnbindContextActions(K)if K.activeGamepad~=A then d:UnbindActivate(K.activeGamepad,Enum.KeyCode.ButtonR2)end d:UnbindAction("\109\111\118\101\084\104\117\109\098\115\116\105\099\107")d:UnbindAction("\106\117\109\112\065\099\116\105\111\110")end function O.OnNewGamepadConnected(K)local d=K:GetHighestPriorityGamepad()if d==K.activeGamepad then return end if d==A then warn("\071\097\109\101\112\097\100\058\079\110\078\101\119\071\097\109\101\112\097\100\067\111\110\110\101\099\116\101\100 \102\111\117\110\100 \110\111 \099\111\110\110\101\099\116\101\100 \103\097\109\101\112\097\100\115")K:UnbindContextActions()return end if K.activeGamepad~=A then K:UnbindContextActions()end K.activeGamepad=d K:BindContextActions()end function O.OnCurrentGamepadDisconnected(K)if K.activeGamepad~=A then d:UnbindActivate(K.activeGamepad,Enum.KeyCode.ButtonR2)end local M=K:GetHighestPriorityGamepad()if K.activeGamepad~=A and M==K.activeGamepad then warn("\071\097\109\101\112\097\100\058\079\110\067\117\114\114\101\110\116\071\097\109\101\112\097\100\068\105\115\099\111\110\110\101\099\116\101\100 \102\111\117\110\100 \116\104\101 \115\117\112\112\111\115\101\100\108\121 \100\105\115\099\111\110\110\101\099\116\101\100 \103\097\109\101\112\097\100 \105\110 \099\111\110\110\101\099\116\101\100\071\097\109\101\112\097\100\115\046")K:UnbindContextActions()K.activeGamepad=A return end if M==A then K:UnbindContextActions()K.activeGamepad=A else K.activeGamepad=M d:BindActivate(K.activeGamepad,Enum.KeyCode.ButtonR2)end end function O.ConnectGamepadConnectionListeners(d)d.gamepadConnectedConn=K.GamepadConnected:Connect(function(K)d:OnNewGamepadConnected()end)d.gamepadDisconnectedConn=K.GamepadDisconnected:Connect(function(K)if d.activeGamepad==K then d:OnCurrentGamepadDisconnected()end end)end function O.DisconnectGamepadConnectionListeners(K)if K.gamepadConnectedConn then K.gamepadConnectedConn:Disconnect()K.gamepadConnectedConn=nil end if K.gamepadDisconnectedConn then K.gamepadDisconnectedConn:Disconnect()K.gamepadDisconnectedConn=nil end end return O end function _Keyboard()local K=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local d=game:GetService("\067\111\110\116\101\120\116\065\099\116\105\111\110\083\101\114\118\105\099\101")local M=Vector3.new(0,0,0)local A=_BaseCharacterController()local U=setmetatable({},A)U.__index=U function U.new(K)local d=setmetatable(A.new(),U)d.CONTROL_ACTION_PRIORITY=K d.textFocusReleasedConn=nil d.textFocusGainedConn=nil d.windowFocusReleasedConn=nil d.forwardValue=0 d.backwardValue=0 d.leftValue=0 d.rightValue=0 d.jumpEnabled=true return d end function U.Enable(A,d)if not K.KeyboardEnabled then return false end if d==A.enabled then return true end A.forwardValue=0 A.backwardValue=0 A.leftValue=0 A.rightValue=0 A.moveVector=M A.jumpRequested=false A:UpdateJump()if d then A:BindContextActions()A:ConnectFocusEventListeners()else A:UnbindContextActions()A:DisconnectFocusEventListeners()end A.enabled=d return true end function U.UpdateMovement(d,K)if K==Enum.UserInputState.Cancel then d.moveVector=M else d.moveVector=Vector3.new(d.leftValue+d.rightValue,0,d.forwardValue+d.backwardValue)end end function U.UpdateJump(K)K.isJumping=K.jumpRequested end function U.BindContextActions(K)local M=function(d,M,A)K.forwardValue=M==Enum.UserInputState.Begin and-1 or 0 K:UpdateMovement(M)return Enum.ContextActionResult.Pass end local A=function(d,M,A)K.backwardValue=M==Enum.UserInputState.Begin and 1 or 0 K:UpdateMovement(M)return Enum.ContextActionResult.Pass end local U=function(d,M,A)K.leftValue=M==Enum.UserInputState.Begin and-1 or 0 K:UpdateMovement(M)return Enum.ContextActionResult.Pass end local j=function(d,M,A)K.rightValue=M==Enum.UserInputState.Begin and 1 or 0 K:UpdateMovement(M)return Enum.ContextActionResult.Pass end local O=function(d,M,A)K.jumpRequested=K.jumpEnabled and M==Enum.UserInputState.Begin K:UpdateJump()return Enum.ContextActionResult.Pass end d:BindActionAtPriority("\109\111\118\101\070\111\114\119\097\114\100\065\099\116\105\111\110",M,false,K.CONTROL_ACTION_PRIORITY,Enum.PlayerActions.CharacterForward)d:BindActionAtPriority("\109\111\118\101\066\097\099\107\119\097\114\100\065\099\116\105\111\110",A,false,K.CONTROL_ACTION_PRIORITY,Enum.PlayerActions.CharacterBackward)d:BindActionAtPriority("\109\111\118\101\076\101\102\116\065\099\116\105\111\110",U,false,K.CONTROL_ACTION_PRIORITY,Enum.PlayerActions.CharacterLeft)d:BindActionAtPriority("\109\111\118\101\082\105\103\104\116\065\099\116\105\111\110",j,false,K.CONTROL_ACTION_PRIORITY,Enum.PlayerActions.CharacterRight)d:BindActionAtPriority("\106\117\109\112\065\099\116\105\111\110",O,false,K.CONTROL_ACTION_PRIORITY,Enum.PlayerActions.CharacterJump)end function U.UnbindContextActions(K)d:UnbindAction("\109\111\118\101\070\111\114\119\097\114\100\065\099\116\105\111\110")d:UnbindAction("\109\111\118\101\066\097\099\107\119\097\114\100\065\099\116\105\111\110")d:UnbindAction("\109\111\118\101\076\101\102\116\065\099\116\105\111\110")d:UnbindAction("\109\111\118\101\082\105\103\104\116\065\099\116\105\111\110")d:UnbindAction("\106\117\109\112\065\099\116\105\111\110")end function U.ConnectFocusEventListeners(d)local function A()d.moveVector=M d.forwardValue=0 d.backwardValue=0 d.leftValue=0 d.rightValue=0 d.jumpRequested=false d:UpdateJump()end local function U(K)d.jumpRequested=false d:UpdateJump()end d.textFocusReleasedConn=K.TextBoxFocusReleased:Connect(A)d.textFocusGainedConn=K.TextBoxFocused:Connect(U)d.windowFocusReleasedConn=K.WindowFocused:Connect(A)end function U.DisconnectFocusEventListeners(K)if K.textFocusReleasedCon then K.textFocusReleasedCon:Disconnect()K.textFocusReleasedCon=nil end if K.textFocusGainedConn then K.textFocusGainedConn:Disconnect()K.textFocusGainedConn=nil end if K.windowFocusReleasedConn then K.windowFocusReleasedConn:Disconnect()K.windowFocusReleasedConn=nil end end return U end function _ControlModule()local K={}K.__index=K local d=game:GetService("\080\108\097\121\101\114\115")local M=game:GetService("\082\117\110\083\101\114\118\105\099\101")local A=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local U=game:GetService("\087\111\114\107\115\112\097\099\101")local j=(UserSettings()):GetService("\085\115\101\114\071\097\109\101\083\101\116\116\105\110\103\115")local O=_Keyboard()local P=_Gamepad()local q=_DynamicThumbstick()local N do local K,d=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\077\097\107\101\084\104\117\109\098\115\116\105\099\107\068\121\110\097\109\105\099")end)N=K and d end local G=N and q or _TouchThumbstick()local c=_ClickToMoveController()local H=_TouchJump()local m=_VehicleController()local b=Enum.ContextActionPriority.Default.Value local p={[Enum.TouchMovementMode.DPad]=q,[Enum.DevTouchMovementMode.DPad]=q;[Enum.TouchMovementMode.Thumbpad]=q,[Enum.DevTouchMovementMode.Thumbpad]=q,[Enum.TouchMovementMode.Thumbstick]=G;[Enum.DevTouchMovementMode.Thumbstick]=G;[Enum.TouchMovementMode.DynamicThumbstick]=q,[Enum.DevTouchMovementMode.DynamicThumbstick]=q,[Enum.TouchMovementMode.ClickToMove]=c,[Enum.DevTouchMovementMode.ClickToMove]=c;[Enum.TouchMovementMode.Default]=q;[Enum.ComputerMovementMode.Default]=O;[Enum.ComputerMovementMode.KeyboardMouse]=O;[Enum.DevComputerMovementMode.KeyboardMouse]=O;[Enum.DevComputerMovementMode.Scriptable]=nil;[Enum.ComputerMovementMode.ClickToMove]=c,[Enum.DevComputerMovementMode.ClickToMove]=c}local t={[Enum.UserInputType.Keyboard]=O;[Enum.UserInputType.MouseButton1]=O;[Enum.UserInputType.MouseButton2]=O,[Enum.UserInputType.MouseButton3]=O,[Enum.UserInputType.MouseWheel]=O,[Enum.UserInputType.MouseMovement]=O;[Enum.UserInputType.Gamepad1]=P;[Enum.UserInputType.Gamepad2]=P,[Enum.UserInputType.Gamepad3]=P;[Enum.UserInputType.Gamepad4]=P}local L function K.new()local U=setmetatable({},K)U.controllers={}U.activeControlModule=nil U.activeController=nil U.touchJumpController=nil U.moveFunction=d.LocalPlayer.Move U.humanoid=nil U.lastInputType=Enum.UserInputType.None U.humanoidSeatedConn=nil U.vehicleController=nil U.touchControlFrame=nil U.vehicleController=m.new(b)d.LocalPlayer.CharacterAdded:Connect(function(K)U:OnCharacterAdded(K)end)d.LocalPlayer.CharacterRemoving:Connect(function(K)U:OnCharacterRemoving(K)end)if d.LocalPlayer.Character then U:OnCharacterAdded(d.LocalPlayer.Character)end M:BindToRenderStep("\067\111\110\116\114\111\108\083\099\114\105\112\116\082\101\110\100\101\114\115\116\101\112",Enum.RenderPriority.Input.Value,function(K)U:OnRenderStepped(K)end)A.LastInputTypeChanged:Connect(function(K)U:OnLastInputTypeChanged(K)end);(j:GetPropertyChangedSignal("\084\111\117\099\104\077\111\118\101\109\101\110\116\077\111\100\101")):Connect(function()U:OnTouchMovementModeChange()end);(d.LocalPlayer:GetPropertyChangedSignal("\068\101\118\084\111\117\099\104\077\111\118\101\109\101\110\116\077\111\100\101")):Connect(function()U:OnTouchMovementModeChange()end);(j:GetPropertyChangedSignal("\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101")):Connect(function()U:OnComputerMovementModeChange()end);(d.LocalPlayer:GetPropertyChangedSignal("\068\101\118\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101")):Connect(function()U:OnComputerMovementModeChange()end)U.playerGui=nil U.touchGui=nil U.playerGuiAddedConn=nil if A.TouchEnabled then U.playerGui=d.LocalPlayer:FindFirstChildOfClass("\080\108\097\121\101\114\071\117\105")if U.playerGui then U:CreateTouchGuiContainer()U:OnLastInputTypeChanged(A:GetLastInputType())else U.playerGuiAddedConn=d.LocalPlayer.ChildAdded:Connect(function(K)if K:IsA("\080\108\097\121\101\114\071\117\105")then U.playerGui=K U:CreateTouchGuiContainer()U.playerGuiAddedConn:Disconnect()U.playerGuiAddedConn=nil U:OnLastInputTypeChanged(A:GetLastInputType())end end)end else U:OnLastInputTypeChanged(A:GetLastInputType())end return U end function K.GetMoveVector(K)if K.activeController then return K.activeController:GetMoveVector()end return Vector3.new(0,0,0)end function K.GetActiveController(K)return K.activeController end function K.EnableActiveControlModule(K)if K.activeControlModule==c then K.activeController:Enable(true,d.LocalPlayer.DevComputerMovementMode==Enum.DevComputerMovementMode.UserChoice,K.touchJumpController)elseif K.touchControlFrame then K.activeController:Enable(true,K.touchControlFrame)else K.activeController:Enable(true)end end function K.Enable(d,K)if not d.activeController then return end if K==nil then K=true end if K then d:EnableActiveControlModule()else d:Disable()end end function K.Disable(K)if K.activeController then K.activeController:Enable(false)if K.moveFunction then K.moveFunction(d.LocalPlayer,Vector3.new(0,0,0),true)end end end function K.SelectComputerMovementModule(K)if not(A.KeyboardEnabled or A.GamepadEnabled)then return nil,false end local M local U=d.LocalPlayer.DevComputerMovementMode if U==Enum.DevComputerMovementMode.UserChoice then M=t[L]if j.ComputerMovementMode==Enum.ComputerMovementMode.ClickToMove and M==O then M=c end else M=p[U]if not M and U~=Enum.DevComputerMovementMode.Scriptable then warn("\078\111 \099\104\097\114\097\099\116\101\114 \099\111\110\116\114\111\108 \109\111\100\117\108\101 \105\115 \097\115\115\111\099\105\097\116\101\100 \119\105\116\104 \068\101\118\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101 ",U)end end if M then return M,true elseif U==Enum.DevComputerMovementMode.Scriptable then return nil,true else return nil,false end end function K.SelectTouchModule(K)if not A.TouchEnabled then return nil,false end local M local U=d.LocalPlayer.DevTouchMovementMode if U==Enum.DevTouchMovementMode.UserChoice then M=p[j.TouchMovementMode]elseif U==Enum.DevTouchMovementMode.Scriptable then return nil,true else M=p[U]end return M,true end local function S(K,d)local M=U.CurrentCamera if not M then return d end if K:GetState()==Enum.HumanoidStateType.Swimming then return M.CFrame:VectorToWorldSpace(d)end local A,j local O,P,q,N,G,c,H,m,b,p,t,L=M.CFrame:GetComponents()if b<1 and b>-1 then A=L j=c else A=N j=-G*math.sign(b)end local S=math.sqrt(A*A+j*j)return Vector3.new((A*d.x+j*d.z)/S,0,(A*d.z-j*d.x)/S)end function K.OnRenderStepped(M,K)if M.activeController and(M.activeController.enabled and M.humanoid)then M.activeController:OnRenderStepped(K)local A=M.activeController:GetMoveVector()local U=M.activeController:IsMoveVectorCameraRelative()local j=M:GetClickToMoveController()if M.activeController~=j then if A.magnitude>0 then j:CleanupPath()else j:OnRenderStepped(K)A=j:GetMoveVector()U=j:IsMoveVectorCameraRelative()end end local O=false if M.vehicleController then A,O=M.vehicleController:Update(A,U,M.activeControlModule==P)end if U then A=S(M.humanoid,A)end M.moveFunction(d.LocalPlayer,A,false)M.humanoid.Jump=M.activeController:GetIsJumping()or M.touchJumpController and M.touchJumpController:GetIsJumping()end end function K.OnHumanoidSeated(M,K,d)if K then if d and d:IsA("\086\101\104\105\099\108\101\083\101\097\116")then if not M.vehicleController then M.vehicleController=M.vehicleController.new(b)end M.vehicleController:Enable(true,d)end else if M.vehicleController then M.vehicleController:Enable(false,d)end end end function K.OnCharacterAdded(d,K)d.humanoid=K:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")while not d.humanoid do K.ChildAdded:wait()d.humanoid=K:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")end if d.touchGui then d.touchGui.Enabled=true end if d.humanoidSeatedConn then d.humanoidSeatedConn:Disconnect()d.humanoidSeatedConn=nil end d.humanoidSeatedConn=d.humanoid.Seated:Connect(function(K,M)d:OnHumanoidSeated(K,M)end)end function K.OnCharacterRemoving(d,K)d.humanoid=nil if d.touchGui then d.touchGui.Enabled=false end end function K.SwitchToController(d,K)if not K then if d.activeController then d.activeController:Enable(false)end d.activeController=nil d.activeControlModule=nil else if not d.controllers[K]then d.controllers[K]=K.new(b)end if d.activeController~=d.controllers[K]then if d.activeController then d.activeController:Enable(false)end d.activeController=d.controllers[K]d.activeControlModule=K if d.touchControlFrame and(d.activeControlModule==c or d.activeControlModule==G or d.activeControlModule==q)then if not d.controllers[H]then d.controllers[H]=H.new()end d.touchJumpController=d.controllers[H]d.touchJumpController:Enable(true,d.touchControlFrame)else if d.touchJumpController then d.touchJumpController:Enable(false)end end d:EnableActiveControlModule()end end end function K.OnLastInputTypeChanged(d,K)if L==K then warn("\076\097\115\116\073\110\112\117\116\084\121\112\101 \067\104\097\110\103\101 \108\105\115\116\101\110\101\114 \099\097\108\108\101\100 \119\105\116\104 \099\117\114\114\101\110\116 \116\121\112\101\046")end L=K if L==Enum.UserInputType.Touch then local K,M=d:SelectTouchModule()if M then while not d.touchControlFrame do wait()end d:SwitchToController(K)end elseif t[L]~=nil then local K=d:SelectComputerMovementModule()if K then d:SwitchToController(K)end end end function K.OnComputerMovementModeChange(K)local d,M=K:SelectComputerMovementModule()if M then K:SwitchToController(d)end end function K.OnTouchMovementModeChange(K)local d,M=K:SelectTouchModule()if M then while not K.touchControlFrame do wait()end K:SwitchToController(d)end end function K.CreateTouchGuiContainer(K)if K.touchGui then K.touchGui:Destroy()end K.touchGui=Instance.new("\083\099\114\101\101\110\071\117\105")K.touchGui.Name="\084\111\117\099\104\071\117\105"K.touchGui.ResetOnSpawn=false K.touchGui.ZIndexBehavior=Enum.ZIndexBehavior.Sibling K.touchGui.Enabled=K.humanoid~=nil K.touchControlFrame=Instance.new("\070\114\097\109\101")K.touchControlFrame.Name="\084\111\117\099\104\067\111\110\116\114\111\108\070\114\097\109\101"K.touchControlFrame.Size=UDim2.new(1,0,1,0)K.touchControlFrame.BackgroundTransparency=1 K.touchControlFrame.Parent=K.touchGui K.touchGui.Parent=K.playerGui end function K.GetClickToMoveController(K)if not K.controllers[c]then K.controllers[c]=c.new(b)end return K.controllers[c]end function K.IsJumping(K)if K.activeController then return K.activeController:GetIsJumping()or K.touchJumpController and K.touchJumpController:GetIsJumping()end return false end return K.new()end function _PlayerModule()local K={}K.__index=K function K.new()local d=setmetatable({},K)d.cameras=_CameraModule()d.controls=_ControlModule()return d end function K.GetCameras(K)return K.cameras end function K.GetControls(K)return K.controls end function K.GetClickToMoveController(K)return K.controls:GetClickToMoveController()end return K.new()end function _sounds()local K=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116",script)local d=game:GetService("\080\108\097\121\101\114\115")local M=game:GetService("\082\117\110\083\101\114\118\105\099\101")local A={Climbing={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\097\099\116\105\111\110\095\102\111\111\116\115\116\101\112\115\095\112\108\097\115\116\105\099\046\109\112\051",Looped=true};Died={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\117\117\104\104\104\046\109\112\051"};FreeFalling={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\097\099\116\105\111\110\095\102\097\108\108\105\110\103\046\109\112\051";Looped=true},GettingUp={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\097\099\116\105\111\110\095\103\101\116\095\117\112\046\109\112\051"},Jumping={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\097\099\116\105\111\110\095\106\117\109\112\046\109\112\051"},Landing={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\097\099\116\105\111\110\095\106\117\109\112\095\108\097\110\100\046\109\112\051"},Running={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\097\099\116\105\111\110\095\102\111\111\116\115\116\101\112\115\095\112\108\097\115\116\105\099\046\109\112\051";Looped=true;Pitch=1.85},Splash={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\105\109\112\097\099\116\095\119\097\116\101\114\046\109\112\051"};Swimming={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\097\099\116\105\111\110\095\115\119\105\109\046\109\112\051",Looped=true,Pitch=1.6}}local function U(...)local K=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116")local d={...}local function M(...)for K=1,#d,1 do d[K]:Disconnect()end return K:Fire(...)end for K=1,#d,1 do d[K]=d[K]:Connect(M)end return K.Event:Wait()end local function j(K,d,M,A,U)return((K-d)*(U-A))/(M-d)+A end local function O(K)K.TimePosition=0 K.Playing=true end local function P(K)K.Playing=false K.TimePosition=0 end local function q(K)local d={}for K,M in pairs(K)do d[K]=M end return d end local function N(d,U,P)local N={}for K,d in pairs(A)do local M=Instance.new("\083\111\117\110\100")M.Name=K M.Archivable=false M.EmitterSize=5 M.MaxDistance=150 M.Volume=.65 for K,d in pairs(d)do M[K]=d end M.Parent=P N[K]=M end local G={}local function c(K)for d in pairs(q(G))do if d~=K then d.Playing=false G[d]=nil end end end local H={[Enum.HumanoidStateType.FallingDown]=function()c()end;[Enum.HumanoidStateType.GettingUp]=function()c()O(N.GettingUp)end;[Enum.HumanoidStateType.Jumping]=function()c()O(N.Jumping)end;[Enum.HumanoidStateType.Swimming]=function()local K=math.abs(P.Velocity.Y)if K>.1 then N.Splash.Volume=math.clamp(j(K,100,350,.28,1),0,1)O(N.Splash)end c(N.Swimming)N.Swimming.Playing=true G[N.Swimming]=true end;[Enum.HumanoidStateType.Freefall]=function()N.FreeFalling.Volume=0 c(N.FreeFalling)G[N.FreeFalling]=true end,[Enum.HumanoidStateType.Landed]=function()c()local K=math.abs(P.Velocity.Y)if K>75 then N.Landing.Volume=math.clamp(j(K,50,100,0,1),0,1)O(N.Landing)end end,[Enum.HumanoidStateType.Running]=function()c(N.Running)N.Running.Playing=true G[N.Running]=true end;[Enum.HumanoidStateType.Climbing]=function()local K=N.Climbing if math.abs(P.Velocity.Y)>.1 then K.Playing=true c(K)else c()end G[K]=true end,[Enum.HumanoidStateType.Seated]=function()c()end,[Enum.HumanoidStateType.Dead]=function()c()O(N.Died)end}local m={[N.Climbing]=function(K,d,M)d.Playing=M.Magnitude>.1 end,[N.FreeFalling]=function(K,d,M)if M.Magnitude>75 then d.Volume=math.clamp(d.Volume+.9*K,0,1)else d.Volume=0 end end;[N.Running]=function(K,d,M)d.Playing=M.Magnitude>.5 and U.MoveDirection.Magnitude>.5 end}local b={[Enum.HumanoidStateType.RunningNoPhysics]=Enum.HumanoidStateType.Running}local p=b[U:GetState()]or U:GetState()local t={}local L=U.StateChanged:Connect(function(K,d)d=b[d]or d if d~=p then local K=H[d]if K then K()end p=d end end)local S=K.Event:Connect(function(K)K=b[K]or K if K~=p then local d=H[K]if d then d()end p=K end end)local Z=M.Stepped:Connect(function(K,d)for K in pairs(G)do local M=m[K]if M then M(d,K,P.Velocity)end end end)local T local B local l local function e()L:Disconnect()S:Disconnect()Z:Disconnect()T:Disconnect()B:Disconnect()l:Disconnect()end T=U.AncestryChanged:Connect(function(K,d)if not d then e()end end)B=P.AncestryChanged:Connect(function(K,d)if not d then e()end end)l=d.CharacterAdded:Connect(e)end local function G(K)local function d(d)if not d.Parent then U(d.AncestryChanged,K.CharacterAdded)end if K.Character~=d or not d.Parent then return end local M=d:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")while d:IsDescendantOf(game)and not M do U(d.ChildAdded,d.AncestryChanged,K.CharacterAdded)M=d:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")end if K.Character~=d or not d:IsDescendantOf(game)then return end local A=d:FindFirstChild("\072\117\109\097\110\111\105\100\082\111\111\116\080\097\114\116")while d:IsDescendantOf(game)and not A do U(d.ChildAdded,d.AncestryChanged,M.AncestryChanged,K.CharacterAdded)A=d:FindFirstChild("\072\117\109\097\110\111\105\100\082\111\111\116\080\097\114\116")end if A and(M:IsDescendantOf(game)and(d:IsDescendantOf(game)and K.Character==d))then N(K,M,A)end end if K.Character then d(K.Character)end K.CharacterAdded:Connect(d)end d.PlayerAdded:Connect(G)for K,d in ipairs(d:GetPlayers())do G(d)end return K end function _StateTracker()local K=.1 local d={onRunning=true,onClimbing=true}local M={onFreeFall=true,onJumping=true}local A={onRunning=Enum.HumanoidStateType.Running;onJumping=Enum.HumanoidStateType.Jumping,onFreeFall=Enum.HumanoidStateType.Freefall}local U={}U.__index=U function U.new(K,d)local M=setmetatable({},U)M.Humanoid=K M.HRP=K.RootPart M.Speed=0 M.State="\111\110\082\117\110\110\105\110\103"M.Jumped=false M.JumpTick=tick()M.SoundState=d M._ChangedEvent=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116")M.Changed=M._ChangedEvent.Event return M end function U.Destroy(K)K._ChangedEvent:Destroy()end function U.RequestedJump(K)K.Jumped=true K.JumpTick=tick()end function U.OnStep(O,M,U,j)local P=O.HRP.Velocity local q=P:Dot(M)local N,G=O.State,O.Speed local c local H=P.Magnitude if not U then if q>0 then if O.Jumped then c="\111\110\074\117\109\112\105\110\103"else c="\111\110\070\114\101\101\070\097\108\108"end else if O.Jumped then O.Jumped=false end c="\111\110\070\114\101\101\070\097\108\108"end else if O.Jumped and tick()-O.JumpTick>.1 then O.Jumped=false end H=(P-q*M).Magnitude c="\111\110\082\117\110\110\105\110\103"end H=j and H or 0 if N~=c or d[c]and math.abs(G-H)>K then O.State=c O.Speed=H O.SoundState:Fire(A[c])O._ChangedEvent:Fire(O.State,O.Speed)end end return U end function _InitObjects()local K=workspace:FindFirstChild("\111\098\106\101\099\116\115")or(game:GetObjects("\114\098\120\097\115\115\101\116\105\100\058\047\047\053\048\052\053\052\048\056\052\056\057"))[1]local d=K:WaitForChild("\083\112\104\101\114\101")local M=K:WaitForChild("\070\108\111\111\114")local A=K:WaitForChild("\086\101\099\116\111\114\070\111\114\099\101")local U=K:WaitForChild("\066\111\100\121\071\121\114\111")local function j(K)local j=K.HRP local O=K.Humanoid local P=d:Clone()P.Parent=K.Character local q=M:Clone()q.Parent=K.Character local N=O.RigType==Enum.HumanoidRigType.R15 local G=N and O.HipHeight+.05 or 2 local c=Instance.new("\087\101\108\100")c.C0=CFrame.new(0,-G,.1)c.Part0=j c.Part1=P c.Parent=P local H=Instance.new("\087\101\108\100")H.C0=CFrame.new(0,-(G+1.5),0)H.Part0=j H.Part1=q H.Parent=q local m=U:Clone()m.CFrame=j.CFrame m.Parent=j local b=A:Clone()b.Attachment0=N and j:WaitForChild("\082\111\111\116\082\105\103\065\116\116\097\099\104\109\101\110\116")or j:WaitForChild("\082\111\111\116\065\116\116\097\099\104\109\101\110\116")b.Parent=j return P,m,b,q end return j end local K=game.Players.LocalPlayer local d=K:GetMouse()local M K.CharacterAdded:Connect(function(K)M=K end)function _R6()function r6()local K=M local d=K:WaitForChild("\084\111\114\115\111")local A=d:WaitForChild("\082\105\103\104\116 \083\104\111\117\108\100\101\114")local U=d:WaitForChild("\076\101\102\116 \083\104\111\117\108\100\101\114")local j=d:WaitForChild("\082\105\103\104\116 \072\105\112")local O=d:WaitForChild("\076\101\102\116 \072\105\112")local P=d:WaitForChild("\078\101\099\107")local q=K:WaitForChild("\072\117\109\097\110\111\105\100")local N="\083\116\097\110\100\105\110\103"local G=""local c=nil local H=nil local m=nil local b=1 local p={}local t={idle={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\048\052\051\053\053\055\049";weight=9},{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\048\052\051\053\055\057\050";weight=1}},walk={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\048\052\050\054\051\053\052",weight=10}};run={{id="\114\117\110\046\120\109\108";weight=10}},jump={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\050\053\055\053\048\055\048\050",weight=10}},fall={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\048\052\051\054\049\052\056";weight=10}},climb={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\048\052\051\054\051\051\052";weight=10}};sit={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\055\056\049\051\048\057\057\054";weight=10}},toolnone={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\051\057\051\052\055\056",weight=10}};toolslash={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\050\057\057\054\055\051\057\048",weight=10}};toollunge={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\050\057\057\054\055\052\055\056";weight=10}};wave={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\050\056\055\055\055\057\055\051";weight=10}},point={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\050\056\056\053\051\051\053\055",weight=10}},dance1={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\051\053\057\057\056",weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\057\049\048\051\055",weight=10},{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\057\049\048\054\053";weight=10}},dance2={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\051\054\056\052\050";weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\057\049\050\052\056";weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\057\049\050\055\055";weight=10}},dance3={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\051\054\057\051\053",weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\057\049\051\054\056",weight=10},{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\057\049\052\050\051";weight=10}},laugh={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\050\057\052\050\051\049\051\049",weight=10}};cheer={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\050\057\052\050\051\048\051\048",weight=10}}}local L={"\100\097\110\099\101\049","\100\097\110\099\101\050","\100\097\110\099\101\051"}local S={wave=false,point=false,dance1=true;dance2=true,dance3=true;laugh=false,cheer=false}function configureAnimationSet(K,d)if p[K]~=nil then for K,d in pairs(p[K].connections)do d:disconnect()end end p[K]={}p[K].count=0 p[K].totalWeight=0 p[K].connections={}local M=script:FindFirstChild(K)if M~=nil then table.insert(p[K].connections,M.ChildAdded:connect(function(M)configureAnimationSet(K,d)end))table.insert(p[K].connections,M.ChildRemoved:connect(function(M)configureAnimationSet(K,d)end))local A=1 for M,U in pairs(M:GetChildren())do if U:IsA("\065\110\105\109\097\116\105\111\110")then table.insert(p[K].connections,U.Changed:connect(function(M)configureAnimationSet(K,d)end))p[K][A]={}p[K][A].anim=U local M=U:FindFirstChild("\087\101\105\103\104\116")if M==nil then p[K][A].weight=1 else p[K][A].weight=M.Value end p[K].count=p[K].count+1 p[K].totalWeight=p[K].totalWeight+p[K][A].weight A=A+1 end end end if p[K].count<=0 then for d,M in pairs(d)do p[K][d]={}p[K][d].anim=Instance.new("\065\110\105\109\097\116\105\111\110")p[K][d].anim.Name=K p[K][d].anim.AnimationId=M.id p[K][d].weight=M.weight p[K].count=p[K].count+1 p[K].totalWeight=p[K].totalWeight+M.weight end end end function scriptChildModified(K)local d=t[K.Name]if d~=nil then configureAnimationSet(K.Name,d)end end script.ChildAdded:connect(scriptChildModified)script.ChildRemoved:connect(scriptChildModified)for K,d in pairs(t)do configureAnimationSet(K,d)end local Z="\078\111\110\101"local T=0 local B=0 local l=.3 local e=.1 local V=.3 local a=.75 function stopAllAnimations()local K=G if S[K]~=nil and S[K]==false then K="\105\100\108\101"end G=""c=nil if m~=nil then m:disconnect()end if H~=nil then H:Stop()H:Destroy()H=nil end return K end function setAnimationSpeed(K)if K~=b then b=K H:AdjustSpeed(b)end end function keyFrameReachedFunc(K)if K=="\069\110\100"then local K=G if S[K]~=nil and S[K]==false then K="\105\100\108\101"end local d=b playAnimation(K,0,q)setAnimationSpeed(d)end end function playAnimation(K,d,M)local A=math.random(1,p[K].totalWeight)local U=A local j=1 while A>p[K][j].weight do A=A-p[K][j].weight j=j+1 end local O=p[K][j].anim if O~=c then if H~=nil then H:Stop(d)H:Destroy()end b=1 H=M:LoadAnimation(O)H.Priority=Enum.AnimationPriority.Core H:Play(d)G=K c=O if m~=nil then m:disconnect()end m=H.KeyframeReached:connect(keyFrameReachedFunc)end end local o=""local Q=nil local k=nil local s=nil function toolKeyFrameReachedFunc(K)if K=="\069\110\100"then playToolAnimation(o,0,q)end end function playToolAnimation(K,d,M,A)local U=math.random(1,p[K].totalWeight)local j=U local O=1 while U>p[K][O].weight do U=U-p[K][O].weight O=O+1 end local P=p[K][O].anim if k~=P then if Q~=nil then Q:Stop()Q:Destroy()d=0 end Q=M:LoadAnimation(P)if A then Q.Priority=A end Q:Play(d)o=K k=P s=Q.KeyframeReached:connect(toolKeyFrameReachedFunc)end end function stopToolAnimations()local K=o if s~=nil then s:disconnect()end o=""k=nil if Q~=nil then Q:Stop()Q:Destroy()Q=nil end return K end function onRunning(K)if K>.01 then playAnimation("\119\097\108\107",.1,q)if c and c.AnimationId=="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\048\052\050\054\051\053\052"then setAnimationSpeed(K/14.5)end N="\082\117\110\110\105\110\103"else if S[G]==nil then playAnimation("\105\100\108\101",.1,q)N="\083\116\097\110\100\105\110\103"end end end function onDied()N="\068\101\097\100"end function onJumping()playAnimation("\106\117\109\112",.1,q)B=l N="\074\117\109\112\105\110\103"end function onClimbing(K)playAnimation("\099\108\105\109\098",.1,q)setAnimationSpeed(K/12)N="\067\108\105\109\098\105\110\103"end function onGettingUp()N="\071\101\116\116\105\110\103\085\112"end function onFreeFall()if B<=0 then playAnimation("\102\097\108\108",V,q)end N="\070\114\101\101\070\097\108\108"end function onFallingDown()N="\070\097\108\108\105\110\103\068\111\119\110"end function onSeated()N="\083\101\097\116\101\100"end function onPlatformStanding()N="\080\108\097\116\102\111\114\109\083\116\097\110\100\105\110\103"end function onSwimming(K)if K>0 then N="\082\117\110\110\105\110\103"else N="\083\116\097\110\100\105\110\103"end end function getTool()for K,d in ipairs(K:GetChildren())do if d.className=="\084\111\111\108"then return d end end return nil end function getToolAnim(K)for K,d in ipairs(K:GetChildren())do if d.Name=="\116\111\111\108\097\110\105\109"and d.className=="\083\116\114\105\110\103\086\097\108\117\101"then return d end end return nil end function animateTool()if Z=="\078\111\110\101"then playToolAnimation("\116\111\111\108\110\111\110\101",e,q,Enum.AnimationPriority.Idle)return end if Z=="\083\108\097\115\104"then playToolAnimation("\116\111\111\108\115\108\097\115\104",0,q,Enum.AnimationPriority.Action)return end if Z=="\076\117\110\103\101"then playToolAnimation("\116\111\111\108\108\117\110\103\101",0,q,Enum.AnimationPriority.Action)return end end function moveSit()A.MaxVelocity=.15 U.MaxVelocity=.15 A:SetDesiredAngle(1.57)U:SetDesiredAngle(-1.57)j:SetDesiredAngle(1.57)O:SetDesiredAngle(-1.57)end local E=0 function move(K)local d=1 local M=1 local P=K-E E=K local G=0 local c=false if B>0 then B=B-P end if N=="\070\114\101\101\070\097\108\108"and B<=0 then playAnimation("\102\097\108\108",V,q)elseif N=="\083\101\097\116\101\100"then playAnimation("\115\105\116",.5,q)return elseif N=="\082\117\110\110\105\110\103"then playAnimation("\119\097\108\107",.1,q)elseif N=="\068\101\097\100"or N=="\071\101\116\116\105\110\103\085\112"or N=="\070\097\108\108\105\110\103\068\111\119\110"or N=="\083\101\097\116\101\100"or N=="\080\108\097\116\102\111\114\109\083\116\097\110\100\105\110\103"then stopAllAnimations()d=.1 M=1 c=true end if c then local P=d*math.sin(K*M)A:SetDesiredAngle(P+G)U:SetDesiredAngle(P-G)j:SetDesiredAngle(-P)O:SetDesiredAngle(-P)end local H=getTool()if H and H:FindFirstChild("\072\097\110\100\108\101")then local d=getToolAnim(H)if d then Z=d.Value d.Parent=nil T=K+.3 end if K>T then T=0 Z="\078\111\110\101"end animateTool()else stopToolAnimations()Z="\078\111\110\101"k=nil T=0 end end local x={}local F=q local function I()for K=1,#x,1 do x[K]:Disconnect()end x={}end local function D()I()N=F.Sit and"\083\101\097\116\101\100"or"\083\116\097\110\100\105\110\103"x={F.Died:connect(onDied);F.Running:connect(onRunning);F.Jumping:connect(onJumping),F.Climbing:connect(onClimbing),F.GettingUp:connect(onGettingUp),F.FreeFalling:connect(onFreeFall);F.FallingDown:connect(onFallingDown);F.Seated:connect(onSeated);F.PlatformStanding:connect(onPlatformStanding);F.Swimming:connect(onSwimming)}end D();(game:GetService("\080\108\097\121\101\114\115")).LocalPlayer.Chatted:connect(function(K)local d=""if K=="\047\101 \100\097\110\099\101"then d=L[math.random(1,#L)]elseif string.sub(K,1,3)=="\047\101 "then d=string.sub(K,4)elseif string.sub(K,1,7)=="\047\101\109\111\116\101 "then d=string.sub(K,8)end if N=="\083\116\097\110\100\105\110\103"and S[d]~=nil then playAnimation(d,.1,q)end end)playAnimation("\105\100\108\101",.1,q)N="\083\116\097\110\100\105\110\103"spawn(function()while K.Parent~=nil do local K,d=wait(.1)move(d)end end)return{onRunning=onRunning;onDied=onDied,onJumping=onJumping;onClimbing=onClimbing;onGettingUp=onGettingUp;onFreeFall=onFreeFall,onFallingDown=onFallingDown;onSeated=onSeated,onPlatformStanding=onPlatformStanding;onHook=D;onUnhook=I}end return r6()end function _R15()local function K()local K=M local d=K:WaitForChild("\072\117\109\097\110\111\105\100")local A="\083\116\097\110\100\105\110\103"local U,j=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\078\111\085\112\100\097\116\101\079\110\076\111\111\112")end)local O=U and j local P,q=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\065\110\105\109\097\116\105\111\110\083\112\101\101\100\068\097\109\112\101\110\105\110\103")end)local N=P and q local G,c=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\065\110\105\109\097\116\101\083\099\114\105\112\116\069\109\111\116\101\072\111\111\107")end)local H=G and c local m=script:FindFirstChild("\083\099\097\108\101\068\097\109\112\101\110\105\110\103\080\101\114\099\101\110\116")local b=2 local p=.1 local t=""local L=nil local S=nil local Z=nil local T=1 local B=nil local l=nil local e={}local V={idle={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\054\054\054\054",weight=1},{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\054\057\053\049";weight=1},{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\054\051\056\056";weight=9}};walk={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\055\056\050\054";weight=10}},run={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\055\055\049\052",weight=10}},swim={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\056\052\056\057\055";weight=10}};swimidle={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\056\053\048\055\050";weight=10}};jump={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\053\048\048\048";weight=10}},fall={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\055\057\054\056",weight=10}};climb={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\053\054\052\052",weight=10}};sit={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\050\053\048\054\050\056\049\055\048\051",weight=10}};toolnone={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\056\051\055\053";weight=10}},toolslash={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\050\050\054\051\053\053\049\052",weight=10}};toollunge={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\050\050\054\051\056\055\054\055";weight=10}};wave={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\048\050\051\057";weight=10}};point={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\048\052\053\051";weight=10}};dance={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\049\048\049\057",weight=10},{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\049\057\053\053";weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\050\049\048\052";weight=10}};dance2={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\054\048\052\051",weight=10},{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\054\055\050\048",weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\054\056\055\057";weight=10}};dance3={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\055\050\054\056";weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\055\052\053\049";weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\055\054\050\051",weight=10}},laugh={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\048\056\049\056";weight=10}},cheer={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\048\054\055\055";weight=10}}}local a={wave=false;point=false,dance=true,dance2=true,dance3=true;laugh=false;cheer=false}local o=false local Q={}local k,s=pcall(function()o=(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\080\114\101\108\111\097\100\065\110\105\109\097\116\105\111\110\115")end)if not k then o=false end math.randomseed(tick())function findExistingAnimationInSet(K,d)if K==nil or d==nil then return 0 end for M=1,K.count,1 do if K[M].anim.AnimationId==d.AnimationId then return M end end return 0 end function configureAnimationSet(K,M)if e[K]~=nil then for K,d in pairs(e[K].connections)do d:disconnect()end end e[K]={}e[K].count=0 e[K].totalWeight=0 e[K].connections={}local A=true local U,j=pcall(function()A=(game:GetService("\083\116\097\114\116\101\114\080\108\097\121\101\114")).AllowCustomAnimations end)if not U then A=true end local O=script:FindFirstChild(K)if A and O~=nil then table.insert(e[K].connections,O.ChildAdded:connect(function(d)configureAnimationSet(K,M)end))table.insert(e[K].connections,O.ChildRemoved:connect(function(d)configureAnimationSet(K,M)end))local d=0 for A,U in pairs(O:GetChildren())do if U:IsA("\065\110\105\109\097\116\105\111\110")then local A=1 local j=U:FindFirstChild("\087\101\105\103\104\116")if j~=nil then A=j.Value end e[K].count=e[K].count+1 d=e[K].count e[K][d]={}e[K][d].anim=U e[K][d].weight=A e[K].totalWeight=e[K].totalWeight+e[K][d].weight table.insert(e[K].connections,U.Changed:connect(function(d)configureAnimationSet(K,M)end))table.insert(e[K].connections,U.ChildAdded:connect(function(d)configureAnimationSet(K,M)end))table.insert(e[K].connections,U.ChildRemoved:connect(function(d)configureAnimationSet(K,M)end))end end end if e[K].count<=0 then for d,M in pairs(M)do e[K][d]={}e[K][d].anim=Instance.new("\065\110\105\109\097\116\105\111\110")e[K][d].anim.Name=K e[K][d].anim.AnimationId=M.id e[K][d].weight=M.weight e[K].count=e[K].count+1 e[K].totalWeight=e[K].totalWeight+M.weight end end if o then for K,M in pairs(e)do for K=1,M.count,1 do if Q[M[K].anim.AnimationId]==nil then d:LoadAnimation(M[K].anim)Q[M[K].anim.AnimationId]=true end end end end end function configureAnimationSetOld(K,M)if e[K]~=nil then for K,d in pairs(e[K].connections)do d:disconnect()end end e[K]={}e[K].count=0 e[K].totalWeight=0 e[K].connections={}local A=true local U,j=pcall(function()A=(game:GetService("\083\116\097\114\116\101\114\080\108\097\121\101\114")).AllowCustomAnimations end)if not U then A=true end local O=script:FindFirstChild(K)if A and O~=nil then table.insert(e[K].connections,O.ChildAdded:connect(function(d)configureAnimationSet(K,M)end))table.insert(e[K].connections,O.ChildRemoved:connect(function(d)configureAnimationSet(K,M)end))local d=1 for A,U in pairs(O:GetChildren())do if U:IsA("\065\110\105\109\097\116\105\111\110")then table.insert(e[K].connections,U.Changed:connect(function(d)configureAnimationSet(K,M)end))e[K][d]={}e[K][d].anim=U local A=U:FindFirstChild("\087\101\105\103\104\116")if A==nil then e[K][d].weight=1 else e[K][d].weight=A.Value end e[K].count=e[K].count+1 e[K].totalWeight=e[K].totalWeight+e[K][d].weight d=d+1 end end end if e[K].count<=0 then for d,M in pairs(M)do e[K][d]={}e[K][d].anim=Instance.new("\065\110\105\109\097\116\105\111\110")e[K][d].anim.Name=K e[K][d].anim.AnimationId=M.id e[K][d].weight=M.weight e[K].count=e[K].count+1 e[K].totalWeight=e[K].totalWeight+M.weight end end if o then for K,M in pairs(e)do for K=1,M.count,1 do d:LoadAnimation(M[K].anim)end end end end function scriptChildModified(K)local d=V[K.Name]if d~=nil then configureAnimationSet(K.Name,d)end end script.ChildAdded:connect(scriptChildModified)script.ChildRemoved:connect(scriptChildModified)for K,d in pairs(V)do configureAnimationSet(K,d)end local E="\078\111\110\101"local x=0 local F=0 local I=.31 local D=.1 local w=.2 local v=false function stopAllAnimations()local K=t if a[K]~=nil and a[K]==false then K="\105\100\108\101"end if H and v then K="\105\100\108\101"v=false end t=""L=nil if Z~=nil then Z:disconnect()end if S~=nil then S:Stop()S:Destroy()S=nil end if l~=nil then l:disconnect()end if B~=nil then B:Stop()B:Destroy()B=nil end return K end function getHeightScale()if d then if not d.AutomaticScalingEnabled then return 1 end local K=d.HipHeight/b if N then if m==nil then m=script:FindFirstChild("\083\099\097\108\101\068\097\109\112\101\110\105\110\103\080\101\114\099\101\110\116")end if m~=nil then K=1+((d.HipHeight-b)*m.Value)/b end end return K end return 1 end local z=.0001 function setRunSpeed(K)local d=K*1.25 local M=getHeightScale()local A=d/M if A~=T then if A<.33 then S:AdjustWeight(1)B:AdjustWeight(z)elseif A<.66 then local K=(A-.33)/.33 S:AdjustWeight((1-K)+z)B:AdjustWeight(K+z)else S:AdjustWeight(z)B:AdjustWeight(1)end T=A B:AdjustSpeed(A)S:AdjustSpeed(A)end end function setAnimationSpeed(K)if t=="\119\097\108\107"then setRunSpeed(K)else if K~=T then T=K S:AdjustSpeed(T)end end end function keyFrameReachedFunc(K)if K=="\069\110\100"then if t=="\119\097\108\107"then if O==true then if B.Looped~=true then B.TimePosition=0 end if S.Looped~=true then S.TimePosition=0 end else B.TimePosition=0 S.TimePosition=0 end else local K=t if a[K]~=nil and a[K]==false then K="\105\100\108\101"end if H and v then if S.Looped then return end K="\105\100\108\101"v=false end local M=T playAnimation(K,.15,d)setAnimationSpeed(M)end end end function rollAnimation(K)local d=math.random(1,e[K].totalWeight)local M=d local A=1 while d>e[K][A].weight do d=d-e[K][A].weight A=A+1 end return A end local function f(K,d,M,A)if K~=L then if S~=nil then S:Stop(M)S:Destroy()end if B~=nil then B:Stop(M)B:Destroy()if O==true then B=nil end end T=1 S=A:LoadAnimation(K)S.Priority=Enum.AnimationPriority.Core S:Play(M)t=d L=K if Z~=nil then Z:disconnect()end Z=S.KeyframeReached:connect(keyFrameReachedFunc)if d=="\119\097\108\107"then local K="\114\117\110"local d=rollAnimation(K)B=A:LoadAnimation(e[K][d].anim)B.Priority=Enum.AnimationPriority.Core B:Play(M)if l~=nil then l:disconnect()end l=B.KeyframeReached:connect(keyFrameReachedFunc)end end end function playAnimation(K,d,M)local A=rollAnimation(K)local U=e[K][A].anim f(U,K,d,M)v=false end function playEmote(K,d,M)f(K,K.Name,d,M)v=true end local g=""local X=nil local h=nil local r=nil function toolKeyFrameReachedFunc(K)if K=="\069\110\100"then playToolAnimation(g,0,d)end end function playToolAnimation(K,d,M,A)local U=rollAnimation(K)local j=e[K][U].anim if h~=j then if X~=nil then X:Stop()X:Destroy()d=0 end X=M:LoadAnimation(j)if A then X.Priority=A end X:Play(d)g=K h=j r=X.KeyframeReached:connect(toolKeyFrameReachedFunc)end end function stopToolAnimations()local K=g if r~=nil then r:disconnect()end g=""h=nil if X~=nil then X:Stop()X:Destroy()X=nil end return K end function onRunning(K)if K>.75 then local M=16 playAnimation("\119\097\108\107",.2,d)setAnimationSpeed(K/M)A="\082\117\110\110\105\110\103"else if a[t]==nil and not v then playAnimation("\105\100\108\101",.2,d)A="\083\116\097\110\100\105\110\103"end end end function onDied()A="\068\101\097\100"end function onJumping()playAnimation("\106\117\109\112",.1,d)F=I A="\074\117\109\112\105\110\103"end function onClimbing(K)local M=5 playAnimation("\099\108\105\109\098",.1,d)setAnimationSpeed(K/M)A="\067\108\105\109\098\105\110\103"end function onGettingUp()A="\071\101\116\116\105\110\103\085\112"end function onFreeFall()if F<=0 then playAnimation("\102\097\108\108",w,d)end A="\070\114\101\101\070\097\108\108"end function onFallingDown()A="\070\097\108\108\105\110\103\068\111\119\110"end function onSeated()A="\083\101\097\116\101\100"end function onPlatformStanding()A="\080\108\097\116\102\111\114\109\083\116\097\110\100\105\110\103"end function onSwimming(K)if K>1 then local M=10 playAnimation("\115\119\105\109",.4,d)setAnimationSpeed(K/M)A="\083\119\105\109\109\105\110\103"else playAnimation("\115\119\105\109\105\100\108\101",.4,d)A="\083\116\097\110\100\105\110\103"end end function animateTool()if E=="\078\111\110\101"then playToolAnimation("\116\111\111\108\110\111\110\101",D,d,Enum.AnimationPriority.Idle)return end if E=="\083\108\097\115\104"then playToolAnimation("\116\111\111\108\115\108\097\115\104",0,d,Enum.AnimationPriority.Action)return end if E=="\076\117\110\103\101"then playToolAnimation("\116\111\111\108\108\117\110\103\101",0,d,Enum.AnimationPriority.Action)return end end function getToolAnim(K)for K,d in ipairs(K:GetChildren())do if d.Name=="\116\111\111\108\097\110\105\109"and d.className=="\083\116\114\105\110\103\086\097\108\117\101"then return d end end return nil end local i=0 function stepAnimate(M)local U=1 local j=1 local O=M-i i=M local P=0 local q=false if F>0 then F=F-O end if A=="\070\114\101\101\070\097\108\108"and F<=0 then playAnimation("\102\097\108\108",w,d)elseif A=="\083\101\097\116\101\100"then playAnimation("\115\105\116",.5,d)return elseif A=="\082\117\110\110\105\110\103"then playAnimation("\119\097\108\107",.2,d)elseif A=="\068\101\097\100"or A=="\071\101\116\116\105\110\103\085\112"or A=="\070\097\108\108\105\110\103\068\111\119\110"or A=="\083\101\097\116\101\100"or A=="\080\108\097\116\102\111\114\109\083\116\097\110\100\105\110\103"then stopAllAnimations()U=.1 j=1 q=true end local N=K:FindFirstChildOfClass("\084\111\111\108")if N and N:FindFirstChild("\072\097\110\100\108\101")then local K=getToolAnim(N)if K then E=K.Value K.Parent=nil x=M+.3 end if M>x then x=0 E="\078\111\110\101"end animateTool()else stopToolAnimations()E="\078\111\110\101"h=nil x=0 end end local Y={}local J=d local function u()for K=1,#Y,1 do Y[K]:Disconnect()end Y={}end local function C()u()A=J.Sit and"\083\101\097\116\101\100"or"\083\116\097\110\100\105\110\103"Y={J.Died:connect(onDied),J.Running:connect(onRunning);J.Jumping:connect(onJumping),J.Climbing:connect(onClimbing);J.GettingUp:connect(onGettingUp);J.FreeFalling:connect(onFreeFall);J.FallingDown:connect(onFallingDown),J.Seated:connect(onSeated);J.PlatformStanding:connect(onPlatformStanding);J.Swimming:connect(onSwimming)}end C();(game:GetService("\080\108\097\121\101\114\115")).LocalPlayer.Chatted:connect(function(K)local M=""if string.sub(K,1,3)=="\047\101 "then M=string.sub(K,4)elseif string.sub(K,1,7)=="\047\101\109\111\116\101 "then M=string.sub(K,8)end if A=="\083\116\097\110\100\105\110\103"and a[M]~=nil then playAnimation(M,p,d)end end)playAnimation("\105\100\108\101",.1,d)A="\083\116\097\110\100\105\110\103"spawn(function()while K.Parent~=nil do local K,d=wait(.1)stepAnimate(d)end end)return{onRunning=onRunning,onDied=onDied,onJumping=onJumping;onClimbing=onClimbing;onGettingUp=onGettingUp,onFreeFall=onFreeFall,onFallingDown=onFallingDown,onSeated=onSeated,onPlatformStanding=onPlatformStanding,onHook=C,onUnhook=u}end return K()end while true do wait(.1)if K.Character~=nil then M=K.Character break end end function _Controller()local K=M:WaitForChild("\072\117\109\097\110\111\105\100")local d={}if K.RigType==Enum.HumanoidRigType.R6 then d=_R6()else d=_R15()end print("\065\110\105\109\097\116\105\111\110 \115\117\099\099\101\115")return d end function _AnimationHandler()local K={}K.__index=K function K.new(d,M)local A=setmetatable({},K)A._AnimFuncs=_Controller()A.Humanoid=d return A end function K.EnableDefault(d,K)if K then d._AnimFuncs.onHook()else d._AnimFuncs.onUnhook()end end function K.Run(d,K,...)d._AnimFuncs[K](...)end return K end function _GravityController()local K=Vector3.new(0,0,0)local d=Vector3.new(1,0,0)local M=Vector3.new(0,1,0)local A=Vector3.new(0,0,1)local U=Vector3.new(1,0,1)local j=CFrame.new()local O=1.2 local P=.15 local q=66.666666666667 local N=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local G=game:GetService("\082\117\110\083\101\114\118\105\099\101")local c=_InitObjects()local H=_AnimationHandler()local m=_StateTracker()local b={}b.__index=b local function p(K,d,M)local A,U=K:Dot(d),K:Cross(d)if A<-0.99999 then return CFrame.fromAxisAngle(M,math.pi)end return CFrame.new(0,0,0,U.x,U.y,U.z,1+A)end local function t(K,d,M)local A=d:Cross(M)local U=A:Cross(d)return CFrame.fromMatrix(K,A.Unit,U.Unit)end local function L(K)local d=0 for K,M in next,K do if M:IsA("\066\097\115\101\080\097\114\116")then d=d+M:GetMass()end end return d end local S=_PlayerModule()local Z=_sounds()function b.new(K)local d=setmetatable({},b)local A=S d.Controls=A:GetControls()d.Camera=A:GetCameras()d.Player=K d.Character=K.Character d.Humanoid=K.Character:WaitForChild("\072\117\109\097\110\111\105\100")d.HRP=K.Character:WaitForChild("\072\117\109\097\110\111\105\100\082\111\111\116\080\097\114\116")d.AnimationHandler=H.new(d.Humanoid,d.Character:WaitForChild("\065\110\105\109\097\116\101"))d.AnimationHandler:EnableDefault(false)local U=(game:GetService("\080\108\097\121\101\114\115")).LocalPlayer.PlayerScripts:FindFirstChild("\083\101\116\083\116\097\116\101")or Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116",(game:GetService("\080\108\097\121\101\114\115")).LocalPlayer.PlayerScripts)local O=Z U.Name="\083\101\116\083\116\097\116\101"d.StateTracker=m.new(d.Humanoid,O)d.StateTracker.Changed:Connect(function(K,M)d.AnimationHandler:Run(K,M)end)local P,q,N,p=c(d)p.Touched:Connect(function() end)P.Touched:Connect(function() end)d.Collider=P d.VForce=N d.Gyro=q d.Floor=p d.LastPart=workspace.Terrain d.LastPartCFrame=j d.GravityUp=M d.Ignores={d.Character}function d.Camera.GetUpVector(K,M)return d.GravityUp end d.Humanoid.PlatformStand=true d.CharacterMass=L(d.Character:GetDescendants())d.Character.AncestryChanged:Connect(function()d.CharacterMass=L(d.Character:GetDescendants())end)d.JumpCon=G.RenderStepped:Connect(function(K)if d.Controls:IsJumping()then d:OnJumpRequest()end end)d.DeathCon=d.Humanoid.Died:Connect(function()d:Destroy()end)d.SeatCon=d.Humanoid.Seated:Connect(function(K)if K then d:Destroy()end end)d.HeartCon=G.Heartbeat:Connect(function(K)d:OnHeartbeatStep(K)end)G:BindToRenderStep("\071\114\097\118\105\116\121\083\116\101\112",Enum.RenderPriority.Input.Value+1,function(K)d:OnGravityStep(K)end)return d end function b.Destroy(K)K.JumpCon:Disconnect()K.DeathCon:Disconnect()K.SeatCon:Disconnect()K.HeartCon:Disconnect()G:UnbindFromRenderStep("\071\114\097\118\105\116\121\083\116\101\112")K.Collider:Destroy()K.VForce:Destroy()K.Gyro:Destroy()K.StateTracker:Destroy()K.Humanoid.PlatformStand=false K.AnimationHandler:EnableDefault(true)K.GravityUp=M end function b.GetGravityUp(d,K)return K end function b.IsGrounded(d,K)if not K then local K=d.Floor:GetTouchingParts()for K,M in next,K do if not M:IsDescendantOf(d.Character)then return true end end else if d.StateTracker.Jumped then return false end local K={}local M=d.Collider:GetTouchingParts()for M,A in next,M do if not A:IsDescendantOf(d.Character)then table.insert(K,A)end end if#K>0 then local M=math.cos(d.Humanoid.MaxSlopeAngle)local A=Ray.new(d.Collider.Position,-10*d.GravityUp)local U,j,O=workspace:FindPartOnRayWithWhitelist(A,K,true)if U and M<=d.GravityUp:Dot(O)then return true end end end return false end function b.OnJumpRequest(K)if not K.StateTracker.Jumped and K:IsGrounded(true)then local d=K.HRP.Velocity K.HRP.Velocity=d+(K.GravityUp*K.Humanoid.JumpPower)*O K.StateTracker:RequestedJump()end end function b.GetMoveVector(K)return K.Controls:GetMoveVector()end function b.OnHeartbeatStep(d,K)local M=Ray.new(d.Collider.Position,-1.1*d.GravityUp)local A,U,j=workspace:FindPartOnRayWithIgnoreList(M,d.Ignores)local O=d.LastPart if A and(O and O==A)then local K=d.LastPartCFrame:ToObjectSpace(d.HRP.CFrame)d.HRP.CFrame=A.CFrame:ToWorldSpace(K)end d.LastPart=A d.LastPartCFrame=A and A.CFrame end function b.OnGravityStep(A,d)local U=A.GravityUp local O=A:GetGravityUp(U)local N=p(U,O,workspace.CurrentCamera.CFrame.RightVector)N=j:Lerp(N,P)A.GravityUp=N*U local G=workspace.CurrentCamera.CFrame local c=G.LookVector:Dot(O)local H=math.abs(c)>.5 and-math.sign(c)*G.UpVector or G.LookVector local m=(H:Cross(-O)).Unit local b=-(m:Cross(O)).Unit local L=A:GetMoveVector()local S=b*L.z-m*L.x S=S:Dot(S)>1 and S.Unit or S local Z=S:Dot(S)>0 local T=A.HRP.CFrame.LookVector local B=T:Dot(b)*b+T:Dot(m)*m local l=(B:Cross(O)).Unit local e=CFrame.fromMatrix(K,l,O,-B)local V=j if Z then V=j:Lerp(p(B,S,O),.7)end local a=workspace.Gravity local o=(a*A.CharacterMass)*(M-O)local Q=A.HRP.Velocity local k=A.Humanoid.WalkSpeed*S local s=Q:Dot(O)*O local E=Q-s if E:Dot(E)<1 then E=K end local x=k-E local F=math.min(10000,((q*A.CharacterMass)*x.Magnitude)/(d*60))local I=F>0 and x.Unit*F or K local D=V*e if A.Camera:IsCamRelative()then local d=workspace.CurrentCamera.CFrame.LookVector local M=d-D.UpVector:Dot(d)*D.UpVector D=t(K,M,D.UpVector)end A.StateTracker:OnStep(A.GravityUp,A:IsGrounded(),Z)A.VForce.Force=I+o A.Gyro.CFrame=D end return b end function _Draw3D()local K={}K.StyleGuide={Point={Thickness=.5;Color=Color3.new(0,1,0)};Line={Thickness=.1;Color=Color3.new(1,1,0)};Ray={Thickness=.1;Color=Color3.new(1,0,1)};Triangle={Thickness=.05};CFrame={Thickness=.1,RightColor3=Color3.new(1,0,0),UpColor3=Color3.new(0,1,0);BackColor3=Color3.new(0,0,1),PartProperties={Material=Enum.Material.SmoothPlastic}}}local d=Instance.new("\087\101\100\103\101\080\097\114\116")d.Material=Enum.Material.SmoothPlastic d.Anchored=true d.CanCollide=false local M=Instance.new("\080\097\114\116")M.Size=Vector3.new(.1,.1,.1)M.Anchored=true M.CanCollide=false M.TopSurface=Enum.SurfaceType.Smooth M.BottomSurface=Enum.SurfaceType.Smooth M.Material=Enum.Material.SmoothPlastic local function A(K,d)local A=M:Clone()for K,d in next,K do A[K]=d end if d then for K,d in next,d do if K~="\084\104\105\099\107\110\101\115\115"then A[K]=d end end end return A end function K.Draw(K,d)d.Parent=K return A(d,nil)end function K.Point(d,M)local U=K.StyleGuide.Point.Thickness return A({Size=Vector3.new(U,U,U);CFrame=typeof(M)=="\067\070\114\097\109\101"and M or CFrame.new(M),Parent=d},K.StyleGuide.Point)end function K.Line(d,M,U)local j=K.StyleGuide.Line.Thickness return A({CFrame=CFrame.new((M+U)/2,U),Size=Vector3.new(j,j,(U-M).Magnitude),Parent=d},K.StyleGuide.Line)end function K.Ray(d,M,U)local j=K.StyleGuide.Ray.Thickness return A({CFrame=CFrame.new(M+U/2,M+U);Size=Vector3.new(j,j,U.Magnitude);Parent=d},K.StyleGuide.Ray)end function K.Triangle(M,A,U,j)local O,P,q=U-A,j-A,j-U local N,G,c=O:Dot(O),P:Dot(P),q:Dot(q)if N>G and N>c then j,A=A,j elseif G>c and G>N then A,U=U,A end O,P,q=U-A,j-A,j-U local H=(P:Cross(O)).Unit local m=(q:Cross(H)).Unit local b=q.Unit local p=math.abs(O:Dot(m))local t=math.abs(O:Dot(b))local L=math.abs(P:Dot(b))local S=K.StyleGuide.Triangle.Thickness local Z=d:Clone()Z.Size=Vector3.new(S,p,t)Z.CFrame=CFrame.fromMatrix((A+U)/2,H,m,b)Z.Parent=M local T=d:Clone()T.Size=Vector3.new(S,p,L)T.CFrame=CFrame.fromMatrix((A+j)/2,-H,m,-b)T.Parent=M for K,d in next,K.StyleGuide.Triangle do if K~="\084\104\105\099\107\110\101\115\115"then Z[K]=d T[K]=d end end return Z,T end function K.CFrame(d,M)local U=M.Position local j=M.RightVector local O=M.UpVector local P=-M.LookVector local q=K.StyleGuide.CFrame.Thickness local N=A({CFrame=CFrame.new(U+j/2,U+j);Size=Vector3.new(q,q,j.Magnitude);Color=K.StyleGuide.CFrame.RightColor3,Parent=d},K.StyleGuide.CFrame.PartProperties)local G=A({CFrame=CFrame.new(U+O/2,U+O);Size=Vector3.new(q,q,j.Magnitude),Color=K.StyleGuide.CFrame.UpColor3;Parent=d},K.StyleGuide.CFrame.PartProperties)local c=A({CFrame=CFrame.new(U+P/2,U+P);Size=Vector3.new(q,q,O.Magnitude),Color=K.StyleGuide.CFrame.BackColor3,Parent=d},K.StyleGuide.CFrame.PartProperties)return N,G,c end return K end function _Draw2D()local K={}K.StyleGuide={Point={BorderSizePixel=0,Size=UDim2.new(0,4,0,4),BorderColor3=Color3.new(0,0,0),BackgroundColor3=Color3.new(0,1,0)},Line={Thickness=1;BorderSizePixel=0;BorderColor3=Color3.new(0,0,0);BackgroundColor3=Color3.new(0,1,0)};Ray={Thickness=1,BorderSizePixel=0;BorderColor3=Color3.new(0,0,0);BackgroundColor3=Color3.new(0,1,0)};Triangle={ImageTransparency=0;ImageColor3=Color3.new(0,1,0)}}local d=Vector2.new(.5,.5)local M="\114\098\120\097\115\115\101\116\105\100\058\047\047\050\055\057\056\049\055\055\053\050\049"local A="\114\098\120\097\115\115\101\116\105\100\058\047\047\050\055\057\056\049\055\055\057\053\053"local U=Instance.new("\073\109\097\103\101\076\097\098\101\108")U.BackgroundTransparency=1 U.AnchorPoint=d U.BorderSizePixel=0 local j=Instance.new("\070\114\097\109\101")j.BorderSizePixel=0 j.Size=UDim2.new(0,0,0,0)j.BackgroundColor3=Color3.new(1,1,1)function draw(K,d)local M=j:Clone()for K,d in next,K do M[K]=d end if d then for K,d in next,d do if K~="\084\104\105\099\107\110\101\115\115"then M[K]=d end end end return M end function K.Draw(K,d)d.Parent=K return draw(d,nil)end function K.Point(M,A)return draw({AnchorPoint=d;Position=UDim2.new(0,A.x,0,A.y),Parent=M},K.StyleGuide.Point)end function K.Line(M,A,U)local j=U-A local O=(A+U)/2 return draw({AnchorPoint=d,Position=UDim2.new(0,O.x,0,O.y);Size=UDim2.new(0,K.StyleGuide.Line.Thickness,0,j.magnitude),Rotation=math.deg(math.atan2(j.y,j.x))-90;BackgroundColor3=Color3.new(1,1,0);Parent=M},K.StyleGuide.Line)end function K.Ray(M,A,U)local j,O=A,A+U local P=O-j local q=(j+O)/2 return draw({AnchorPoint=d,Position=UDim2.new(0,q.x,0,q.y);Size=UDim2.new(0,K.StyleGuide.Ray.Thickness,0,P.magnitude);Rotation=math.deg(math.atan2(P.y,P.x))-90,Parent=M},K.StyleGuide.Ray)end function K.Triangle(j,O,P,q)local N,G,c=P-O,q-O,q-P local H,m,b=N:Dot(N),G:Dot(G),c:Dot(c)if H>m and H>b then q,O=O,q elseif m>b and m>H then O,P=P,O end N,G,c=P-O,q-O,q-P local p=c.unit local t=p:Cross(N)local L=t>=0 local S=math.deg(math.atan2(p.y,p.x))+(L and 0 or 180)local Z=(O+P)/2 local T=(O+q)/2 local B=U:Clone()B.Image=L and M or A B.AnchorPoint=d B.Size=UDim2.new(0,math.abs(p:Dot(N)),0,t)B.Position=UDim2.new(0,Z.x,0,Z.y)B.Rotation=S B.Parent=j local l=U:Clone()l.Image=L and A or M l.AnchorPoint=d l.Size=UDim2.new(0,math.abs(p:Dot(G)),0,t)l.Position=UDim2.new(0,T.x,0,T.y)l.Rotation=S l.Parent=j for K,d in next,K.StyleGuide.Triangle do B[K]=d l[K]=d end return B,l end return K end function _DrawClass()local K=_Draw2D()local d=_Draw3D()local M={}local A=setmetatable({},{__mode="\107"})M.__index=M function M.new(U)local j=setmetatable({},M)j.Parent=U A[j]={}j.Draw3D={}for K,d in next,d do j.Draw3D[K]=function(...)local K={d(j.Parent,...)}for d=1,#K,1 do table.insert(A[j],K[d])end return unpack(K)end end j.Draw2D={}for K,d in next,K do j.Draw2D[K]=function(...)local K={d(j.Parent,...)}for d=1,#K,1 do table.insert(A[j],K[d])end return unpack(K)end end return j end function M.Clear(K)local d=A[K]while#d>0 do local K=table.remove(d)if K then K:Destroy()end end A[K]={}end return M end local A=game:GetService("\080\108\097\121\101\114\115")local U=_GravityController()local j=U.new(A.LocalPlayer)local O=_DrawClass()local P=math.pi*2 local q=Vector3.new(0,0,0)local N=3 local G=24 local c=3 local H=2 local m=1.66666 local b=1 local p=9 local t=2 local L=2 local S=3.5 local Z=1 local T=8 function GetGravityUp(K,d)local M={}for K,d in next,A:GetPlayers()do M[K]=d.Character end local U=K.HRP.CFrame local j=K.Humanoid.RigType==Enum.HumanoidRigType.R15 local O=j and U.p or U.p+.35*d local B=math.abs(U.LookVector:Dot(d))<.999 and U.LookVector:Cross(d)or U.RightVector:Cross(d)local l=25 local e=Ray.new(O,-l*d)local V,a,o=workspace:FindPartOnRayWithIgnoreList(e,M)local Q=0 local k=0 local s=0 local E=0 local x=0 local F=q if V then F=o s=0 end local I=q for K=1,G,1 do local A=P*((K-1)/G)local U=.25+.75*math.abs(math.cos(A))local j=K%2==0 local q=j and H or c local p=j and b or m local t=l local L=CFrame.fromAxisAngle(d,A)*B local S=N*-d+(p-q)*L local Z=Ray.new(O+q*L,t*S.unit)local T,e,V=workspace:FindPartOnRayWithIgnoreList(Z,M)if T then I=I+U*V Q=Q+1 if j then E=E+1 else x=x+1 end end end local D=0 local w=q for K=1,p,1 do local A=(2*math.pi)*((K-1)/p)local U=.25+.75*math.abs(math.cos(A))local j=CFrame.fromAxisAngle(d,A)*B local P=(S*j+N*-d).unit local q=(O-Z*-d)+L*P local G=Ray.new(q,t*P)local c,H,m=workspace:FindPartOnRayWithIgnoreList(G,M)if c then w=w+(T*U)*m D=D+1 end end if(s+Q)+D>0 then local K=(F+I)+w if K~=q then return K.unit end end return d end j.GetGravityUp=GetGravityUp;(game:GetService("\067\111\110\116\101\120\116\065\099\116\105\111\110\083\101\114\118\105\099\101")):BindAction("\084\111\103\103\108\101",function(K,d,M)if not(d==Enum.UserInputState.Begin)then return end if j then j:Destroy()j=nil else j=U.new(A.LocalPlayer)j.GetGravityUp=GetGravityUp end end,false,Enum.KeyCode.Z)print("\101\110\100")
-- its back frfr
