-- It back fr
repeat wait()a=pcall(function()((game:WaitForChild("\080\108\097\121\101\114\115")).LocalPlayer:WaitForChild("\080\108\097\121\101\114\083\099\114\105\112\116\115")).ChildAdded:Connect(function(l)if l.Name=="\080\108\097\121\101\114\083\099\114\105\112\116\115\076\111\097\100\101\114"then l.Disabled=true end end)end)if a==true then break end until false;((game:WaitForChild("\080\108\097\121\101\114\115")).LocalPlayer:WaitForChild("\080\108\097\121\101\114\083\099\114\105\112\116\115")).ChildAdded:Connect(function(l)if l.Name=="\080\108\097\121\101\114\083\099\114\105\112\116\115\076\111\097\100\101\114"then l.Disabled=true end end)function _CameraUI()local l=game:GetService("\080\108\097\121\101\114\115")local q=game:GetService("\084\119\101\101\110\083\101\114\118\105\099\101")local L=l.LocalPlayer if not L then(l:GetPropertyChangedSignal("\076\111\099\097\108\080\108\097\121\101\114")):Wait()L=l.LocalPlayer end local function e(l,q)local L=l:FindFirstChildOfClass(q)while not L or L.ClassName~=q do L=l.ChildAdded:Wait()end return L end local c=e(L,"\080\108\097\121\101\114\071\117\105")local W=UDim2.new(0,326,0,58)local o=UDim2.new(0,80,0,58)local y=Color3.fromRGB(32,32,32)local K=.4 local R=Color3.fromRGB(200,200,200)local E=0 local function D(l)return function(q)local L=Instance.new(l)local e=q.Parent q.Parent=nil for l,q in pairs(q)do if type(l)=="\115\116\114\105\110\103"then L[l]=q else q.Parent=L end end L.Parent=e return L end end local m=false local v local X local h local T local i local function r()assert(not m)v=(D("\083\099\114\101\101\110\071\117\105"))({Name="\082\098\120\067\097\109\101\114\097\085\073";AutoLocalize=false;Enabled=true;DisplayOrder=-1,IgnoreGuiInset=false;ResetOnSpawn=false,ZIndexBehavior=Enum.ZIndexBehavior.Sibling;(D("\073\109\097\103\101\076\097\098\101\108"))({Name="\084\111\097\115\116",Visible=false;AnchorPoint=Vector2.new(.5,0);BackgroundTransparency=1;BorderSizePixel=0,Position=UDim2.new(.5,0,0,8);Size=o;Image="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\117\105\047\067\097\109\101\114\097\047\067\097\109\101\114\097\084\111\097\115\116\057\083\108\105\099\101\046\112\110\103",ImageColor3=y,ImageRectSize=Vector2.new(6,6),ImageTransparency=1,ScaleType=Enum.ScaleType.Slice;SliceCenter=Rect.new(3,3,3,3);ClipsDescendants=true,(D("\070\114\097\109\101"))({Name="\073\099\111\110\066\117\102\102\101\114",BackgroundTransparency=1,BorderSizePixel=0,Position=UDim2.new(0,0,0,0),Size=UDim2.new(0,80,1,0),(D("\073\109\097\103\101\076\097\098\101\108"))({Name="\073\099\111\110",AnchorPoint=Vector2.new(.5,.5);BackgroundTransparency=1;Position=UDim2.new(.5,0,.5,0);Size=UDim2.new(0,48,0,48);ZIndex=2;Image="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\117\105\047\067\097\109\101\114\097\047\067\097\109\101\114\097\084\111\097\115\116\073\099\111\110\046\112\110\103";ImageColor3=R;ImageTransparency=1})});(D("\070\114\097\109\101"))({Name="\084\101\120\116\066\117\102\102\101\114",BackgroundTransparency=1,BorderSizePixel=0,Position=UDim2.new(0,80,0,0),Size=UDim2.new(1,-80,1,0),ClipsDescendants=true;(D("\084\101\120\116\076\097\098\101\108"))({Name="\085\112\112\101\114";AnchorPoint=Vector2.new(0,1),BackgroundTransparency=1,Position=UDim2.new(0,0,.5,0),Size=UDim2.new(1,0,0,19),Font=Enum.Font.GothamSemibold,Text="\067\097\109\101\114\097 \099\111\110\116\114\111\108 \101\110\097\098\108\101\100";TextColor3=R;TextTransparency=1;TextSize=19,TextXAlignment=Enum.TextXAlignment.Left;TextYAlignment=Enum.TextYAlignment.Center}),(D("\084\101\120\116\076\097\098\101\108"))({Name="\076\111\119\101\114";AnchorPoint=Vector2.new(0,0),BackgroundTransparency=1,Position=UDim2.new(0,0,.5,3),Size=UDim2.new(1,0,0,15),Font=Enum.Font.Gotham,Text="\082\105\103\104\116 \109\111\117\115\101 \098\117\116\116\111\110 \116\111 \116\111\103\103\108\101",TextColor3=R,TextTransparency=1,TextSize=15,TextXAlignment=Enum.TextXAlignment.Left,TextYAlignment=Enum.TextYAlignment.Center})})}),Parent=c})X=v.Toast h=X.IconBuffer.Icon T=X.TextBuffer.Upper i=X.TextBuffer.Lower m=true end local U={}do function U.setCameraModeToastEnabled(l)if not l and not m then return end if not m then r()end X.Visible=l if not l then U.setCameraModeToastOpen(false)end end local l=TweenInfo.new(.25,Enum.EasingStyle.Quad,Enum.EasingDirection.Out)function U.setCameraModeToastOpen(L)assert(m);(q:Create(X,l,{Size=L and W or o;ImageTransparency=L and K or 1})):Play();(q:Create(h,l,{ImageTransparency=L and E or 1})):Play();(q:Create(T,l,{TextTransparency=L and E or 1})):Play();(q:Create(i,l,{TextTransparency=L and E or 1})):Play()end end return U end function _CameraToggleStateController()local l=game:GetService("\080\108\097\121\101\114\115")local q=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local L=(UserSettings()):GetService("\085\115\101\114\071\097\109\101\083\101\116\116\105\110\103\115")local e=l.LocalPlayer if not e then(l:GetPropertyChangedSignal("\076\111\099\097\108\080\108\097\121\101\114")):Wait()e=l.LocalPlayer end local c=e:GetMouse()local W=_CameraInput()local o=_CameraUI()local y=false local K=tick()local R="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\067\117\114\115\111\114\115\047\067\114\111\115\115\077\111\117\115\101\073\099\111\110\046\112\110\103"local E=false local D=false local m=false o.setCameraModeToastEnabled(false)return function(l)local e=W.getTogglePan()local v=3 if l and e~=y then E=true end if y~=e or tick()-K>v then local l=e and tick()-K<v o.setCameraModeToastOpen(l)if e then E=false end K=tick()y=e end if l~=m then if l then D=W.getTogglePan()W.setTogglePan(true)elseif not E then W.setTogglePan(D)end end if l then if W.getTogglePan()then c.Icon=R q.MouseBehavior=Enum.MouseBehavior.LockCenter else c.Icon=""q.MouseBehavior=Enum.MouseBehavior.Default end elseif W.getTogglePan()then c.Icon=R q.MouseBehavior=Enum.MouseBehavior.LockCenter L.RotationType=Enum.RotationType.MovementRelative elseif W.getHoldPan()then c.Icon=""q.MouseBehavior=Enum.MouseBehavior.LockCurrentPosition L.RotationType=Enum.RotationType.MovementRelative else c.Icon=""q.MouseBehavior=Enum.MouseBehavior.Default L.RotationType=Enum.RotationType.MovementRelative end m=l end end function _CameraInput()local l=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local q=.3 local L,e do local q=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116")local c=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116")L=q.Event e=c.Event l.InputBegan:Connect(function(l,L)if not L and l.UserInputType==Enum.UserInputType.MouseButton2 then q:Fire()end end)l.InputEnded:Connect(function(l,q)if l.UserInputType==Enum.UserInputType.MouseButton2 then c:Fire()end end)end local c=false local W=false local o=0 local y={}function y.getHoldPan()return c end function y.getTogglePan()return W end function y.getPanning()return W or c end function y.setTogglePan(l)W=l end local K=false local R local E function y.enableCameraToggleInput()if K then return end K=true c=false W=false if R then R:Disconnect()end if E then E:Disconnect()end R=L:Connect(function()c=true o=tick()end)E=e:Connect(function()c=false if tick()-o<q and(W or(l:GetMouseDelta()).Magnitude<2)then W=not W end end)end function y.disableCameraToggleInput()if not K then return end K=false if R then R:Disconnect()R=nil end if E then E:Disconnect()E=nil end end return y end function _BaseCamera()local l=Vector3.new(0,0,1)local q=Vector3.new(1,0,1)local L=.2 local e=12.5 local c=25 local W=1 local o=Enum.ContextActionPriority.Default.Value local y=math.rad(-80)local K=math.rad(80)local R=math.rad(30)local E=math.rad(-15)local D=2.1 local m=.5 local v=math.rad(15)local X=Vector2.new(math.rad(15),0)local h=Vector2.new(math.rad(45),0)local T=.1 local i=.4 local r=Vector2.new(0,0)local U=Vector3.new(0,0,0)local w=Vector2.new(.00945*math.pi,.003375*math.pi)local G=Vector2.new(.002*math.pi,.0015*math.pi)local I=Vector3.new(0,5,0)local a=Vector3.new(0,4,0)local H=Vector3.new(0,1.5,0)local d=Vector3.new(0,1.5,0)local z=Vector3.new(0,2,0)local j=Vector3.new(2,2,1)local Q=0 local P=10 local n=20 local k=20 local N=.5 local C=math.abs local V=math.sign local g do local l,q=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\067\097\109\101\114\097\084\111\103\103\108\101")end)g=l and q end local s do local l,q=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\068\111\110\116\065\100\106\117\115\116\083\101\110\115\105\116\118\105\116\121\070\111\114\080\111\114\116\114\097\105\116")end)s=l and q end local Y do local l,q=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\070\105\120\090\111\111\109\073\110\090\111\111\109\079\117\116\068\105\115\099\114\101\112\097\110\099\121")end)Y=l and q end local M=_CameraUtils()local O=_ZoomController()local x=_CameraToggleStateController()local J=_CameraInput()local u=_CameraUI()local F=game:GetService("\080\108\097\121\101\114\115")local Z=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local b=game:GetService("\083\116\097\114\116\101\114\071\117\105")local f=game:GetService("\071\117\105\083\101\114\118\105\099\101")local t=game:GetService("\067\111\110\116\101\120\116\065\099\116\105\111\110\083\101\114\118\105\099\101")local p=game:GetService("\086\082\083\101\114\118\105\099\101")local B=(UserSettings()):GetService("\085\115\101\114\071\097\109\101\083\101\116\116\105\110\103\115")local A=F.LocalPlayer local S={}S.__index=S function S.new()local l=setmetatable({},S)l.FIRST_PERSON_DISTANCE_THRESHOLD=W l.cameraType=nil l.cameraMovementMode=nil l.lastCameraTransform=nil l.rotateInput=r l.userPanningCamera=false l.lastUserPanCamera=tick()l.humanoidRootPart=nil l.humanoidCache={}l.lastSubject=nil l.lastSubjectPosition=Vector3.new(0,5,0)l.defaultSubjectDistance=math.clamp(e,A.CameraMinZoomDistance,A.CameraMaxZoomDistance)l.currentSubjectDistance=math.clamp(e,A.CameraMinZoomDistance,A.CameraMaxZoomDistance)l.inFirstPerson=false l.inMouseLockedMode=false l.portraitMode=false l.isSmallTouchScreen=false l.resetCameraAngle=true l.enabled=false l.inputBeganConn=nil l.inputChangedConn=nil l.inputEndedConn=nil l.startPos=nil l.lastPos=nil l.panBeginLook=nil l.panEnabled=true l.keyPanEnabled=true l.distanceChangeEnabled=true l.PlayerGui=nil l.cameraChangedConn=nil l.viewportSizeChangedConn=nil l.boundContextActions={}l.shouldUseVRRotation=false l.VRRotationIntensityAvailable=false l.lastVRRotationIntensityCheckTime=0 l.lastVRRotationTime=0 l.vrRotateKeyCooldown={}l.cameraTranslationConstraints=Vector3.new(1,1,1)l.humanoidJumpOrigin=nil l.trackingHumanoid=nil l.cameraFrozen=false l.subjectStateChangedConn=nil l.activeGamepad=nil l.gamepadPanningCamera=false l.lastThumbstickRotate=nil l.numOfSeconds=.7 l.currentSpeed=0 l.maxSpeed=6 l.vrMaxSpeed=4 l.lastThumbstickPos=Vector2.new(0,0)l.ySensitivity=.65 l.lastVelocity=nil l.gamepadConnectedConn=nil l.gamepadDisconnectedConn=nil l.currentZoomSpeed=1 l.L3ButtonDown=false l.dpadLeftDown=false l.dpadRightDown=false l.isDynamicThumbstickEnabled=false l.fingerTouches={}l.dynamicTouchInput=nil l.numUnsunkTouches=0 l.inputStartPositions={}l.inputStartTimes={}l.startingDiff=nil l.pinchBeginZoom=nil l.userPanningTheCamera=false l.touchActivateConn=nil l.mouseLockOffset=U if A.Character then l:OnCharacterAdded(A.Character)end A.CharacterAdded:Connect(function(q)l:OnCharacterAdded(q)end)if l.cameraChangedConn then l.cameraChangedConn:Disconnect()end l.cameraChangedConn=(workspace:GetPropertyChangedSignal("\067\117\114\114\101\110\116\067\097\109\101\114\097")):Connect(function()l:OnCurrentCameraChanged()end)l:OnCurrentCameraChanged()if l.playerCameraModeChangeConn then l.playerCameraModeChangeConn:Disconnect()end l.playerCameraModeChangeConn=(A:GetPropertyChangedSignal("\067\097\109\101\114\097\077\111\100\101")):Connect(function()l:OnPlayerCameraPropertyChange()end)if l.minDistanceChangeConn then l.minDistanceChangeConn:Disconnect()end l.minDistanceChangeConn=(A:GetPropertyChangedSignal("\067\097\109\101\114\097\077\105\110\090\111\111\109\068\105\115\116\097\110\099\101")):Connect(function()l:OnPlayerCameraPropertyChange()end)if l.maxDistanceChangeConn then l.maxDistanceChangeConn:Disconnect()end l.maxDistanceChangeConn=(A:GetPropertyChangedSignal("\067\097\109\101\114\097\077\097\120\090\111\111\109\068\105\115\116\097\110\099\101")):Connect(function()l:OnPlayerCameraPropertyChange()end)if l.playerDevTouchMoveModeChangeConn then l.playerDevTouchMoveModeChangeConn:Disconnect()end l.playerDevTouchMoveModeChangeConn=(A:GetPropertyChangedSignal("\068\101\118\084\111\117\099\104\077\111\118\101\109\101\110\116\077\111\100\101")):Connect(function()l:OnDevTouchMovementModeChanged()end)l:OnDevTouchMovementModeChanged()if l.gameSettingsTouchMoveMoveChangeConn then l.gameSettingsTouchMoveMoveChangeConn:Disconnect()end l.gameSettingsTouchMoveMoveChangeConn=(B:GetPropertyChangedSignal("\084\111\117\099\104\077\111\118\101\109\101\110\116\077\111\100\101")):Connect(function()l:OnGameSettingsTouchMovementModeChanged()end)l:OnGameSettingsTouchMovementModeChanged()B:SetCameraYInvertVisible()B:SetGamepadCameraSensitivityVisible()l.hasGameLoaded=game:IsLoaded()if not l.hasGameLoaded then l.gameLoadedConn=game.Loaded:Connect(function()l.hasGameLoaded=true l.gameLoadedConn:Disconnect()l.gameLoadedConn=nil end)end l:OnPlayerCameraPropertyChange()return l end function S.GetModuleName(l)return"\066\097\115\101\067\097\109\101\114\097"end function S.OnCharacterAdded(q,l)q.resetCameraAngle=q.resetCameraAngle or q:GetEnabled()q.humanoidRootPart=nil if Z.TouchEnabled then q.PlayerGui=A:WaitForChild("\080\108\097\121\101\114\071\117\105")for l,L in ipairs(l:GetChildren())do if L:IsA("\084\111\111\108")then q.isAToolEquipped=true end end l.ChildAdded:Connect(function(l)if l:IsA("\084\111\111\108")then q.isAToolEquipped=true end end)l.ChildRemoved:Connect(function(l)if l:IsA("\084\111\111\108")then q.isAToolEquipped=false end end)end end function S.GetHumanoidRootPart(l)if not l.humanoidRootPart then if A.Character then local q=A.Character:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")if q then l.humanoidRootPart=q.RootPart end end end return l.humanoidRootPart end function S.GetBodyPartToFollow(L,l,q)if l:GetState()==Enum.HumanoidStateType.Dead then local q=l.Parent if q and q:IsA("\077\111\100\101\108")then return q:FindFirstChild("\072\101\097\100")or l.RootPart end end return l.RootPart end function S.GetSubjectPosition(l)local q=l.lastSubjectPosition local L=game.Workspace.CurrentCamera local e=L and L.CameraSubject if e then if e:IsA("\072\117\109\097\110\111\105\100")then local L=e local c=L:GetState()==Enum.HumanoidStateType.Dead if p.VREnabled and(c and L==l.lastSubject)then q=l.lastSubjectPosition else local l=L.RootPart if c then if L.Parent and L.Parent:IsA("\077\111\100\101\108")then l=L.Parent:FindFirstChild("\072\101\097\100")or l end end if l and l:IsA("\066\097\115\101\080\097\114\116")then local e if L.RigType==Enum.HumanoidRigType.R15 then if L.AutomaticScalingEnabled then e=d if l==L.RootPart then local l=L.RootPart.Size.Y/2-j.Y/2 e=e+Vector3.new(0,l,0)end else e=z end else e=H end if c then e=U end q=l.CFrame.p+l.CFrame:vectorToWorldSpace(e+L.CameraOffset)end end elseif e:IsA("\086\101\104\105\099\108\101\083\101\097\116")then local l=I if p.VREnabled then l=a end q=e.CFrame.p+e.CFrame:vectorToWorldSpace(l)elseif e:IsA("\083\107\097\116\101\098\111\097\114\100\080\108\097\116\102\111\114\109")then q=e.CFrame.p+I elseif e:IsA("\066\097\115\101\080\097\114\116")then q=e.CFrame.p elseif e:IsA("\077\111\100\101\108")then if e.PrimaryPart then q=(e:GetPrimaryPartCFrame()).p else q=(e:GetModelCFrame()).p end end else return end l.lastSubject=e l.lastSubjectPosition=q return q end function S.UpdateDefaultSubjectDistance(l)if l.portraitMode then l.defaultSubjectDistance=math.clamp(c,A.CameraMinZoomDistance,A.CameraMaxZoomDistance)else l.defaultSubjectDistance=math.clamp(e,A.CameraMinZoomDistance,A.CameraMaxZoomDistance)end end function S.OnViewportSizeChanged(l)local q=game.Workspace.CurrentCamera local L=q.ViewportSize l.portraitMode=L.X<L.Y l.isSmallTouchScreen=Z.TouchEnabled and(L.Y<500 or L.X<700)l:UpdateDefaultSubjectDistance()end function S.OnCurrentCameraChanged(l)if Z.TouchEnabled then if l.viewportSizeChangedConn then l.viewportSizeChangedConn:Disconnect()l.viewportSizeChangedConn=nil end local q=game.Workspace.CurrentCamera if q then l:OnViewportSizeChanged()l.viewportSizeChangedConn=(q:GetPropertyChangedSignal("\086\105\101\119\112\111\114\116\083\105\122\101")):Connect(function()l:OnViewportSizeChanged()end)end end if l.cameraSubjectChangedConn then l.cameraSubjectChangedConn:Disconnect()l.cameraSubjectChangedConn=nil end local q=game.Workspace.CurrentCamera if q then l.cameraSubjectChangedConn=(q:GetPropertyChangedSignal("\067\097\109\101\114\097\083\117\098\106\101\099\116")):Connect(function()l:OnNewCameraSubject()end)l:OnNewCameraSubject()end end function S.OnDynamicThumbstickEnabled(l)if Z.TouchEnabled then l.isDynamicThumbstickEnabled=true end end function S.OnDynamicThumbstickDisabled(l)l.isDynamicThumbstickEnabled=false end function S.OnGameSettingsTouchMovementModeChanged(l)if A.DevTouchMovementMode==Enum.DevTouchMovementMode.UserChoice then if B.TouchMovementMode==Enum.TouchMovementMode.DynamicThumbstick or B.TouchMovementMode==Enum.TouchMovementMode.Default then l:OnDynamicThumbstickEnabled()else l:OnDynamicThumbstickDisabled()end end end function S.OnDevTouchMovementModeChanged(l)if A.DevTouchMovementMode.Name=="\068\121\110\097\109\105\099\084\104\117\109\098\115\116\105\099\107"then l:OnDynamicThumbstickEnabled()else l:OnGameSettingsTouchMovementModeChanged()end end function S.OnPlayerCameraPropertyChange(l)l:SetCameraToSubjectDistance(l.currentSubjectDistance)end function S.GetCameraHeight(l)if p.VREnabled and not l.inFirstPerson then return math.sin(v)*l.currentSubjectDistance end return 0 end function S.InputTranslationToCameraAngleChange(L,l,q)if not s then local L=game.Workspace.CurrentCamera if L and(L.ViewportSize.X>0 and(L.ViewportSize.Y>0 and L.ViewportSize.Y>L.ViewportSize.X))then return l*Vector2.new(q.Y,q.X)end end return l*q end function S.Enable(q,l)if q.enabled~=l then q.enabled=l if q.enabled then q:ConnectInputEvents()q:BindContextActions()if A.CameraMode==Enum.CameraMode.LockFirstPerson then q.currentSubjectDistance=.5 if not q.inFirstPerson then q:EnterFirstPerson()end end else q:DisconnectInputEvents()q:UnbindContextActions()q:Cleanup()end end end function S.GetEnabled(l)return l.enabled end function S.OnInputBegan(L,l,q)if l.UserInputType==Enum.UserInputType.Touch then L:OnTouchBegan(l,q)elseif l.UserInputType==Enum.UserInputType.MouseButton2 then L:OnMouse2Down(l,q)elseif l.UserInputType==Enum.UserInputType.MouseButton3 then L:OnMouse3Down(l,q)end end function S.OnInputChanged(L,l,q)if l.UserInputType==Enum.UserInputType.Touch then L:OnTouchChanged(l,q)elseif l.UserInputType==Enum.UserInputType.MouseMovement then L:OnMouseMoved(l,q)end end function S.OnInputEnded(L,l,q)if l.UserInputType==Enum.UserInputType.Touch then L:OnTouchEnded(l,q)elseif l.UserInputType==Enum.UserInputType.MouseButton2 then L:OnMouse2Up(l,q)elseif l.UserInputType==Enum.UserInputType.MouseButton3 then L:OnMouse3Up(l,q)end end function S.OnPointerAction(c,l,q,L,e)if e then return end if q.Magnitude>0 then local l=Vector2.new(1,B:GetCameraYInvertValue())local L=c:InputTranslationToCameraAngleChange(k*q,G)*l c.rotateInput=c.rotateInput+L end local o=c.currentSubjectDistance local y=-(l+L)if C(y)>0 then local l if c.inFirstPerson and y>0 then l=W else if Y then if y>0 then l=o+y*(1+o*N)else l=(o+y)/(1-y*N)end else l=o+y*(1+o*N)end end c:SetCameraToSubjectDistance(l)end end function S.ConnectInputEvents(l)l.pointerActionConn=Z.PointerAction:Connect(function(q,L,e,c)l:OnPointerAction(q,L,e,c)end)l.inputBeganConn=Z.InputBegan:Connect(function(q,L)l:OnInputBegan(q,L)end)l.inputChangedConn=Z.InputChanged:Connect(function(q,L)l:OnInputChanged(q,L)end)l.inputEndedConn=Z.InputEnded:Connect(function(q,L)l:OnInputEnded(q,L)end)l.menuOpenedConn=f.MenuOpened:connect(function()l:ResetInputStates()end)l.gamepadConnectedConn=Z.GamepadDisconnected:connect(function(q)if l.activeGamepad~=q then return end l.activeGamepad=nil l:AssignActivateGamepad()end)l.gamepadDisconnectedConn=Z.GamepadConnected:connect(function(q)if l.activeGamepad==nil then l:AssignActivateGamepad()end end)l:AssignActivateGamepad()if not g then l:UpdateMouseBehavior()end end function S.BindContextActions(l)l:BindGamepadInputActions()l:BindKeyboardInputActions()end function S.AssignActivateGamepad(l)local q=Z:GetConnectedGamepads()if#q>0 then for L=1,#q,1 do if l.activeGamepad==nil then l.activeGamepad=q[L]elseif q[L].Value<l.activeGamepad.Value then l.activeGamepad=q[L]end end end if l.activeGamepad==nil then l.activeGamepad=Enum.UserInputType.Gamepad1 end end function S.DisconnectInputEvents(l)if l.inputBeganConn then l.inputBeganConn:Disconnect()l.inputBeganConn=nil end if l.inputChangedConn then l.inputChangedConn:Disconnect()l.inputChangedConn=nil end if l.inputEndedConn then l.inputEndedConn:Disconnect()l.inputEndedConn=nil end end function S.UnbindContextActions(l)for q=1,#l.boundContextActions,1 do t:UnbindAction(l.boundContextActions[q])end l.boundContextActions={}end function S.Cleanup(l)if l.pointerActionConn then l.pointerActionConn:Disconnect()l.pointerActionConn=nil end if l.menuOpenedConn then l.menuOpenedConn:Disconnect()l.menuOpenedConn=nil end if l.mouseLockToggleConn then l.mouseLockToggleConn:Disconnect()l.mouseLockToggleConn=nil end if l.gamepadConnectedConn then l.gamepadConnectedConn:Disconnect()l.gamepadConnectedConn=nil end if l.gamepadDisconnectedConn then l.gamepadDisconnectedConn:Disconnect()l.gamepadDisconnectedConn=nil end if l.subjectStateChangedConn then l.subjectStateChangedConn:Disconnect()l.subjectStateChangedConn=nil end if l.viewportSizeChangedConn then l.viewportSizeChangedConn:Disconnect()l.viewportSizeChangedConn=nil end if l.touchActivateConn then l.touchActivateConn:Disconnect()l.touchActivateConn=nil end l.turningLeft=false l.turningRight=false l.lastCameraTransform=nil l.lastSubjectCFrame=nil l.userPanningTheCamera=false l.rotateInput=Vector2.new()l.gamepadPanningCamera=Vector2.new(0,0)l.startPos=nil l.lastPos=nil l.panBeginLook=nil l.isRightMouseDown=false l.isMiddleMouseDown=false l.fingerTouches={}l.dynamicTouchInput=nil l.numUnsunkTouches=0 l.startingDiff=nil l.pinchBeginZoom=nil if Z.MouseBehavior~=Enum.MouseBehavior.LockCenter then Z.MouseBehavior=Enum.MouseBehavior.Default end end function S.ResetInputStates(l)l.isRightMouseDown=false l.isMiddleMouseDown=false l:OnMousePanButtonReleased()if Z.TouchEnabled then for q in pairs(l.fingerTouches)do l.fingerTouches[q]=nil end l.dynamicTouchInput=nil l.panBeginLook=nil l.startPos=nil l.lastPos=nil l.userPanningTheCamera=false l.startingDiff=nil l.pinchBeginZoom=nil l.numUnsunkTouches=0 end end function S.GetGamepadPan(c,l,q,e)if e.UserInputType==c.activeGamepad and e.KeyCode==Enum.KeyCode.Thumbstick2 then if q==Enum.UserInputState.Cancel then c.gamepadPanningCamera=r return end local l=Vector2.new(e.Position.X,-e.Position.Y)if l.magnitude>L then c.gamepadPanningCamera=Vector2.new(e.Position.X,-e.Position.Y)else c.gamepadPanningCamera=r end return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end function S.DoKeyboardPanTurn(e,l,q,L)if not e.hasGameLoaded and p.VREnabled then return Enum.ContextActionResult.Pass end if q==Enum.UserInputState.Cancel then e.turningLeft=false e.turningRight=false return Enum.ContextActionResult.Sink end if e.panBeginLook==nil and e.keyPanEnabled then if L.KeyCode==Enum.KeyCode.Left then e.turningLeft=q==Enum.UserInputState.Begin elseif L.KeyCode==Enum.KeyCode.Right then e.turningRight=q==Enum.UserInputState.Begin end return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end function S.DoPanRotateCamera(q,l)local L=M.RotateVectorByAngleAndRound(q:GetCameraLookVector()*Vector3.new(1,0,1),l,math.pi*.25)if L~=0 then q.rotateInput=q.rotateInput+Vector2.new(L,0)q.lastUserPanCamera=tick()q.lastCameraTransform=nil end end function S.DoGamepadZoom(e,l,q,L)if L.UserInputType==e.activeGamepad then if L.KeyCode==Enum.KeyCode.ButtonR3 then if q==Enum.UserInputState.Begin then if e.distanceChangeEnabled then local l=e:GetCameraToSubjectDistance()if l>(P+n)/2 then e:SetCameraToSubjectDistance(P)elseif l>(Q+P)/2 then e:SetCameraToSubjectDistance(Q)else e:SetCameraToSubjectDistance(n)end end end elseif L.KeyCode==Enum.KeyCode.DPadLeft then e.dpadLeftDown=q==Enum.UserInputState.Begin elseif L.KeyCode==Enum.KeyCode.DPadRight then e.dpadRightDown=q==Enum.UserInputState.Begin end if e.dpadLeftDown then e.currentZoomSpeed=1.04 elseif e.dpadRightDown then e.currentZoomSpeed=.96 else e.currentZoomSpeed=1 end return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end function S.DoKeyboardZoom(e,l,q,L)if not e.hasGameLoaded and p.VREnabled then return Enum.ContextActionResult.Pass end if q~=Enum.UserInputState.Begin then return Enum.ContextActionResult.Pass end if e.distanceChangeEnabled and A.CameraMode~=Enum.CameraMode.LockFirstPerson then if L.KeyCode==Enum.KeyCode.I then e:SetCameraToSubjectDistance(e.currentSubjectDistance-5)elseif L.KeyCode==Enum.KeyCode.O then e:SetCameraToSubjectDistance(e.currentSubjectDistance+5)end return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end function S.BindAction(e,l,q,L,...)table.insert(e.boundContextActions,l)t:BindActionAtPriority(l,q,L,o,...)end function S.BindGamepadInputActions(l)l:BindAction("\066\097\115\101\067\097\109\101\114\097\071\097\109\101\112\097\100\080\097\110",function(q,L,e)return l:GetGamepadPan(q,L,e)end,false,Enum.KeyCode.Thumbstick2)l:BindAction("\066\097\115\101\067\097\109\101\114\097\071\097\109\101\112\097\100\090\111\111\109",function(q,L,e)return l:DoGamepadZoom(q,L,e)end,false,Enum.KeyCode.DPadLeft,Enum.KeyCode.DPadRight,Enum.KeyCode.ButtonR3)end function S.BindKeyboardInputActions(l)l:BindAction("\066\097\115\101\067\097\109\101\114\097\075\101\121\098\111\097\114\100\080\097\110\065\114\114\111\119\075\101\121\115",function(q,L,e)return l:DoKeyboardPanTurn(q,L,e)end,false,Enum.KeyCode.Left,Enum.KeyCode.Right)l:BindAction("\066\097\115\101\067\097\109\101\114\097\075\101\121\098\111\097\114\100\090\111\111\109",function(q,L,e)return l:DoKeyboardZoom(q,L,e)end,false,Enum.KeyCode.I,Enum.KeyCode.O)end local function lI(l)local q=A:FindFirstChildOfClass("\080\108\097\121\101\114\071\117\105")local L=q and q:FindFirstChild("\084\111\117\099\104\071\117\105")local e=L and L:FindFirstChild("\084\111\117\099\104\067\111\110\116\114\111\108\070\114\097\109\101")local c=e and e:FindFirstChild("\068\121\110\097\109\105\099\084\104\117\109\098\115\116\105\099\107\070\114\097\109\101")if not c then return false end local W=c.AbsolutePosition local o=W+c.AbsoluteSize if l.Position.X>=W.X and l.Position.Y>=W.Y then if l.Position.X<=o.X and l.Position.Y<=o.Y then return true end end return false end function S.AdjustTouchSensitivity(L,l,q)local e=game.Workspace.CurrentCamera and game.Workspace.CurrentCamera.CFrame if not e then return q end local c=e:ToEulerAnglesYXZ()local W=D if c>R and l.Y<0 then local l=(c-R)/(K-R)l=1-(1-l)^3 W=D-l*(D-m)elseif c<E and l.Y>0 then local l=(c-E)/(y-E)l=1-(1-l)^3 W=D-l*(D-m)end return Vector2.new(q.X,q.Y*W)end function S.OnTouchBegan(L,l,q)local e=L.isDynamicThumbstickEnabled and not q if e then if L.dynamicTouchInput==nil and lI(l)then L.dynamicTouchInput=l return end L.fingerTouches[l]=q L.inputStartPositions[l]=l.Position L.inputStartTimes[l]=tick()L.numUnsunkTouches=L.numUnsunkTouches+1 end end function S.OnTouchChanged(L,l,q)if L.fingerTouches[l]==nil then if L.isDynamicThumbstickEnabled then return end L.fingerTouches[l]=q if not q then L.numUnsunkTouches=L.numUnsunkTouches+1 end end if L.numUnsunkTouches==1 then if L.fingerTouches[l]==false then L.panBeginLook=L.panBeginLook or L:GetCameraLookVector()L.startPos=L.startPos or l.Position L.lastPos=L.lastPos or L.startPos L.userPanningTheCamera=true local q=l.Position-L.lastPos q=Vector2.new(q.X,q.Y*B:GetCameraYInvertValue())if L.panEnabled then local l=w L:AdjustTouchSensitivity(q,w)local e=L:InputTranslationToCameraAngleChange(q,l)L.rotateInput=L.rotateInput+e end L.lastPos=l.Position end else L.panBeginLook=nil L.startPos=nil L.lastPos=nil L.userPanningTheCamera=false end if L.numUnsunkTouches==2 then local l={}for q,L in pairs(L.fingerTouches)do if not L then table.insert(l,q)end end if#l==2 then local q=(l[1].Position-l[2].Position).magnitude if L.startingDiff and L.pinchBeginZoom then local l=q/math.max(.01,L.startingDiff)local e=math.clamp(l,.1,10)if L.distanceChangeEnabled then L:SetCameraToSubjectDistance(L.pinchBeginZoom/e)end else L.startingDiff=q L.pinchBeginZoom=L:GetCameraToSubjectDistance()end end else L.startingDiff=nil L.pinchBeginZoom=nil end end function S.OnTouchEnded(L,l,q)if l==L.dynamicTouchInput then L.dynamicTouchInput=nil return end if L.fingerTouches[l]==false then if L.numUnsunkTouches==1 then L.panBeginLook=nil L.startPos=nil L.lastPos=nil L.userPanningTheCamera=false elseif L.numUnsunkTouches==2 then L.startingDiff=nil L.pinchBeginZoom=nil end end if L.fingerTouches[l]~=nil and L.fingerTouches[l]==false then L.numUnsunkTouches=L.numUnsunkTouches-1 end L.fingerTouches[l]=nil L.inputStartPositions[l]=nil L.inputStartTimes[l]=nil end function S.OnMouse2Down(L,l,q)if q then return end L.isRightMouseDown=true L:OnMousePanButtonPressed(l,q)end function S.OnMouse2Up(L,l,q)L.isRightMouseDown=false L:OnMousePanButtonReleased(l,q)end function S.OnMouse3Down(L,l,q)if q then return end L.isMiddleMouseDown=true L:OnMousePanButtonPressed(l,q)end function S.OnMouse3Up(L,l,q)L.isMiddleMouseDown=false L:OnMousePanButtonReleased(l,q)end function S.OnMouseMoved(L,l,q)if not L.hasGameLoaded and p.VREnabled then return end local e=l.Delta e=Vector2.new(e.X,e.Y*B:GetCameraYInvertValue())local c=g and J.getPanning()local W=L.startPos and(L.lastPos and L.panBeginLook)local o=W or L.inFirstPerson or L.inMouseLockedMode or c if L.panEnabled and o then local l=L:InputTranslationToCameraAngleChange(e,G)L.rotateInput=L.rotateInput+l end if L.startPos and(L.lastPos and L.panBeginLook)then L.lastPos=L.lastPos+l.Delta end end function S.OnMousePanButtonPressed(L,l,q)if q then return end if not g then L:UpdateMouseBehavior()end L.panBeginLook=L.panBeginLook or L:GetCameraLookVector()L.startPos=L.startPos or l.Position L.lastPos=L.lastPos or L.startPos L.userPanningTheCamera=true end function S.OnMousePanButtonReleased(L,l,q)if not g then L:UpdateMouseBehavior()end if not(L.isRightMouseDown or L.isMiddleMouseDown)then L.panBeginLook=nil L.startPos=nil L.lastPos=nil L.userPanningTheCamera=false end end function S.UpdateMouseBehavior(l)if g and l.isCameraToggle then u.setCameraModeToastEnabled(true)J.enableCameraToggleInput()x(l.inFirstPerson)else if g then u.setCameraModeToastEnabled(false)J.disableCameraToggleInput()end if l.inFirstPerson or l.inMouseLockedMode then Z.MouseBehavior=Enum.MouseBehavior.LockCenter else B.RotationType=Enum.RotationType.MovementRelative if l.isRightMouseDown or l.isMiddleMouseDown then Z.MouseBehavior=Enum.MouseBehavior.LockCurrentPosition else Z.MouseBehavior=Enum.MouseBehavior.Default end end end end function S.UpdateForDistancePropertyChange(l)l:SetCameraToSubjectDistance(l.currentSubjectDistance)end function S.SetCameraToSubjectDistance(q,l)local L=q.currentSubjectDistance if A.CameraMode==Enum.CameraMode.LockFirstPerson then q.currentSubjectDistance=.5 if not q.inFirstPerson then q:EnterFirstPerson()end else local L=math.clamp(l,A.CameraMinZoomDistance,A.CameraMaxZoomDistance)if L<W then q.currentSubjectDistance=.5 if not q.inFirstPerson then q:EnterFirstPerson()end else q.currentSubjectDistance=L if q.inFirstPerson then q:LeaveFirstPerson()end end end O.SetZoomParameters(q.currentSubjectDistance,math.sign(l-L))return q.currentSubjectDistance end function S.SetCameraType(q,l)q.cameraType=l end function S.GetCameraType(l)return l.cameraType end function S.SetCameraMovementMode(q,l)q.cameraMovementMode=l end function S.GetCameraMovementMode(l)return l.cameraMovementMode end function S.SetIsMouseLocked(q,l)q.inMouseLockedMode=l if not g then q:UpdateMouseBehavior()end end function S.GetIsMouseLocked(l)return l.inMouseLockedMode end function S.SetMouseLockOffset(q,l)q.mouseLockOffset=l end function S.GetMouseLockOffset(l)return l.mouseLockOffset end function S.InFirstPerson(l)return l.inFirstPerson end function S.EnterFirstPerson(l) end function S.LeaveFirstPerson(l) end function S.GetCameraToSubjectDistance(l)return l.currentSubjectDistance end function S.GetMeasuredDistanceToFocus(l)local q=game.Workspace.CurrentCamera if q then return(q.CoordinateFrame.p-q.Focus.p).magnitude end return nil end function S.GetCameraLookVector(q)return game.Workspace.CurrentCamera and game.Workspace.CurrentCamera.CFrame.lookVector or l end function S.CalculateNewLookCFrame(q,l)local L=l or q:GetCameraLookVector()local e=math.asin(L.y)local c=math.clamp(q.rotateInput.y,-K+e,-y+e)local W=Vector2.new(q.rotateInput.x,c)local o=CFrame.new(U,L)local R=(CFrame.Angles(0,-W.x,0)*o)*CFrame.Angles(-W.y,0,0)return R end function S.CalculateNewLookVector(q,l)local L=q:CalculateNewLookCFrame(l)return L.lookVector end function S.CalculateNewLookVectorVR(l)local L=l:GetSubjectPosition()local e=L-game.Workspace.CurrentCamera.CFrame.p local c=(e*q).unit local W=Vector2.new(l.rotateInput.x,0)local o=CFrame.new(U,c)local y=((CFrame.Angles(0,-W.x,0)*o)*CFrame.Angles(-W.y,0,0)).lookVector return(y*q).unit end function S.GetHumanoid(l)local q=A and A.Character if q then local L=l.humanoidCache[A]if L and L.Parent==q then return L else l.humanoidCache[A]=nil local L=q:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")if L then l.humanoidCache[A]=L end return L end end return nil end function S.GetHumanoidPartToFollow(L,l,q)if q==Enum.HumanoidStateType.Dead then local q=l.Parent if q then return q:FindFirstChild("\072\101\097\100")or l.Torso else return l.Torso end else return l.Torso end end function S.UpdateGamepad(l)local q=l.gamepadPanningCamera if q and(l.hasGameLoaded or not p.VREnabled)then q=M.GamepadLinearToCurve(q)local L=tick()if q.X~=0 or q.Y~=0 then l.userPanningTheCamera=true elseif q==r then l.lastThumbstickRotate=nil if l.lastThumbstickPos==r then l.currentSpeed=0 end end local e=0 if l.lastThumbstickRotate then if p.VREnabled then l.currentSpeed=l.vrMaxSpeed else local e=(L-l.lastThumbstickRotate)*10 l.currentSpeed=l.currentSpeed+l.maxSpeed*((e*e)/l.numOfSeconds)if l.currentSpeed>l.maxSpeed then l.currentSpeed=l.maxSpeed end if l.lastVelocity then local e=(q-l.lastThumbstickPos)/(L-l.lastThumbstickRotate)local c=(e-l.lastVelocity).magnitude if c>12 then l.currentSpeed=l.currentSpeed*(20/c)if l.currentSpeed>l.maxSpeed then l.currentSpeed=l.maxSpeed end end end end e=B.GamepadCameraSensitivity*l.currentSpeed l.lastVelocity=(q-l.lastThumbstickPos)/(L-l.lastThumbstickRotate)end l.lastThumbstickPos=q l.lastThumbstickRotate=L return Vector2.new(q.X*e,((q.Y*e)*l.ySensitivity)*B:GetCameraYInvertValue())end return r end function S.ApplyVRTransform(l)if not p.VREnabled then return end local q=l.humanoidRootPart and l.humanoidRootPart:FindFirstChild("\082\111\111\116\074\111\105\110\116")if not q then return end local L=game.Workspace.CurrentCamera.CameraSubject local e=L and L:IsA("\086\101\104\105\099\108\101\083\101\097\116")if l.inFirstPerson and not e then local l=p:GetUserCFrame(Enum.UserCFrame.Head)local L=l-l.p q.C0=CFrame.new(L:vectorToObjectSpace(l.p))*CFrame.new(0,0,0,-1,0,0,0,0,1,0,1,0)else q.C0=CFrame.new(0,0,0,-1,0,0,0,0,1,0,1,0)end end function S.IsInFirstPerson(l)return l.inFirstPerson end function S.ShouldUseVRRotation(l)if not p.VREnabled then return false end if not l.VRRotationIntensityAvailable and tick()-l.lastVRRotationIntensityCheckTime<1 then return false end local q,L=pcall(function()return b:GetCore("\086\082\082\111\116\097\116\105\111\110\073\110\116\101\110\115\105\116\121")end)l.VRRotationIntensityAvailable=q and L~=nil l.lastVRRotationIntensityCheckTime=tick()l.shouldUseVRRotation=q and(L~=nil and L~="\083\109\111\111\116\104")return l.shouldUseVRRotation end function S.GetVRRotationInput(l)local q=r local L,e=pcall(function()return b:GetCore("\086\082\082\111\116\097\116\105\111\110\073\110\116\101\110\115\105\116\121")end)if not L then return end local c=l.GamepadPanningCamera or r local W=tick()-l.lastVRRotationTime>=l:GetRepeatDelayValue(e)if math.abs(c.x)>=l:GetActivateValue()then if W or not l.vrRotateKeyCooldown[Enum.KeyCode.Thumbstick2]then local L=1 if c.x<0 then L=-1 end q=q+l:GetRotateAmountValue(e)*L l.vrRotateKeyCooldown[Enum.KeyCode.Thumbstick2]=true end elseif math.abs(c.x)<l:GetActivateValue()-.1 then l.vrRotateKeyCooldown[Enum.KeyCode.Thumbstick2]=nil end if l.turningLeft then if W or not l.vrRotateKeyCooldown[Enum.KeyCode.Left]then q=q-l:GetRotateAmountValue(e)l.vrRotateKeyCooldown[Enum.KeyCode.Left]=true end else l.vrRotateKeyCooldown[Enum.KeyCode.Left]=nil end if l.turningRight then if W or not l.vrRotateKeyCooldown[Enum.KeyCode.Right]then q=q+l:GetRotateAmountValue(e)l.vrRotateKeyCooldown[Enum.KeyCode.Right]=true end else l.vrRotateKeyCooldown[Enum.KeyCode.Right]=nil end if q~=r then l.lastVRRotationTime=tick()end return q end function S.CancelCameraFreeze(q,l)if not l then q.cameraTranslationConstraints=Vector3.new(q.cameraTranslationConstraints.x,1,q.cameraTranslationConstraints.z)end if q.cameraFrozen then q.trackingHumanoid=nil q.cameraFrozen=false end end function S.StartCameraFreeze(L,l,q)if not L.cameraFrozen then L.humanoidJumpOrigin=l L.trackingHumanoid=q L.cameraTranslationConstraints=Vector3.new(L.cameraTranslationConstraints.x,0,L.cameraTranslationConstraints.z)L.cameraFrozen=true end end function S.OnNewCameraSubject(l)if l.subjectStateChangedConn then l.subjectStateChangedConn:Disconnect()l.subjectStateChangedConn=nil end local q=workspace.CurrentCamera and workspace.CurrentCamera.CameraSubject if l.trackingHumanoid~=q then l:CancelCameraFreeze()end if q and q:IsA("\072\117\109\097\110\111\105\100")then l.subjectStateChangedConn=q.StateChanged:Connect(function(L,e)if p.VREnabled and(e==Enum.HumanoidStateType.Jumping and not l.inFirstPerson)then l:StartCameraFreeze(l:GetSubjectPosition(),q)elseif e~=Enum.HumanoidStateType.Jumping and e~=Enum.HumanoidStateType.Freefall then l:CancelCameraFreeze(true)end end)end end function S.GetVRFocus(L,l,q)local e=L.LastCameraFocus or l if not L.cameraFrozen then L.cameraTranslationConstraints=Vector3.new(L.cameraTranslationConstraints.x,math.min(1,L.cameraTranslationConstraints.y+.42*q),L.cameraTranslationConstraints.z)end local c if L.cameraFrozen and(L.humanoidJumpOrigin and L.humanoidJumpOrigin.y>e.y)then c=CFrame.new(Vector3.new(l.x,math.min(L.humanoidJumpOrigin.y,e.y+5*q),l.z))else c=CFrame.new((Vector3.new(l.x,e.y,l.z)):lerp(l,L.cameraTranslationConstraints.y))end if L.cameraFrozen then if L.inFirstPerson then L:CancelCameraFreeze()end if L.humanoidJumpOrigin and l.y<L.humanoidJumpOrigin.y-.5 then L:CancelCameraFreeze()end end return c end function S.GetRotateAmountValue(q,l)l=l or b:GetCore("\086\082\082\111\116\097\116\105\111\110\073\110\116\101\110\115\105\116\121")if l then if l=="\076\111\119"then return X elseif l=="\072\105\103\104"then return h end end return r end function S.GetRepeatDelayValue(q,l)l=l or b:GetCore("\086\082\082\111\116\097\116\105\111\110\073\110\116\101\110\115\105\116\121")if l then if l=="\076\111\119"then return T elseif l=="\072\105\103\104"then return i end end return 0 end function S.Update(q,l)error("\066\097\115\101\067\097\109\101\114\097\058\085\112\100\097\116\101\040\041 \084\104\105\115 \105\115 \097 \118\105\114\116\117\097\108 \102\117\110\099\116\105\111\110 \116\104\097\116 \115\104\111\117\108\100 \110\101\118\101\114 \098\101 \103\101\116\116\105\110\103 \099\097\108\108\101\100\046",2)end S.UpCFrame=CFrame.new()function S.UpdateUpCFrame(q,l)q.UpCFrame=l end local qI=Vector3.new(0,0,0)function S.CalculateNewLookCFrame(q,l)local L=l or q:GetCameraLookVector()L=q.UpCFrame:VectorToObjectSpace(L)local e=math.asin(L.y)local c=math.clamp(q.rotateInput.y,-K+e,-y+e)local W=Vector2.new(q.rotateInput.x,c)local o=CFrame.new(qI,L)local R=(CFrame.Angles(0,-W.x,0)*o)*CFrame.Angles(-W.y,0,0)return R end return S end function _BaseOcclusion()local l={}l.__index=l setmetatable(l,{__call=function(q,...)return l.new(...)end})function l.new()local q=setmetatable({},l)return q end function l.CharacterAdded(L,l,q) end function l.CharacterRemoving(L,l,q) end function l.OnCameraSubjectChanged(q,l) end function l.GetOcclusionMode(l)warn("\066\097\115\101\079\099\099\108\117\115\105\111\110 \071\101\116\079\099\099\108\117\115\105\111\110\077\111\100\101 \109\117\115\116 \098\101 \111\118\101\114\114\105\100\100\101\110 \098\121 \100\101\114\105\118\101\100 \099\108\097\115\115\101\115")return nil end function l.Enable(q,l)warn("\066\097\115\101\079\099\099\108\117\115\105\111\110 \069\110\097\098\108\101 \109\117\115\116 \098\101 \111\118\101\114\114\105\100\100\101\110 \098\121 \100\101\114\105\118\101\100 \099\108\097\115\115\101\115")end function l.Update(e,l,q,L)warn("\066\097\115\101\079\099\099\108\117\115\105\111\110 \085\112\100\097\116\101 \109\117\115\116 \098\101 \111\118\101\114\114\105\100\100\101\110 \098\121 \100\101\114\105\118\101\100 \099\108\097\115\115\101\115")return q,L end return l end function _Popper()local l=game:GetService("\080\108\097\121\101\114\115")local q=game.Workspace.CurrentCamera local L=math.min local e=math.tan local c=math.rad local W=math.huge local o=Ray.new local function y(l)return 1-(1-l.Transparency)*(1-l.LocalTransparencyModifier)end local function K(l,q)for q=#l,q+1,-1 do l[q]=nil end end local R,E,D do local function l()local l=c(q.FieldOfView)local L=q.ViewportSize local W=L.X/L.Y D=2*e(l/2)E=W*D end;(q:GetPropertyChangedSignal("\070\105\101\108\100\079\102\086\105\101\119")):Connect(l);(q:GetPropertyChangedSignal("\086\105\101\119\112\111\114\116\083\105\122\101")):Connect(l)l()R=q.NearPlaneZ;(q:GetPropertyChangedSignal("\078\101\097\114\080\108\097\110\101\090")):Connect(function()R=q.NearPlaneZ end)end local m={}do local q={}local function L()local l=1 m={}for q,L in pairs(q)do m[l]=L l=l+1 end end local function e(l)local function e(e)q[l]=e L()end local function c()q[l]=nil L()end l.CharacterAdded:Connect(e)l.CharacterRemoving:Connect(c)if l.Character then e(l.Character)end end local function c(l)q[l]=nil L()end l.PlayerAdded:Connect(e)l.PlayerRemoving:Connect(c)for l,q in ipairs(l:GetPlayers())do e(q)end L()end local v local X;(q:GetPropertyChangedSignal("\067\097\109\101\114\097\083\117\098\106\101\099\116")):Connect(function()local l=q.CameraSubject if l:IsA("\072\117\109\097\110\111\105\100")then X=l.RootPart elseif l:IsA("\066\097\115\101\080\097\114\116")then X=l else X=nil end end)local function h(l)return y(l)<.25 and(l.CanCollide and(v~=(l:GetRootPart()or l)and not l:IsA("\084\114\117\115\115\080\097\114\116")))end local T={Vector2.new(.4,0),Vector2.new(-0.4,0);Vector2.new(0,-0.4),Vector2.new(0,.4);Vector2.new(0,.2)}local function i(l,q)local L=#m repeat local e,c=workspace:FindPartOnRayWithIgnoreList(o(l,q),m,false,true)if e then if e.CanCollide then K(m,L)return c,true end m[#m+1]=e end until not e K(m,L)return l+q,false end local function r(l,q,L,e)debug.profilebegin("\113\117\101\114\121\080\111\105\110\116")local c=#m L=L+R local y=l+q*L local E=W local D=W local v=l repeat local c,K=workspace:FindPartOnRayWithIgnoreList(o(v,y-v),m,false,true)if c then if h(c)then local q={c}local W=workspace:FindPartOnRayWithWhitelist(o(y,K-y),q,true)local R=(K-l).Magnitude if W then local l=false if e then l=workspace:FindPartOnRayWithWhitelist(o(e,y-e),q,true)or workspace:FindPartOnRayWithWhitelist(o(y,e-y),q,true)end if l then D=R elseif L<E then E=R end else D=R end end m[#m+1]=c v=K-q*.001 end until D<W or not c K(m,c)debug.profileend()return E-R,D-R end local function U(l,L)debug.profilebegin("\113\117\101\114\121\086\105\101\119\112\111\114\116")local e=l.p local c=l.rightVector local o=l.upVector local y=-l.lookVector local K=q.ViewportSize local m=W local v=W for l=0,1,1 do local W=c*((l-.5)*E)for c=0,1,1 do local E=o*((c-.5)*D)local X=e+R*(W+E)local h=(q:ViewportPointToRay(K.x*l,K.y*c)).Origin local T,i=r(X,y,L,h)if i<m then m=i end if T<v then v=T end end end debug.profileend()return v,m end local function w(l,q,e)debug.profilebegin("\116\101\115\116\080\114\111\109\111\116\105\111\110")local c=l.p local o=l.rightVector local y=l.upVector local K=-l.lookVector do debug.profilebegin("\101\120\116\114\097\112\111\108\097\116\101")local l=.0625 local W=1.25 local o=(i(c,e.posVelocity*W)-c).Magnitude local y=e.posVelocity.magnitude for l=0,L(W,e.rotVelocity.magnitude+o/y),l do local L=e.extrapolate(l)if r(L.p,-L.lookVector,q)>=q then return false end end debug.profileend()end do debug.profilebegin("\116\101\115\116\079\102\102\115\101\116\115")for l,L in ipairs(T)do local e=L local R=i(c,o*e.x+y*e.y)if r(R,((c+K*q)-R).Unit,q)==W then return false end end debug.profileend()end debug.profileend()return true end local function G(l,q,L)debug.profilebegin("\112\111\112\112\101\114")v=X and X:GetRootPart()or X local e=q local c,W=U(l,q)if W<e then e=W end if c<e and w(l,q,L)then e=c end v=nil debug.profileend()return e end return G end function _ZoomController()local l=4.5 local q=12.5 local L=.0375 local e=.5 local c=1 local W=_Popper()local o=math.clamp local y=math.exp local K=math.min local R=math.max local E=math.pi local D,m do local l=(game:GetService("\080\108\097\121\101\114\115")).LocalPlayer local function q()D=l.CameraMinZoomDistance m=l.CameraMaxZoomDistance end q();(l:GetPropertyChangedSignal("\067\097\109\101\114\097\077\105\110\090\111\111\109\068\105\115\116\097\110\099\101")):Connect(q);(l:GetPropertyChangedSignal("\067\097\109\101\114\097\077\097\120\090\111\111\109\068\105\115\116\097\110\099\101")):Connect(q)end local v={}do v.__index=v function v.new(l,q,L,e)q=o(q,L,e)return setmetatable({freq=l,x=q,v=0;minValue=L,maxValue=e,goal=q},v)end function v.Step(q,l)local L=(q.freq*2)*E local e=q.x local c=q.v local W=q.minValue local o=q.maxValue local K=q.goal local R=K-e local D=L*l local m=y(-D)local v=K+(c*l-R*(D+1))*m local X=((R*L-c)*D+c)*m if v<W then v=W X=0 elseif v>o then v=o X=0 end q.x=v q.v=X return v end end local X=v.new(l,q,e,m)local function h(l,q,e,W)l=o(l+q*(1+l*L),e,W)if l<c then l=q<=0 and e or c end return l end local T=0 local i={}do function i.Update(l,q,L)local o=math.huge if X.goal>c then local l=R(X.x,h(X.goal,T,D,m))o=W(q*CFrame.new(0,0,e),l-e,L)+e end X.minValue=e X.maxValue=K(m,o)return X:Step(l)end function i.SetZoomParameters(l,q)X.goal=l T=q end end return i end function _MouseLockController()local l="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\077\111\117\115\101\076\111\099\107\101\100\067\117\114\115\111\114\046\112\110\103"local q="\077\111\117\115\101\076\111\099\107\083\119\105\116\099\104\065\099\116\105\111\110"local L=Enum.ContextActionPriority.Default.Value local e=game:GetService("\080\108\097\121\101\114\115")local c=game:GetService("\067\111\110\116\101\120\116\065\099\116\105\111\110\083\101\114\118\105\099\101")local W=UserSettings()local o=W.GameSettings local y=e.LocalPlayer:GetMouse()local K={}K.__index=K function K.new()local l=setmetatable({},K)l.isMouseLocked=false l.savedMouseCursor=nil l.boundKeys={Enum.KeyCode.LeftShift;Enum.KeyCode.RightShift}l.mouseLockToggledEvent=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116")local q=script:FindFirstChild("\066\111\117\110\100\075\101\121\115")if not q or not q:IsA("\083\116\114\105\110\103\086\097\108\117\101")then if q then q:Destroy()end q=Instance.new("\083\116\114\105\110\103\086\097\108\117\101")q.Name="\066\111\117\110\100\075\101\121\115"q.Value="\076\101\102\116\083\104\105\102\116\044\082\105\103\104\116\083\104\105\102\116"q.Parent=script end if q then q.Changed:Connect(function(q)l:OnBoundKeysObjectChanged(q)end)l:OnBoundKeysObjectChanged(q.Value)end o.Changed:Connect(function(q)if q=="\067\111\110\116\114\111\108\077\111\100\101"or q=="\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101"then l:UpdateMouseLockAvailability()end end);(e.LocalPlayer:GetPropertyChangedSignal("\068\101\118\069\110\097\098\108\101\077\111\117\115\101\076\111\099\107")):Connect(function()l:UpdateMouseLockAvailability()end);(e.LocalPlayer:GetPropertyChangedSignal("\068\101\118\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101")):Connect(function()l:UpdateMouseLockAvailability()end)l:UpdateMouseLockAvailability()return l end function K.GetIsMouseLocked(l)return l.isMouseLocked end function K.GetBindableToggleEvent(l)return l.mouseLockToggledEvent.Event end function K.GetMouseLockOffset(l)local q=script:FindFirstChild("\067\097\109\101\114\097\079\102\102\115\101\116")if q and q:IsA("\086\101\099\116\111\114\051\086\097\108\117\101")then return q.Value else if q then q:Destroy()end q=Instance.new("\086\101\099\116\111\114\051\086\097\108\117\101")q.Name="\067\097\109\101\114\097\079\102\102\115\101\116"q.Value=Vector3.new(1.75,0,0)q.Parent=script end if q and q.Value then return q.Value end return Vector3.new(1.75,0,0)end function K.UpdateMouseLockAvailability(l)local q=e.LocalPlayer.DevEnableMouseLock local L=e.LocalPlayer.DevComputerMovementMode==Enum.DevComputerMovementMode.Scriptable local c=o.ControlMode==Enum.ControlMode.MouseLockSwitch local W=o.ComputerMovementMode==Enum.ComputerMovementMode.ClickToMove local y=q and(c and(not W and not L))if y~=l.enabled then l:EnableMouseLock(y)end end function K.OnBoundKeysObjectChanged(q,l)q.boundKeys={}for l in string.gmatch(l,"\091\094\037\115\044\093\043")do for L,e in pairs(Enum.KeyCode:GetEnumItems())do if l==e.Name then q.boundKeys[#q.boundKeys+1]=e break end end end q:UnbindContextActions()q:BindContextActions()end function K.OnMouseLockToggled(q)q.isMouseLocked=not q.isMouseLocked if q.isMouseLocked then local L=script:FindFirstChild("\067\117\114\115\111\114\073\109\097\103\101")if L and(L:IsA("\083\116\114\105\110\103\086\097\108\117\101")and L.Value)then q.savedMouseCursor=y.Icon y.Icon=L.Value else if L then L:Destroy()end L=Instance.new("\083\116\114\105\110\103\086\097\108\117\101")L.Name="\067\117\114\115\111\114\073\109\097\103\101"L.Value=l L.Parent=script q.savedMouseCursor=y.Icon y.Icon=l end else if q.savedMouseCursor then y.Icon=q.savedMouseCursor q.savedMouseCursor=nil end end q.mouseLockToggledEvent:Fire()end function K.DoMouseLockSwitch(e,l,q,L)if q==Enum.UserInputState.Begin then e:OnMouseLockToggled()return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end function K.BindContextActions(l)c:BindActionAtPriority(q,function(q,L,e)return l:DoMouseLockSwitch(q,L,e)end,false,L,unpack(l.boundKeys))end function K.UnbindContextActions(l)c:UnbindAction(q)end function K.IsMouseLocked(l)return l.enabled and l.isMouseLocked end function K.EnableMouseLock(q,l)if l~=q.enabled then q.enabled=l if q.enabled then q:BindContextActions()else if y.Icon~=""then y.Icon=""end q:UnbindContextActions()if q.isMouseLocked then q.mouseLockToggledEvent:Fire()end q.isMouseLocked=false end end end return K end function _TransparencyController()local l=2.8 local q=_CameraUtils()local L={}L.__index=L function L.new()local l=setmetatable({},L)l.lastUpdate=tick()l.transparencyDirty=false l.enabled=false l.lastTransparency=nil l.descendantAddedConn,l.descendantRemovingConn=nil,nil l.toolDescendantAddedConns={}l.toolDescendantRemovingConns={}l.cachedParts={}return l end function L.HasToolAncestor(q,l)if l.Parent==nil then return false end return l.Parent:IsA("\084\111\111\108")or q:HasToolAncestor(l.Parent)end function L.IsValidPartToModify(q,l)if l:IsA("\066\097\115\101\080\097\114\116")or l:IsA("\068\101\099\097\108")then return not q:HasToolAncestor(l)end return false end function L.CachePartsRecursive(q,l)if l then if q:IsValidPartToModify(l)then q.cachedParts[l]=true q.transparencyDirty=true end for l,L in pairs(l:GetChildren())do q:CachePartsRecursive(L)end end end function L.TeardownTransparency(l)for l,q in pairs(l.cachedParts)do l.LocalTransparencyModifier=0 end l.cachedParts={}l.transparencyDirty=true l.lastTransparency=nil if l.descendantAddedConn then l.descendantAddedConn:disconnect()l.descendantAddedConn=nil end if l.descendantRemovingConn then l.descendantRemovingConn:disconnect()l.descendantRemovingConn=nil end for q,L in pairs(l.toolDescendantAddedConns)do L:Disconnect()l.toolDescendantAddedConns[q]=nil end for q,L in pairs(l.toolDescendantRemovingConns)do L:Disconnect()l.toolDescendantRemovingConns[q]=nil end end function L.SetupTransparency(q,l)q:TeardownTransparency()if q.descendantAddedConn then q.descendantAddedConn:disconnect()end q.descendantAddedConn=l.DescendantAdded:Connect(function(L)if q:IsValidPartToModify(L)then q.cachedParts[L]=true q.transparencyDirty=true elseif L:IsA("\084\111\111\108")then if q.toolDescendantAddedConns[L]then q.toolDescendantAddedConns[L]:Disconnect()end q.toolDescendantAddedConns[L]=L.DescendantAdded:Connect(function(l)q.cachedParts[l]=nil if l:IsA("\066\097\115\101\080\097\114\116")or l:IsA("\068\101\099\097\108")then l.LocalTransparencyModifier=0 end end)if q.toolDescendantRemovingConns[L]then q.toolDescendantRemovingConns[L]:disconnect()end q.toolDescendantRemovingConns[L]=L.DescendantRemoving:Connect(function(L)wait()if l and(L and L:IsDescendantOf(l))then if q:IsValidPartToModify(L)then q.cachedParts[L]=true q.transparencyDirty=true end end end)end end)if q.descendantRemovingConn then q.descendantRemovingConn:disconnect()end q.descendantRemovingConn=l.DescendantRemoving:connect(function(l)if q.cachedParts[l]then q.cachedParts[l]=nil l.LocalTransparencyModifier=0 end end)q:CachePartsRecursive(l)end function L.Enable(q,l)if q.enabled~=l then q.enabled=l q:Update()end end function L.SetSubject(q,l)local L=nil if l and l:IsA("\072\117\109\097\110\111\105\100")then L=l.Parent end if l and(l:IsA("\086\101\104\105\099\108\101\083\101\097\116")and l.Occupant)then L=l.Occupant.Parent end if L then q:SetupTransparency(L)else q:TeardownTransparency()end end function L.Update(L)local e=false local c=tick()local W=workspace.CurrentCamera if W then local o=0 if not L.enabled then e=true else local y=(W.Focus.p-W.CoordinateFrame.p).magnitude o=y<2 and 1-(y-.5)/1.5 or 0 if o<.5 then o=0 end if L.lastTransparency then local q=o-L.lastTransparency if not e and(o<1 and L.lastTransparency<.95)then local e=l*(c-L.lastUpdate)q=math.clamp(q,-e,e)end o=L.lastTransparency+q else L.transparencyDirty=true end o=math.clamp(q.Round(o,2),0,1)end if L.transparencyDirty or L.lastTransparency~=o then for l,q in pairs(L.cachedParts)do l.LocalTransparencyModifier=o end L.transparencyDirty=false L.lastTransparency=o end end L.lastUpdate=c end return L end function _Poppercam()local l=_ZoomController()local q={}do q.__index=q local l=CFrame.new()local function L(l)local q,L=l:toAxisAngle()return q*L end local function e(q)local L=q.magnitude if L>1e-05 then return CFrame.fromAxisAngle(q,L)end return l end local function c(l)local q,L,e,c,W,o,y,K,R,E,D,m=l:components()return CFrame.new(0,0,0,c,W,o,y,K,R,E,D,m)end function q.new()return setmetatable({lastCFrame=nil},q)end function q.Step(W,l,q)local o=W.lastCFrame or q W.lastCFrame=q local y=q.p local K=c(q)local R=o.p local E=c(o)local D=(y-R)/l local m=L(K*E:inverse())/l local function v(l)local q=D*l+y local L=e(m*l)*K return L+q end return{extrapolate=v,posVelocity=D;rotVelocity=m}end function q.Reset(l)l.lastCFrame=nil end end local L=_BaseOcclusion()local e=setmetatable({},L)e.__index=e function e.new()local l=setmetatable(L.new(),e)l.focusExtrapolator=q.new()return l end function e.GetOcclusionMode(l)return Enum.DevCameraOcclusionMode.Zoom end function e.Enable(q,l)q.focusExtrapolator:Reset()end function e.Update(W,q,L,e,c)local o=CFrame.new(e.p,L.p)*CFrame.new(0,0,0,-1,0,0,0,1,0,0,0,-1)local y=W.focusExtrapolator:Step(q,o)local K=l.Update(q,o,y)return o*CFrame.new(0,0,K),e end function e.CharacterAdded(L,l,q) end function e.CharacterRemoving(L,l,q) end function e.OnCameraSubjectChanged(q,l) end local c=_ZoomController()function e.Update(W,l,q,L,e)local o=L*(q-q.p)local y=W.focusExtrapolator:Step(l,o)local K=c.Update(l,o,y)return o*CFrame.new(0,0,K),L end return e end function _Invisicam()local l=game:GetService("\080\108\097\121\101\114\115")local q=Vector3.new(0,0,0)local L=true local e=.75 local c=.5 local W={LIMBS=2;MOVEMENT=3;CORNERS=4,CIRCLE1=5;CIRCLE2=6;LIMBMOVE=7,SMART_CIRCLE=8,CHAR_OUTLINE=9}local o={Head=true;["\076\101\102\116 \065\114\109"]=true;["\082\105\103\104\116 \065\114\109"]=true,["\076\101\102\116 \076\101\103"]=true,["\082\105\103\104\116 \076\101\103"]=true;LeftLowerArm=true,RightLowerArm=true;LeftUpperLeg=true;RightUpperLeg=true}local y={Vector3.new(1,1,-1),Vector3.new(1,-1,-1);Vector3.new(-1,-1,-1);Vector3.new(-1,1,-1)}local K=10 local R=3 local E=24 local D=(2*math.pi)/E local m=24 local function v(l,...)local q={}local L=""for l,e in pairs({...})do q[e]=true L=L..((L==""and""or" \111\114 ")..e)end local e=type(l)assert(q[e],L..(" \116\121\112\101 \101\120\112\101\099\116\101\100\044 \103\111\116\058 "..e))end local function X(l,q,L,e,c,W,o,y,K)return(l*(c*K-W*y)-q*(e*K-W*o))+L*(e*y-c*o)end local function h(l,L,e,c)local W=L:Cross(c)local o=e.x-l.x local y=e.y-l.y local K=e.z-l.z local R=X(L.x,-c.x,W.x,L.y,-c.y,W.y,L.z,-c.z,W.z)if R==0 then return q end local E=X(o,-c.x,W.x,y,-c.y,W.y,K,-c.z,W.z)/R local D=X(L.x,o,W.x,L.y,y,W.y,L.z,K,W.z)/R local m=l+E*L local v=e+D*c local h=m+.5*(v-m)if(v-m).Magnitude<.25 then return h else return q end end local T=_BaseOcclusion()local i=setmetatable({},T)i.__index=i function i.new()local l=setmetatable(T.new(),i)l.char=nil l.humanoidRootPart=nil l.torsoPart=nil l.headPart=nil l.childAddedConn=nil l.childRemovedConn=nil l.behaviors={}l.behaviors[W.LIMBS]=l.LimbBehavior l.behaviors[W.MOVEMENT]=l.MoveBehavior l.behaviors[W.CORNERS]=l.CornerBehavior l.behaviors[W.CIRCLE1]=l.CircleBehavior l.behaviors[W.CIRCLE2]=l.CircleBehavior l.behaviors[W.LIMBMOVE]=l.LimbMoveBehavior l.behaviors[W.SMART_CIRCLE]=l.SmartCircleBehavior l.behaviors[W.CHAR_OUTLINE]=l.CharacterOutlineBehavior l.mode=W.SMART_CIRCLE l.behaviorFunction=l.SmartCircleBehavior l.savedHits={}l.trackedLimbs={}l.camera=game.Workspace.CurrentCamera l.enabled=false return l end function i.Enable(q,l)q.enabled=l if not l then q:Cleanup()end end function i.GetOcclusionMode(l)return Enum.DevCameraOcclusionMode.Invisicam end function i.LimbBehavior(q,l)for q,L in pairs(q.trackedLimbs)do l[#l+1]=q.Position end end function i.MoveBehavior(q,l)for L=1,R,1 do local e,c=q.humanoidRootPart.Position,q.humanoidRootPart.Velocity local W=(Vector3.new(c.X,0,c.Z)).Magnitude/2 local o=((L-1)*q.humanoidRootPart.CFrame.lookVector)*W l[#l+1]=e+o end end function i.CornerBehavior(q,l)local L=q.humanoidRootPart.CFrame local e=L.p local c=L-e local W=q.char:GetExtentsSize()/2 l[#l+1]=e for q=1,#y,1 do l[#l+1]=e+c*(W*y[q])end end function i.CircleBehavior(q,l)local L if q.mode==W.CIRCLE1 then L=q.humanoidRootPart.CFrame else local l=q.camera.CoordinateFrame L=(l-l.p)+q.humanoidRootPart.Position end l[#l+1]=L.p for q=0,K-1,1 do local e=((2*math.pi)/K)*q local c=3*Vector3.new(math.cos(e),math.sin(e),0)l[#l+1]=L*c end end function i.LimbMoveBehavior(q,l)q:LimbBehavior(l)q:MoveBehavior(l)end function i.CharacterOutlineBehavior(L,l)local e=L.torsoPart.CFrame.upVector.unit local c=L.torsoPart.CFrame.rightVector.unit l[#l+1]=L.torsoPart.CFrame.p l[#l+1]=L.torsoPart.CFrame.p+e l[#l+1]=L.torsoPart.CFrame.p-e l[#l+1]=L.torsoPart.CFrame.p+c l[#l+1]=L.torsoPart.CFrame.p-c if L.headPart then l[#l+1]=L.headPart.CFrame.p end local W=CFrame.new(q,Vector3.new(L.camera.CoordinateFrame.lookVector.X,0,L.camera.CoordinateFrame.lookVector.Z))local o=L.torsoPart and L.torsoPart.Position or L.humanoidRootPart.Position local y={L.torsoPart}if L.headPart then y[#y+1]=L.headPart end for q=1,m,1 do local L=((2*math.pi)*q)/m local e=W*(3*Vector3.new(math.cos(L),math.sin(L),0))e=Vector3.new(e.X,math.max(e.Y,-2.25),e.Z)local c=Ray.new(o+e,-3*e)local K,R=game.Workspace:FindPartOnRayWithWhitelist(c,y,false,false)if K then l[#l+1]=R+.2*(o-R).unit end end end function i.SmartCircleBehavior(q,l)local L=q.torsoPart.CFrame.upVector.unit local e=q.torsoPart.CFrame.rightVector.unit l[#l+1]=q.torsoPart.CFrame.p l[#l+1]=q.torsoPart.CFrame.p+L l[#l+1]=q.torsoPart.CFrame.p-L l[#l+1]=q.torsoPart.CFrame.p+e l[#l+1]=q.torsoPart.CFrame.p-e if q.headPart then l[#l+1]=q.headPart.CFrame.p end local c=q.camera.CFrame-q.camera.CFrame.p local W=Vector3.new(0,.5,0)+(q.torsoPart and q.torsoPart.Position or q.humanoidRootPart.Position)local o=2.5 for L=1,E,1 do local e=D*L-.5*math.pi local y=o*Vector3.new(math.cos(e),math.sin(e),0)local K=W+c*y local R=K-q.camera.CFrame.p local E=Ray.new(W,K-W)local m,v,X=game.Workspace:FindPartOnRayWithIgnoreList(E,{q.char},false,false)local T=K if m then local l=v+.1*X.unit local L=l-W local e=(L:Cross(R)).unit local c=(e:Cross(X)).unit local o=(l-q.camera.CFrame.p).unit if L.unit:Dot(-c)<L.unit:Dot(o)then T=h(l,c,K,R)if T.Magnitude>0 then local L=Ray.new(l,T-l)local e,c,W=game.Workspace:FindPartOnRayWithIgnoreList(L,{q.char},false,false)if e then local l=c+.1*W.unit T=l end else T=l end else T=l end local y=Ray.new(W,T-W)local E,D,m=game.Workspace:FindPartOnRayWithIgnoreList(y,{q.char},false,false)if E then local l=D-.1*(T-W).unit T=l end end l[#l+1]=T end end function i.CheckTorsoReference(l)if l.char then l.torsoPart=l.char:FindFirstChild("\084\111\114\115\111")if not l.torsoPart then l.torsoPart=l.char:FindFirstChild("\085\112\112\101\114\084\111\114\115\111")if not l.torsoPart then l.torsoPart=l.char:FindFirstChild("\072\117\109\097\110\111\105\100\082\111\111\116\080\097\114\116")end end l.headPart=l.char:FindFirstChild("\072\101\097\100")end end function i.CharacterAdded(e,q,L)if L~=l.LocalPlayer then return end if e.childAddedConn then e.childAddedConn:Disconnect()e.childAddedConn=nil end if e.childRemovedConn then e.childRemovedConn:Disconnect()e.childRemovedConn=nil end e.char=q e.trackedLimbs={}local function c(l)if l:IsA("\066\097\115\101\080\097\114\116")then if o[l.Name]then e.trackedLimbs[l]=true end if l.Name=="\084\111\114\115\111"or l.Name=="\085\112\112\101\114\084\111\114\115\111"then e.torsoPart=l end if l.Name=="\072\101\097\100"then e.headPart=l end end end local function W(l)e.trackedLimbs[l]=nil e:CheckTorsoReference()end e.childAddedConn=q.ChildAdded:Connect(c)e.childRemovedConn=q.ChildRemoved:Connect(W)for l,q in pairs(e.char:GetChildren())do c(q)end end function i.SetMode(q,l)v(l,"\110\117\109\098\101\114")for L,e in pairs(W)do if e==l then q.mode=l q.behaviorFunction=q.behaviors[q.mode]return end end error("\073\110\118\097\108\105\100 \109\111\100\101 \110\117\109\098\101\114")end function i.GetObscuredParts(l)return l.savedHits end function i.Cleanup(l)for l,q in pairs(l.savedHits)do l.LocalTransparencyModifier=q end end function i.Update(o,l,q,W)if not o.enabled or not o.char then return q,W end o.camera=game.Workspace.CurrentCamera if not o.humanoidRootPart then local l=o.char:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")if l and l.RootPart then o.humanoidRootPart=l.RootPart else o.humanoidRootPart=o.char:FindFirstChild("\072\117\109\097\110\111\105\100\082\111\111\116\080\097\114\116")if not o.humanoidRootPart then return q,W end end local L L=o.humanoidRootPart.AncestryChanged:Connect(function(l,q)if l==o.humanoidRootPart and not q then o.humanoidRootPart=nil if L and L.Connected then L:Disconnect()L=nil end end end)end if not o.torsoPart then o:CheckTorsoReference()if not o.torsoPart then return q,W end end local y={}o.behaviorFunction(o,y)local K={}local R={o.char}local function E(l)K[l]=true if not o.savedHits[l]then o.savedHits[l]=l.LocalTransparencyModifier end end local D local m=0 local v={}local X=e local h=e if L then local l=o.headPart and o.headPart.CFrame.p or y[1]local q=o.torsoPart and o.torsoPart.CFrame.p or y[2]D=o.camera:GetPartsObscuringTarget({l,q},R)for l=1,#D,1 do local q=D[l]m=m+1 v[q]=true for l,q in pairs(q:GetChildren())do if q:IsA("\068\101\099\097\108")or q:IsA("\084\101\120\116\117\114\101")then m=m+1 break end end end if m>0 then X=math.pow(.5*e+(.5*e)/m,1/m)h=math.pow(.5*c+(.5*c)/m,1/m)end end D=o.camera:GetPartsObscuringTarget(y,R)local T={}for l=1,#D,1 do local q=D[l]T[q]=v[q]and X or h if q.Transparency<T[q]then E(q)end for l,L in pairs(q:GetChildren())do if L:IsA("\068\101\099\097\108")or L:IsA("\084\101\120\116\117\114\101")then if L.Transparency<T[q]then T[L]=T[q]E(L)end end end end for l,q in pairs(o.savedHits)do if K[l]then l.LocalTransparencyModifier=l.Transparency<1 and(T[l]-l.Transparency)/(1-l.Transparency)or 0 else l.LocalTransparencyModifier=q o.savedHits[l]=nil end end return q,W end return i end function _LegacyCamera()local l=Vector2.new(0,0)local q=_CameraUtils()local L=game:GetService("\080\108\097\121\101\114\115")local e=_BaseCamera()local c=setmetatable({},e)c.__index=c function c.new()local l=setmetatable(e.new(),c)l.cameraType=Enum.CameraType.Fixed l.lastUpdate=tick()l.lastDistanceToSubject=nil return l end function c.GetModuleName(l)return"\076\101\103\097\099\121\067\097\109\101\114\097"end function c.SetCameraToSubjectDistance(q,l)return e.SetCameraToSubjectDistance(q,l)end function c.Update(c,e)if not c.cameraType then return end local W=tick()local o=W-c.lastUpdate local y=workspace.CurrentCamera local K=y.CFrame local R=y.Focus local E=L.LocalPlayer if c.lastUpdate==nil or o>1 then c.lastDistanceToSubject=nil end local D=c:GetSubjectPosition()if c.cameraType==Enum.CameraType.Fixed then if c.lastUpdate then local l=math.min(.1,W-c.lastUpdate)local q=c:UpdateGamepad()c.rotateInput=c.rotateInput+q*l end if D and(E and y)then local q=c:GetCameraToSubjectDistance()local L=c:CalculateNewLookVector()c.rotateInput=l R=y.Focus K=CFrame.new(y.CFrame.p,y.CFrame.p+q*L)end elseif c.cameraType==Enum.CameraType.Attach then if D and y then local L=c:GetCameraToSubjectDistance()local e=c:GetHumanoid()if c.lastUpdate and(e and e.RootPart)then local l=math.min(.1,W-c.lastUpdate)local L=c:UpdateGamepad()c.rotateInput=c.rotateInput+L*l local o=e.RootPart.CFrame.lookVector local y=q.GetAngleBetweenXZVectors(o,c:GetCameraLookVector())if q.IsFinite(y)then c.rotateInput=Vector2.new(y,c.rotateInput.Y)end end local o=c:CalculateNewLookVector()c.rotateInput=l R=CFrame.new(D)K=CFrame.new(D-L*o,D)end elseif c.cameraType==Enum.CameraType.Watch then if D and(E and y)then local q=nil local L=c:GetHumanoid()if L and L.RootPart then local l=D-y.CFrame.p q=l.unit if c.lastDistanceToSubject and c.lastDistanceToSubject==c:GetCameraToSubjectDistance()then local q=l.magnitude c:SetCameraToSubjectDistance(q)end end local e=c:GetCameraToSubjectDistance()local W=c:CalculateNewLookVector(q)c.rotateInput=l R=CFrame.new(D)K=CFrame.new(D-e*W,D)c.lastDistanceToSubject=e end else return y.CFrame,y.Focus end c.lastUpdate=W return K,R end return c end function _OrbitalCamera()local l=Vector3.new(0,0,1)local q=Vector3.new(1,0,1)local L=Vector3.new(0,0,0)local e=Vector2.new(0,0)local c=2*math.pi local W=.2 local o=-80 local y=80 local K={}K.InitialDistance=25 K.MinDistance=10 K.MaxDistance=100 K.InitialElevation=35 K.MinElevation=35 K.MaxElevation=35 K.ReferenceAzimuth=-45 K.CWAzimuthTravel=90 K.CCWAzimuthTravel=90 K.UseAzimuthLimits=false local R=_CameraUtils()local E=game:GetService("\080\108\097\121\101\114\115")local D=game:GetService("\086\082\083\101\114\118\105\099\101")local m=_BaseCamera()local v=setmetatable({},m)v.__index=v function v.new()local l=setmetatable(m.new(),v)l.lastUpdate=tick()l.changedSignalConnections={}l.refAzimuthRad=nil l.curAzimuthRad=nil l.minAzimuthAbsoluteRad=nil l.maxAzimuthAbsoluteRad=nil l.useAzimuthLimits=nil l.curElevationRad=nil l.minElevationRad=nil l.maxElevationRad=nil l.curDistance=nil l.minDistance=nil l.maxDistance=nil l.r3ButtonDown=false l.l3ButtonDown=false l.gamepadDollySpeedMultiplier=1 l.lastUserPanCamera=tick()l.externalProperties={}l.externalProperties.InitialDistance=25 l.externalProperties.MinDistance=10 l.externalProperties.MaxDistance=100 l.externalProperties.InitialElevation=35 l.externalProperties.MinElevation=35 l.externalProperties.MaxElevation=35 l.externalProperties.ReferenceAzimuth=-45 l.externalProperties.CWAzimuthTravel=90 l.externalProperties.CCWAzimuthTravel=90 l.externalProperties.UseAzimuthLimits=false l:LoadNumberValueParameters()return l end function v.LoadOrCreateNumberValueParameter(e,l,q,L)local c=script:FindFirstChild(l)if c and c:isA(q)then e.externalProperties[l]=c.Value elseif e.externalProperties[l]~=nil then c=Instance.new(q)c.Name=l c.Parent=script c.Value=e.externalProperties[l]else print("\101\120\116\101\114\110\097\108\080\114\111\112\101\114\116\105\101\115 \116\097\098\108\101 \104\097\115 \110\111 \101\110\116\114\121 \102\111\114 ",l)return end if L then if e.changedSignalConnections[l]then e.changedSignalConnections[l]:Disconnect()end e.changedSignalConnections[l]=c.Changed:Connect(function(q)e.externalProperties[l]=q L(e)end)end end function v.SetAndBoundsCheckAzimuthValues(l)l.minAzimuthAbsoluteRad=math.rad(l.externalProperties.ReferenceAzimuth)-math.abs(math.rad(l.externalProperties.CWAzimuthTravel))l.maxAzimuthAbsoluteRad=math.rad(l.externalProperties.ReferenceAzimuth)+math.abs(math.rad(l.externalProperties.CCWAzimuthTravel))l.useAzimuthLimits=l.externalProperties.UseAzimuthLimits if l.useAzimuthLimits then l.curAzimuthRad=math.max(l.curAzimuthRad,l.minAzimuthAbsoluteRad)l.curAzimuthRad=math.min(l.curAzimuthRad,l.maxAzimuthAbsoluteRad)end end function v.SetAndBoundsCheckElevationValues(l)local q=math.max(l.externalProperties.MinElevation,o)local L=math.min(l.externalProperties.MaxElevation,y)l.minElevationRad=math.rad(math.min(q,L))l.maxElevationRad=math.rad(math.max(q,L))l.curElevationRad=math.max(l.curElevationRad,l.minElevationRad)l.curElevationRad=math.min(l.curElevationRad,l.maxElevationRad)end function v.SetAndBoundsCheckDistanceValues(l)l.minDistance=l.externalProperties.MinDistance l.maxDistance=l.externalProperties.MaxDistance l.curDistance=math.max(l.curDistance,l.minDistance)l.curDistance=math.min(l.curDistance,l.maxDistance)end function v.LoadNumberValueParameters(l)l:LoadOrCreateNumberValueParameter("\073\110\105\116\105\097\108\069\108\101\118\097\116\105\111\110","\078\117\109\098\101\114\086\097\108\117\101",nil)l:LoadOrCreateNumberValueParameter("\073\110\105\116\105\097\108\068\105\115\116\097\110\099\101","\078\117\109\098\101\114\086\097\108\117\101",nil)l:LoadOrCreateNumberValueParameter("\082\101\102\101\114\101\110\099\101\065\122\105\109\117\116\104","\078\117\109\098\101\114\086\097\108\117\101",l.SetAndBoundsCheckAzimuthValue)l:LoadOrCreateNumberValueParameter("\067\087\065\122\105\109\117\116\104\084\114\097\118\101\108","\078\117\109\098\101\114\086\097\108\117\101",l.SetAndBoundsCheckAzimuthValues)l:LoadOrCreateNumberValueParameter("\067\067\087\065\122\105\109\117\116\104\084\114\097\118\101\108","\078\117\109\098\101\114\086\097\108\117\101",l.SetAndBoundsCheckAzimuthValues)l:LoadOrCreateNumberValueParameter("\077\105\110\069\108\101\118\097\116\105\111\110","\078\117\109\098\101\114\086\097\108\117\101",l.SetAndBoundsCheckElevationValues)l:LoadOrCreateNumberValueParameter("\077\097\120\069\108\101\118\097\116\105\111\110","\078\117\109\098\101\114\086\097\108\117\101",l.SetAndBoundsCheckElevationValues)l:LoadOrCreateNumberValueParameter("\077\105\110\068\105\115\116\097\110\099\101","\078\117\109\098\101\114\086\097\108\117\101",l.SetAndBoundsCheckDistanceValues)l:LoadOrCreateNumberValueParameter("\077\097\120\068\105\115\116\097\110\099\101","\078\117\109\098\101\114\086\097\108\117\101",l.SetAndBoundsCheckDistanceValues)l:LoadOrCreateNumberValueParameter("\085\115\101\065\122\105\109\117\116\104\076\105\109\105\116\115","\066\111\111\108\086\097\108\117\101",l.SetAndBoundsCheckAzimuthValues)l.curAzimuthRad=math.rad(l.externalProperties.ReferenceAzimuth)l.curElevationRad=math.rad(l.externalProperties.InitialElevation)l.curDistance=l.externalProperties.InitialDistance l:SetAndBoundsCheckAzimuthValues()l:SetAndBoundsCheckElevationValues()l:SetAndBoundsCheckDistanceValues()end function v.GetModuleName(l)return"\079\114\098\105\116\097\108\067\097\109\101\114\097"end function v.SetInitialOrientation(q,l)if not l or not l.RootPart then warn("\079\114\098\105\116\097\108\067\097\109\101\114\097 \099\111\117\108\100 \110\111\116 \115\101\116 \105\110\105\116\105\097\108 \111\114\105\101\110\116\097\116\105\111\110 \100\117\101 \116\111 \109\105\115\115\105\110\103 \104\117\109\097\110\111\105\100")return end local L=(l.RootPart.CFrame.lookVector-Vector3.new(0,.23,0)).unit local e=R.GetAngleBetweenXZVectors(L,q:GetCameraLookVector())local c=math.asin((q:GetCameraLookVector()).y)-math.asin(L.y)if not R.IsFinite(e)then e=0 end if not R.IsFinite(c)then c=0 end q.rotateInput=Vector2.new(e,c)end function v.GetCameraToSubjectDistance(l)return l.curDistance end function v.SetCameraToSubjectDistance(q,l)print("\079\114\098\105\116\097\108\067\097\109\101\114\097 \083\101\116\067\097\109\101\114\097\084\111\083\117\098\106\101\099\116\068\105\115\116\097\110\099\101 ",l)local L=E.LocalPlayer if L then q.currentSubjectDistance=math.clamp(l,q.minDistance,q.maxDistance)q.currentSubjectDistance=math.max(q.currentSubjectDistance,q.FIRST_PERSON_DISTANCE_THRESHOLD)end q.inFirstPerson=false q:UpdateMouseBehavior()return q.currentSubjectDistance end function v.CalculateNewLookVector(e,l,q)local c=l or e:GetCameraLookVector()local W=math.asin(c.y)local K=math.clamp(q.y,W-math.rad(y),W-math.rad(o))local R=Vector2.new(q.x,K)local E=CFrame.new(L,c)local D=((CFrame.Angles(0,-R.x,0)*E)*CFrame.Angles(-R.y,0,0)).lookVector return D end function v.GetGamepadPan(c,l,q,L)if L.UserInputType==c.activeGamepad and L.KeyCode==Enum.KeyCode.Thumbstick2 then if c.r3ButtonDown or c.l3ButtonDown then if L.Position.Y>W then c.gamepadDollySpeedMultiplier=.96 elseif L.Position.Y<-W then c.gamepadDollySpeedMultiplier=1.04 else c.gamepadDollySpeedMultiplier=1 end else if q==Enum.UserInputState.Cancel then c.gamepadPanningCamera=e return end local l=Vector2.new(L.Position.X,-L.Position.Y)if l.magnitude>W then c.gamepadPanningCamera=Vector2.new(L.Position.X,-L.Position.Y)else c.gamepadPanningCamera=e end end return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end function v.DoGamepadZoom(e,l,q,L)if L.UserInputType==e.activeGamepad and(L.KeyCode==Enum.KeyCode.ButtonR3 or L.KeyCode==Enum.KeyCode.ButtonL3)then if q==Enum.UserInputState.Begin then e.r3ButtonDown=L.KeyCode==Enum.KeyCode.ButtonR3 e.l3ButtonDown=L.KeyCode==Enum.KeyCode.ButtonL3 elseif q==Enum.UserInputState.End then if L.KeyCode==Enum.KeyCode.ButtonR3 then e.r3ButtonDown=false elseif L.KeyCode==Enum.KeyCode.ButtonL3 then e.l3ButtonDown=false end if not e.r3ButtonDown and not e.l3ButtonDown then e.gamepadDollySpeedMultiplier=1 end end return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end function v.BindGamepadInputActions(l)l:BindAction("\079\114\098\105\116\097\108\067\097\109\071\097\109\101\112\097\100\080\097\110",function(q,L,e)return l:GetGamepadPan(q,L,e)end,false,Enum.KeyCode.Thumbstick2)l:BindAction("\079\114\098\105\116\097\108\067\097\109\071\097\109\101\112\097\100\090\111\111\109",function(q,L,e)return l:DoGamepadZoom(q,L,e)end,false,Enum.KeyCode.ButtonR3,Enum.KeyCode.ButtonL3)end function v.Update(W,L)local o=tick()local y=o-W.lastUpdate local K=W.UserPanningTheCamera==true local R=workspace.CurrentCamera local m=R.CFrame local v=R.Focus local X=E.LocalPlayer local h=R and R.CameraSubject local T=h and h:IsA("\086\101\104\105\099\108\101\083\101\097\116")local i=h and h:IsA("\083\107\097\116\101\098\111\097\114\100\080\108\097\116\102\111\114\109")if W.lastUpdate==nil or y>1 then W.lastCameraTransform=nil end if W.lastUpdate then local l=W:UpdateGamepad()if W:ShouldUseVRRotation()then W.RotateInput=W.RotateInput+W:GetVRRotationInput()else local q=math.min(.1,y)if l~=e then K=true W.rotateInput=W.rotateInput+l*q end local L=0 if not(T or i)then L=L+(W.TurningLeft and-120 or 0)L=L+(W.TurningRight and 120 or 0)end if L~=0 then W.rotateInput=W.rotateInput+Vector2.new(math.rad(L*q),0)K=true end end end if K then W.lastUserPanCamera=tick()end local r=W:GetSubjectPosition()if r and(X and R)then if W.gamepadDollySpeedMultiplier~=1 then W:SetCameraToSubjectDistance(W.currentSubjectDistance*W.gamepadDollySpeedMultiplier)end local L=D.VREnabled v=L and W:GetVRFocus(r,y)or CFrame.new(r)local o=v.p if L and not W:IsInFirstPerson()then local l=W:GetCameraHeight()local L=r-R.CFrame.p local c=L.magnitude if c>W.currentSubjectDistance or W.rotateInput.x~=0 then local y=math.min(c,W.currentSubjectDistance)L=W:CalculateNewLookVector(L.unit*q,Vector2.new(W.rotateInput.x,0))*y local K=o-L local E=R.CFrame.lookVector if W.rotateInput.x~=0 then E=L end local D=Vector3.new(K.x+E.x,K.y,K.z+E.z)W.RotateInput=e m=CFrame.new(K,D)+Vector3.new(0,l,0)end else W.curAzimuthRad=W.curAzimuthRad-W.rotateInput.x if W.useAzimuthLimits then W.curAzimuthRad=math.clamp(W.curAzimuthRad,W.minAzimuthAbsoluteRad,W.maxAzimuthAbsoluteRad)else W.curAzimuthRad=W.curAzimuthRad~=0 and math.sign(W.curAzimuthRad)*(math.abs(W.curAzimuthRad)%c)or 0 end W.curElevationRad=math.clamp(W.curElevationRad+W.rotateInput.y,W.minElevationRad,W.maxElevationRad)local q=W.currentSubjectDistance*(CFrame.fromEulerAnglesYXZ(-W.curElevationRad,W.curAzimuthRad,0)*l)local L=r+q m=CFrame.new(L,r)W.rotateInput=e end W.lastCameraTransform=m W.lastCameraFocus=v if(T or i)and h:IsA("\066\097\115\101\080\097\114\116")then W.lastSubjectCFrame=h.CFrame else W.lastSubjectCFrame=nil end end W.lastUpdate=o return m,v end return v end function _ClassicCamera()local l=Vector2.new(0,0)local q=math.rad(220)local L=math.rad(0)local e=math.rad(250)local c=2 local W=CFrame.fromOrientation(math.rad(-15),0,0)local o do local l,q=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\067\097\109\101\114\097\084\111\103\103\108\101")end)o=l and q end local y=game:GetService("\080\108\097\121\101\114\115")local K=game:GetService("\086\082\083\101\114\118\105\099\101")local R=_CameraInput()local E=_CameraUtils()local D=_BaseCamera()local m=setmetatable({},D)m.__index=m function m.new()local l=setmetatable(D.new(),m)l.isFollowCamera=false l.isCameraToggle=false l.lastUpdate=tick()l.cameraToggleSpring=E.Spring.new(5,0)return l end function m.GetCameraToggleOffset(q,l)assert(o)if q.isCameraToggle then local L=q.currentSubjectDistance if R.getTogglePan()then q.cameraToggleSpring.goal=math.clamp(E.map(L,.5,q.FIRST_PERSON_DISTANCE_THRESHOLD,0,1),0,1)else q.cameraToggleSpring.goal=0 end local e=math.clamp(E.map(L,.5,64,0,1),0,1)+1 return Vector3.new(0,q.cameraToggleSpring:step(l)*e,0)end return Vector3.new()end function m.SetCameraMovementMode(q,l)D.SetCameraMovementMode(q,l)q.isFollowCamera=l==Enum.ComputerCameraMovementMode.Follow q.isCameraToggle=l==Enum.ComputerCameraMovementMode.CameraToggle end function m.Update(R)local D=tick()local m=D-R.lastUpdate local v=workspace.CurrentCamera local X=v.CFrame local h=v.Focus local T=nil if R.resetCameraAngle then local l=R:GetHumanoidRootPart()if l then T=(l.CFrame*W).lookVector else T=W.lookVector end R.resetCameraAngle=false end local i=y.LocalPlayer local r=R:GetHumanoid()local U=v.CameraSubject local w=U and U:IsA("\086\101\104\105\099\108\101\083\101\097\116")local G=U and U:IsA("\083\107\097\116\101\098\111\097\114\100\080\108\097\116\102\111\114\109")local I=r and r:GetState()==Enum.HumanoidStateType.Climbing if R.lastUpdate==nil or m>1 then R.lastCameraTransform=nil end if R.lastUpdate then local q=R:UpdateGamepad()if R:ShouldUseVRRotation()then R.rotateInput=R.rotateInput+R:GetVRRotationInput()else local L=math.min(.1,m)if q~=l then R.rotateInput=R.rotateInput+q*L end local e=0 if not(w or G)then e=e+(R.turningLeft and-120 or 0)e=e+(R.turningRight and 120 or 0)end if e~=0 then R.rotateInput=R.rotateInput+Vector2.new(math.rad(e*L),0)end end end local a=R:GetCameraHeight()if R.userPanningTheCamera then L=0 R.lastUserPanCamera=tick()end local H=D-R.lastUserPanCamera<c local d=R:GetSubjectPosition()if d and(i and v)then local c=R:GetCameraToSubjectDistance()if c<.5 then c=.5 end if R:GetIsMouseLocked()and not R:IsInFirstPerson()then local l=R:CalculateNewLookCFrame(T)local q=R:GetMouseLockOffset()local L=(q.X*l.rightVector+q.Y*l.upVector)+q.Z*l.lookVector if E.IsFiniteVector3(L)then d=d+L end else if not R.userPanningTheCamera and R.lastCameraTransform then local l=R:IsInFirstPerson()if(w or G or R.isFollowCamera and I)and(R.lastUpdate and(r and r.Torso))then if l then if R.lastSubjectCFrame and((w or G)and U:IsA("\066\097\115\101\080\097\114\116"))then local l=-E.GetAngleBetweenXZVectors(R.lastSubjectCFrame.lookVector,U.CFrame.lookVector)if E.IsFinite(l)then R.rotateInput=R.rotateInput+Vector2.new(l,0)end L=0 end elseif not H then local l=r.Torso.CFrame.lookVector if G then l=U.CFrame.lookVector end L=math.clamp(L+q*m,0,e)local c=math.clamp(L*m,0,1)if R:IsInFirstPerson()and not(R.isFollowCamera and R.isClimbing)then c=1 end local W=E.GetAngleBetweenXZVectors(l,R:GetCameraLookVector())if E.IsFinite(W)and math.abs(W)>.0001 then R.rotateInput=R.rotateInput+Vector2.new(W*c,0)end end elseif R.isFollowCamera and(not(l or H)and not K.VREnabled)then local l=-(R.lastCameraTransform.p-d)local q=E.GetAngleBetweenXZVectors(l,R:GetCameraLookVector())local L=.4 if E.IsFinite(q)and(math.abs(q)>.0001 and math.abs(q)>L*m)then R.rotateInput=R.rotateInput+Vector2.new(q,0)end end end end if not R.isFollowCamera then local q=K.VREnabled if q then h=R:GetVRFocus(d,m)else h=CFrame.new(d)end local L=h.p if q and not R:IsInFirstPerson()then local q=d-v.CFrame.p local e=q.magnitude if e>c or R.rotateInput.x~=0 then local W=math.min(e,c)q=R:CalculateNewLookVectorVR()*W local o=L-q local y=v.CFrame.lookVector if R.rotateInput.x~=0 then y=q end local K=Vector3.new(o.x+y.x,o.y,o.z+y.z)R.rotateInput=l X=CFrame.new(o,K)+Vector3.new(0,a,0)end else local q=R:CalculateNewLookVector(T)R.rotateInput=l X=CFrame.new(L-c*q,L)end else local q=R:CalculateNewLookVector(T)R.rotateInput=l if K.VREnabled then h=R:GetVRFocus(d,m)else h=CFrame.new(d)end X=CFrame.new(h.p-c*q,h.p)+Vector3.new(0,a,0)end if o then local l=R:GetCameraToggleOffset(m)h=h+l X=X+l end R.lastCameraTransform=X R.lastCameraFocus=h if(w or G)and U:IsA("\066\097\115\101\080\097\114\116")then R.lastSubjectCFrame=U.CFrame else R.lastSubjectCFrame=nil end end R.lastUpdate=D return X,h end function m.EnterFirstPerson(l)l.inFirstPerson=true l:UpdateMouseBehavior()end function m.LeaveFirstPerson(l)l.inFirstPerson=false l:UpdateMouseBehavior()end return m end function _CameraUtils()local l={}local q do local l,L=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\067\097\109\101\114\097\084\111\103\103\108\101")end)q=l and L end local function L(l)return math.floor(l+.5)end local e={}do e.__index=e function e.new(l,q)return setmetatable({freq=l,goal=q;pos=q;vel=0},e)end function e.step(q,l)local L=(q.freq*2)*math.pi local e=q.goal local c=q.pos local W=q.vel local o=c-e local y=math.exp(-L*l)local K=(o*(1+L*l)+W*l)*y+e local R=(W*(1-L*l)-o*((L*L)*l))*y q.pos=K q.vel=R return K end end l.Spring=e function l.map(l,q,L,e,c)return((l-q)*(c-e))/(L-q)+e end function l.Round(l,q)local L=10^q return math.floor(l*L+.5)/L end function l.IsFinite(l)return l==l and(l~=math.huge and l~=-math.huge)end function l.IsFiniteVector3(q)return l.IsFinite(q.X)and(l.IsFinite(q.Y)and l.IsFinite(q.Z))end function l.GetAngleBetweenXZVectors(l,q)return math.atan2(q.X*l.Z-q.Z*l.X,q.X*l.X+q.Z*l.Z)end function l.RotateVectorByAngleAndRound(l,q,e)if l.Magnitude>0 then l=l.unit local c=math.atan2(l.z,l.x)local W=L((math.atan2(l.z,l.x)+q)/e)*e return W-c end return 0 end local c=.35 local W=.8 local function o(l)l=math.clamp(l,-1,1)if l>=0 then return(c*l)/((c-l)+1)end return-((W*-l)/((W+l)+1))end local y=.1 local function K(l)return(1+y)*(2*math.abs(l)-1)-y end local function R(l)return l/2+.5 end function l.GamepadLinearToCurve(l)local function q(l)local q=1 if l<0 then q=-1 end local L=R(o(K(math.abs(l))))L=L*q return math.clamp(L,-1,1)end return Vector2.new(q(l.x),q(l.y))end function l.ConvertCameraModeEnumToStandard(l)if l==Enum.TouchCameraMovementMode.Default then return Enum.ComputerCameraMovementMode.Follow end if l==Enum.ComputerCameraMovementMode.Default then return Enum.ComputerCameraMovementMode.Classic end if l==Enum.TouchCameraMovementMode.Classic or l==Enum.DevTouchCameraMovementMode.Classic or l==Enum.DevComputerCameraMovementMode.Classic or l==Enum.ComputerCameraMovementMode.Classic then return Enum.ComputerCameraMovementMode.Classic end if l==Enum.TouchCameraMovementMode.Follow or l==Enum.DevTouchCameraMovementMode.Follow or l==Enum.DevComputerCameraMovementMode.Follow or l==Enum.ComputerCameraMovementMode.Follow then return Enum.ComputerCameraMovementMode.Follow end if l==Enum.TouchCameraMovementMode.Orbital or l==Enum.DevTouchCameraMovementMode.Orbital or l==Enum.DevComputerCameraMovementMode.Orbital or l==Enum.ComputerCameraMovementMode.Orbital then return Enum.ComputerCameraMovementMode.Orbital end if q then if l==Enum.ComputerCameraMovementMode.CameraToggle or l==Enum.DevComputerCameraMovementMode.CameraToggle then return Enum.ComputerCameraMovementMode.CameraToggle end end if l==Enum.DevTouchCameraMovementMode.UserChoice or l==Enum.DevComputerCameraMovementMode.UserChoice then return Enum.DevComputerCameraMovementMode.UserChoice end return Enum.ComputerCameraMovementMode.Classic end return l end function _CameraModule()local l={}l.__index=l local q do local l,L=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\067\097\109\101\114\097\084\111\103\103\108\101")end)q=l and L end local L do local l,q=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\082\101\109\111\118\101\084\104\101\067\097\109\101\114\097\065\112\105")end)L=l and q end local e={"\067\097\109\101\114\097\077\105\110\090\111\111\109\068\105\115\116\097\110\099\101","\067\097\109\101\114\097\077\097\120\090\111\111\109\068\105\115\116\097\110\099\101","\067\097\109\101\114\097\077\111\100\101";"\068\101\118\067\097\109\101\114\097\079\099\099\108\117\115\105\111\110\077\111\100\101","\068\101\118\067\111\109\112\117\116\101\114\067\097\109\101\114\097\077\111\100\101";"\068\101\118\084\111\117\099\104\067\097\109\101\114\097\077\111\100\101","\068\101\118\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101";"\068\101\118\084\111\117\099\104\077\111\118\101\109\101\110\116\077\111\100\101","\068\101\118\069\110\097\098\108\101\077\111\117\115\101\076\111\099\107"}local c={"\067\111\109\112\117\116\101\114\067\097\109\101\114\097\077\111\118\101\109\101\110\116\077\111\100\101";"\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101";"\067\111\110\116\114\111\108\077\111\100\101";"\071\097\109\101\112\097\100\067\097\109\101\114\097\083\101\110\115\105\116\105\118\105\116\121";"\077\111\117\115\101\083\101\110\115\105\116\105\118\105\116\121","\082\111\116\097\116\105\111\110\084\121\112\101","\084\111\117\099\104\067\097\109\101\114\097\077\111\118\101\109\101\110\116\077\111\100\101";"\084\111\117\099\104\077\111\118\101\109\101\110\116\077\111\100\101"}local W=game:GetService("\080\108\097\121\101\114\115")local o=game:GetService("\082\117\110\083\101\114\118\105\099\101")local y=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local K=(UserSettings()):GetService("\085\115\101\114\071\097\109\101\083\101\116\116\105\110\103\115")local R=_CameraUtils()local E=_ClassicCamera()local D=_OrbitalCamera()local m=_LegacyCamera()local v=_Invisicam()local X=_Poppercam()local h=_TransparencyController()local T=_MouseLockController()local i={}local r={}do local l=W.LocalPlayer:WaitForChild("\080\108\097\121\101\114\083\099\114\105\112\116\115")l:RegisterTouchCameraMovementMode(Enum.TouchCameraMovementMode.Default)l:RegisterTouchCameraMovementMode(Enum.TouchCameraMovementMode.Follow)l:RegisterTouchCameraMovementMode(Enum.TouchCameraMovementMode.Classic)l:RegisterComputerCameraMovementMode(Enum.ComputerCameraMovementMode.Default)l:RegisterComputerCameraMovementMode(Enum.ComputerCameraMovementMode.Follow)l:RegisterComputerCameraMovementMode(Enum.ComputerCameraMovementMode.Classic)if q then l:RegisterComputerCameraMovementMode(Enum.ComputerCameraMovementMode.CameraToggle)end end l.FFlagUserCameraToggle=q function l.new()local q=setmetatable({},l)q.activeCameraController=nil q.activeOcclusionModule=nil q.activeTransparencyController=nil q.activeMouseLockController=nil q.currentComputerCameraMovementMode=nil q.cameraSubjectChangedConn=nil q.cameraTypeChangedConn=nil for l,L in pairs(W:GetPlayers())do q:OnPlayerAdded(L)end W.PlayerAdded:Connect(function(l)q:OnPlayerAdded(l)end)q.activeTransparencyController=h.new()q.activeTransparencyController:Enable(true)if not y.TouchEnabled then q.activeMouseLockController=T.new()local l=q.activeMouseLockController:GetBindableToggleEvent()if l then l:Connect(function()q:OnMouseLockToggled()end)end end q:ActivateCameraController(q:GetCameraControlChoice())q:ActivateOcclusionModule(W.LocalPlayer.DevCameraOcclusionMode)q:OnCurrentCameraChanged()o:BindToRenderStep("\099\097\109\101\114\097\082\101\110\100\101\114\085\112\100\097\116\101",Enum.RenderPriority.Camera.Value,function(l)q:Update(l)end)for l,L in pairs(e)do(W.LocalPlayer:GetPropertyChangedSignal(L)):Connect(function()q:OnLocalPlayerCameraPropertyChanged(L)end)end for l,L in pairs(c)do(K:GetPropertyChangedSignal(L)):Connect(function()q:OnUserGameSettingsPropertyChanged(L)end)end;(game.Workspace:GetPropertyChangedSignal("\067\117\114\114\101\110\116\067\097\109\101\114\097")):Connect(function()q:OnCurrentCameraChanged()end)q.lastInputType=y:GetLastInputType()y.LastInputTypeChanged:Connect(function(l)q.lastInputType=l end)return q end function l.GetCameraMovementModeFromSettings(l)local q=W.LocalPlayer.CameraMode if q==Enum.CameraMode.LockFirstPerson then return R.ConvertCameraModeEnumToStandard(Enum.ComputerCameraMovementMode.Classic)end local L,e if y.TouchEnabled then L=R.ConvertCameraModeEnumToStandard(W.LocalPlayer.DevTouchCameraMode)e=R.ConvertCameraModeEnumToStandard(K.TouchCameraMovementMode)else L=R.ConvertCameraModeEnumToStandard(W.LocalPlayer.DevComputerCameraMode)e=R.ConvertCameraModeEnumToStandard(K.ComputerCameraMovementMode)end if L==Enum.DevComputerCameraMovementMode.UserChoice then return e end return L end function l.ActivateOcclusionModule(q,l)local L if l==Enum.DevCameraOcclusionMode.Zoom then L=X elseif l==Enum.DevCameraOcclusionMode.Invisicam then L=v else warn("\067\097\109\101\114\097\083\099\114\105\112\116 \065\099\116\105\118\097\116\101\079\099\099\108\117\115\105\111\110\077\111\100\117\108\101 \099\097\108\108\101\100 \119\105\116\104 \117\110\115\117\112\112\111\114\116\101\100 \109\111\100\101")return end if q.activeOcclusionModule and q.activeOcclusionModule:GetOcclusionMode()==l then if not q.activeOcclusionModule:GetEnabled()then q.activeOcclusionModule:Enable(true)end return end local e=q.activeOcclusionModule q.activeOcclusionModule=r[L]if not q.activeOcclusionModule then q.activeOcclusionModule=L.new()if q.activeOcclusionModule then r[L]=q.activeOcclusionModule end end if q.activeOcclusionModule then local L=q.activeOcclusionModule:GetOcclusionMode()if L~=l then warn("\067\097\109\101\114\097\083\099\114\105\112\116 \065\099\116\105\118\097\116\101\079\099\099\108\117\115\105\111\110\077\111\100\117\108\101 \109\105\115\109\097\116\099\104\058 ",q.activeOcclusionModule:GetOcclusionMode(),"~\061",l)end if e then if e~=q.activeOcclusionModule then e:Enable(false)else warn("\067\097\109\101\114\097\083\099\114\105\112\116 \065\099\116\105\118\097\116\101\079\099\099\108\117\115\105\111\110\077\111\100\117\108\101 \102\097\105\108\117\114\101 \116\111 \100\101\116\101\099\116 \097\108\114\101\097\100\121 \114\117\110\110\105\110\103 \099\111\114\114\101\099\116 \109\111\100\117\108\101")end end if l==Enum.DevCameraOcclusionMode.Invisicam then if W.LocalPlayer.Character then q.activeOcclusionModule:CharacterAdded(W.LocalPlayer.Character,W.LocalPlayer)end else for l,L in pairs(W:GetPlayers())do if L and L.Character then q.activeOcclusionModule:CharacterAdded(L.Character,L)end end q.activeOcclusionModule:OnCameraSubjectChanged(game.Workspace.CurrentCamera.CameraSubject)end q.activeOcclusionModule:Enable(true)end end function l.ActivateCameraController(e,l,L)local c=nil if L~=nil then if L==Enum.CameraType.Scriptable then if e.activeCameraController then e.activeCameraController:Enable(false)e.activeCameraController=nil return end elseif L==Enum.CameraType.Custom then l=e:GetCameraMovementModeFromSettings()elseif L==Enum.CameraType.Track then l=Enum.ComputerCameraMovementMode.Classic elseif L==Enum.CameraType.Follow then l=Enum.ComputerCameraMovementMode.Follow elseif L==Enum.CameraType.Orbital then l=Enum.ComputerCameraMovementMode.Orbital elseif L==Enum.CameraType.Attach or L==Enum.CameraType.Watch or L==Enum.CameraType.Fixed then c=m else warn("\067\097\109\101\114\097\083\099\114\105\112\116 \101\110\099\111\117\110\116\101\114\101\100 \097\110 \117\110\104\097\110\100\108\101\100 \067\097\109\101\114\097\046\067\097\109\101\114\097\084\121\112\101 \118\097\108\117\101\058 ",L)end end if not c then if l==Enum.ComputerCameraMovementMode.Classic or l==Enum.ComputerCameraMovementMode.Follow or l==Enum.ComputerCameraMovementMode.Default or q and l==Enum.ComputerCameraMovementMode.CameraToggle then c=E elseif l==Enum.ComputerCameraMovementMode.Orbital then c=D else warn("\065\099\116\105\118\097\116\101\067\097\109\101\114\097\067\111\110\116\114\111\108\108\101\114 \100\105\100 \110\111\116 \115\101\108\101\099\116 \097 \109\111\100\117\108\101\046")return end end local W if not i[c]then W=c.new()i[c]=W else W=i[c]end if e.activeCameraController then if e.activeCameraController~=W then e.activeCameraController:Enable(false)e.activeCameraController=W e.activeCameraController:Enable(true)elseif not e.activeCameraController:GetEnabled()then e.activeCameraController:Enable(true)end elseif W~=nil then e.activeCameraController=W e.activeCameraController:Enable(true)end if e.activeCameraController then if l~=nil then e.activeCameraController:SetCameraMovementMode(l)elseif L~=nil then e.activeCameraController:SetCameraType(L)end end end function l.OnCameraSubjectChanged(l)if l.activeTransparencyController then l.activeTransparencyController:SetSubject(game.Workspace.CurrentCamera.CameraSubject)end if l.activeOcclusionModule then l.activeOcclusionModule:OnCameraSubjectChanged(game.Workspace.CurrentCamera.CameraSubject)end end function l.OnCameraTypeChanged(q,l)if l==Enum.CameraType.Scriptable then if y.MouseBehavior==Enum.MouseBehavior.LockCenter then y.MouseBehavior=Enum.MouseBehavior.Default end end q:ActivateCameraController(nil,l)end function l.OnCurrentCameraChanged(l)local q=game.Workspace.CurrentCamera if not q then return end if l.cameraSubjectChangedConn then l.cameraSubjectChangedConn:Disconnect()end if l.cameraTypeChangedConn then l.cameraTypeChangedConn:Disconnect()end l.cameraSubjectChangedConn=(q:GetPropertyChangedSignal("\067\097\109\101\114\097\083\117\098\106\101\099\116")):Connect(function()l:OnCameraSubjectChanged(q.CameraSubject)end)l.cameraTypeChangedConn=(q:GetPropertyChangedSignal("\067\097\109\101\114\097\084\121\112\101")):Connect(function()l:OnCameraTypeChanged(q.CameraType)end)l:OnCameraSubjectChanged(q.CameraSubject)l:OnCameraTypeChanged(q.CameraType)end function l.OnLocalPlayerCameraPropertyChanged(q,l)if l=="\067\097\109\101\114\097\077\111\100\101"then if W.LocalPlayer.CameraMode==Enum.CameraMode.LockFirstPerson then if not q.activeCameraController or q.activeCameraController:GetModuleName()~="\067\108\097\115\115\105\099\067\097\109\101\114\097"then q:ActivateCameraController(R.ConvertCameraModeEnumToStandard(Enum.DevComputerCameraMovementMode.Classic))end if q.activeCameraController then q.activeCameraController:UpdateForDistancePropertyChange()end elseif W.LocalPlayer.CameraMode==Enum.CameraMode.Classic then local l=q:GetCameraMovementModeFromSettings()q:ActivateCameraController(R.ConvertCameraModeEnumToStandard(l))else warn("\085\110\104\097\110\100\108\101\100 \118\097\108\117\101 \102\111\114 \112\114\111\112\101\114\116\121 \112\108\097\121\101\114\046\067\097\109\101\114\097\077\111\100\101\058 ",W.LocalPlayer.CameraMode)end elseif l=="\068\101\118\067\111\109\112\117\116\101\114\067\097\109\101\114\097\077\111\100\101"or l=="\068\101\118\084\111\117\099\104\067\097\109\101\114\097\077\111\100\101"then local l=q:GetCameraMovementModeFromSettings()q:ActivateCameraController(R.ConvertCameraModeEnumToStandard(l))elseif l=="\068\101\118\067\097\109\101\114\097\079\099\099\108\117\115\105\111\110\077\111\100\101"then q:ActivateOcclusionModule(W.LocalPlayer.DevCameraOcclusionMode)elseif l=="\067\097\109\101\114\097\077\105\110\090\111\111\109\068\105\115\116\097\110\099\101"or l=="\067\097\109\101\114\097\077\097\120\090\111\111\109\068\105\115\116\097\110\099\101"then if q.activeCameraController then q.activeCameraController:UpdateForDistancePropertyChange()end elseif l=="\068\101\118\084\111\117\099\104\077\111\118\101\109\101\110\116\077\111\100\101"then elseif l=="\068\101\118\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101"then elseif l=="\068\101\118\069\110\097\098\108\101\077\111\117\115\101\076\111\099\107"then end end function l.OnUserGameSettingsPropertyChanged(q,l)if l=="\067\111\109\112\117\116\101\114\067\097\109\101\114\097\077\111\118\101\109\101\110\116\077\111\100\101"then local l=q:GetCameraMovementModeFromSettings()q:ActivateCameraController(R.ConvertCameraModeEnumToStandard(l))end end function l.Update(L,l)if L.activeCameraController then if q then L.activeCameraController:UpdateMouseBehavior()end local e,c=L.activeCameraController:Update(l)L.activeCameraController:ApplyVRTransform()if L.activeOcclusionModule then e,c=L.activeOcclusionModule:Update(l,e,c)end game.Workspace.CurrentCamera.CFrame=e game.Workspace.CurrentCamera.Focus=c if L.activeTransparencyController then L.activeTransparencyController:Update()end end end function l.GetCameraControlChoice(l)local q=W.LocalPlayer if q then if l.lastInputType==Enum.UserInputType.Touch or y.TouchEnabled then if q.DevTouchCameraMode==Enum.DevTouchCameraMovementMode.UserChoice then return R.ConvertCameraModeEnumToStandard(K.TouchCameraMovementMode)else return R.ConvertCameraModeEnumToStandard(q.DevTouchCameraMode)end else if q.DevComputerCameraMode==Enum.DevComputerCameraMovementMode.UserChoice then local l=R.ConvertCameraModeEnumToStandard(K.ComputerCameraMovementMode)return R.ConvertCameraModeEnumToStandard(l)else return R.ConvertCameraModeEnumToStandard(q.DevComputerCameraMode)end end end end function l.OnCharacterAdded(L,l,q)if L.activeOcclusionModule then L.activeOcclusionModule:CharacterAdded(l,q)end end function l.OnCharacterRemoving(L,l,q)if L.activeOcclusionModule then L.activeOcclusionModule:CharacterRemoving(l,q)end end function l.OnPlayerAdded(q,l)l.CharacterAdded:Connect(function(L)q:OnCharacterAdded(L,l)end)l.CharacterRemoving:Connect(function(L)q:OnCharacterRemoving(L,l)end)end function l.OnMouseLockToggled(l)if l.activeMouseLockController then local q=l.activeMouseLockController:GetIsMouseLocked()local L=l.activeMouseLockController:GetMouseLockOffset()if l.activeCameraController then l.activeCameraController:SetIsMouseLocked(q)l.activeCameraController:SetMouseLockOffset(L)end end end local U=l local w=CFrame.new()local G=w U.UpVector=Vector3.new(0,1,0)U.TransitionRate=.15 U.UpCFrame=w function U.GetUpVector(q,l)return l end local function I(l,q,L)local e,c=l:Dot(q),l:Cross(q)if e<-0.99999 then return CFrame.fromAxisAngle(L,math.pi)end return CFrame.new(0,0,0,c.x,c.y,c.z,1+e)end function U.CalculateUpCFrame(l)local q=l.UpVector local L=l:GetUpVector(q)local e=game.Workspace.CurrentCamera.CFrame.RightVector local c=I(q,L,e)local W=w:Lerp(c,l.TransitionRate)l.UpVector=W*q l.UpCFrame=W*l.UpCFrame G=l.UpCFrame end function U.Update(q,l)if q.activeCameraController then if U.FFlagUserCameraToggle then q.activeCameraController:UpdateMouseBehavior()end local L,e=q.activeCameraController:Update(l)q.activeCameraController:ApplyVRTransform()q:CalculateUpCFrame()q.activeCameraController:UpdateUpCFrame(q.UpCFrame)local c=Vector3.new(0,0,0)if q.activeMouseLockController and q.activeMouseLockController:GetIsMouseLocked()then c=q.activeMouseLockController:GetMouseLockOffset()end local W=e:ToObjectSpace(L)local o=q.UpCFrame*W e=(e-L:VectorToWorldSpace(c))+o:VectorToWorldSpace(c)L=e*o if q.activeCameraController.lastCameraTransform then q.activeCameraController.lastCameraTransform=L q.activeCameraController.lastCameraFocus=e end if q.activeOcclusionModule then L,e=q.activeOcclusionModule:Update(l,L,e)end game.Workspace.CurrentCamera.CFrame=L game.Workspace.CurrentCamera.Focus=e if q.activeTransparencyController then q.activeTransparencyController:Update()end end end function U.IsFirstPerson(l)if l.activeCameraController then return l.activeCameraController:InFirstPerson()end return false end function U.IsMouseLocked(l)if l.activeCameraController then return l.activeCameraController:GetIsMouseLocked()end return false end function U.IsToggleMode(l)if l.activeCameraController then return l.activeCameraController.isCameraToggle end return false end function U.IsCamRelative(l)return l:IsMouseLocked()or l:IsFirstPerson()end local a=_CameraUtils()function a.GetAngleBetweenXZVectors(l,q)local L=G l=L:VectorToObjectSpace(l)q=L:VectorToObjectSpace(q)return math.atan2(q.X*l.Z-q.Z*l.X,q.X*l.X+q.Z*l.Z)end local H=l.new()local d={}return H end function _ClickToMoveDisplay()local l={}local q="\114\098\120\097\115\115\101\116\105\100\058\047\047\050\056\055\052\056\052\048\055\048\054"local L="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\117\105\047\116\114\097\105\108\100\111\116\046\112\110\103"local e="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\117\105\047\119\097\121\112\111\105\110\116\046\112\110\103"local c=false local W=2 local o=3 local y=UDim2.new(0,42,0,50)local K=Vector2.new(0,.5)local R=Vector2.new(0,1)local E=Vector2.new(0,.5)local D=Vector2.new(.1,.5)local m=Vector2.new(-0.1,.5)local v=.125 local X=4 local h=5 local T="\067\108\105\099\107\084\111\077\111\118\101\068\105\115\112\108\097\121"local i=Vector2.new(1.5,1.5)local r=1 local U=10 local w=2.5 local G=100 local I=game:GetService("\080\108\097\121\101\114\115")local a=game:GetService("\084\119\101\101\110\083\101\114\118\105\099\101")local H=game:GetService("\082\117\110\083\101\114\118\105\099\101")local d=game:GetService("\087\111\114\107\115\112\097\099\101")local z=I.LocalPlayer local function j()local l=Instance.new("\080\097\114\116")l.Size=Vector3.new(1,1,1)l.Anchored=true l.CanCollide=false l.Name="\084\114\097\105\108\068\111\116"l.Transparency=1 local q=Instance.new("\073\109\097\103\101\072\097\110\100\108\101\065\100\111\114\110\109\101\110\116")q.Name="\084\114\097\105\108\068\111\116\073\109\097\103\101"q.Size=i q.SizeRelativeOffset=Vector3.new(0,0,-0.1)q.AlwaysOnTop=c q.Image=L q.Adornee=l q.Parent=l local W=Instance.new("\080\097\114\116")W.Size=Vector3.new(2,2,2)W.Anchored=true W.CanCollide=false W.Name="\069\110\100\087\097\121\112\111\105\110\116"W.Transparency=1 local o=Instance.new("\073\109\097\103\101\072\097\110\100\108\101\065\100\111\114\110\109\101\110\116")o.Name="\084\114\097\105\108\068\111\116\073\109\097\103\101"o.Size=i o.SizeRelativeOffset=Vector3.new(0,0,-0.1)o.AlwaysOnTop=c o.Image=L o.Adornee=W o.Parent=W local R=Instance.new("\066\105\108\108\098\111\097\114\100\071\117\105")R.Name="\069\110\100\087\097\121\112\111\105\110\116\066\105\108\108\098\111\097\114\100"R.Size=y R.LightInfluence=0 R.SizeOffset=K R.AlwaysOnTop=true R.Adornee=W R.Parent=W local D=Instance.new("\073\109\097\103\101\076\097\098\101\108")D.Image=e D.BackgroundTransparency=1 D.Size=UDim2.new(1,0,1,0)D.Parent=R local m=Instance.new("\080\097\114\116")m.Size=Vector3.new(2,2,2)m.Anchored=true m.CanCollide=false m.Name="\070\097\105\108\117\114\101\087\097\121\112\111\105\110\116"m.Transparency=1 local v=Instance.new("\073\109\097\103\101\072\097\110\100\108\101\065\100\111\114\110\109\101\110\116")v.Name="\084\114\097\105\108\068\111\116\073\109\097\103\101"v.Size=i v.SizeRelativeOffset=Vector3.new(0,0,-0.1)v.AlwaysOnTop=c v.Image=L v.Adornee=m v.Parent=m local X=Instance.new("\066\105\108\108\098\111\097\114\100\071\117\105")X.Name="\070\097\105\108\117\114\101\087\097\121\112\111\105\110\116\066\105\108\108\098\111\097\114\100"X.Size=y X.LightInfluence=0 X.SizeOffset=E X.AlwaysOnTop=true X.Adornee=m X.Parent=m local h=Instance.new("\070\114\097\109\101")h.BackgroundTransparency=1 h.Size=UDim2.new(0,0,0,0)h.Position=UDim2.new(.5,0,1,0)h.Parent=X local T=Instance.new("\073\109\097\103\101\076\097\098\101\108")T.Image=e T.BackgroundTransparency=1 T.Position=UDim2.new(0,-y.X.Offset/2,0,-y.Y.Offset)T.Size=y T.Parent=h return l,W,m end local Q,P,n=j()local function k()local l=d.CurrentCamera local q=l:FindFirstChild(T)if not q then q=Instance.new("\077\111\100\101\108")q.Name=T q.Parent=l end return q end local function N(l,q)local L=Ray.new(q+Vector3.new(0,2.5,0),Vector3.new(0,-10,0))local e,c,W=d:FindPartOnRayWithIgnoreList(L,{d.CurrentCamera;z.Character})if e then l.CFrame=CFrame.new(c,c+W)l.Parent=k()end end local C={}C.__index=C function C.Destroy(l)l.DisplayModel:Destroy()end function C.NewDisplayModel(q,l)local L=Q:Clone()N(L,l)return L end function C.new(l,q)local L=setmetatable({},C)L.DisplayModel=L:NewDisplayModel(l)L.ClosestWayPoint=q return L end local V={}V.__index=V function V.Destroy(l)l.Destroyed=true l.Tween:Cancel()l.DisplayModel:Destroy()end function V.NewDisplayModel(q,l)local L=P:Clone()N(L,l)return L end function V.CreateTween(l)local q=TweenInfo.new(.5,Enum.EasingStyle.Sine,Enum.EasingDirection.Out,-1,true)local L=a:Create(l.DisplayModel.EndWaypointBillboard,q,{SizeOffset=R})L:Play()return L end function V.TweenInFrom(q,l)local L=q.DisplayModel.Position local e=l-L q.DisplayModel.EndWaypointBillboard.StudsOffset=Vector3.new(0,e.Y,0)local c=TweenInfo.new(1,Enum.EasingStyle.Sine,Enum.EasingDirection.Out)local W=a:Create(q.DisplayModel.EndWaypointBillboard,c,{StudsOffset=Vector3.new(0,0,0)})W:Play()return W end function V.new(l,q,L)local e=setmetatable({},V)e.DisplayModel=e:NewDisplayModel(l)e.Destroyed=false if L and(L-l).magnitude>h then e.Tween=e:TweenInFrom(L);(coroutine.wrap(function()e.Tween.Completed:Wait()if not e.Destroyed then e.Tween=e:CreateTween()end end))()else e.Tween=e:CreateTween()end e.ClosestWayPoint=q return e end local g={}g.__index=g function g.Hide(l)l.DisplayModel.Parent=nil end function g.Destroy(l)l.DisplayModel:Destroy()end function g.NewDisplayModel(q,l)local L=n:Clone()N(L,l)local e=Ray.new(l+Vector3.new(0,2.5,0),Vector3.new(0,-10,0))local c,W,o=d:FindPartOnRayWithIgnoreList(e,{d.CurrentCamera;z.Character})if c then L.CFrame=CFrame.new(W,W+o)L.Parent=k()end return L end function g.RunFailureTween(l)wait(v)local q=TweenInfo.new(v/2,Enum.EasingStyle.Sine,Enum.EasingDirection.Out)local L=a:Create(l.DisplayModel.FailureWaypointBillboard,q,{SizeOffset=D})L:Play()local e=a:Create(l.DisplayModel.FailureWaypointBillboard.Frame,q,{Rotation=10})e:Play()L.Completed:wait()q=TweenInfo.new(v,Enum.EasingStyle.Sine,Enum.EasingDirection.Out,X-1,true)local c=a:Create(l.DisplayModel.FailureWaypointBillboard,q,{SizeOffset=m})c:Play()q=TweenInfo.new(v,Enum.EasingStyle.Sine,Enum.EasingDirection.Out,X-1,true)local W=a:Create(l.DisplayModel.FailureWaypointBillboard.Frame.ImageLabel,q,{ImageColor3=Color3.new(.75,.75,.75)})W:Play()local o=a:Create(l.DisplayModel.FailureWaypointBillboard.Frame,q,{Rotation=-10})o:Play()c.Completed:wait()q=TweenInfo.new(v/2,Enum.EasingStyle.Sine,Enum.EasingDirection.Out)local y=a:Create(l.DisplayModel.FailureWaypointBillboard,q,{SizeOffset=E})y:Play()local K=a:Create(l.DisplayModel.FailureWaypointBillboard.Frame,q,{Rotation=0})K:Play()y.Completed:wait()wait(v)end function g.new(l)local q=setmetatable({},g)q.DisplayModel=q:NewDisplayModel(l)return q end local s=Instance.new("\065\110\105\109\097\116\105\111\110")s.AnimationId=q local Y=nil local M=nil local function O(l)if l==Y then return M end M=l:LoadAnimation(s)M.Priority=Enum.AnimationPriority.Action M.Looped=false return M end local function x()local l=z.Character if l then return l:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")end end local function J(l,q)local L={}local e=1 for q=1,#l-1,1 do local c=(l[q].Position-l[#l].Position).magnitude<o local y=q%W==0 and not c if y then local c=C.new(l[q].Position,q)L[e]=c e=e+1 end end local c=V.new(l[#l].Position,#l,q)table.insert(L,c)local y={}e=1 for l=#L,1,-1 do y[e]=L[l]e=e+1 end return y end local function u(l,q)local L=G-U local e=math.clamp(l-U,0,L)/L local c=r+(w-r)*e return q*c end local F=0 function l.CreatePathDisplay(l,q)F=F+1 local L=J(l,q)local function e(l)for q=#L,1,-1 do local e=L[q]if e.ClosestWayPoint<=l then e:Destroy()L[q]=nil else break end end end local c="\067\108\105\099\107\084\111\077\111\118\101\082\101\115\105\122\101\084\114\097\105\108"..F local function W()if#L==0 then H:UnbindFromRenderStep(c)return end local l=d.CurrentCamera.CFrame.p for q=1,#L,1 do local e=L[q].DisplayModel:FindFirstChild("\084\114\097\105\108\068\111\116\073\109\097\103\101")if e then local c=(L[q].DisplayModel.Position-l).magnitude e.Size=u(c,i)end end end H:BindToRenderStep(c,Enum.RenderPriority.Camera.Value-1,W)local function o()e(#l)end return o,e end local Z=nil function l.DisplayFailureWaypoint(l)if Z then Z:Hide()end local q=g.new(l)Z=q;(coroutine.wrap(function()q:RunFailureTween()q:Destroy()q=nil end))()end function l.CreateEndWaypoint(l)return V.new(l)end function l.PlayFailureAnimation()local l=x()if l then local q=O(l)q:Play()end end function l.CancelFailureAnimation()if M~=nil and M.IsPlaying then M:Stop()end end function l.SetWaypointTexture(l)L=l Q,P,n=j()end function l.GetWaypointTexture()return L end function l.SetWaypointRadius(l)i=Vector2.new(l,l)Q,P,n=j()end function l.GetWaypointRadius()return i.X end function l.SetEndWaypointTexture(l)e=l Q,P,n=j()end function l.GetEndWaypointTexture()return e end function l.SetWaypointsAlwaysOnTop(l)c=l Q,P,n=j()end function l.GetWaypointsAlwaysOnTop()return c end return l end function _BaseCharacterController()local l=Vector3.new(0,0,0)local q={}q.__index=q function q.new()local L=setmetatable({},q)L.enabled=false L.moveVector=l L.moveVectorIsCameraRelative=true L.isJumping=false return L end function q.OnRenderStepped(q,l) end function q.GetMoveVector(l)return l.moveVector end function q.IsMoveVectorCameraRelative(l)return l.moveVectorIsCameraRelative end function q.GetIsJumping(l)return l.isJumping end function q.Enable(q,l)error("\066\097\115\101\067\104\097\114\097\099\116\101\114\067\111\110\116\114\111\108\108\101\114\058\069\110\097\098\108\101 \109\117\115\116 \098\101 \111\118\101\114\114\105\100\100\101\110 \105\110 \100\101\114\105\118\101\100 \099\108\097\115\115\101\115 \097\110\100 \115\104\111\117\108\100 \110\111\116 \098\101 \099\097\108\108\101\100\046")return false end return q end function _VehicleController()local l=game:GetService("\067\111\110\116\101\120\116\065\099\116\105\111\110\083\101\114\118\105\099\101")local q=true local L=false local e=Vector3.new(0,0,0)local c=35 local W={}W.__index=W function W.new(l)local q=setmetatable({},W)q.CONTROL_ACTION_PRIORITY=l q.enabled=false q.vehicleSeat=nil q.throttle=0 q.steer=0 q.acceleration=0 q.decceleration=0 q.turningRight=0 q.turningLeft=0 q.vehicleMoveVector=e q.autoPilot={}q.autoPilot.MaxSpeed=0 q.autoPilot.MaxSteeringAngle=0 return q end function W.BindContextActions(L)if q then l:BindActionAtPriority("\116\104\114\111\116\116\108\101\065\099\099\101\108",function(l,q,e)L:OnThrottleAccel(l,q,e)return Enum.ContextActionResult.Pass end,false,L.CONTROL_ACTION_PRIORITY,Enum.KeyCode.ButtonR2)l:BindActionAtPriority("\116\104\114\111\116\116\108\101\068\101\099\099\101\108",function(l,q,e)L:OnThrottleDeccel(l,q,e)return Enum.ContextActionResult.Pass end,false,L.CONTROL_ACTION_PRIORITY,Enum.KeyCode.ButtonL2)end l:BindActionAtPriority("\097\114\114\111\119\083\116\101\101\114\082\105\103\104\116",function(l,q,e)L:OnSteerRight(l,q,e)return Enum.ContextActionResult.Pass end,false,L.CONTROL_ACTION_PRIORITY,Enum.KeyCode.Right)l:BindActionAtPriority("\097\114\114\111\119\083\116\101\101\114\076\101\102\116",function(l,q,e)L:OnSteerLeft(l,q,e)return Enum.ContextActionResult.Pass end,false,L.CONTROL_ACTION_PRIORITY,Enum.KeyCode.Left)end function W.Enable(W,L,c)if L==W.enabled and c==W.vehicleSeat then return end W.enabled=L W.vehicleMoveVector=e if L then if c then W.vehicleSeat=c W:SetupAutoPilot()W:BindContextActions()end else if q then l:UnbindAction("\116\104\114\111\116\116\108\101\065\099\099\101\108")l:UnbindAction("\116\104\114\111\116\116\108\101\068\101\099\099\101\108")end l:UnbindAction("\097\114\114\111\119\083\116\101\101\114\082\105\103\104\116")l:UnbindAction("\097\114\114\111\119\083\116\101\101\114\076\101\102\116")W.vehicleSeat=nil end end function W.OnThrottleAccel(e,l,q,L)if q==Enum.UserInputState.End or q==Enum.UserInputState.Cancel then e.acceleration=0 else e.acceleration=-1 end e.throttle=e.acceleration+e.decceleration end function W.OnThrottleDeccel(e,l,q,L)if q==Enum.UserInputState.End or q==Enum.UserInputState.Cancel then e.decceleration=0 else e.decceleration=1 end e.throttle=e.acceleration+e.decceleration end function W.OnSteerRight(e,l,q,L)if q==Enum.UserInputState.End or q==Enum.UserInputState.Cancel then e.turningRight=0 else e.turningRight=1 end e.steer=e.turningRight+e.turningLeft end function W.OnSteerLeft(e,l,q,L)if q==Enum.UserInputState.End or q==Enum.UserInputState.Cancel then e.turningLeft=0 else e.turningLeft=-1 end e.steer=e.turningRight+e.turningLeft end function W.Update(o,l,c,W)if o.vehicleSeat then if c then l=l+Vector3.new(o.steer,0,o.throttle)if W and(L and q)then o.vehicleSeat.ThrottleFloat=-o.throttle else o.vehicleSeat.ThrottleFloat=-l.Z end o.vehicleSeat.SteerFloat=l.X return l,true else local q=o.vehicleSeat.Occupant.RootPart.CFrame:VectorToObjectSpace(l)o.vehicleSeat.ThrottleFloat=o:ComputeThrottle(q)o.vehicleSeat.SteerFloat=o:ComputeSteer(q)return e,true end end return l,false end function W.ComputeThrottle(q,l)if l~=e then local q=-l.Z return q else return 0 end end function W.ComputeSteer(q,l)if l~=e then local L=-math.atan2(-l.x,-l.z)*(180/math.pi)return L/q.autoPilot.MaxSteeringAngle else return 0 end end function W.SetupAutoPilot(l)l.autoPilot.MaxSpeed=l.vehicleSeat.MaxSpeed l.autoPilot.MaxSteeringAngle=c end return W end function _TouchJump()local l=game:GetService("\080\108\097\121\101\114\115")local q=game:GetService("\071\117\105\083\101\114\118\105\099\101")local L="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\117\105\047\073\110\112\117\116\047\084\111\117\099\104\067\111\110\116\114\111\108\115\083\104\101\101\116\086\050\046\112\110\103"local e=_BaseCharacterController()local c=setmetatable({},e)c.__index=c function c.new()local l=setmetatable(e.new(),c)l.parentUIFrame=nil l.jumpButton=nil l.characterAddedConn=nil l.humanoidStateEnabledChangedConn=nil l.humanoidJumpPowerConn=nil l.humanoidParentConn=nil l.externallyEnabled=false l.jumpPower=0 l.jumpStateEnabled=true l.isJumping=false l.humanoid=nil return l end function c.EnableButton(L,q)if q then if not L.jumpButton then L:Create()end local q=l.LocalPlayer.Character and l.LocalPlayer.Character:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")if q and L.externallyEnabled then if L.externallyEnabled then if q.JumpPower>0 then L.jumpButton.Visible=true end end end else L.jumpButton.Visible=false L.isJumping=false L.jumpButton.ImageRectOffset=Vector2.new(1,146)end end function c.UpdateEnabled(l)if l.jumpPower>0 and l.jumpStateEnabled then l:EnableButton(true)else l:EnableButton(false)end end function c.HumanoidChanged(L,q)local e=l.LocalPlayer.Character and l.LocalPlayer.Character:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")if e then if q=="\074\117\109\112\080\111\119\101\114"then L.jumpPower=e.JumpPower L:UpdateEnabled()elseif q=="\080\097\114\101\110\116"then if not e.Parent then L.humanoidChangeConn:Disconnect()end end end end function c.HumanoidStateEnabledChanged(L,l,q)if l==Enum.HumanoidStateType.Jumping then L.jumpStateEnabled=q L:UpdateEnabled()end end function c.CharacterAdded(q,l)if q.humanoidChangeConn then q.humanoidChangeConn:Disconnect()q.humanoidChangeConn=nil end q.humanoid=l:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")while not q.humanoid do l.ChildAdded:wait()q.humanoid=l:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")end q.humanoidJumpPowerConn=(q.humanoid:GetPropertyChangedSignal("\074\117\109\112\080\111\119\101\114")):Connect(function()q.jumpPower=q.humanoid.JumpPower q:UpdateEnabled()end)q.humanoidParentConn=(q.humanoid:GetPropertyChangedSignal("\080\097\114\101\110\116")):Connect(function()if not q.humanoid.Parent then q.humanoidJumpPowerConn:Disconnect()q.humanoidJumpPowerConn=nil q.humanoidParentConn:Disconnect()q.humanoidParentConn=nil end end)q.humanoidStateEnabledChangedConn=q.humanoid.StateEnabledChanged:Connect(function(l,L)q:HumanoidStateEnabledChanged(l,L)end)q.jumpPower=q.humanoid.JumpPower q.jumpStateEnabled=q.humanoid:GetStateEnabled(Enum.HumanoidStateType.Jumping)q:UpdateEnabled()end function c.SetupCharacterAddedFunction(q)q.characterAddedConn=l.LocalPlayer.CharacterAdded:Connect(function(l)q:CharacterAdded(l)end)if l.LocalPlayer.Character then q:CharacterAdded(l.LocalPlayer.Character)end end function c.Enable(L,l,q)if q then L.parentUIFrame=q end L.externallyEnabled=l L:EnableButton(l)end function c.Create(l)if not l.parentUIFrame then return end if l.jumpButton then l.jumpButton:Destroy()l.jumpButton=nil end local e=math.min(l.parentUIFrame.AbsoluteSize.x,l.parentUIFrame.AbsoluteSize.y)local c=e<=500 local W=c and 70 or 120 l.jumpButton=Instance.new("\073\109\097\103\101\066\117\116\116\111\110")l.jumpButton.Name="\074\117\109\112\066\117\116\116\111\110"l.jumpButton.Visible=false l.jumpButton.BackgroundTransparency=1 l.jumpButton.Image=L l.jumpButton.ImageRectOffset=Vector2.new(1,146)l.jumpButton.ImageRectSize=Vector2.new(144,144)l.jumpButton.Size=UDim2.new(0,W,0,W)l.jumpButton.Position=c and UDim2.new(1,-(W*1.5-10),1,-W-20)or UDim2.new(1,-(W*1.5-10),1,-W*1.75)local o=nil l.jumpButton.InputBegan:connect(function(q)if o or q.UserInputType~=Enum.UserInputType.Touch or q.UserInputState~=Enum.UserInputState.Begin then return end o=q l.jumpButton.ImageRectOffset=Vector2.new(146,146)l.isJumping=true end)local y=function()o=nil l.isJumping=false l.jumpButton.ImageRectOffset=Vector2.new(1,146)end l.jumpButton.InputEnded:connect(function(l)if l==o then y()end end)q.MenuOpened:connect(function()if o then y()end end)if not l.characterAddedConn then l:SetupCharacterAddedFunction()end l.jumpButton.Parent=l.parentUIFrame end return c end function _ClickToMoveController()local l=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local q=game:GetService("\080\097\116\104\102\105\110\100\105\110\103\083\101\114\118\105\099\101")local L=game:GetService("\080\108\097\121\101\114\115")local e=game:GetService("\068\101\098\114\105\115")local c=game:GetService("\083\116\097\114\116\101\114\071\117\105")local W=game:GetService("\087\111\114\107\115\112\097\099\101")local o=game:GetService("\067\111\108\108\101\099\116\105\111\110\083\101\114\118\105\099\101")local y=game:GetService("\071\117\105\083\101\114\118\105\099\101")local K=true local R=true local E=false local D=true local m=1 local v=8 local X={[Enum.KeyCode.W]=true,[Enum.KeyCode.A]=true;[Enum.KeyCode.S]=true;[Enum.KeyCode.D]=true;[Enum.KeyCode.Up]=true,[Enum.KeyCode.Down]=true}local h,T=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\078\097\118\105\103\097\116\105\111\110\067\108\105\099\107\084\111\077\111\118\101\083\107\105\112\080\097\115\115\101\100\087\097\121\112\111\105\110\116\115")end)local i=h and T local r=L.LocalPlayer local U=_ClickToMoveDisplay()local w=Vector3.new(0,0,0)local G=1e-06 local I={}do local function l(q)if q then local L=q:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")if L then return q,L else return l(q.Parent)end end end I.FindCharacterAncestor=l local function q(L,e,c)c=c or{}local o,y,K,R=W:FindPartOnRayWithIgnoreList(L,c)if o then if e and o.CanCollide==false then local W,y=l(o)if y==nil then table.insert(c,o)return q(L,e,c)end end return o,y,K,R end return nil,nil end I.Raycast=q end local a={}local function H(l)local q=l and l.Character if q then local L=a[l]if L and L.Parent==q then return L else a[l]=nil local L=q:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")if L then a[l]=L end return L end end end local d local z=nil local j=nil local Q=nil local function P()return r and r.Character end local function n(l)if l==z then return end if j then j:Disconnect()j=nil end if Q then Q:Disconnect()Q=nil end z=l d={P()}if z~=nil then local l=o:GetTagged(z)for l,q in ipairs(l)do table.insert(d,q)end j=(o:GetInstanceAddedSignal(z)):Connect(function(l)table.insert(d,l)end)Q=(o:GetInstanceRemovedSignal(z)):Connect(function(l)for q=1,#d,1 do if d[q]==l then d[q]=d[#d]table.remove(d)break end end end)end end local function k()if d then return d end d={}table.insert(d,P())return d end local function N(l,L,e)local c={}local o local y if e~=nil then o=e y=e else o=E y=D end c.Cancelled=false c.Started=false c.Finished=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116")c.PathFailed=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116")c.PathComputing=false c.PathComputed=false c.OriginalTargetPoint=l c.TargetPoint=l c.TargetSurfaceNormal=L c.DiedConn=nil c.SeatedConn=nil c.BlockedConn=nil c.TeleportedConn=nil c.CurrentPoint=0 c.HumanoidOffsetFromPath=w c.CurrentWaypointPosition=nil c.CurrentWaypointPlaneNormal=w c.CurrentWaypointPlaneDistance=0 c.CurrentWaypointNeedsJump=false c.CurrentHumanoidPosition=w c.CurrentHumanoidVelocity=0 c.NextActionMoveDirection=w c.NextActionJump=false c.Timeout=0 c.Humanoid=H(r)c.OriginPoint=nil c.AgentCanFollowPath=false c.DirectPath=false c.DirectPathRiseFirst=false local R=c.Humanoid and c.Humanoid.RootPart if R then c.OriginPoint=R.CFrame.p local l=2 local L=5 local e=true local W=c.Humanoid.SeatPart if W and W:IsA("\086\101\104\105\099\108\101\083\101\097\116")then local q=W:FindFirstAncestorOfClass("\077\111\100\101\108")if q then local o=q.PrimaryPart q.PrimaryPart=W if y then local W=q:GetExtentsSize()l=(m*.5)*math.sqrt(W.X*W.X+W.Z*W.Z)L=m*W.Y e=false c.AgentCanFollowPath=true c.DirectPath=y end q.PrimaryPart=o end else local q=(P()):GetExtentsSize()l=(m*.5)*math.sqrt(q.X*q.X+q.Z*q.Z)L=m*q.Y e=c.Humanoid.JumpPower>0 c.AgentCanFollowPath=true c.DirectPath=o c.DirectPathRiseFirst=c.Humanoid.Sit end c.pathResult=q:CreatePath({AgentRadius=l,AgentHeight=L;AgentCanJump=e})end function c.Cleanup(l)if c.stopTraverseFunc then c.stopTraverseFunc()c.stopTraverseFunc=nil end if c.MoveToConn then c.MoveToConn:Disconnect()c.MoveToConn=nil end if c.BlockedConn then c.BlockedConn:Disconnect()c.BlockedConn=nil end if c.DiedConn then c.DiedConn:Disconnect()c.DiedConn=nil end if c.SeatedConn then c.SeatedConn:Disconnect()c.SeatedConn=nil end if c.TeleportedConn then c.TeleportedConn:Disconnect()c.TeleportedConn=nil end c.Started=false end function c.Cancel(l)c.Cancelled=true c:Cleanup()end function c.IsActive(l)return c.AgentCanFollowPath and(c.Started and not c.Cancelled)end function c.OnPathInterrupted(l)c.Cancelled=true c:OnPointReached(false)end function c.ComputePath(l)if c.OriginPoint then if c.PathComputed or c.PathComputing then return end c.PathComputing=true if c.AgentCanFollowPath then if c.DirectPath then c.pointList={PathWaypoint.new(c.OriginPoint,Enum.PathWaypointAction.Walk);PathWaypoint.new(c.TargetPoint,c.DirectPathRiseFirst and Enum.PathWaypointAction.Jump or Enum.PathWaypointAction.Walk)}c.PathComputed=true else c.pathResult:ComputeAsync(c.OriginPoint,c.TargetPoint)c.pointList=c.pathResult:GetWaypoints()c.BlockedConn=c.pathResult.Blocked:Connect(function(l)c:OnPathBlocked(l)end)c.PathComputed=c.pathResult.Status==Enum.PathStatus.Success end end c.PathComputing=false end end function c.IsValidPath(l)c:ComputePath()return c.PathComputed and c.AgentCanFollowPath end c.Recomputing=false function c.OnPathBlocked(q,l)local L=l>=c.CurrentPoint if not L or c.Recomputing then return end c.Recomputing=true if c.stopTraverseFunc then c.stopTraverseFunc()c.stopTraverseFunc=nil end c.OriginPoint=c.Humanoid.RootPart.CFrame.p c.pathResult:ComputeAsync(c.OriginPoint,c.TargetPoint)c.pointList=c.pathResult:GetWaypoints()if#c.pointList>0 then c.HumanoidOffsetFromPath=c.pointList[1].Position-c.OriginPoint end c.PathComputed=c.pathResult.Status==Enum.PathStatus.Success if K then c.stopTraverseFunc,c.setPointFunc=U.CreatePathDisplay(c.pointList)end if c.PathComputed then c.CurrentPoint=1 c:OnPointReached(true)else c.PathFailed:Fire()c:Cleanup()end c.Recomputing=false end function c.OnRenderStepped(q,l)if c.Started and not c.Cancelled then c.Timeout=c.Timeout+l if c.Timeout>v then c:OnPointReached(false)return end c.CurrentHumanoidPosition=c.Humanoid.RootPart.Position+c.HumanoidOffsetFromPath c.CurrentHumanoidVelocity=c.Humanoid.RootPart.Velocity while c.Started and c:IsCurrentWaypointReached()do c:OnPointReached(true)end if c.Started then c.NextActionMoveDirection=c.CurrentWaypointPosition-c.CurrentHumanoidPosition if c.NextActionMoveDirection.Magnitude>G then c.NextActionMoveDirection=c.NextActionMoveDirection.Unit else c.NextActionMoveDirection=w end if c.CurrentWaypointNeedsJump then c.NextActionJump=true c.CurrentWaypointNeedsJump=false else c.NextActionJump=false end end end end function c.IsCurrentWaypointReached(l)local q=false if c.CurrentWaypointPlaneNormal~=w then local l=c.CurrentWaypointPlaneNormal:Dot(c.CurrentHumanoidPosition)-c.CurrentWaypointPlaneDistance local L=-c.CurrentWaypointPlaneNormal:Dot(c.CurrentHumanoidVelocity)local e=math.max(1,.0625*L)q=l<e else q=true end if q then c.CurrentWaypointPosition=nil c.CurrentWaypointPlaneNormal=w c.CurrentWaypointPlaneDistance=0 end return q end function c.OnPointReached(q,l)if l and not c.Cancelled then if c.setPointFunc then c.setPointFunc(c.CurrentPoint)end local l=c.CurrentPoint+1 if l>#c.pointList then if c.stopTraverseFunc then c.stopTraverseFunc()end c.Finished:Fire()c:Cleanup()else local q=c.pointList[c.CurrentPoint]local L=c.pointList[l]local e=c.Humanoid:GetState()local W=e==Enum.HumanoidStateType.FallingDown or e==Enum.HumanoidStateType.Freefall or e==Enum.HumanoidStateType.Jumping if W then local l=L.Action==Enum.PathWaypointAction.Jump if not l and c.CurrentPoint>1 then local e=c.pointList[c.CurrentPoint-1]local W=q.Position-e.Position local o=L.Position-q.Position local y=(Vector2.new(W.x,W.z)).Unit local K=(Vector2.new(o.x,o.z)).Unit local R=.996 l=y:Dot(K)<R end if l then c.Humanoid.FreeFalling:Wait()wait(.1)end end if i then c:MoveToNextWayPoint(q,L,l)else if c.setPointFunc then c.setPointFunc(l)end if L.Action==Enum.PathWaypointAction.Jump then c.Humanoid.Jump=true end c.Humanoid:MoveTo(L.Position)c.CurrentPoint=l end end else c.PathFailed:Fire()c:Cleanup()end end function c.MoveToNextWayPoint(e,l,q,L)c.CurrentWaypointPlaneNormal=l.Position-q.Position c.CurrentWaypointPlaneNormal=Vector3.new(c.CurrentWaypointPlaneNormal.X,0,c.CurrentWaypointPlaneNormal.Z)if c.CurrentWaypointPlaneNormal.Magnitude>G then c.CurrentWaypointPlaneNormal=c.CurrentWaypointPlaneNormal.Unit c.CurrentWaypointPlaneDistance=c.CurrentWaypointPlaneNormal:Dot(q.Position)else c.CurrentWaypointPlaneNormal=w c.CurrentWaypointPlaneDistance=0 end c.CurrentWaypointNeedsJump=q.Action==Enum.PathWaypointAction.Jump c.CurrentWaypointPosition=q.Position c.CurrentPoint=L c.Timeout=0 end function c.Start(q,l)if not c.AgentCanFollowPath then c.PathFailed:Fire()return end if c.Started then return end c.Started=true U.CancelFailureAnimation()if K then if l==nil or l then c.stopTraverseFunc,c.setPointFunc=U.CreatePathDisplay(c.pointList,c.OriginalTargetPoint)end end if#c.pointList>0 then c.HumanoidOffsetFromPath=Vector3.new(0,c.pointList[1].Position.Y-c.OriginPoint.Y,0)c.CurrentHumanoidPosition=c.Humanoid.RootPart.Position+c.HumanoidOffsetFromPath c.CurrentHumanoidVelocity=c.Humanoid.RootPart.Velocity c.SeatedConn=c.Humanoid.Seated:Connect(function(l,q)c:OnPathInterrupted()end)c.DiedConn=c.Humanoid.Died:Connect(function()c:OnPathInterrupted()end)c.TeleportedConn=(c.Humanoid.RootPart:GetPropertyChangedSignal("\067\070\114\097\109\101")):Connect(function()c:OnPathInterrupted()end)c.CurrentPoint=1 c:OnPointReached(true)else c.PathFailed:Fire()if c.stopTraverseFunc then c.stopTraverseFunc()end end end local X=c.TargetPoint+c.TargetSurfaceNormal*1.5 local h=Ray.new(X,Vector3.new(0,-1,0)*50)local T,I=W:FindPartOnRayWithIgnoreList(h,k())if T then c.TargetPoint=I end c:ComputePath()return c end local function C()local l=H(r)return l~=nil and l.Health>0 end local function V(l)if l~=nil then for l,q in pairs(l:GetChildren())do if q:IsA("\084\111\111\108")then return q end end end end local g=nil local s=nil local Y=nil local M=nil local function O()if g then g:Cancel()g=nil end if Y then Y:Disconnect()Y=nil end if M then M:Disconnect()M=nil end if s then s:Destroy()end end local function x(l,q,L,e,c)if g then O()end g=l l:Start(c)Y=l.Finished.Event:Connect(function()O()if L then local l=V(e)if l then l:Activate()end end end)M=l.PathFailed.Event:Connect(function()O()if c==nil or c then local l=R and not(g and g:IsActive())if l then U.PlayFailureAnimation()end U.DisplayFailureWaypoint(q)end end)end local function J(l)if g and g:IsActive()then g:Cancel()end if R then U.PlayFailureAnimation()end U.DisplayFailureWaypoint(l)end function OnTap(l,q,e)local o=W.CurrentCamera local y=r.Character if not C()then return end if#l==1 or q then if o then local W=o:ScreenPointToRay(l[1].x,l[1].y)local K=Ray.new(W.Origin,W.Direction*1000)local R=H(r)local E,D,m=I.Raycast(K,true,k())local v,X=I.FindCharacterAncestor(E)if e and(X and c:GetCore("\065\118\097\116\097\114\067\111\110\116\101\120\116\077\101\110\117\069\110\097\098\108\101\100"))then local l=L:GetPlayerFromCharacter(X.Parent)if l then O()return end end if q then D=q v=nil end if D and y then O()local l=N(D,m)if l:IsValidPath()then x(l,D,v,y)else l:Cleanup()J(D)end end end elseif#l>=2 then if o then local l=V(y)if l then l:Activate()end end end end local function u(l)if l then l:Disconnect()end end local F=_Keyboard()local Z=setmetatable({},F)Z.__index=Z function Z.new(l)local q=setmetatable(F.new(l),Z)q.fingerTouches={}q.numUnsunkTouches=0 q.mouse1Down=tick()q.mouse1DownPos=Vector2.new()q.mouse2DownTime=tick()q.mouse2DownPos=Vector2.new()q.mouse2UpTime=tick()q.keyboardMoveVector=w q.tapConn=nil q.inputBeganConn=nil q.inputChangedConn=nil q.inputEndedConn=nil q.humanoidDiedConn=nil q.characterChildAddedConn=nil q.onCharacterAddedConn=nil q.characterChildRemovedConn=nil q.renderSteppedConn=nil q.menuOpenedConnection=nil q.running=false q.wasdEnabled=false return q end function Z.DisconnectEvents(l)u(l.tapConn)u(l.inputBeganConn)u(l.inputChangedConn)u(l.inputEndedConn)u(l.humanoidDiedConn)u(l.characterChildAddedConn)u(l.onCharacterAddedConn)u(l.renderSteppedConn)u(l.characterChildRemovedConn)u(l.menuOpenedConnection)end function Z.OnTouchBegan(L,l,q)if L.fingerTouches[l]==nil and not q then L.numUnsunkTouches=L.numUnsunkTouches+1 end L.fingerTouches[l]=q end function Z.OnTouchChanged(L,l,q)if L.fingerTouches[l]==nil then L.fingerTouches[l]=q if not q then L.numUnsunkTouches=L.numUnsunkTouches+1 end end end function Z.OnTouchEnded(L,l,q)if L.fingerTouches[l]~=nil and L.fingerTouches[l]==false then L.numUnsunkTouches=L.numUnsunkTouches-1 end L.fingerTouches[l]=nil end function Z.OnCharacterAdded(L,q)L:DisconnectEvents()L.inputBeganConn=l.InputBegan:Connect(function(l,q)if l.UserInputType==Enum.UserInputType.Touch then L:OnTouchBegan(l,q)end if L.wasdEnabled and(q==false and(l.UserInputType==Enum.UserInputType.Keyboard and X[l.KeyCode]))then O()U.CancelFailureAnimation()end if l.UserInputType==Enum.UserInputType.MouseButton1 then L.mouse1DownTime=tick()L.mouse1DownPos=l.Position end if l.UserInputType==Enum.UserInputType.MouseButton2 then L.mouse2DownTime=tick()L.mouse2DownPos=l.Position end end)L.inputChangedConn=l.InputChanged:Connect(function(l,q)if l.UserInputType==Enum.UserInputType.Touch then L:OnTouchChanged(l,q)end end)L.inputEndedConn=l.InputEnded:Connect(function(l,q)if l.UserInputType==Enum.UserInputType.Touch then L:OnTouchEnded(l,q)end if l.UserInputType==Enum.UserInputType.MouseButton2 then L.mouse2UpTime=tick()local q=l.Position local e=g or L.keyboardMoveVector.Magnitude<=0 if L.mouse2UpTime-L.mouse2DownTime<.25 and((q-L.mouse2DownPos).magnitude<5 and e)then local l={q}OnTap(l)end end end)L.tapConn=l.TouchTap:Connect(function(l,q)if not q then OnTap(l,nil,true)end end)L.menuOpenedConnection=y.MenuOpened:Connect(function()O()end)local function c(q)if l.TouchEnabled then if q:IsA("\084\111\111\108")then q.ManualActivationOnly=true end end if q:IsA("\072\117\109\097\110\111\105\100")then u(L.humanoidDiedConn)L.humanoidDiedConn=q.Died:Connect(function()if s then e:AddItem(s.Model,1)end end)end end L.characterChildAddedConn=q.ChildAdded:Connect(function(l)c(l)end)L.characterChildRemovedConn=q.ChildRemoved:Connect(function(q)if l.TouchEnabled then if q:IsA("\084\111\111\108")then q.ManualActivationOnly=false end end end)for l,q in pairs(q:GetChildren())do c(q)end end function Z.Start(l)l:Enable(true)end function Z.Stop(l)l:Enable(false)end function Z.CleanupPath(l)O()end function Z.Enable(c,q,L,e)if q then if not c.running then if r.Character then c:OnCharacterAdded(r.Character)end c.onCharacterAddedConn=r.CharacterAdded:Connect(function(l)c:OnCharacterAdded(l)end)c.running=true end c.touchJumpController=e if c.touchJumpController then c.touchJumpController:Enable(c.jumpEnabled)end else if c.running then c:DisconnectEvents()O()if l.TouchEnabled then local l=r.Character if l then for l,q in pairs(l:GetChildren())do if q:IsA("\084\111\111\108")then q.ManualActivationOnly=false end end end end c.running=false end if c.touchJumpController and not c.jumpEnabled then c.touchJumpController:Enable(true)end c.touchJumpController=nil end if l.KeyboardEnabled and q~=c.enabled then c.forwardValue=0 c.backwardValue=0 c.leftValue=0 c.rightValue=0 c.moveVector=w if q then c:BindContextActions()c:ConnectFocusEventListeners()else c:UnbindContextActions()c:DisconnectFocusEventListeners()end end c.wasdEnabled=q and L or false c.enabled=q end function Z.OnRenderStepped(q,l)q.isJumping=false if g then g:OnRenderStepped(l)if g then q.moveVector=g.NextActionMoveDirection q.moveVectorIsCameraRelative=false if g.NextActionJump then q.isJumping=true end else q.moveVector=q.keyboardMoveVector q.moveVectorIsCameraRelative=true end else q.moveVector=q.keyboardMoveVector q.moveVectorIsCameraRelative=true end if q.jumpRequested then q.isJumping=true end end function Z.UpdateMovement(q,l)if l==Enum.UserInputState.Cancel then q.keyboardMoveVector=w elseif q.wasdEnabled then q.keyboardMoveVector=Vector3.new(q.leftValue+q.rightValue,0,q.forwardValue+q.backwardValue)end end function Z.UpdateJump(l) end function Z.SetShowPath(q,l)K=l end function Z.GetShowPath(l)return K end function Z.SetWaypointTexture(q,l)U.SetWaypointTexture(l)end function Z.GetWaypointTexture(l)return U.GetWaypointTexture()end function Z.SetWaypointRadius(q,l)U.SetWaypointRadius(l)end function Z.GetWaypointRadius(l)return U.GetWaypointRadius()end function Z.SetEndWaypointTexture(q,l)U.SetEndWaypointTexture(l)end function Z.GetEndWaypointTexture(l)return U.GetEndWaypointTexture()end function Z.SetWaypointsAlwaysOnTop(q,l)U.SetWaypointsAlwaysOnTop(l)end function Z.GetWaypointsAlwaysOnTop(l)return U.GetWaypointsAlwaysOnTop()end function Z.SetFailureAnimationEnabled(q,l)R=l end function Z.GetFailureAnimationEnabled(l)return R end function Z.SetIgnoredPartsTag(q,l)n(l)end function Z.GetIgnoredPartsTag(l)return z end function Z.SetUseDirectPath(q,l)E=l end function Z.GetUseDirectPath(l)return E end function Z.SetAgentSizeIncreaseFactor(q,l)m=1+l/100 end function Z.GetAgentSizeIncreaseFactor(l)return(m-1)*100 end function Z.SetUnreachableWaypointTimeout(q,l)v=l end function Z.GetUnreachableWaypointTimeout(l)return v end function Z.SetUserJumpEnabled(q,l)q.jumpEnabled=l if q.touchJumpController then q.touchJumpController:Enable(l)end end function Z.GetUserJumpEnabled(l)return l.jumpEnabled end function Z.MoveTo(e,l,q,L)local c=r.Character if c==nil then return false end local W=N(l,Vector3.new(0,1,0),L)if W and W:IsValidPath()then x(W,l,nil,c,q)return true end return false end return Z end function _TouchThumbstick()local l=game:GetService("\080\108\097\121\101\114\115")local q=game:GetService("\071\117\105\083\101\114\118\105\099\101")local L=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local e=Vector3.new(0,0,0)local c="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\117\105\047\084\111\117\099\104\067\111\110\116\114\111\108\115\083\104\101\101\116\046\112\110\103"local W=_BaseCharacterController()local o=setmetatable({},W)o.__index=o function o.new()local l=setmetatable(W.new(),o)l.isFollowStick=false l.thumbstickFrame=nil l.moveTouchObject=nil l.onTouchMovedConn=nil l.onTouchEndedConn=nil l.screenPos=nil l.stickImage=nil l.thumbstickSize=nil return l end function o.Enable(L,l,q)if l==nil then return false end l=l and true or false if L.enabled==l then return true end L.moveVector=e L.isJumping=false if l then if not L.thumbstickFrame then L:Create(q)end L.thumbstickFrame.Visible=true else L.thumbstickFrame.Visible=false L:OnInputEnded()end L.enabled=l end function o.OnInputEnded(l)l.thumbstickFrame.Position=l.screenPos l.stickImage.Position=UDim2.new(0,l.thumbstickFrame.Size.X.Offset/2-l.thumbstickSize/4,0,l.thumbstickFrame.Size.Y.Offset/2-l.thumbstickSize/4)l.moveVector=e l.isJumping=false l.thumbstickFrame.Position=l.screenPos l.moveTouchObject=nil end function o.Create(e,l)if e.thumbstickFrame then e.thumbstickFrame:Destroy()e.thumbstickFrame=nil if e.onTouchMovedConn then e.onTouchMovedConn:Disconnect()e.onTouchMovedConn=nil end if e.onTouchEndedConn then e.onTouchEndedConn:Disconnect()e.onTouchEndedConn=nil end end local W=math.min(l.AbsoluteSize.x,l.AbsoluteSize.y)local o=W<=500 e.thumbstickSize=o and 70 or 120 e.screenPos=o and UDim2.new(0,e.thumbstickSize/2-10,1,-e.thumbstickSize-20)or UDim2.new(0,e.thumbstickSize/2,1,-e.thumbstickSize*1.75)e.thumbstickFrame=Instance.new("\070\114\097\109\101")e.thumbstickFrame.Name="\084\104\117\109\098\115\116\105\099\107\070\114\097\109\101"e.thumbstickFrame.Active=true e.thumbstickFrame.Visible=false e.thumbstickFrame.Size=UDim2.new(0,e.thumbstickSize,0,e.thumbstickSize)e.thumbstickFrame.Position=e.screenPos e.thumbstickFrame.BackgroundTransparency=1 local y=Instance.new("\073\109\097\103\101\076\097\098\101\108")y.Name="\079\117\116\101\114\073\109\097\103\101"y.Image=c y.ImageRectOffset=Vector2.new()y.ImageRectSize=Vector2.new(220,220)y.BackgroundTransparency=1 y.Size=UDim2.new(0,e.thumbstickSize,0,e.thumbstickSize)y.Position=UDim2.new(0,0,0,0)y.Parent=e.thumbstickFrame e.stickImage=Instance.new("\073\109\097\103\101\076\097\098\101\108")e.stickImage.Name="\083\116\105\099\107\073\109\097\103\101"e.stickImage.Image=c e.stickImage.ImageRectOffset=Vector2.new(220,0)e.stickImage.ImageRectSize=Vector2.new(111,111)e.stickImage.BackgroundTransparency=1 e.stickImage.Size=UDim2.new(0,e.thumbstickSize/2,0,e.thumbstickSize/2)e.stickImage.Position=UDim2.new(0,e.thumbstickSize/2-e.thumbstickSize/4,0,e.thumbstickSize/2-e.thumbstickSize/4)e.stickImage.ZIndex=2 e.stickImage.Parent=e.thumbstickFrame local K=nil local R=.05 local function E(l)local q=l/(e.thumbstickSize/2)local L=q.magnitude if L<R then q=Vector3.new()else q=q.unit*((L-R)/(1-R))q=Vector3.new(q.x,0,q.y)end e.moveVector=q end local function D(l)local q=Vector2.new(l.x-K.x,l.y-K.y)local L=q.magnitude local c=e.thumbstickFrame.AbsoluteSize.x/2 if e.isFollowStick and L>c then local L=q.unit*c e.thumbstickFrame.Position=UDim2.new(0,(l.x-e.thumbstickFrame.AbsoluteSize.x/2)-L.x,0,(l.y-e.thumbstickFrame.AbsoluteSize.y/2)-L.y)else L=math.min(L,c)q=q.unit*L end e.stickImage.Position=UDim2.new(0,q.x+e.stickImage.AbsoluteSize.x/2,0,q.y+e.stickImage.AbsoluteSize.y/2)end e.thumbstickFrame.InputBegan:Connect(function(l)if e.moveTouchObject or l.UserInputType~=Enum.UserInputType.Touch or l.UserInputState~=Enum.UserInputState.Begin then return end e.moveTouchObject=l e.thumbstickFrame.Position=UDim2.new(0,l.Position.x-e.thumbstickFrame.Size.X.Offset/2,0,l.Position.y-e.thumbstickFrame.Size.Y.Offset/2)K=Vector2.new(e.thumbstickFrame.AbsolutePosition.x+e.thumbstickFrame.AbsoluteSize.x/2,e.thumbstickFrame.AbsolutePosition.y+e.thumbstickFrame.AbsoluteSize.y/2)local q=Vector2.new(l.Position.x-K.x,l.Position.y-K.y)end)e.onTouchMovedConn=L.TouchMoved:Connect(function(l,q)if l==e.moveTouchObject then K=Vector2.new(e.thumbstickFrame.AbsolutePosition.x+e.thumbstickFrame.AbsoluteSize.x/2,e.thumbstickFrame.AbsolutePosition.y+e.thumbstickFrame.AbsoluteSize.y/2)local q=Vector2.new(l.Position.x-K.x,l.Position.y-K.y)E(q)D(l.Position)end end)e.onTouchEndedConn=L.TouchEnded:Connect(function(l,q)if l==e.moveTouchObject then e:OnInputEnded()end end)q.MenuOpened:Connect(function()if e.moveTouchObject then e:OnInputEnded()end end)e.thumbstickFrame.Parent=l end return o end function _DynamicThumbstick()local l=Vector3.new(0,0,0)local q="\114\098\120\097\115\115\101\116\058\047\047\116\101\120\116\117\114\101\115\047\117\105\047\073\110\112\117\116\047\084\111\117\099\104\067\111\110\116\114\111\108\115\083\104\101\101\116\086\050\046\112\110\103"local L="\068\121\110\097\109\105\099\084\104\117\109\098\115\116\105\099\107\065\099\116\105\111\110"local e=Enum.ContextActionPriority.High.Value local c={.11;.3,.4;.5;.6;.7;.75}local W=#c local o=true local y=.35 local K=.3 local R=.5 local E=TweenInfo.new(.15,Enum.EasingStyle.Quad,Enum.EasingDirection.InOut)local D=game:GetService("\080\108\097\121\101\114\115")local m=game:GetService("\071\117\105\083\101\114\118\105\099\101")local v=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local X=game:GetService("\067\111\110\116\101\120\116\065\099\116\105\111\110\083\101\114\118\105\099\101")local h=game:GetService("\082\117\110\083\101\114\118\105\099\101")local T=game:GetService("\084\119\101\101\110\083\101\114\118\105\099\101")local i=D.LocalPlayer if not i then(D:GetPropertyChangedSignal("\076\111\099\097\108\080\108\097\121\101\114")):Wait()i=D.LocalPlayer end local r=_BaseCharacterController()local U=setmetatable({},r)U.__index=U function U.new()local l=setmetatable(r.new(),U)l.moveTouchObject=nil l.moveTouchLockedIn=false l.moveTouchFirstChanged=false l.moveTouchStartPosition=nil l.startImage=nil l.endImage=nil l.middleImages={}l.startImageFadeTween=nil l.endImageFadeTween=nil l.middleImageFadeTweens={}l.isFirstTouch=true l.thumbstickFrame=nil l.onRenderSteppedConn=nil l.fadeInAndOutBalance=R l.fadeInAndOutHalfDuration=K l.hasFadedBackgroundInPortrait=false l.hasFadedBackgroundInLandscape=false l.tweenInAlphaStart=nil l.tweenOutAlphaStart=nil return l end function U.GetIsJumping(l)local q=l.isJumping l.isJumping=false return q end function U.Enable(e,l,q)if l==nil then return false end l=l and true or false if e.enabled==l then return true end if l then if not e.thumbstickFrame then e:Create(q)end e:BindContextActions()else X:UnbindAction(L)e:OnInputEnded()end e.enabled=l e.thumbstickFrame.Visible=l end function U.OnInputEnded(q)q.moveTouchObject=nil q.moveVector=l q:FadeThumbstick(false)end function U.FadeThumbstick(q,l)if not l and q.moveTouchObject then return end if q.isFirstTouch then return end if q.startImageFadeTween then q.startImageFadeTween:Cancel()end if q.endImageFadeTween then q.endImageFadeTween:Cancel()end for l=1,#q.middleImages,1 do if q.middleImageFadeTweens[l]then q.middleImageFadeTweens[l]:Cancel()end end if l then q.startImageFadeTween=T:Create(q.startImage,E,{ImageTransparency=0})q.startImageFadeTween:Play()q.endImageFadeTween=T:Create(q.endImage,E,{ImageTransparency=.2})q.endImageFadeTween:Play()for l=1,#q.middleImages,1 do q.middleImageFadeTweens[l]=T:Create(q.middleImages[l],E,{ImageTransparency=c[l]})q.middleImageFadeTweens[l]:Play()end else q.startImageFadeTween=T:Create(q.startImage,E,{ImageTransparency=1})q.startImageFadeTween:Play()q.endImageFadeTween=T:Create(q.endImage,E,{ImageTransparency=1})q.endImageFadeTween:Play()for l=1,#q.middleImages,1 do q.middleImageFadeTweens[l]=T:Create(q.middleImages[l],E,{ImageTransparency=1})q.middleImageFadeTweens[l]:Play()end end end function U.FadeThumbstickFrame(L,l,q)L.fadeInAndOutHalfDuration=l*.5 L.fadeInAndOutBalance=q L.tweenInAlphaStart=tick()end function U.InputInFrame(q,l)local L=q.thumbstickFrame.AbsolutePosition local e=L+q.thumbstickFrame.AbsoluteSize local c=l.Position if c.X>=L.X and c.Y>=L.Y then if c.X<=e.X and c.Y<=e.Y then return true end end return false end function U.DoFadeInBackground(l)local q=i:FindFirstChildOfClass("\080\108\097\121\101\114\071\117\105")local L=false if q then if q.CurrentScreenOrientation==Enum.ScreenOrientation.LandscapeLeft or q.CurrentScreenOrientation==Enum.ScreenOrientation.LandscapeRight then L=l.hasFadedBackgroundInLandscape l.hasFadedBackgroundInLandscape=true elseif q.CurrentScreenOrientation==Enum.ScreenOrientation.Portrait then L=l.hasFadedBackgroundInPortrait l.hasFadedBackgroundInPortrait=true end end if not L then l.fadeInAndOutHalfDuration=K l.fadeInAndOutBalance=R l.tweenInAlphaStart=tick()end end function U.DoMove(L,q)local e=q local c=e.magnitude if c<L.radiusOfDeadZone then e=l else e=e.unit*(1-math.max(0,(L.radiusOfMaxSpeed-e.magnitude)/L.radiusOfMaxSpeed))e=Vector3.new(e.x,0,e.y)end L.moveVector=e end function U.LayoutMiddleImages(L,l,q)local e=L.thumbstickSize/2+L.middleSize local c=q-l local o=(c.magnitude-L.thumbstickRingSize/2)-L.middleSize local y=c.unit local K=L.middleSpacing*W local R=L.middleSpacing if K<o then R=o/W end for l=1,W,1 do local c=L.middleImages[l]local W=e+R*(l-2)local K=e+R*(l-1)if W<o then local l=q-y*K local e=math.clamp(1-(K-o)/R,0,1)c.Visible=true c.Position=UDim2.new(0,l.X,0,l.Y)c.Size=UDim2.new(0,L.middleSize*e,0,L.middleSize*e)else c.Visible=false end end end function U.MoveStick(q,l)local L=Vector2.new(q.moveTouchStartPosition.X,q.moveTouchStartPosition.Y)local e=L-q.thumbstickFrame.AbsolutePosition local c=Vector2.new(l.X,l.Y)-q.thumbstickFrame.AbsolutePosition q.endImage.Position=UDim2.new(0,c.X,0,c.Y)q:LayoutMiddleImages(e,c)end function U.BindContextActions(l)local function q(q)if l.moveTouchObject then return Enum.ContextActionResult.Pass end if not l:InputInFrame(q)then return Enum.ContextActionResult.Pass end if l.isFirstTouch then l.isFirstTouch=false local q=TweenInfo.new(.5,Enum.EasingStyle.Quad,Enum.EasingDirection.Out,0,false,0);(T:Create(l.startImage,q,{Size=UDim2.new(0,0,0,0)})):Play();(T:Create(l.endImage,q,{Size=UDim2.new(0,l.thumbstickSize,0,l.thumbstickSize),ImageColor3=Color3.new(0,0,0)})):Play()end l.moveTouchLockedIn=false l.moveTouchObject=q l.moveTouchStartPosition=q.Position l.moveTouchFirstChanged=true if o then l:DoFadeInBackground()end return Enum.ContextActionResult.Pass end local function c(q)if q==l.moveTouchObject then if l.moveTouchFirstChanged then l.moveTouchFirstChanged=false local L=Vector2.new(q.Position.X-l.thumbstickFrame.AbsolutePosition.X,q.Position.Y-l.thumbstickFrame.AbsolutePosition.Y)l.startImage.Visible=true l.startImage.Position=UDim2.new(0,L.X,0,L.Y)l.endImage.Visible=true l.endImage.Position=l.startImage.Position l:FadeThumbstick(true)l:MoveStick(q.Position)end l.moveTouchLockedIn=true local L=Vector2.new(q.Position.x-l.moveTouchStartPosition.x,q.Position.y-l.moveTouchStartPosition.y)if math.abs(L.x)>0 or math.abs(L.y)>0 then l:DoMove(L)l:MoveStick(q.Position)end return Enum.ContextActionResult.Sink end return Enum.ContextActionResult.Pass end local function W(q)if q==l.moveTouchObject then l:OnInputEnded()if l.moveTouchLockedIn then return Enum.ContextActionResult.Sink end end return Enum.ContextActionResult.Pass end local function y(L,e,o)if e==Enum.UserInputState.Begin then return q(o)elseif e==Enum.UserInputState.Change then return c(o)elseif e==Enum.UserInputState.End then return W(o)elseif e==Enum.UserInputState.Cancel then l:OnInputEnded()end end X:BindActionAtPriority(L,y,false,e,Enum.UserInputType.Touch)end function U.Create(L,l)if L.thumbstickFrame then L.thumbstickFrame:Destroy()L.thumbstickFrame=nil if L.onRenderSteppedConn then L.onRenderSteppedConn:Disconnect()L.onRenderSteppedConn=nil end end L.thumbstickSize=45 L.thumbstickRingSize=20 L.middleSize=10 L.middleSpacing=L.middleSize+4 L.radiusOfDeadZone=2 L.radiusOfMaxSpeed=20 local e=l.AbsoluteSize local o=math.min(e.x,e.y)>500 if o then L.thumbstickSize=L.thumbstickSize*2 L.thumbstickRingSize=L.thumbstickRingSize*2 L.middleSize=L.middleSize*2 L.middleSpacing=L.middleSpacing*2 L.radiusOfDeadZone=L.radiusOfDeadZone*2 L.radiusOfMaxSpeed=L.radiusOfMaxSpeed*2 end local function K(l)if l then L.thumbstickFrame.Size=UDim2.new(1,0,.4,0)L.thumbstickFrame.Position=UDim2.new(0,0,.6,0)else L.thumbstickFrame.Size=UDim2.new(.4,0,.66666666666667,0)L.thumbstickFrame.Position=UDim2.new(0,0,.33333333333333,0)end end L.thumbstickFrame=Instance.new("\070\114\097\109\101")L.thumbstickFrame.BorderSizePixel=0 L.thumbstickFrame.Name="\068\121\110\097\109\105\099\084\104\117\109\098\115\116\105\099\107\070\114\097\109\101"L.thumbstickFrame.Visible=false L.thumbstickFrame.BackgroundTransparency=1 L.thumbstickFrame.BackgroundColor3=Color3.fromRGB(0,0,0)L.thumbstickFrame.Active=false K(false)L.startImage=Instance.new("\073\109\097\103\101\076\097\098\101\108")L.startImage.Name="\084\104\117\109\098\115\116\105\099\107\083\116\097\114\116"L.startImage.Visible=true L.startImage.BackgroundTransparency=1 L.startImage.Image=q L.startImage.ImageRectOffset=Vector2.new(1,1)L.startImage.ImageRectSize=Vector2.new(144,144)L.startImage.ImageColor3=Color3.new(0,0,0)L.startImage.AnchorPoint=Vector2.new(.5,.5)L.startImage.Position=UDim2.new(0,L.thumbstickRingSize*3.3,1,-L.thumbstickRingSize*2.8)L.startImage.Size=UDim2.new(0,L.thumbstickRingSize*3.7,0,L.thumbstickRingSize*3.7)L.startImage.ZIndex=10 L.startImage.Parent=L.thumbstickFrame L.endImage=Instance.new("\073\109\097\103\101\076\097\098\101\108")L.endImage.Name="\084\104\117\109\098\115\116\105\099\107\069\110\100"L.endImage.Visible=true L.endImage.BackgroundTransparency=1 L.endImage.Image=q L.endImage.ImageRectOffset=Vector2.new(1,1)L.endImage.ImageRectSize=Vector2.new(144,144)L.endImage.AnchorPoint=Vector2.new(.5,.5)L.endImage.Position=L.startImage.Position L.endImage.Size=UDim2.new(0,L.thumbstickSize*.8,0,L.thumbstickSize*.8)L.endImage.ZIndex=10 L.endImage.Parent=L.thumbstickFrame for l=1,W,1 do L.middleImages[l]=Instance.new("\073\109\097\103\101\076\097\098\101\108")L.middleImages[l].Name="\084\104\117\109\098\115\116\105\099\107\077\105\100\100\108\101"L.middleImages[l].Visible=false L.middleImages[l].BackgroundTransparency=1 L.middleImages[l].Image=q L.middleImages[l].ImageRectOffset=Vector2.new(1,1)L.middleImages[l].ImageRectSize=Vector2.new(144,144)L.middleImages[l].ImageTransparency=c[l]L.middleImages[l].AnchorPoint=Vector2.new(.5,.5)L.middleImages[l].ZIndex=9 L.middleImages[l].Parent=L.thumbstickFrame end local R=nil local function E()if R then R:Disconnect()R=nil end local l=workspace.CurrentCamera if l then local function q()local q=l.ViewportSize local L=q.X<q.Y K(L)end R=(l:GetPropertyChangedSignal("\086\105\101\119\112\111\114\116\083\105\122\101")):Connect(q)q()end end;(workspace:GetPropertyChangedSignal("\067\117\114\114\101\110\116\067\097\109\101\114\097")):Connect(E)if workspace.CurrentCamera then E()end L.moveTouchStartPosition=nil L.startImageFadeTween=nil L.endImageFadeTween=nil L.middleImageFadeTweens={}L.onRenderSteppedConn=h.RenderStepped:Connect(function()if L.tweenInAlphaStart~=nil then local l=tick()-L.tweenInAlphaStart local q=(L.fadeInAndOutHalfDuration*2)*L.fadeInAndOutBalance L.thumbstickFrame.BackgroundTransparency=1-y*math.min(l/q,1)if l>q then L.tweenOutAlphaStart=tick()L.tweenInAlphaStart=nil end elseif L.tweenOutAlphaStart~=nil then local l=tick()-L.tweenOutAlphaStart local q=L.fadeInAndOutHalfDuration*2-(L.fadeInAndOutHalfDuration*2)*L.fadeInAndOutBalance L.thumbstickFrame.BackgroundTransparency=(1-y)+y*math.min(l/q,1)if l>q then L.tweenOutAlphaStart=nil end end end)L.onTouchEndedConn=v.TouchEnded:connect(function(l)if l==L.moveTouchObject then L:OnInputEnded()end end)m.MenuOpened:connect(function()if L.moveTouchObject then L:OnInputEnded()end end)local D=i:FindFirstChildOfClass("\080\108\097\121\101\114\071\117\105")while not D do i.ChildAdded:wait()D=i:FindFirstChildOfClass("\080\108\097\121\101\114\071\117\105")end local X=nil local T=D.CurrentScreenOrientation==Enum.ScreenOrientation.LandscapeLeft or D.CurrentScreenOrientation==Enum.ScreenOrientation.LandscapeRight local function r()L.fadeInAndOutHalfDuration=2.5 L.fadeInAndOutBalance=.05 L.tweenInAlphaStart=tick()end X=(D:GetPropertyChangedSignal("\067\117\114\114\101\110\116\083\099\114\101\101\110\079\114\105\101\110\116\097\116\105\111\110")):Connect(function()if T and D.CurrentScreenOrientation==Enum.ScreenOrientation.Portrait or not T and D.CurrentScreenOrientation~=Enum.ScreenOrientation.Portrait then X:disconnect()r()if T then L.hasFadedBackgroundInPortrait=true else L.hasFadedBackgroundInLandscape=true end end end)L.thumbstickFrame.Parent=l if game:IsLoaded()then r()else(coroutine.wrap(function()game.Loaded:Wait()r()end))()end end return U end function _Gamepad()local l=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local q=game:GetService("\067\111\110\116\101\120\116\065\099\116\105\111\110\083\101\114\118\105\099\101")local L=Vector3.new(0,0,0)local e=Enum.UserInputType.None local c=.2 local W=_BaseCharacterController()local o=setmetatable({},W)o.__index=o function o.new(l)local q=setmetatable(W.new(),o)q.CONTROL_ACTION_PRIORITY=l q.forwardValue=0 q.backwardValue=0 q.leftValue=0 q.rightValue=0 q.activeGamepad=e q.gamepadConnectedConn=nil q.gamepadDisconnectedConn=nil return q end function o.Enable(c,q)if not l.GamepadEnabled then return false end if q==c.enabled then return true end c.forwardValue=0 c.backwardValue=0 c.leftValue=0 c.rightValue=0 c.moveVector=L c.isJumping=false if q then c.activeGamepad=c:GetHighestPriorityGamepad()if c.activeGamepad~=e then c:BindContextActions()c:ConnectGamepadConnectionListeners()else return false end else c:UnbindContextActions()c:DisconnectGamepadConnectionListeners()c.activeGamepad=e end c.enabled=q return true end function o.GetHighestPriorityGamepad(q)local L=l:GetConnectedGamepads()local c=e for l,q in pairs(L)do if q.Value<c.Value then c=q end end return c end function o.BindContextActions(l)if l.activeGamepad==e then return false end local W=function(q,L,e)l.isJumping=L==Enum.UserInputState.Begin return Enum.ContextActionResult.Sink end local o=function(q,e,W)if e==Enum.UserInputState.Cancel then l.moveVector=L return Enum.ContextActionResult.Sink end if l.activeGamepad~=W.UserInputType then return Enum.ContextActionResult.Pass end if W.KeyCode~=Enum.KeyCode.Thumbstick1 then return end if W.Position.magnitude>c then l.moveVector=Vector3.new(W.Position.X,0,-W.Position.Y)else l.moveVector=L end return Enum.ContextActionResult.Sink end q:BindActivate(l.activeGamepad,Enum.KeyCode.ButtonR2)q:BindActionAtPriority("\106\117\109\112\065\099\116\105\111\110",W,false,l.CONTROL_ACTION_PRIORITY,Enum.KeyCode.ButtonA)q:BindActionAtPriority("\109\111\118\101\084\104\117\109\098\115\116\105\099\107",o,false,l.CONTROL_ACTION_PRIORITY,Enum.KeyCode.Thumbstick1)return true end function o.UnbindContextActions(l)if l.activeGamepad~=e then q:UnbindActivate(l.activeGamepad,Enum.KeyCode.ButtonR2)end q:UnbindAction("\109\111\118\101\084\104\117\109\098\115\116\105\099\107")q:UnbindAction("\106\117\109\112\065\099\116\105\111\110")end function o.OnNewGamepadConnected(l)local q=l:GetHighestPriorityGamepad()if q==l.activeGamepad then return end if q==e then warn("\071\097\109\101\112\097\100\058\079\110\078\101\119\071\097\109\101\112\097\100\067\111\110\110\101\099\116\101\100 \102\111\117\110\100 \110\111 \099\111\110\110\101\099\116\101\100 \103\097\109\101\112\097\100\115")l:UnbindContextActions()return end if l.activeGamepad~=e then l:UnbindContextActions()end l.activeGamepad=q l:BindContextActions()end function o.OnCurrentGamepadDisconnected(l)if l.activeGamepad~=e then q:UnbindActivate(l.activeGamepad,Enum.KeyCode.ButtonR2)end local L=l:GetHighestPriorityGamepad()if l.activeGamepad~=e and L==l.activeGamepad then warn("\071\097\109\101\112\097\100\058\079\110\067\117\114\114\101\110\116\071\097\109\101\112\097\100\068\105\115\099\111\110\110\101\099\116\101\100 \102\111\117\110\100 \116\104\101 \115\117\112\112\111\115\101\100\108\121 \100\105\115\099\111\110\110\101\099\116\101\100 \103\097\109\101\112\097\100 \105\110 \099\111\110\110\101\099\116\101\100\071\097\109\101\112\097\100\115\046")l:UnbindContextActions()l.activeGamepad=e return end if L==e then l:UnbindContextActions()l.activeGamepad=e else l.activeGamepad=L q:BindActivate(l.activeGamepad,Enum.KeyCode.ButtonR2)end end function o.ConnectGamepadConnectionListeners(q)q.gamepadConnectedConn=l.GamepadConnected:Connect(function(l)q:OnNewGamepadConnected()end)q.gamepadDisconnectedConn=l.GamepadDisconnected:Connect(function(l)if q.activeGamepad==l then q:OnCurrentGamepadDisconnected()end end)end function o.DisconnectGamepadConnectionListeners(l)if l.gamepadConnectedConn then l.gamepadConnectedConn:Disconnect()l.gamepadConnectedConn=nil end if l.gamepadDisconnectedConn then l.gamepadDisconnectedConn:Disconnect()l.gamepadDisconnectedConn=nil end end return o end function _Keyboard()local l=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local q=game:GetService("\067\111\110\116\101\120\116\065\099\116\105\111\110\083\101\114\118\105\099\101")local L=Vector3.new(0,0,0)local e=_BaseCharacterController()local c=setmetatable({},e)c.__index=c function c.new(l)local q=setmetatable(e.new(),c)q.CONTROL_ACTION_PRIORITY=l q.textFocusReleasedConn=nil q.textFocusGainedConn=nil q.windowFocusReleasedConn=nil q.forwardValue=0 q.backwardValue=0 q.leftValue=0 q.rightValue=0 q.jumpEnabled=true return q end function c.Enable(e,q)if not l.KeyboardEnabled then return false end if q==e.enabled then return true end e.forwardValue=0 e.backwardValue=0 e.leftValue=0 e.rightValue=0 e.moveVector=L e.jumpRequested=false e:UpdateJump()if q then e:BindContextActions()e:ConnectFocusEventListeners()else e:UnbindContextActions()e:DisconnectFocusEventListeners()end e.enabled=q return true end function c.UpdateMovement(q,l)if l==Enum.UserInputState.Cancel then q.moveVector=L else q.moveVector=Vector3.new(q.leftValue+q.rightValue,0,q.forwardValue+q.backwardValue)end end function c.UpdateJump(l)l.isJumping=l.jumpRequested end function c.BindContextActions(l)local L=function(q,L,e)l.forwardValue=L==Enum.UserInputState.Begin and-1 or 0 l:UpdateMovement(L)return Enum.ContextActionResult.Pass end local e=function(q,L,e)l.backwardValue=L==Enum.UserInputState.Begin and 1 or 0 l:UpdateMovement(L)return Enum.ContextActionResult.Pass end local c=function(q,L,e)l.leftValue=L==Enum.UserInputState.Begin and-1 or 0 l:UpdateMovement(L)return Enum.ContextActionResult.Pass end local W=function(q,L,e)l.rightValue=L==Enum.UserInputState.Begin and 1 or 0 l:UpdateMovement(L)return Enum.ContextActionResult.Pass end local o=function(q,L,e)l.jumpRequested=l.jumpEnabled and L==Enum.UserInputState.Begin l:UpdateJump()return Enum.ContextActionResult.Pass end q:BindActionAtPriority("\109\111\118\101\070\111\114\119\097\114\100\065\099\116\105\111\110",L,false,l.CONTROL_ACTION_PRIORITY,Enum.PlayerActions.CharacterForward)q:BindActionAtPriority("\109\111\118\101\066\097\099\107\119\097\114\100\065\099\116\105\111\110",e,false,l.CONTROL_ACTION_PRIORITY,Enum.PlayerActions.CharacterBackward)q:BindActionAtPriority("\109\111\118\101\076\101\102\116\065\099\116\105\111\110",c,false,l.CONTROL_ACTION_PRIORITY,Enum.PlayerActions.CharacterLeft)q:BindActionAtPriority("\109\111\118\101\082\105\103\104\116\065\099\116\105\111\110",W,false,l.CONTROL_ACTION_PRIORITY,Enum.PlayerActions.CharacterRight)q:BindActionAtPriority("\106\117\109\112\065\099\116\105\111\110",o,false,l.CONTROL_ACTION_PRIORITY,Enum.PlayerActions.CharacterJump)end function c.UnbindContextActions(l)q:UnbindAction("\109\111\118\101\070\111\114\119\097\114\100\065\099\116\105\111\110")q:UnbindAction("\109\111\118\101\066\097\099\107\119\097\114\100\065\099\116\105\111\110")q:UnbindAction("\109\111\118\101\076\101\102\116\065\099\116\105\111\110")q:UnbindAction("\109\111\118\101\082\105\103\104\116\065\099\116\105\111\110")q:UnbindAction("\106\117\109\112\065\099\116\105\111\110")end function c.ConnectFocusEventListeners(q)local function e()q.moveVector=L q.forwardValue=0 q.backwardValue=0 q.leftValue=0 q.rightValue=0 q.jumpRequested=false q:UpdateJump()end local function c(l)q.jumpRequested=false q:UpdateJump()end q.textFocusReleasedConn=l.TextBoxFocusReleased:Connect(e)q.textFocusGainedConn=l.TextBoxFocused:Connect(c)q.windowFocusReleasedConn=l.WindowFocused:Connect(e)end function c.DisconnectFocusEventListeners(l)if l.textFocusReleasedCon then l.textFocusReleasedCon:Disconnect()l.textFocusReleasedCon=nil end if l.textFocusGainedConn then l.textFocusGainedConn:Disconnect()l.textFocusGainedConn=nil end if l.windowFocusReleasedConn then l.windowFocusReleasedConn:Disconnect()l.windowFocusReleasedConn=nil end end return c end function _ControlModule()local l={}l.__index=l local q=game:GetService("\080\108\097\121\101\114\115")local L=game:GetService("\082\117\110\083\101\114\118\105\099\101")local e=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local c=game:GetService("\087\111\114\107\115\112\097\099\101")local W=(UserSettings()):GetService("\085\115\101\114\071\097\109\101\083\101\116\116\105\110\103\115")local o=_Keyboard()local y=_Gamepad()local K=_DynamicThumbstick()local R do local l,q=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\077\097\107\101\084\104\117\109\098\115\116\105\099\107\068\121\110\097\109\105\099")end)R=l and q end local E=R and K or _TouchThumbstick()local D=_ClickToMoveController()local m=_TouchJump()local v=_VehicleController()local X=Enum.ContextActionPriority.Default.Value local h={[Enum.TouchMovementMode.DPad]=K;[Enum.DevTouchMovementMode.DPad]=K,[Enum.TouchMovementMode.Thumbpad]=K,[Enum.DevTouchMovementMode.Thumbpad]=K,[Enum.TouchMovementMode.Thumbstick]=E,[Enum.DevTouchMovementMode.Thumbstick]=E,[Enum.TouchMovementMode.DynamicThumbstick]=K,[Enum.DevTouchMovementMode.DynamicThumbstick]=K,[Enum.TouchMovementMode.ClickToMove]=D;[Enum.DevTouchMovementMode.ClickToMove]=D,[Enum.TouchMovementMode.Default]=K;[Enum.ComputerMovementMode.Default]=o,[Enum.ComputerMovementMode.KeyboardMouse]=o;[Enum.DevComputerMovementMode.KeyboardMouse]=o,[Enum.DevComputerMovementMode.Scriptable]=nil,[Enum.ComputerMovementMode.ClickToMove]=D,[Enum.DevComputerMovementMode.ClickToMove]=D}local T={[Enum.UserInputType.Keyboard]=o,[Enum.UserInputType.MouseButton1]=o,[Enum.UserInputType.MouseButton2]=o,[Enum.UserInputType.MouseButton3]=o;[Enum.UserInputType.MouseWheel]=o;[Enum.UserInputType.MouseMovement]=o;[Enum.UserInputType.Gamepad1]=y,[Enum.UserInputType.Gamepad2]=y;[Enum.UserInputType.Gamepad3]=y,[Enum.UserInputType.Gamepad4]=y}local i function l.new()local c=setmetatable({},l)c.controllers={}c.activeControlModule=nil c.activeController=nil c.touchJumpController=nil c.moveFunction=q.LocalPlayer.Move c.humanoid=nil c.lastInputType=Enum.UserInputType.None c.humanoidSeatedConn=nil c.vehicleController=nil c.touchControlFrame=nil c.vehicleController=v.new(X)q.LocalPlayer.CharacterAdded:Connect(function(l)c:OnCharacterAdded(l)end)q.LocalPlayer.CharacterRemoving:Connect(function(l)c:OnCharacterRemoving(l)end)if q.LocalPlayer.Character then c:OnCharacterAdded(q.LocalPlayer.Character)end L:BindToRenderStep("\067\111\110\116\114\111\108\083\099\114\105\112\116\082\101\110\100\101\114\115\116\101\112",Enum.RenderPriority.Input.Value,function(l)c:OnRenderStepped(l)end)e.LastInputTypeChanged:Connect(function(l)c:OnLastInputTypeChanged(l)end);(W:GetPropertyChangedSignal("\084\111\117\099\104\077\111\118\101\109\101\110\116\077\111\100\101")):Connect(function()c:OnTouchMovementModeChange()end);(q.LocalPlayer:GetPropertyChangedSignal("\068\101\118\084\111\117\099\104\077\111\118\101\109\101\110\116\077\111\100\101")):Connect(function()c:OnTouchMovementModeChange()end);(W:GetPropertyChangedSignal("\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101")):Connect(function()c:OnComputerMovementModeChange()end);(q.LocalPlayer:GetPropertyChangedSignal("\068\101\118\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101")):Connect(function()c:OnComputerMovementModeChange()end)c.playerGui=nil c.touchGui=nil c.playerGuiAddedConn=nil if e.TouchEnabled then c.playerGui=q.LocalPlayer:FindFirstChildOfClass("\080\108\097\121\101\114\071\117\105")if c.playerGui then c:CreateTouchGuiContainer()c:OnLastInputTypeChanged(e:GetLastInputType())else c.playerGuiAddedConn=q.LocalPlayer.ChildAdded:Connect(function(l)if l:IsA("\080\108\097\121\101\114\071\117\105")then c.playerGui=l c:CreateTouchGuiContainer()c.playerGuiAddedConn:Disconnect()c.playerGuiAddedConn=nil c:OnLastInputTypeChanged(e:GetLastInputType())end end)end else c:OnLastInputTypeChanged(e:GetLastInputType())end return c end function l.GetMoveVector(l)if l.activeController then return l.activeController:GetMoveVector()end return Vector3.new(0,0,0)end function l.GetActiveController(l)return l.activeController end function l.EnableActiveControlModule(l)if l.activeControlModule==D then l.activeController:Enable(true,q.LocalPlayer.DevComputerMovementMode==Enum.DevComputerMovementMode.UserChoice,l.touchJumpController)elseif l.touchControlFrame then l.activeController:Enable(true,l.touchControlFrame)else l.activeController:Enable(true)end end function l.Enable(q,l)if not q.activeController then return end if l==nil then l=true end if l then q:EnableActiveControlModule()else q:Disable()end end function l.Disable(l)if l.activeController then l.activeController:Enable(false)if l.moveFunction then l.moveFunction(q.LocalPlayer,Vector3.new(0,0,0),true)end end end function l.SelectComputerMovementModule(l)if not(e.KeyboardEnabled or e.GamepadEnabled)then return nil,false end local L local c=q.LocalPlayer.DevComputerMovementMode if c==Enum.DevComputerMovementMode.UserChoice then L=T[i]if W.ComputerMovementMode==Enum.ComputerMovementMode.ClickToMove and L==o then L=D end else L=h[c]if not L and c~=Enum.DevComputerMovementMode.Scriptable then warn("\078\111 \099\104\097\114\097\099\116\101\114 \099\111\110\116\114\111\108 \109\111\100\117\108\101 \105\115 \097\115\115\111\099\105\097\116\101\100 \119\105\116\104 \068\101\118\067\111\109\112\117\116\101\114\077\111\118\101\109\101\110\116\077\111\100\101 ",c)end end if L then return L,true elseif c==Enum.DevComputerMovementMode.Scriptable then return nil,true else return nil,false end end function l.SelectTouchModule(l)if not e.TouchEnabled then return nil,false end local L local c=q.LocalPlayer.DevTouchMovementMode if c==Enum.DevTouchMovementMode.UserChoice then L=h[W.TouchMovementMode]elseif c==Enum.DevTouchMovementMode.Scriptable then return nil,true else L=h[c]end return L,true end local function r(l,q)local L=c.CurrentCamera if not L then return q end if l:GetState()==Enum.HumanoidStateType.Swimming then return L.CFrame:VectorToWorldSpace(q)end local e,W local o,y,K,R,E,D,m,v,X,h,T,i=L.CFrame:GetComponents()if X<1 and X>-1 then e=i W=D else e=R W=-E*math.sign(X)end local r=math.sqrt(e*e+W*W)return Vector3.new((e*q.x+W*q.z)/r,0,(e*q.z-W*q.x)/r)end function l.OnRenderStepped(L,l)if L.activeController and(L.activeController.enabled and L.humanoid)then L.activeController:OnRenderStepped(l)local e=L.activeController:GetMoveVector()local c=L.activeController:IsMoveVectorCameraRelative()local W=L:GetClickToMoveController()if L.activeController~=W then if e.magnitude>0 then W:CleanupPath()else W:OnRenderStepped(l)e=W:GetMoveVector()c=W:IsMoveVectorCameraRelative()end end local o=false if L.vehicleController then e,o=L.vehicleController:Update(e,c,L.activeControlModule==y)end if c then e=r(L.humanoid,e)end L.moveFunction(q.LocalPlayer,e,false)L.humanoid.Jump=L.activeController:GetIsJumping()or L.touchJumpController and L.touchJumpController:GetIsJumping()end end function l.OnHumanoidSeated(L,l,q)if l then if q and q:IsA("\086\101\104\105\099\108\101\083\101\097\116")then if not L.vehicleController then L.vehicleController=L.vehicleController.new(X)end L.vehicleController:Enable(true,q)end else if L.vehicleController then L.vehicleController:Enable(false,q)end end end function l.OnCharacterAdded(q,l)q.humanoid=l:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")while not q.humanoid do l.ChildAdded:wait()q.humanoid=l:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")end if q.touchGui then q.touchGui.Enabled=true end if q.humanoidSeatedConn then q.humanoidSeatedConn:Disconnect()q.humanoidSeatedConn=nil end q.humanoidSeatedConn=q.humanoid.Seated:Connect(function(l,L)q:OnHumanoidSeated(l,L)end)end function l.OnCharacterRemoving(q,l)q.humanoid=nil if q.touchGui then q.touchGui.Enabled=false end end function l.SwitchToController(q,l)if not l then if q.activeController then q.activeController:Enable(false)end q.activeController=nil q.activeControlModule=nil else if not q.controllers[l]then q.controllers[l]=l.new(X)end if q.activeController~=q.controllers[l]then if q.activeController then q.activeController:Enable(false)end q.activeController=q.controllers[l]q.activeControlModule=l if q.touchControlFrame and(q.activeControlModule==D or q.activeControlModule==E or q.activeControlModule==K)then if not q.controllers[m]then q.controllers[m]=m.new()end q.touchJumpController=q.controllers[m]q.touchJumpController:Enable(true,q.touchControlFrame)else if q.touchJumpController then q.touchJumpController:Enable(false)end end q:EnableActiveControlModule()end end end function l.OnLastInputTypeChanged(q,l)if i==l then warn("\076\097\115\116\073\110\112\117\116\084\121\112\101 \067\104\097\110\103\101 \108\105\115\116\101\110\101\114 \099\097\108\108\101\100 \119\105\116\104 \099\117\114\114\101\110\116 \116\121\112\101\046")end i=l if i==Enum.UserInputType.Touch then local l,L=q:SelectTouchModule()if L then while not q.touchControlFrame do wait()end q:SwitchToController(l)end elseif T[i]~=nil then local l=q:SelectComputerMovementModule()if l then q:SwitchToController(l)end end end function l.OnComputerMovementModeChange(l)local q,L=l:SelectComputerMovementModule()if L then l:SwitchToController(q)end end function l.OnTouchMovementModeChange(l)local q,L=l:SelectTouchModule()if L then while not l.touchControlFrame do wait()end l:SwitchToController(q)end end function l.CreateTouchGuiContainer(l)if l.touchGui then l.touchGui:Destroy()end l.touchGui=Instance.new("\083\099\114\101\101\110\071\117\105")l.touchGui.Name="\084\111\117\099\104\071\117\105"l.touchGui.ResetOnSpawn=false l.touchGui.ZIndexBehavior=Enum.ZIndexBehavior.Sibling l.touchGui.Enabled=l.humanoid~=nil l.touchControlFrame=Instance.new("\070\114\097\109\101")l.touchControlFrame.Name="\084\111\117\099\104\067\111\110\116\114\111\108\070\114\097\109\101"l.touchControlFrame.Size=UDim2.new(1,0,1,0)l.touchControlFrame.BackgroundTransparency=1 l.touchControlFrame.Parent=l.touchGui l.touchGui.Parent=l.playerGui end function l.GetClickToMoveController(l)if not l.controllers[D]then l.controllers[D]=D.new(X)end return l.controllers[D]end function l.IsJumping(l)if l.activeController then return l.activeController:GetIsJumping()or l.touchJumpController and l.touchJumpController:GetIsJumping()end return false end return l.new()end function _PlayerModule()local l={}l.__index=l function l.new()local q=setmetatable({},l)q.cameras=_CameraModule()q.controls=_ControlModule()return q end function l.GetCameras(l)return l.cameras end function l.GetControls(l)return l.controls end function l.GetClickToMoveController(l)return l.controls:GetClickToMoveController()end return l.new()end function _sounds()local l=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116",script)local q=game:GetService("\080\108\097\121\101\114\115")local L=game:GetService("\082\117\110\083\101\114\118\105\099\101")local e={Climbing={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\097\099\116\105\111\110\095\102\111\111\116\115\116\101\112\115\095\112\108\097\115\116\105\099\046\109\112\051";Looped=true},Died={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\117\117\104\104\104\046\109\112\051"};FreeFalling={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\097\099\116\105\111\110\095\102\097\108\108\105\110\103\046\109\112\051";Looped=true},GettingUp={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\097\099\116\105\111\110\095\103\101\116\095\117\112\046\109\112\051"},Jumping={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\097\099\116\105\111\110\095\106\117\109\112\046\109\112\051"};Landing={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\097\099\116\105\111\110\095\106\117\109\112\095\108\097\110\100\046\109\112\051"},Running={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\097\099\116\105\111\110\095\102\111\111\116\115\116\101\112\115\095\112\108\097\115\116\105\099\046\109\112\051",Looped=true;Pitch=1.85};Splash={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\105\109\112\097\099\116\095\119\097\116\101\114\046\109\112\051"};Swimming={SoundId="\114\098\120\097\115\115\101\116\058\047\047\115\111\117\110\100\115\047\097\099\116\105\111\110\095\115\119\105\109\046\109\112\051",Looped=true;Pitch=1.6}}local function c(...)local l=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116")local q={...}local function L(...)for l=1,#q,1 do q[l]:Disconnect()end return l:Fire(...)end for l=1,#q,1 do q[l]=q[l]:Connect(L)end return l.Event:Wait()end local function W(l,q,L,e,c)return((l-q)*(c-e))/(L-q)+e end local function o(l)l.TimePosition=0 l.Playing=true end local function y(l)l.Playing=false l.TimePosition=0 end local function K(l)local q={}for l,L in pairs(l)do q[l]=L end return q end local function R(q,c,y)local R={}for l,q in pairs(e)do local L=Instance.new("\083\111\117\110\100")L.Name=l L.Archivable=false L.EmitterSize=5 L.MaxDistance=150 L.Volume=.65 for l,q in pairs(q)do L[l]=q end L.Parent=y R[l]=L end local E={}local function D(l)for q in pairs(K(E))do if q~=l then q.Playing=false E[q]=nil end end end local m={[Enum.HumanoidStateType.FallingDown]=function()D()end;[Enum.HumanoidStateType.GettingUp]=function()D()o(R.GettingUp)end,[Enum.HumanoidStateType.Jumping]=function()D()o(R.Jumping)end,[Enum.HumanoidStateType.Swimming]=function()local l=math.abs(y.Velocity.Y)if l>.1 then R.Splash.Volume=math.clamp(W(l,100,350,.28,1),0,1)o(R.Splash)end D(R.Swimming)R.Swimming.Playing=true E[R.Swimming]=true end,[Enum.HumanoidStateType.Freefall]=function()R.FreeFalling.Volume=0 D(R.FreeFalling)E[R.FreeFalling]=true end,[Enum.HumanoidStateType.Landed]=function()D()local l=math.abs(y.Velocity.Y)if l>75 then R.Landing.Volume=math.clamp(W(l,50,100,0,1),0,1)o(R.Landing)end end;[Enum.HumanoidStateType.Running]=function()D(R.Running)R.Running.Playing=true E[R.Running]=true end;[Enum.HumanoidStateType.Climbing]=function()local l=R.Climbing if math.abs(y.Velocity.Y)>.1 then l.Playing=true D(l)else D()end E[l]=true end,[Enum.HumanoidStateType.Seated]=function()D()end,[Enum.HumanoidStateType.Dead]=function()D()o(R.Died)end}local v={[R.Climbing]=function(l,q,L)q.Playing=L.Magnitude>.1 end,[R.FreeFalling]=function(l,q,L)if L.Magnitude>75 then q.Volume=math.clamp(q.Volume+.9*l,0,1)else q.Volume=0 end end,[R.Running]=function(l,q,L)q.Playing=L.Magnitude>.5 and c.MoveDirection.Magnitude>.5 end}local X={[Enum.HumanoidStateType.RunningNoPhysics]=Enum.HumanoidStateType.Running}local h=X[c:GetState()]or c:GetState()local T={}local i=c.StateChanged:Connect(function(l,q)q=X[q]or q if q~=h then local l=m[q]if l then l()end h=q end end)local r=l.Event:Connect(function(l)l=X[l]or l if l~=h then local q=m[l]if q then q()end h=l end end)local U=L.Stepped:Connect(function(l,q)for l in pairs(E)do local L=v[l]if L then L(q,l,y.Velocity)end end end)local w local G local I local function a()i:Disconnect()r:Disconnect()U:Disconnect()w:Disconnect()G:Disconnect()I:Disconnect()end w=c.AncestryChanged:Connect(function(l,q)if not q then a()end end)G=y.AncestryChanged:Connect(function(l,q)if not q then a()end end)I=q.CharacterAdded:Connect(a)end local function E(l)local function q(q)if not q.Parent then c(q.AncestryChanged,l.CharacterAdded)end if l.Character~=q or not q.Parent then return end local L=q:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")while q:IsDescendantOf(game)and not L do c(q.ChildAdded,q.AncestryChanged,l.CharacterAdded)L=q:FindFirstChildOfClass("\072\117\109\097\110\111\105\100")end if l.Character~=q or not q:IsDescendantOf(game)then return end local e=q:FindFirstChild("\072\117\109\097\110\111\105\100\082\111\111\116\080\097\114\116")while q:IsDescendantOf(game)and not e do c(q.ChildAdded,q.AncestryChanged,L.AncestryChanged,l.CharacterAdded)e=q:FindFirstChild("\072\117\109\097\110\111\105\100\082\111\111\116\080\097\114\116")end if e and(L:IsDescendantOf(game)and(q:IsDescendantOf(game)and l.Character==q))then R(l,L,e)end end if l.Character then q(l.Character)end l.CharacterAdded:Connect(q)end q.PlayerAdded:Connect(E)for l,q in ipairs(q:GetPlayers())do E(q)end return l end function _StateTracker()local l=.1 local q={onRunning=true,onClimbing=true}local L={onFreeFall=true;onJumping=true}local e={onRunning=Enum.HumanoidStateType.Running,onJumping=Enum.HumanoidStateType.Jumping;onFreeFall=Enum.HumanoidStateType.Freefall}local c={}c.__index=c function c.new(l,q)local L=setmetatable({},c)L.Humanoid=l L.HRP=l.RootPart L.Speed=0 L.State="\111\110\082\117\110\110\105\110\103"L.Jumped=false L.JumpTick=tick()L.SoundState=q L._ChangedEvent=Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116")L.Changed=L._ChangedEvent.Event return L end function c.Destroy(l)l._ChangedEvent:Destroy()end function c.RequestedJump(l)l.Jumped=true l.JumpTick=tick()end function c.OnStep(o,L,c,W)local y=o.HRP.Velocity local K=y:Dot(L)local R,E=o.State,o.Speed local D local m=y.Magnitude if not c then if K>0 then if o.Jumped then D="\111\110\074\117\109\112\105\110\103"else D="\111\110\070\114\101\101\070\097\108\108"end else if o.Jumped then o.Jumped=false end D="\111\110\070\114\101\101\070\097\108\108"end else if o.Jumped and tick()-o.JumpTick>.1 then o.Jumped=false end m=(y-K*L).Magnitude D="\111\110\082\117\110\110\105\110\103"end m=W and m or 0 if R~=D or q[D]and math.abs(E-m)>l then o.State=D o.Speed=m o.SoundState:Fire(e[D])o._ChangedEvent:Fire(o.State,o.Speed)end end return c end function _InitObjects()local l=workspace:FindFirstChild("\111\098\106\101\099\116\115")or(game:GetObjects("\114\098\120\097\115\115\101\116\105\100\058\047\047\053\048\052\053\052\048\056\052\056\057"))[1]local q=l:WaitForChild("\083\112\104\101\114\101")local L=l:WaitForChild("\070\108\111\111\114")local e=l:WaitForChild("\086\101\099\116\111\114\070\111\114\099\101")local c=l:WaitForChild("\066\111\100\121\071\121\114\111")local function W(l)local W=l.HRP local o=l.Humanoid local y=q:Clone()y.Parent=l.Character local K=L:Clone()K.Parent=l.Character local R=o.RigType==Enum.HumanoidRigType.R15 local E=R and o.HipHeight+.05 or 2 local D=Instance.new("\087\101\108\100")D.C0=CFrame.new(0,-E,.1)D.Part0=W D.Part1=y D.Parent=y local m=Instance.new("\087\101\108\100")m.C0=CFrame.new(0,-(E+1.5),0)m.Part0=W m.Part1=K m.Parent=K local v=c:Clone()v.CFrame=W.CFrame v.Parent=W local X=e:Clone()X.Attachment0=R and W:WaitForChild("\082\111\111\116\082\105\103\065\116\116\097\099\104\109\101\110\116")or W:WaitForChild("\082\111\111\116\065\116\116\097\099\104\109\101\110\116")X.Parent=W return y,v,X,K end return W end local l=game.Players.LocalPlayer local q=l:GetMouse()local L l.CharacterAdded:Connect(function(l)L=l end)function _R6()function r6()local l=L local q=l:WaitForChild("\084\111\114\115\111")local e=q:WaitForChild("\082\105\103\104\116 \083\104\111\117\108\100\101\114")local c=q:WaitForChild("\076\101\102\116 \083\104\111\117\108\100\101\114")local W=q:WaitForChild("\082\105\103\104\116 \072\105\112")local o=q:WaitForChild("\076\101\102\116 \072\105\112")local y=q:WaitForChild("\078\101\099\107")local K=l:WaitForChild("\072\117\109\097\110\111\105\100")local R="\083\116\097\110\100\105\110\103"local E=""local D=nil local m=nil local v=nil local X=1 local h={}local T={idle={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\048\052\051\053\053\055\049";weight=9},{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\048\052\051\053\055\057\050";weight=1}};walk={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\048\052\050\054\051\053\052";weight=10}},run={{id="\114\117\110\046\120\109\108",weight=10}};jump={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\050\053\055\053\048\055\048\050",weight=10}},fall={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\048\052\051\054\049\052\056",weight=10}};climb={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\048\052\051\054\051\051\052";weight=10}};sit={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\055\056\049\051\048\057\057\054";weight=10}},toolnone={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\051\057\051\052\055\056";weight=10}},toolslash={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\050\057\057\054\055\051\057\048",weight=10}},toollunge={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\050\057\057\054\055\052\055\056";weight=10}},wave={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\050\056\055\055\055\057\055\051";weight=10}},point={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\050\056\056\053\051\051\053\055";weight=10}},dance1={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\051\053\057\057\056",weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\057\049\048\051\055",weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\057\049\048\054\053";weight=10}};dance2={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\051\054\056\052\050",weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\057\049\050\052\056",weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\057\049\050\055\055",weight=10}},dance3={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\051\054\057\051\053";weight=10},{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\057\049\051\054\056",weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\050\052\057\049\052\050\051";weight=10}},laugh={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\050\057\052\050\051\049\051\049";weight=10}};cheer={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\050\057\052\050\051\048\051\048";weight=10}}}local i={"\100\097\110\099\101\049","\100\097\110\099\101\050","\100\097\110\099\101\051"}local r={wave=false;point=false,dance1=true;dance2=true;dance3=true;laugh=false;cheer=false}function configureAnimationSet(l,q)if h[l]~=nil then for l,q in pairs(h[l].connections)do q:disconnect()end end h[l]={}h[l].count=0 h[l].totalWeight=0 h[l].connections={}local L=script:FindFirstChild(l)if L~=nil then table.insert(h[l].connections,L.ChildAdded:connect(function(L)configureAnimationSet(l,q)end))table.insert(h[l].connections,L.ChildRemoved:connect(function(L)configureAnimationSet(l,q)end))local e=1 for L,c in pairs(L:GetChildren())do if c:IsA("\065\110\105\109\097\116\105\111\110")then table.insert(h[l].connections,c.Changed:connect(function(L)configureAnimationSet(l,q)end))h[l][e]={}h[l][e].anim=c local L=c:FindFirstChild("\087\101\105\103\104\116")if L==nil then h[l][e].weight=1 else h[l][e].weight=L.Value end h[l].count=h[l].count+1 h[l].totalWeight=h[l].totalWeight+h[l][e].weight e=e+1 end end end if h[l].count<=0 then for q,L in pairs(q)do h[l][q]={}h[l][q].anim=Instance.new("\065\110\105\109\097\116\105\111\110")h[l][q].anim.Name=l h[l][q].anim.AnimationId=L.id h[l][q].weight=L.weight h[l].count=h[l].count+1 h[l].totalWeight=h[l].totalWeight+L.weight end end end function scriptChildModified(l)local q=T[l.Name]if q~=nil then configureAnimationSet(l.Name,q)end end script.ChildAdded:connect(scriptChildModified)script.ChildRemoved:connect(scriptChildModified)for l,q in pairs(T)do configureAnimationSet(l,q)end local U="\078\111\110\101"local w=0 local G=0 local I=.3 local a=.1 local H=.3 local d=.75 function stopAllAnimations()local l=E if r[l]~=nil and r[l]==false then l="\105\100\108\101"end E=""D=nil if v~=nil then v:disconnect()end if m~=nil then m:Stop()m:Destroy()m=nil end return l end function setAnimationSpeed(l)if l~=X then X=l m:AdjustSpeed(X)end end function keyFrameReachedFunc(l)if l=="\069\110\100"then local l=E if r[l]~=nil and r[l]==false then l="\105\100\108\101"end local q=X playAnimation(l,0,K)setAnimationSpeed(q)end end function playAnimation(l,q,L)local e=math.random(1,h[l].totalWeight)local c=e local W=1 while e>h[l][W].weight do e=e-h[l][W].weight W=W+1 end local o=h[l][W].anim if o~=D then if m~=nil then m:Stop(q)m:Destroy()end X=1 m=L:LoadAnimation(o)m.Priority=Enum.AnimationPriority.Core m:Play(q)E=l D=o if v~=nil then v:disconnect()end v=m.KeyframeReached:connect(keyFrameReachedFunc)end end local z=""local j=nil local Q=nil local P=nil function toolKeyFrameReachedFunc(l)if l=="\069\110\100"then playToolAnimation(z,0,K)end end function playToolAnimation(l,q,L,e)local c=math.random(1,h[l].totalWeight)local W=c local o=1 while c>h[l][o].weight do c=c-h[l][o].weight o=o+1 end local y=h[l][o].anim if Q~=y then if j~=nil then j:Stop()j:Destroy()q=0 end j=L:LoadAnimation(y)if e then j.Priority=e end j:Play(q)z=l Q=y P=j.KeyframeReached:connect(toolKeyFrameReachedFunc)end end function stopToolAnimations()local l=z if P~=nil then P:disconnect()end z=""Q=nil if j~=nil then j:Stop()j:Destroy()j=nil end return l end function onRunning(l)if l>.01 then playAnimation("\119\097\108\107",.1,K)if D and D.AnimationId=="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\049\056\048\052\050\054\051\053\052"then setAnimationSpeed(l/14.5)end R="\082\117\110\110\105\110\103"else if r[E]==nil then playAnimation("\105\100\108\101",.1,K)R="\083\116\097\110\100\105\110\103"end end end function onDied()R="\068\101\097\100"end function onJumping()playAnimation("\106\117\109\112",.1,K)G=I R="\074\117\109\112\105\110\103"end function onClimbing(l)playAnimation("\099\108\105\109\098",.1,K)setAnimationSpeed(l/12)R="\067\108\105\109\098\105\110\103"end function onGettingUp()R="\071\101\116\116\105\110\103\085\112"end function onFreeFall()if G<=0 then playAnimation("\102\097\108\108",H,K)end R="\070\114\101\101\070\097\108\108"end function onFallingDown()R="\070\097\108\108\105\110\103\068\111\119\110"end function onSeated()R="\083\101\097\116\101\100"end function onPlatformStanding()R="\080\108\097\116\102\111\114\109\083\116\097\110\100\105\110\103"end function onSwimming(l)if l>0 then R="\082\117\110\110\105\110\103"else R="\083\116\097\110\100\105\110\103"end end function getTool()for l,q in ipairs(l:GetChildren())do if q.className=="\084\111\111\108"then return q end end return nil end function getToolAnim(l)for l,q in ipairs(l:GetChildren())do if q.Name=="\116\111\111\108\097\110\105\109"and q.className=="\083\116\114\105\110\103\086\097\108\117\101"then return q end end return nil end function animateTool()if U=="\078\111\110\101"then playToolAnimation("\116\111\111\108\110\111\110\101",a,K,Enum.AnimationPriority.Idle)return end if U=="\083\108\097\115\104"then playToolAnimation("\116\111\111\108\115\108\097\115\104",0,K,Enum.AnimationPriority.Action)return end if U=="\076\117\110\103\101"then playToolAnimation("\116\111\111\108\108\117\110\103\101",0,K,Enum.AnimationPriority.Action)return end end function moveSit()e.MaxVelocity=.15 c.MaxVelocity=.15 e:SetDesiredAngle(1.57)c:SetDesiredAngle(-1.57)W:SetDesiredAngle(1.57)o:SetDesiredAngle(-1.57)end local n=0 function move(l)local q=1 local L=1 local y=l-n n=l local E=0 local D=false if G>0 then G=G-y end if R=="\070\114\101\101\070\097\108\108"and G<=0 then playAnimation("\102\097\108\108",H,K)elseif R=="\083\101\097\116\101\100"then playAnimation("\115\105\116",.5,K)return elseif R=="\082\117\110\110\105\110\103"then playAnimation("\119\097\108\107",.1,K)elseif R=="\068\101\097\100"or R=="\071\101\116\116\105\110\103\085\112"or R=="\070\097\108\108\105\110\103\068\111\119\110"or R=="\083\101\097\116\101\100"or R=="\080\108\097\116\102\111\114\109\083\116\097\110\100\105\110\103"then stopAllAnimations()q=.1 L=1 D=true end if D then local y=q*math.sin(l*L)e:SetDesiredAngle(y+E)c:SetDesiredAngle(y-E)W:SetDesiredAngle(-y)o:SetDesiredAngle(-y)end local m=getTool()if m and m:FindFirstChild("\072\097\110\100\108\101")then local q=getToolAnim(m)if q then U=q.Value q.Parent=nil w=l+.3 end if l>w then w=0 U="\078\111\110\101"end animateTool()else stopToolAnimations()U="\078\111\110\101"Q=nil w=0 end end local k={}local N=K local function C()for l=1,#k,1 do k[l]:Disconnect()end k={}end local function V()C()R=N.Sit and"\083\101\097\116\101\100"or"\083\116\097\110\100\105\110\103"k={N.Died:connect(onDied);N.Running:connect(onRunning),N.Jumping:connect(onJumping);N.Climbing:connect(onClimbing);N.GettingUp:connect(onGettingUp);N.FreeFalling:connect(onFreeFall);N.FallingDown:connect(onFallingDown),N.Seated:connect(onSeated),N.PlatformStanding:connect(onPlatformStanding),N.Swimming:connect(onSwimming)}end V();(game:GetService("\080\108\097\121\101\114\115")).LocalPlayer.Chatted:connect(function(l)local q=""if l=="\047\101 \100\097\110\099\101"then q=i[math.random(1,#i)]elseif string.sub(l,1,3)=="\047\101 "then q=string.sub(l,4)elseif string.sub(l,1,7)=="\047\101\109\111\116\101 "then q=string.sub(l,8)end if R=="\083\116\097\110\100\105\110\103"and r[q]~=nil then playAnimation(q,.1,K)end end)playAnimation("\105\100\108\101",.1,K)R="\083\116\097\110\100\105\110\103"spawn(function()while l.Parent~=nil do local l,q=wait(.1)move(q)end end)return{onRunning=onRunning;onDied=onDied;onJumping=onJumping;onClimbing=onClimbing,onGettingUp=onGettingUp,onFreeFall=onFreeFall;onFallingDown=onFallingDown,onSeated=onSeated;onPlatformStanding=onPlatformStanding;onHook=V,onUnhook=C}end return r6()end function _R15()local function l()local l=L local q=l:WaitForChild("\072\117\109\097\110\111\105\100")local e="\083\116\097\110\100\105\110\103"local c,W=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\078\111\085\112\100\097\116\101\079\110\076\111\111\112")end)local o=c and W local y,K=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\065\110\105\109\097\116\105\111\110\083\112\101\101\100\068\097\109\112\101\110\105\110\103")end)local R=y and K local E,D=pcall(function()return(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\065\110\105\109\097\116\101\083\099\114\105\112\116\069\109\111\116\101\072\111\111\107")end)local m=E and D local v=script:FindFirstChild("\083\099\097\108\101\068\097\109\112\101\110\105\110\103\080\101\114\099\101\110\116")local X=2 local h=.1 local T=""local i=nil local r=nil local U=nil local w=1 local G=nil local I=nil local a={}local H={idle={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\054\054\054\054";weight=1},{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\054\057\053\049";weight=1};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\054\051\056\056";weight=9}},walk={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\055\056\050\054",weight=10}},run={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\055\055\049\052",weight=10}},swim={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\056\052\056\057\055";weight=10}};swimidle={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\056\053\048\055\050",weight=10}},jump={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\053\048\048\048";weight=10}},fall={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\055\057\054\056",weight=10}};climb={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\053\054\052\052",weight=10}},sit={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\050\053\048\054\050\056\049\055\048\051";weight=10}},toolnone={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\054\056\051\055\053",weight=10}};toolslash={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\050\050\054\051\053\053\049\052";weight=10}};toollunge={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\050\050\054\051\056\055\054\055",weight=10}};wave={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\048\050\051\057",weight=10}};point={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\048\052\053\051";weight=10}},dance={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\049\048\049\057";weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\049\057\053\053";weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\050\049\048\052",weight=10}},dance2={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\054\048\052\051",weight=10},{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\054\055\050\048",weight=10},{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\054\056\055\057",weight=10}};dance3={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\055\050\054\056",weight=10},{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\055\052\053\049",weight=10};{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\055\054\050\051";weight=10}};laugh={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\048\056\049\056",weight=10}};cheer={{id="\104\116\116\112\058\047\047\119\119\119\046\114\111\098\108\111\120\046\099\111\109\047\097\115\115\101\116\047\063\105\100\061\053\048\055\055\055\048\054\055\055",weight=10}}}local d={wave=false,point=false,dance=true,dance2=true,dance3=true;laugh=false,cheer=false}local z=false local j={}local Q,P=pcall(function()z=(UserSettings()):IsUserFeatureEnabled("\085\115\101\114\080\114\101\108\111\097\100\065\110\105\109\097\116\105\111\110\115")end)if not Q then z=false end math.randomseed(tick())function findExistingAnimationInSet(l,q)if l==nil or q==nil then return 0 end for L=1,l.count,1 do if l[L].anim.AnimationId==q.AnimationId then return L end end return 0 end function configureAnimationSet(l,L)if a[l]~=nil then for l,q in pairs(a[l].connections)do q:disconnect()end end a[l]={}a[l].count=0 a[l].totalWeight=0 a[l].connections={}local e=true local c,W=pcall(function()e=(game:GetService("\083\116\097\114\116\101\114\080\108\097\121\101\114")).AllowCustomAnimations end)if not c then e=true end local o=script:FindFirstChild(l)if e and o~=nil then table.insert(a[l].connections,o.ChildAdded:connect(function(q)configureAnimationSet(l,L)end))table.insert(a[l].connections,o.ChildRemoved:connect(function(q)configureAnimationSet(l,L)end))local q=0 for e,c in pairs(o:GetChildren())do if c:IsA("\065\110\105\109\097\116\105\111\110")then local e=1 local W=c:FindFirstChild("\087\101\105\103\104\116")if W~=nil then e=W.Value end a[l].count=a[l].count+1 q=a[l].count a[l][q]={}a[l][q].anim=c a[l][q].weight=e a[l].totalWeight=a[l].totalWeight+a[l][q].weight table.insert(a[l].connections,c.Changed:connect(function(q)configureAnimationSet(l,L)end))table.insert(a[l].connections,c.ChildAdded:connect(function(q)configureAnimationSet(l,L)end))table.insert(a[l].connections,c.ChildRemoved:connect(function(q)configureAnimationSet(l,L)end))end end end if a[l].count<=0 then for q,L in pairs(L)do a[l][q]={}a[l][q].anim=Instance.new("\065\110\105\109\097\116\105\111\110")a[l][q].anim.Name=l a[l][q].anim.AnimationId=L.id a[l][q].weight=L.weight a[l].count=a[l].count+1 a[l].totalWeight=a[l].totalWeight+L.weight end end if z then for l,L in pairs(a)do for l=1,L.count,1 do if j[L[l].anim.AnimationId]==nil then q:LoadAnimation(L[l].anim)j[L[l].anim.AnimationId]=true end end end end end function configureAnimationSetOld(l,L)if a[l]~=nil then for l,q in pairs(a[l].connections)do q:disconnect()end end a[l]={}a[l].count=0 a[l].totalWeight=0 a[l].connections={}local e=true local c,W=pcall(function()e=(game:GetService("\083\116\097\114\116\101\114\080\108\097\121\101\114")).AllowCustomAnimations end)if not c then e=true end local o=script:FindFirstChild(l)if e and o~=nil then table.insert(a[l].connections,o.ChildAdded:connect(function(q)configureAnimationSet(l,L)end))table.insert(a[l].connections,o.ChildRemoved:connect(function(q)configureAnimationSet(l,L)end))local q=1 for e,c in pairs(o:GetChildren())do if c:IsA("\065\110\105\109\097\116\105\111\110")then table.insert(a[l].connections,c.Changed:connect(function(q)configureAnimationSet(l,L)end))a[l][q]={}a[l][q].anim=c local e=c:FindFirstChild("\087\101\105\103\104\116")if e==nil then a[l][q].weight=1 else a[l][q].weight=e.Value end a[l].count=a[l].count+1 a[l].totalWeight=a[l].totalWeight+a[l][q].weight q=q+1 end end end if a[l].count<=0 then for q,L in pairs(L)do a[l][q]={}a[l][q].anim=Instance.new("\065\110\105\109\097\116\105\111\110")a[l][q].anim.Name=l a[l][q].anim.AnimationId=L.id a[l][q].weight=L.weight a[l].count=a[l].count+1 a[l].totalWeight=a[l].totalWeight+L.weight end end if z then for l,L in pairs(a)do for l=1,L.count,1 do q:LoadAnimation(L[l].anim)end end end end function scriptChildModified(l)local q=H[l.Name]if q~=nil then configureAnimationSet(l.Name,q)end end script.ChildAdded:connect(scriptChildModified)script.ChildRemoved:connect(scriptChildModified)for l,q in pairs(H)do configureAnimationSet(l,q)end local n="\078\111\110\101"local k=0 local N=0 local C=.31 local V=.1 local g=.2 local s=false function stopAllAnimations()local l=T if d[l]~=nil and d[l]==false then l="\105\100\108\101"end if m and s then l="\105\100\108\101"s=false end T=""i=nil if U~=nil then U:disconnect()end if r~=nil then r:Stop()r:Destroy()r=nil end if I~=nil then I:disconnect()end if G~=nil then G:Stop()G:Destroy()G=nil end return l end function getHeightScale()if q then if not q.AutomaticScalingEnabled then return 1 end local l=q.HipHeight/X if R then if v==nil then v=script:FindFirstChild("\083\099\097\108\101\068\097\109\112\101\110\105\110\103\080\101\114\099\101\110\116")end if v~=nil then l=1+((q.HipHeight-X)*v.Value)/X end end return l end return 1 end local Y=.0001 function setRunSpeed(l)local q=l*1.25 local L=getHeightScale()local e=q/L if e~=w then if e<.33 then r:AdjustWeight(1)G:AdjustWeight(Y)elseif e<.66 then local l=(e-.33)/.33 r:AdjustWeight((1-l)+Y)G:AdjustWeight(l+Y)else r:AdjustWeight(Y)G:AdjustWeight(1)end w=e G:AdjustSpeed(e)r:AdjustSpeed(e)end end function setAnimationSpeed(l)if T=="\119\097\108\107"then setRunSpeed(l)else if l~=w then w=l r:AdjustSpeed(w)end end end function keyFrameReachedFunc(l)if l=="\069\110\100"then if T=="\119\097\108\107"then if o==true then if G.Looped~=true then G.TimePosition=0 end if r.Looped~=true then r.TimePosition=0 end else G.TimePosition=0 r.TimePosition=0 end else local l=T if d[l]~=nil and d[l]==false then l="\105\100\108\101"end if m and s then if r.Looped then return end l="\105\100\108\101"s=false end local L=w playAnimation(l,.15,q)setAnimationSpeed(L)end end end function rollAnimation(l)local q=math.random(1,a[l].totalWeight)local L=q local e=1 while q>a[l][e].weight do q=q-a[l][e].weight e=e+1 end return e end local function M(l,q,L,e)if l~=i then if r~=nil then r:Stop(L)r:Destroy()end if G~=nil then G:Stop(L)G:Destroy()if o==true then G=nil end end w=1 r=e:LoadAnimation(l)r.Priority=Enum.AnimationPriority.Core r:Play(L)T=q i=l if U~=nil then U:disconnect()end U=r.KeyframeReached:connect(keyFrameReachedFunc)if q=="\119\097\108\107"then local l="\114\117\110"local q=rollAnimation(l)G=e:LoadAnimation(a[l][q].anim)G.Priority=Enum.AnimationPriority.Core G:Play(L)if I~=nil then I:disconnect()end I=G.KeyframeReached:connect(keyFrameReachedFunc)end end end function playAnimation(l,q,L)local e=rollAnimation(l)local c=a[l][e].anim M(c,l,q,L)s=false end function playEmote(l,q,L)M(l,l.Name,q,L)s=true end local O=""local x=nil local J=nil local u=nil function toolKeyFrameReachedFunc(l)if l=="\069\110\100"then playToolAnimation(O,0,q)end end function playToolAnimation(l,q,L,e)local c=rollAnimation(l)local W=a[l][c].anim if J~=W then if x~=nil then x:Stop()x:Destroy()q=0 end x=L:LoadAnimation(W)if e then x.Priority=e end x:Play(q)O=l J=W u=x.KeyframeReached:connect(toolKeyFrameReachedFunc)end end function stopToolAnimations()local l=O if u~=nil then u:disconnect()end O=""J=nil if x~=nil then x:Stop()x:Destroy()x=nil end return l end function onRunning(l)if l>.75 then local L=16 playAnimation("\119\097\108\107",.2,q)setAnimationSpeed(l/L)e="\082\117\110\110\105\110\103"else if d[T]==nil and not s then playAnimation("\105\100\108\101",.2,q)e="\083\116\097\110\100\105\110\103"end end end function onDied()e="\068\101\097\100"end function onJumping()playAnimation("\106\117\109\112",.1,q)N=C e="\074\117\109\112\105\110\103"end function onClimbing(l)local L=5 playAnimation("\099\108\105\109\098",.1,q)setAnimationSpeed(l/L)e="\067\108\105\109\098\105\110\103"end function onGettingUp()e="\071\101\116\116\105\110\103\085\112"end function onFreeFall()if N<=0 then playAnimation("\102\097\108\108",g,q)end e="\070\114\101\101\070\097\108\108"end function onFallingDown()e="\070\097\108\108\105\110\103\068\111\119\110"end function onSeated()e="\083\101\097\116\101\100"end function onPlatformStanding()e="\080\108\097\116\102\111\114\109\083\116\097\110\100\105\110\103"end function onSwimming(l)if l>1 then local L=10 playAnimation("\115\119\105\109",.4,q)setAnimationSpeed(l/L)e="\083\119\105\109\109\105\110\103"else playAnimation("\115\119\105\109\105\100\108\101",.4,q)e="\083\116\097\110\100\105\110\103"end end function animateTool()if n=="\078\111\110\101"then playToolAnimation("\116\111\111\108\110\111\110\101",V,q,Enum.AnimationPriority.Idle)return end if n=="\083\108\097\115\104"then playToolAnimation("\116\111\111\108\115\108\097\115\104",0,q,Enum.AnimationPriority.Action)return end if n=="\076\117\110\103\101"then playToolAnimation("\116\111\111\108\108\117\110\103\101",0,q,Enum.AnimationPriority.Action)return end end function getToolAnim(l)for l,q in ipairs(l:GetChildren())do if q.Name=="\116\111\111\108\097\110\105\109"and q.className=="\083\116\114\105\110\103\086\097\108\117\101"then return q end end return nil end local F=0 function stepAnimate(L)local c=1 local W=1 local o=L-F F=L local y=0 local K=false if N>0 then N=N-o end if e=="\070\114\101\101\070\097\108\108"and N<=0 then playAnimation("\102\097\108\108",g,q)elseif e=="\083\101\097\116\101\100"then playAnimation("\115\105\116",.5,q)return elseif e=="\082\117\110\110\105\110\103"then playAnimation("\119\097\108\107",.2,q)elseif e=="\068\101\097\100"or e=="\071\101\116\116\105\110\103\085\112"or e=="\070\097\108\108\105\110\103\068\111\119\110"or e=="\083\101\097\116\101\100"or e=="\080\108\097\116\102\111\114\109\083\116\097\110\100\105\110\103"then stopAllAnimations()c=.1 W=1 K=true end local R=l:FindFirstChildOfClass("\084\111\111\108")if R and R:FindFirstChild("\072\097\110\100\108\101")then local l=getToolAnim(R)if l then n=l.Value l.Parent=nil k=L+.3 end if L>k then k=0 n="\078\111\110\101"end animateTool()else stopToolAnimations()n="\078\111\110\101"J=nil k=0 end end local Z={}local b=q local function f()for l=1,#Z,1 do Z[l]:Disconnect()end Z={}end local function t()f()e=b.Sit and"\083\101\097\116\101\100"or"\083\116\097\110\100\105\110\103"Z={b.Died:connect(onDied),b.Running:connect(onRunning),b.Jumping:connect(onJumping),b.Climbing:connect(onClimbing),b.GettingUp:connect(onGettingUp),b.FreeFalling:connect(onFreeFall),b.FallingDown:connect(onFallingDown),b.Seated:connect(onSeated);b.PlatformStanding:connect(onPlatformStanding);b.Swimming:connect(onSwimming)}end t();(game:GetService("\080\108\097\121\101\114\115")).LocalPlayer.Chatted:connect(function(l)local L=""if string.sub(l,1,3)=="\047\101 "then L=string.sub(l,4)elseif string.sub(l,1,7)=="\047\101\109\111\116\101 "then L=string.sub(l,8)end if e=="\083\116\097\110\100\105\110\103"and d[L]~=nil then playAnimation(L,h,q)end end)playAnimation("\105\100\108\101",.1,q)e="\083\116\097\110\100\105\110\103"spawn(function()while l.Parent~=nil do local l,q=wait(.1)stepAnimate(q)end end)return{onRunning=onRunning;onDied=onDied,onJumping=onJumping;onClimbing=onClimbing,onGettingUp=onGettingUp,onFreeFall=onFreeFall;onFallingDown=onFallingDown;onSeated=onSeated;onPlatformStanding=onPlatformStanding,onHook=t;onUnhook=f}end return l()end while true do wait(.1)if l.Character~=nil then L=l.Character break end end function _Controller()local l=L:WaitForChild("\072\117\109\097\110\111\105\100")local q={}if l.RigType==Enum.HumanoidRigType.R6 then q=_R6()else q=_R15()end print("\065\110\105\109\097\116\105\111\110 \115\117\099\099\101\115")return q end function _AnimationHandler()local l={}l.__index=l function l.new(q,L)local e=setmetatable({},l)e._AnimFuncs=_Controller()e.Humanoid=q return e end function l.EnableDefault(q,l)if l then q._AnimFuncs.onHook()else q._AnimFuncs.onUnhook()end end function l.Run(q,l,...)q._AnimFuncs[l](...)end return l end function _GravityController()local l=Vector3.new(0,0,0)local q=Vector3.new(1,0,0)local L=Vector3.new(0,1,0)local e=Vector3.new(0,0,1)local c=Vector3.new(1,0,1)local W=CFrame.new()local o=1.2 local y=.15 local K=66.666666666667 local R=game:GetService("\085\115\101\114\073\110\112\117\116\083\101\114\118\105\099\101")local E=game:GetService("\082\117\110\083\101\114\118\105\099\101")local D=_InitObjects()local m=_AnimationHandler()local v=_StateTracker()local X={}X.__index=X local function h(l,q,L)local e,c=l:Dot(q),l:Cross(q)if e<-0.99999 then return CFrame.fromAxisAngle(L,math.pi)end return CFrame.new(0,0,0,c.x,c.y,c.z,1+e)end local function T(l,q,L)local e=q:Cross(L)local c=e:Cross(q)return CFrame.fromMatrix(l,e.Unit,c.Unit)end local function i(l)local q=0 for l,L in next,l do if L:IsA("\066\097\115\101\080\097\114\116")then q=q+L:GetMass()end end return q end local r=_PlayerModule()local U=_sounds()function X.new(l)local q=setmetatable({},X)local e=r q.Controls=e:GetControls()q.Camera=e:GetCameras()q.Player=l q.Character=l.Character q.Humanoid=l.Character:WaitForChild("\072\117\109\097\110\111\105\100")q.HRP=l.Character:WaitForChild("\072\117\109\097\110\111\105\100\082\111\111\116\080\097\114\116")q.AnimationHandler=m.new(q.Humanoid,q.Character:WaitForChild("\065\110\105\109\097\116\101"))q.AnimationHandler:EnableDefault(false)local c=(game:GetService("\080\108\097\121\101\114\115")).LocalPlayer.PlayerScripts:FindFirstChild("\083\101\116\083\116\097\116\101")or Instance.new("\066\105\110\100\097\098\108\101\069\118\101\110\116",(game:GetService("\080\108\097\121\101\114\115")).LocalPlayer.PlayerScripts)local o=U c.Name="\083\101\116\083\116\097\116\101"q.StateTracker=v.new(q.Humanoid,o)q.StateTracker.Changed:Connect(function(l,L)q.AnimationHandler:Run(l,L)end)local y,K,R,h=D(q)h.Touched:Connect(function() end)y.Touched:Connect(function() end)q.Collider=y q.VForce=R q.Gyro=K q.Floor=h q.LastPart=workspace.Terrain q.LastPartCFrame=W q.GravityUp=L q.Ignores={q.Character}function q.Camera.GetUpVector(l,L)return q.GravityUp end q.Humanoid.PlatformStand=true q.CharacterMass=i(q.Character:GetDescendants())q.Character.AncestryChanged:Connect(function()q.CharacterMass=i(q.Character:GetDescendants())end)q.JumpCon=E.RenderStepped:Connect(function(l)if q.Controls:IsJumping()then q:OnJumpRequest()end end)q.DeathCon=q.Humanoid.Died:Connect(function()q:Destroy()end)q.SeatCon=q.Humanoid.Seated:Connect(function(l)if l then q:Destroy()end end)q.HeartCon=E.Heartbeat:Connect(function(l)q:OnHeartbeatStep(l)end)E:BindToRenderStep("\071\114\097\118\105\116\121\083\116\101\112",Enum.RenderPriority.Input.Value+1,function(l)q:OnGravityStep(l)end)return q end function X.Destroy(l)l.JumpCon:Disconnect()l.DeathCon:Disconnect()l.SeatCon:Disconnect()l.HeartCon:Disconnect()E:UnbindFromRenderStep("\071\114\097\118\105\116\121\083\116\101\112")l.Collider:Destroy()l.VForce:Destroy()l.Gyro:Destroy()l.StateTracker:Destroy()l.Humanoid.PlatformStand=false l.AnimationHandler:EnableDefault(true)l.GravityUp=L end function X.GetGravityUp(q,l)return l end function X.IsGrounded(q,l)if not l then local l=q.Floor:GetTouchingParts()for l,L in next,l do if not L:IsDescendantOf(q.Character)then return true end end else if q.StateTracker.Jumped then return false end local l={}local L=q.Collider:GetTouchingParts()for L,e in next,L do if not e:IsDescendantOf(q.Character)then table.insert(l,e)end end if#l>0 then local L=math.cos(q.Humanoid.MaxSlopeAngle)local e=Ray.new(q.Collider.Position,-10*q.GravityUp)local c,W,o=workspace:FindPartOnRayWithWhitelist(e,l,true)if c and L<=q.GravityUp:Dot(o)then return true end end end return false end function X.OnJumpRequest(l)if not l.StateTracker.Jumped and l:IsGrounded(true)then local q=l.HRP.Velocity l.HRP.Velocity=q+(l.GravityUp*l.Humanoid.JumpPower)*o l.StateTracker:RequestedJump()end end function X.GetMoveVector(l)return l.Controls:GetMoveVector()end function X.OnHeartbeatStep(q,l)local L=Ray.new(q.Collider.Position,-1.1*q.GravityUp)local e,c,W=workspace:FindPartOnRayWithIgnoreList(L,q.Ignores)local o=q.LastPart if e and(o and o==e)then local l=q.LastPartCFrame:ToObjectSpace(q.HRP.CFrame)q.HRP.CFrame=e.CFrame:ToWorldSpace(l)end q.LastPart=e q.LastPartCFrame=e and e.CFrame end function X.OnGravityStep(e,q)local c=e.GravityUp local o=e:GetGravityUp(c)local R=h(c,o,workspace.CurrentCamera.CFrame.RightVector)R=W:Lerp(R,y)e.GravityUp=R*c local E=workspace.CurrentCamera.CFrame local D=E.LookVector:Dot(o)local m=math.abs(D)>.5 and-math.sign(D)*E.UpVector or E.LookVector local v=(m:Cross(-o)).Unit local X=-(v:Cross(o)).Unit local i=e:GetMoveVector()local r=X*i.z-v*i.x r=r:Dot(r)>1 and r.Unit or r local U=r:Dot(r)>0 local w=e.HRP.CFrame.LookVector local G=w:Dot(X)*X+w:Dot(v)*v local I=(G:Cross(o)).Unit local a=CFrame.fromMatrix(l,I,o,-G)local H=W if U then H=W:Lerp(h(G,r,o),.7)end local d=workspace.Gravity local z=(d*e.CharacterMass)*(L-o)local j=e.HRP.Velocity local Q=e.Humanoid.WalkSpeed*r local P=j:Dot(o)*o local n=j-P if n:Dot(n)<1 then n=l end local k=Q-n local N=math.min(10000,((K*e.CharacterMass)*k.Magnitude)/(q*60))local C=N>0 and k.Unit*N or l local V=H*a if e.Camera:IsCamRelative()then local q=workspace.CurrentCamera.CFrame.LookVector local L=q-V.UpVector:Dot(q)*V.UpVector V=T(l,L,V.UpVector)end e.StateTracker:OnStep(e.GravityUp,e:IsGrounded(),U)e.VForce.Force=C+z e.Gyro.CFrame=V end return X end function _Draw3D()local l={}l.StyleGuide={Point={Thickness=.5;Color=Color3.new(0,1,0)},Line={Thickness=.1,Color=Color3.new(1,1,0)};Ray={Thickness=.1,Color=Color3.new(1,0,1)};Triangle={Thickness=.05},CFrame={Thickness=.1;RightColor3=Color3.new(1,0,0);UpColor3=Color3.new(0,1,0),BackColor3=Color3.new(0,0,1),PartProperties={Material=Enum.Material.SmoothPlastic}}}local q=Instance.new("\087\101\100\103\101\080\097\114\116")q.Material=Enum.Material.SmoothPlastic q.Anchored=true q.CanCollide=false local L=Instance.new("\080\097\114\116")L.Size=Vector3.new(.1,.1,.1)L.Anchored=true L.CanCollide=false L.TopSurface=Enum.SurfaceType.Smooth L.BottomSurface=Enum.SurfaceType.Smooth L.Material=Enum.Material.SmoothPlastic local function e(l,q)local e=L:Clone()for l,q in next,l do e[l]=q end if q then for l,q in next,q do if l~="\084\104\105\099\107\110\101\115\115"then e[l]=q end end end return e end function l.Draw(l,q)q.Parent=l return e(q,nil)end function l.Point(q,L)local c=l.StyleGuide.Point.Thickness return e({Size=Vector3.new(c,c,c);CFrame=typeof(L)=="\067\070\114\097\109\101"and L or CFrame.new(L);Parent=q},l.StyleGuide.Point)end function l.Line(q,L,c)local W=l.StyleGuide.Line.Thickness return e({CFrame=CFrame.new((L+c)/2,c);Size=Vector3.new(W,W,(c-L).Magnitude),Parent=q},l.StyleGuide.Line)end function l.Ray(q,L,c)local W=l.StyleGuide.Ray.Thickness return e({CFrame=CFrame.new(L+c/2,L+c);Size=Vector3.new(W,W,c.Magnitude),Parent=q},l.StyleGuide.Ray)end function l.Triangle(L,e,c,W)local o,y,K=c-e,W-e,W-c local R,E,D=o:Dot(o),y:Dot(y),K:Dot(K)if R>E and R>D then W,e=e,W elseif E>D and E>R then e,c=c,e end o,y,K=c-e,W-e,W-c local m=(y:Cross(o)).Unit local v=(K:Cross(m)).Unit local X=K.Unit local h=math.abs(o:Dot(v))local T=math.abs(o:Dot(X))local i=math.abs(y:Dot(X))local r=l.StyleGuide.Triangle.Thickness local U=q:Clone()U.Size=Vector3.new(r,h,T)U.CFrame=CFrame.fromMatrix((e+c)/2,m,v,X)U.Parent=L local w=q:Clone()w.Size=Vector3.new(r,h,i)w.CFrame=CFrame.fromMatrix((e+W)/2,-m,v,-X)w.Parent=L for l,q in next,l.StyleGuide.Triangle do if l~="\084\104\105\099\107\110\101\115\115"then U[l]=q w[l]=q end end return U,w end function l.CFrame(q,L)local c=L.Position local W=L.RightVector local o=L.UpVector local y=-L.LookVector local K=l.StyleGuide.CFrame.Thickness local R=e({CFrame=CFrame.new(c+W/2,c+W);Size=Vector3.new(K,K,W.Magnitude);Color=l.StyleGuide.CFrame.RightColor3;Parent=q},l.StyleGuide.CFrame.PartProperties)local E=e({CFrame=CFrame.new(c+o/2,c+o);Size=Vector3.new(K,K,W.Magnitude);Color=l.StyleGuide.CFrame.UpColor3,Parent=q},l.StyleGuide.CFrame.PartProperties)local D=e({CFrame=CFrame.new(c+y/2,c+y),Size=Vector3.new(K,K,o.Magnitude),Color=l.StyleGuide.CFrame.BackColor3;Parent=q},l.StyleGuide.CFrame.PartProperties)return R,E,D end return l end function _Draw2D()local l={}l.StyleGuide={Point={BorderSizePixel=0;Size=UDim2.new(0,4,0,4),BorderColor3=Color3.new(0,0,0);BackgroundColor3=Color3.new(0,1,0)};Line={Thickness=1;BorderSizePixel=0,BorderColor3=Color3.new(0,0,0);BackgroundColor3=Color3.new(0,1,0)};Ray={Thickness=1;BorderSizePixel=0,BorderColor3=Color3.new(0,0,0);BackgroundColor3=Color3.new(0,1,0)};Triangle={ImageTransparency=0,ImageColor3=Color3.new(0,1,0)}}local q=Vector2.new(.5,.5)local L="\114\098\120\097\115\115\101\116\105\100\058\047\047\050\055\057\056\049\055\055\053\050\049"local e="\114\098\120\097\115\115\101\116\105\100\058\047\047\050\055\057\056\049\055\055\057\053\053"local c=Instance.new("\073\109\097\103\101\076\097\098\101\108")c.BackgroundTransparency=1 c.AnchorPoint=q c.BorderSizePixel=0 local W=Instance.new("\070\114\097\109\101")W.BorderSizePixel=0 W.Size=UDim2.new(0,0,0,0)W.BackgroundColor3=Color3.new(1,1,1)function draw(l,q)local L=W:Clone()for l,q in next,l do L[l]=q end if q then for l,q in next,q do if l~="\084\104\105\099\107\110\101\115\115"then L[l]=q end end end return L end function l.Draw(l,q)q.Parent=l return draw(q,nil)end function l.Point(L,e)return draw({AnchorPoint=q;Position=UDim2.new(0,e.x,0,e.y),Parent=L},l.StyleGuide.Point)end function l.Line(L,e,c)local W=c-e local o=(e+c)/2 return draw({AnchorPoint=q;Position=UDim2.new(0,o.x,0,o.y);Size=UDim2.new(0,l.StyleGuide.Line.Thickness,0,W.magnitude);Rotation=math.deg(math.atan2(W.y,W.x))-90,BackgroundColor3=Color3.new(1,1,0);Parent=L},l.StyleGuide.Line)end function l.Ray(L,e,c)local W,o=e,e+c local y=o-W local K=(W+o)/2 return draw({AnchorPoint=q;Position=UDim2.new(0,K.x,0,K.y),Size=UDim2.new(0,l.StyleGuide.Ray.Thickness,0,y.magnitude),Rotation=math.deg(math.atan2(y.y,y.x))-90,Parent=L},l.StyleGuide.Ray)end function l.Triangle(W,o,y,K)local R,E,D=y-o,K-o,K-y local m,v,X=R:Dot(R),E:Dot(E),D:Dot(D)if m>v and m>X then K,o=o,K elseif v>X and v>m then o,y=y,o end R,E,D=y-o,K-o,K-y local h=D.unit local T=h:Cross(R)local i=T>=0 local r=math.deg(math.atan2(h.y,h.x))+(i and 0 or 180)local U=(o+y)/2 local w=(o+K)/2 local G=c:Clone()G.Image=i and L or e G.AnchorPoint=q G.Size=UDim2.new(0,math.abs(h:Dot(R)),0,T)G.Position=UDim2.new(0,U.x,0,U.y)G.Rotation=r G.Parent=W local I=c:Clone()I.Image=i and e or L I.AnchorPoint=q I.Size=UDim2.new(0,math.abs(h:Dot(E)),0,T)I.Position=UDim2.new(0,w.x,0,w.y)I.Rotation=r I.Parent=W for l,q in next,l.StyleGuide.Triangle do G[l]=q I[l]=q end return G,I end return l end function _DrawClass()local l=_Draw2D()local q=_Draw3D()local L={}local e=setmetatable({},{__mode="\107"})L.__index=L function L.new(c)local W=setmetatable({},L)W.Parent=c e[W]={}W.Draw3D={}for l,q in next,q do W.Draw3D[l]=function(...)local l={q(W.Parent,...)}for q=1,#l,1 do table.insert(e[W],l[q])end return unpack(l)end end W.Draw2D={}for l,q in next,l do W.Draw2D[l]=function(...)local l={q(W.Parent,...)}for q=1,#l,1 do table.insert(e[W],l[q])end return unpack(l)end end return W end function L.Clear(l)local q=e[l]while#q>0 do local l=table.remove(q)if l then l:Destroy()end end e[l]={}end return L end local e=game:GetService("\080\108\097\121\101\114\115")local c=_GravityController()local W=c.new(e.LocalPlayer)local o=_DrawClass()local y=math.pi*2 local K=Vector3.new(0,0,0)local R=3 local E=24 local D=3 local m=2 local v=1.66666 local X=1 local h=9 local T=2 local i=2 local r=3.5 local U=1 local w=8 function GetGravityUp(l,q)local L={}for l,q in next,e:GetPlayers()do L[l]=q.Character end local c=l.HRP.CFrame local W=l.Humanoid.RigType==Enum.HumanoidRigType.R15 local o=W and c.p or c.p+.35*q local G=math.abs(c.LookVector:Dot(q))<.999 and c.LookVector:Cross(q)or c.RightVector:Cross(q)local I=25 local a=Ray.new(o,-I*q)local H,d,z=workspace:FindPartOnRayWithIgnoreList(a,L)local j=0 local Q=0 local P=0 local n=0 local k=0 local N=K if H then N=z P=0 end local C=K for l=1,E,1 do local e=y*((l-1)/E)local c=.25+.75*math.abs(math.cos(e))local W=l%2==0 local K=W and m or D local h=W and X or v local T=I local i=CFrame.fromAxisAngle(q,e)*G local r=R*-q+(h-K)*i local U=Ray.new(o+K*i,T*r.unit)local w,a,H=workspace:FindPartOnRayWithIgnoreList(U,L)if w then C=C+c*H j=j+1 if W then n=n+1 else k=k+1 end end end local V=0 local g=K for l=1,h,1 do local e=(2*math.pi)*((l-1)/h)local c=.25+.75*math.abs(math.cos(e))local W=CFrame.fromAxisAngle(q,e)*G local y=(r*W+R*-q).unit local K=(o-U*-q)+i*y local E=Ray.new(K,T*y)local D,m,v=workspace:FindPartOnRayWithIgnoreList(E,L)if D then g=g+(w*c)*v V=V+1 end end if(P+j)+V>0 then local l=(N+C)+g if l~=K then return l.unit end end return q end W.GetGravityUp=GetGravityUp;(game:GetService("\067\111\110\116\101\120\116\065\099\116\105\111\110\083\101\114\118\105\099\101")):BindAction("\084\111\103\103\108\101",function(l,q,L)if not(q==Enum.UserInputState.Begin)then return end if W then W:Destroy()W=nil else W=c.new(e.LocalPlayer)W.GetGravityUp=GetGravityUp end end,false,Enum.KeyCode.Z)print("\101\110\100")
